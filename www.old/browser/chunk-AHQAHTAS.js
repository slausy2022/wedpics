import{$a as Gh,A as ni,B as kr,C as Jt,D as j,F as Nr,K as ri,Na as ci,O as si,Oa as li,Pa as hi,Qa as Ca,Ra as bt,Sa as di,Ta as fi,Ua as mi,Wa as gi,Xa as Uh,Ya as qh,Za as Bh,_a as jh,a as Js,ab as zh,bb as $h,c as kh,cb as Kh,d as Xt,e as xn,g as Nt,ia as Fh,m as Sa,n as Nh,q as Oh,r as Zs,t as ti,w as ei,x as Ra}from"./chunk-QAHDMDZU.js";import{C as Pa,L as B,M as be,P as Zt,Q as Lh,R as ai,S as ui,U as Dn,V as Pe,l as ii,m as Or,q as ba,r as Mh,s as oi}from"./chunk-F4FQDMWJ.js";import{a as Xs,b as va,e as K,f as Aa,g as p}from"./chunk-EGHARNWC.js";var D_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},$t={},A,Xa=Xa||{},V=D_||self;function Ci(n){var t=typeof n;return t=t!="object"?t:n?Array.isArray(n)?"array":t:"null",t=="array"||t=="object"&&typeof n.length=="number"}function Hr(n){var t=typeof n;return t=="object"&&n!=null||t=="function"}function V_(n){return Object.prototype.hasOwnProperty.call(n,xa)&&n[xa]||(n[xa]=++k_)}var xa="closure_uid_"+(1e9*Math.random()>>>0),k_=0;function N_(n,t,e){return n.call.apply(n.bind,arguments)}function O_(n,t,e){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var s=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(s,r),n.apply(t,s)}}return function(){return n.apply(t,arguments)}}function Et(n,t,e){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?Et=N_:Et=O_,Et.apply(null,arguments)}function pi(n,t){var e=Array.prototype.slice.call(arguments,1);return function(){var r=e.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function gt(n,t){function e(){}e.prototype=t.prototype,n.$=t.prototype,n.prototype=new e,n.prototype.constructor=n,n.ac=function(r,s,i){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return t.prototype[s].apply(r,o)}}function Ce(){this.s=this.s,this.o=this.o}var F_=0;Ce.prototype.s=!1;Ce.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),F_!=0)&&V_(this)};Ce.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var id=Array.prototype.indexOf?function(n,t){return Array.prototype.indexOf.call(n,t,void 0)}:function(n,t){if(typeof n=="string")return typeof t!="string"||t.length!=1?-1:n.indexOf(t,0);for(let e=0;e<n.length;e++)if(e in n&&n[e]===t)return e;return-1};function Ja(n){let t=n.length;if(0<t){let e=Array(t);for(let r=0;r<t;r++)e[r]=n[r];return e}return[]}function Qh(n,t){for(let e=1;e<arguments.length;e++){let r=arguments[e];if(Ci(r)){let s=n.length||0,i=r.length||0;n.length=s+i;for(let o=0;o<i;o++)n[s+o]=r[o]}else n.push(r)}}function vt(n,t){this.type=n,this.g=this.target=t,this.defaultPrevented=!1}vt.prototype.h=function(){this.defaultPrevented=!0};var M_=function(){if(!V.addEventListener||!Object.defineProperty)return!1;var n=!1,t=Object.defineProperty({},"passive",{get:function(){n=!0}});try{let e=()=>{};V.addEventListener("test",e,t),V.removeEventListener("test",e,t)}catch{}return n}();function Br(n){return/^[\s\xa0]*$/.test(n)}function xi(){var n=V.navigator;return n&&(n=n.userAgent)?n:""}function te(n){return xi().indexOf(n)!=-1}function Za(n){return Za[" "](n),n}Za[" "]=function(){};function L_(n,t){var e=Ry;return Object.prototype.hasOwnProperty.call(e,n)?e[n]:e[n]=t(n)}var U_=te("Opera"),On=te("Trident")||te("MSIE"),od=te("Edge"),Oa=od||On,ad=te("Gecko")&&!(xi().toLowerCase().indexOf("webkit")!=-1&&!te("Edge"))&&!(te("Trident")||te("MSIE"))&&!te("Edge"),q_=xi().toLowerCase().indexOf("webkit")!=-1&&!te("Edge");function ud(){var n=V.document;return n?n.documentMode:void 0}var Fa;t:{if(_i="",yi=function(){var n=xi();if(ad)return/rv:([^\);]+)(\)|;)/.exec(n);if(od)return/Edge\/([\d\.]+)/.exec(n);if(On)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(q_)return/WebKit\/(\S+)/.exec(n);if(U_)return/(?:Version)[ \/]?(\S+)/.exec(n)}(),yi&&(_i=yi?yi[1]:""),On&&(wi=ud(),wi!=null&&wi>parseFloat(_i))){Fa=String(wi);break t}Fa=_i}var _i,yi,wi,Ma;V.document&&On?(Da=ud(),Ma=Da||parseInt(Fa,10)||void 0):Ma=void 0;var Da,B_=Ma;function jr(n,t){if(vt.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var e=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=t,t=n.relatedTarget){if(ad){t:{try{Za(t.nodeName);var s=!0;break t}catch{}s=!1}s||(t=null)}}else e=="mouseover"?t=n.fromElement:e=="mouseout"&&(t=n.toElement);this.relatedTarget=t,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:j_[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&jr.$.h.call(this)}}gt(jr,vt);var j_={2:"touch",3:"pen",4:"mouse"};jr.prototype.h=function(){jr.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Yr="closure_listenable_"+(1e6*Math.random()|0),G_=0;function z_(n,t,e,r,s){this.listener=n,this.proxy=null,this.src=t,this.type=e,this.capture=!!r,this.la=s,this.key=++G_,this.fa=this.ia=!1}function Di(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function tu(n,t,e){for(let r in n)t.call(e,n[r],r,n)}function $_(n,t){for(let e in n)t.call(void 0,n[e],e,n)}function cd(n){let t={};for(let e in n)t[e]=n[e];return t}var Wh="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ld(n,t){let e,r;for(let s=1;s<arguments.length;s++){r=arguments[s];for(e in r)n[e]=r[e];for(let i=0;i<Wh.length;i++)e=Wh[i],Object.prototype.hasOwnProperty.call(r,e)&&(n[e]=r[e])}}function Vi(n){this.src=n,this.g={},this.h=0}Vi.prototype.add=function(n,t,e,r,s){var i=n.toString();n=this.g[i],n||(n=this.g[i]=[],this.h++);var o=Ua(n,t,r,s);return-1<o?(t=n[o],e||(t.ia=!1)):(t=new z_(t,this.src,i,!!r,s),t.ia=e,n.push(t)),t};function La(n,t){var e=t.type;if(e in n.g){var r=n.g[e],s=id(r,t),i;(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(Di(t),n.g[e].length==0&&(delete n.g[e],n.h--))}}function Ua(n,t,e,r){for(var s=0;s<n.length;++s){var i=n[s];if(!i.fa&&i.listener==t&&i.capture==!!e&&i.la==r)return s}return-1}var eu="closure_lm_"+(1e6*Math.random()|0),Va={};function hd(n,t,e,r,s){if(r&&r.once)return fd(n,t,e,r,s);if(Array.isArray(t)){for(var i=0;i<t.length;i++)hd(n,t[i],e,r,s);return null}return e=su(e),n&&n[Yr]?n.O(t,e,Hr(r)?!!r.capture:!!r,s):dd(n,t,e,!1,r,s)}function dd(n,t,e,r,s,i){if(!t)throw Error("Invalid event type");var o=Hr(s)?!!s.capture:!!s,a=ru(n);if(a||(n[eu]=a=new Vi(n)),e=a.add(t,e,r,o,i),e.proxy)return e;if(r=K_(),e.proxy=r,r.src=n,r.listener=e,n.addEventListener)M_||(s=o),s===void 0&&(s=!1),n.addEventListener(t.toString(),r,s);else if(n.attachEvent)n.attachEvent(gd(t.toString()),r);else if(n.addListener&&n.removeListener)n.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return e}function K_(){function n(e){return t.call(n.src,n.listener,e)}let t=Q_;return n}function fd(n,t,e,r,s){if(Array.isArray(t)){for(var i=0;i<t.length;i++)fd(n,t[i],e,r,s);return null}return e=su(e),n&&n[Yr]?n.P(t,e,Hr(r)?!!r.capture:!!r,s):dd(n,t,e,!0,r,s)}function md(n,t,e,r,s){if(Array.isArray(t))for(var i=0;i<t.length;i++)md(n,t[i],e,r,s);else r=Hr(r)?!!r.capture:!!r,e=su(e),n&&n[Yr]?(n=n.i,t=String(t).toString(),t in n.g&&(i=n.g[t],e=Ua(i,e,r,s),-1<e&&(Di(i[e]),Array.prototype.splice.call(i,e,1),i.length==0&&(delete n.g[t],n.h--)))):n&&(n=ru(n))&&(t=n.g[t.toString()],n=-1,t&&(n=Ua(t,e,r,s)),(e=-1<n?t[n]:null)&&nu(e))}function nu(n){if(typeof n!="number"&&n&&!n.fa){var t=n.src;if(t&&t[Yr])La(t.i,n);else{var e=n.type,r=n.proxy;t.removeEventListener?t.removeEventListener(e,r,n.capture):t.detachEvent?t.detachEvent(gd(e),r):t.addListener&&t.removeListener&&t.removeListener(r),(e=ru(t))?(La(e,n),e.h==0&&(e.src=null,t[eu]=null)):Di(n)}}}function gd(n){return n in Va?Va[n]:Va[n]="on"+n}function Q_(n,t){if(n.fa)n=!0;else{t=new jr(t,this);var e=n.listener,r=n.la||n.src;n.ia&&nu(n),n=e.call(r,t)}return n}function ru(n){return n=n[eu],n instanceof Vi?n:null}var ka="__closure_events_fn_"+(1e9*Math.random()>>>0);function su(n){return typeof n=="function"?n:(n[ka]||(n[ka]=function(t){return n.handleEvent(t)}),n[ka])}function mt(){Ce.call(this),this.i=new Vi(this),this.S=this,this.J=null}gt(mt,Ce);mt.prototype[Yr]=!0;mt.prototype.removeEventListener=function(n,t,e,r){md(this,n,t,e,r)};function wt(n,t){var e,r=n.J;if(r)for(e=[];r;r=r.J)e.push(r);if(n=n.S,r=t.type||t,typeof t=="string")t=new vt(t,n);else if(t instanceof vt)t.target=t.target||n;else{var s=t;t=new vt(r,n),ld(t,s)}if(s=!0,e)for(var i=e.length-1;0<=i;i--){var o=t.g=e[i];s=Ti(o,r,!0,t)&&s}if(o=t.g=n,s=Ti(o,r,!0,t)&&s,s=Ti(o,r,!1,t)&&s,e)for(i=0;i<e.length;i++)o=t.g=e[i],s=Ti(o,r,!1,t)&&s}mt.prototype.N=function(){if(mt.$.N.call(this),this.i){var n=this.i,t;for(t in n.g){for(var e=n.g[t],r=0;r<e.length;r++)Di(e[r]);delete n.g[t],n.h--}}this.J=null};mt.prototype.O=function(n,t,e,r){return this.i.add(String(n),t,!1,e,r)};mt.prototype.P=function(n,t,e,r){return this.i.add(String(n),t,!0,e,r)};function Ti(n,t,e,r){if(t=n.i.g[String(t)],!t)return!0;t=t.concat();for(var s=!0,i=0;i<t.length;++i){var o=t[i];if(o&&!o.fa&&o.capture==e){var a=o.listener,u=o.la||o.src;o.ia&&La(n.i,o),s=a.call(u,r)!==!1&&s}}return s&&!r.defaultPrevented}var iu=V.JSON.stringify,qa=class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}};function W_(){var n=ou;let t=null;return n.g&&(t=n.g,n.g=n.g.next,n.g||(n.h=null),t.next=null),t}var Ba=class{constructor(){this.h=this.g=null}add(t,e){let r=pd.get();r.set(t,e),this.h?this.h.next=r:this.g=r,this.h=r}},pd=new qa(()=>new ja,n=>n.reset()),ja=class{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}};function H_(n){var t=1;n=n.split(":");let e=[];for(;0<t&&n.length;)e.push(n.shift()),t--;return n.length&&e.push(n.join(":")),e}function Y_(n){V.setTimeout(()=>{throw n},0)}var Gr,zr=!1,ou=new Ba,_d=()=>{let n=V.Promise.resolve(void 0);Gr=()=>{n.then(X_)}},X_=()=>{for(var n;n=W_();){try{n.h.call(n.g)}catch(e){Y_(e)}var t=pd;t.j(n),100>t.h&&(t.h++,n.next=t.g,t.g=n)}zr=!1};function ki(n,t){mt.call(this),this.h=n||1,this.g=t||V,this.j=Et(this.qb,this),this.l=Date.now()}gt(ki,mt);A=ki.prototype;A.ga=!1;A.T=null;A.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),wt(this,"tick"),this.ga&&(au(this),this.start()))}};A.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function au(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}A.N=function(){ki.$.N.call(this),au(this),delete this.g};function uu(n,t,e){if(typeof n=="function")e&&(n=Et(n,e));else if(n&&typeof n.handleEvent=="function")n=Et(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(t)?-1:V.setTimeout(n,t||0)}function yd(n){n.g=uu(()=>{n.g=null,n.i&&(n.i=!1,yd(n))},n.j);let t=n.h;n.h=null,n.m.apply(null,t)}var Ga=class extends Ce{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:yd(this)}N(){super.N(),this.g&&(V.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function $r(n){Ce.call(this),this.h=n,this.g={}}gt($r,Ce);var Hh=[];function wd(n,t,e,r){Array.isArray(e)||(e&&(Hh[0]=e.toString()),e=Hh);for(var s=0;s<e.length;s++){var i=hd(t,e[s],r||n.handleEvent,!1,n.h||n);if(!i)break;n.g[i.key]=i}}function Td(n){tu(n.g,function(t,e){this.g.hasOwnProperty(e)&&nu(t)},n),n.g={}}$r.prototype.N=function(){$r.$.N.call(this),Td(this)};$r.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Ni(){this.g=!0}Ni.prototype.Ea=function(){this.g=!1};function J_(n,t,e,r,s,i){n.info(function(){if(n.g)if(i)for(var o="",a=i.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&h[1]=="type"?o+(l+"="+c+"&"):o+(l+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+t+`
`+e+`
`+o})}function Z_(n,t,e,r,s,i,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+t+`
`+e+`
`+i+" "+o})}function kn(n,t,e,r){n.info(function(){return"XMLHTTP TEXT ("+t+"): "+ey(n,e)+(r?" "+r:"")})}function ty(n,t){n.info(function(){return"TIMEOUT: "+t})}Ni.prototype.info=function(){};function ey(n,t){if(!n.g)return t;if(!t)return null;try{var e=JSON.parse(t);if(e){for(n=0;n<e.length;n++)if(Array.isArray(e[n])){var r=e[n];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if(i!="noop"&&i!="stop"&&i!="close")for(var o=1;o<s.length;o++)s[o]=""}}}}return iu(e)}catch{return t}}var Ze={},Yh=null;function Oi(){return Yh=Yh||new mt}Ze.Ta="serverreachability";function Id(n){vt.call(this,Ze.Ta,n)}gt(Id,vt);function Kr(n){let t=Oi();wt(t,new Id(t))}Ze.STAT_EVENT="statevent";function Ed(n,t){vt.call(this,Ze.STAT_EVENT,n),this.stat=t}gt(Ed,vt);function Pt(n){let t=Oi();wt(t,new Ed(t,n))}Ze.Ua="timingevent";function vd(n,t){vt.call(this,Ze.Ua,n),this.size=t}gt(vd,vt);function Xr(n,t){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return V.setTimeout(function(){n()},t)}var Fi={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Ad={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function cu(){}cu.prototype.h=null;function Xh(n){return n.h||(n.h=n.i())}function Sd(){}var Jr={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function lu(){vt.call(this,"d")}gt(lu,vt);function hu(){vt.call(this,"c")}gt(hu,vt);var za;function Mi(){}gt(Mi,cu);Mi.prototype.g=function(){return new XMLHttpRequest};Mi.prototype.i=function(){return{}};za=new Mi;function Zr(n,t,e,r){this.l=n,this.j=t,this.m=e,this.W=r||1,this.U=new $r(this),this.P=ny,n=Oa?125:void 0,this.V=new ki(n),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Rd}function Rd(){this.i=null,this.g="",this.h=!1}var ny=45e3,bd={},$a={};A=Zr.prototype;A.setTimeout=function(n){this.P=n};function Ka(n,t,e){n.L=1,n.A=Ui(pe(t)),n.u=e,n.S=!0,Pd(n,null)}function Pd(n,t){n.G=Date.now(),ts(n),n.B=pe(n.A);var e=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),Fd(e.i,"t",r),n.o=0,e=n.l.J,n.h=new Rd,n.g=rf(n.l,e?t:null,!n.u),0<n.O&&(n.M=new Ga(Et(n.Pa,n,n.g),n.O)),wd(n.U,n.g,"readystatechange",n.nb),t=n.I?cd(n.I):{},n.u?(n.v||(n.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,t)):(n.v="GET",n.g.ha(n.B,n.v,null,t)),Kr(),J_(n.j,n.v,n.B,n.m,n.W,n.u)}A.nb=function(n){n=n.target;let t=this.M;t&&ee(n)==3?t.l():this.Pa(n)};A.Pa=function(n){try{if(n==this.g)t:{let l=ee(this.g);var t=this.g.Ia();let h=this.g.da();if(!(3>l)&&(l!=3||Oa||this.g&&(this.h.h||this.g.ja()||ed(this.g)))){this.J||l!=4||t==7||(t==8||0>=h?Kr(3):Kr(2)),Li(this);var e=this.g.da();this.ca=e;e:if(Cd(this)){var r=ed(this.g);n="";var s=r.length,i=ee(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ye(this),qr(this);var o="";break e}this.h.i=new V.TextDecoder}for(t=0;t<s;t++)this.h.h=!0,n+=this.h.i.decode(r[t],{stream:i&&t==s-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=e==200,Z_(this.j,this.v,this.B,this.m,this.W,l,e),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Br(a)){var c=a;break e}}c=null}if(e=c)kn(this.j,this.m,e,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Qa(this,e);else{this.i=!1,this.s=3,Pt(12),Ye(this),qr(this);break t}}this.S?(xd(this,l,o),Oa&&this.i&&l==3&&(wd(this.U,this.V,"tick",this.mb),this.V.start())):(kn(this.j,this.m,o,null),Qa(this,o)),l==4&&Ye(this),this.i&&!this.J&&(l==4?Zd(this.l,this):(this.i=!1,ts(this)))}else vy(this.g),e==400&&0<o.indexOf("Unknown SID")?(this.s=3,Pt(12)):(this.s=0,Pt(13)),Ye(this),qr(this)}}}catch{}finally{}};function Cd(n){return n.g?n.v=="GET"&&n.L!=2&&n.l.Ha:!1}function xd(n,t,e){let r=!0,s;for(;!n.J&&n.o<e.length;)if(s=ry(n,e),s==$a){t==4&&(n.s=4,Pt(14),r=!1),kn(n.j,n.m,null,"[Incomplete Response]");break}else if(s==bd){n.s=4,Pt(15),kn(n.j,n.m,e,"[Invalid Chunk]"),r=!1;break}else kn(n.j,n.m,s,null),Qa(n,s);Cd(n)&&n.o!=0&&(n.h.g=n.h.g.slice(n.o),n.o=0),t!=4||e.length!=0||n.h.h||(n.s=1,Pt(16),r=!1),n.i=n.i&&r,r?0<e.length&&!n.ba&&(n.ba=!0,t=n.l,t.g==n&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+e.length),_u(t),t.M=!0,Pt(11))):(kn(n.j,n.m,e,"[Invalid Chunked Response]"),Ye(n),qr(n))}A.mb=function(){if(this.g){var n=ee(this.g),t=this.g.ja();this.o<t.length&&(Li(this),xd(this,n,t),this.i&&n!=4&&ts(this))}};function ry(n,t){var e=n.o,r=t.indexOf(`
`,e);return r==-1?$a:(e=Number(t.substring(e,r)),isNaN(e)?bd:(r+=1,r+e>t.length?$a:(t=t.slice(r,r+e),n.o=r+e,t)))}A.cancel=function(){this.J=!0,Ye(this)};function ts(n){n.Y=Date.now()+n.P,Dd(n,n.P)}function Dd(n,t){if(n.C!=null)throw Error("WatchDog timer not null");n.C=Xr(Et(n.lb,n),t)}function Li(n){n.C&&(V.clearTimeout(n.C),n.C=null)}A.lb=function(){this.C=null;let n=Date.now();0<=n-this.Y?(ty(this.j,this.B),this.L!=2&&(Kr(),Pt(17)),Ye(this),this.s=2,qr(this)):Dd(this,this.Y-n)};function qr(n){n.l.H==0||n.J||Zd(n.l,n)}function Ye(n){Li(n);var t=n.M;t&&typeof t.sa=="function"&&t.sa(),n.M=null,au(n.V),Td(n.U),n.g&&(t=n.g,n.g=null,t.abort(),t.sa())}function Qa(n,t){try{var e=n.l;if(e.H!=0&&(e.g==n||Wa(e.i,n))){if(!n.K&&Wa(e.i,n)&&e.H==3){try{var r=e.Ja.g.parse(t)}catch{r=null}if(Array.isArray(r)&&r.length==3){var s=r;if(s[0]==0){t:if(!e.u){if(e.g)if(e.g.G+3e3<n.G)Si(e),ji(e);else break t;pu(e),Pt(18)}}else e.Fa=s[1],0<e.Fa-e.V&&37500>s[2]&&e.G&&e.A==0&&!e.v&&(e.v=Xr(Et(e.ib,e),6e3));if(1>=Ud(e.i)&&e.oa){try{e.oa()}catch{}e.oa=void 0}}else Xe(e,11)}else if((n.K||e.g==n)&&Si(e),!Br(t))for(s=e.Ja.g.parse(t),t=0;t<s.length;t++){let c=s[t];if(e.V=c[0],c=c[1],e.H==2)if(c[0]=="c"){e.K=c[1],e.pa=c[2];let l=c[3];l!=null&&(e.ra=l,e.l.info("VER="+e.ra));let h=c[4];h!=null&&(e.Ga=h,e.l.info("SVER="+e.Ga));let d=c[5];d!=null&&typeof d=="number"&&0<d&&(r=1.5*d,e.L=r,e.l.info("backChannelRequestTimeoutMs_="+r)),r=e;let f=n.g;if(f){let T=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(T){var i=r.i;i.g||T.indexOf("spdy")==-1&&T.indexOf("quic")==-1&&T.indexOf("h2")==-1||(i.j=i.l,i.g=new Set,i.h&&(du(i,i.h),i.h=null))}if(r.F){let I=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;I&&(r.Da=I,W(r.I,r.F,I))}}e.H=3,e.h&&e.h.Ba(),e.ca&&(e.S=Date.now()-n.G,e.l.info("Handshake RTT: "+e.S+"ms")),r=e;var o=n;if(r.wa=nf(r,r.J?r.pa:null,r.Y),o.K){qd(r.i,o);var a=o,u=r.L;u&&a.setTimeout(u),a.C&&(Li(a),ts(a)),r.g=o}else Xd(r);0<e.j.length&&Gi(e)}else c[0]!="stop"&&c[0]!="close"||Xe(e,7);else e.H==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?Xe(e,7):gu(e):c[0]!="noop"&&e.h&&e.h.Aa(c),e.A=0)}}Kr(4)}catch{}}function sy(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(Ci(n)){for(var t=[],e=n.length,r=0;r<e;r++)t.push(n[r]);return t}t=[],e=0;for(r in n)t[e++]=n[r];return t}function iy(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(Ci(n)||typeof n=="string"){var t=[];n=n.length;for(var e=0;e<n;e++)t.push(e);return t}t=[],e=0;for(let r in n)t[e++]=r;return t}}}function Vd(n,t){if(n.forEach&&typeof n.forEach=="function")n.forEach(t,void 0);else if(Ci(n)||typeof n=="string")Array.prototype.forEach.call(n,t,void 0);else for(var e=iy(n),r=sy(n),s=r.length,i=0;i<s;i++)t.call(void 0,r[i],e&&e[i],n)}var kd=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function oy(n,t){if(n){n=n.split("&");for(var e=0;e<n.length;e++){var r=n[e].indexOf("="),s=null;if(0<=r){var i=n[e].substring(0,r);s=n[e].substring(r+1)}else i=n[e];t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}function Je(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Je){this.h=n.h,vi(this,n.j),this.s=n.s,this.g=n.g,Ai(this,n.m),this.l=n.l;var t=n.i,e=new Qr;e.i=t.i,t.g&&(e.g=new Map(t.g),e.h=t.h),Jh(this,e),this.o=n.o}else n&&(t=String(n).match(kd))?(this.h=!1,vi(this,t[1]||"",!0),this.s=Lr(t[2]||""),this.g=Lr(t[3]||"",!0),Ai(this,t[4]),this.l=Lr(t[5]||"",!0),Jh(this,t[6]||"",!0),this.o=Lr(t[7]||"")):(this.h=!1,this.i=new Qr(null,this.h))}Je.prototype.toString=function(){var n=[],t=this.j;t&&n.push(Ur(t,Zh,!0),":");var e=this.g;return(e||t=="file")&&(n.push("//"),(t=this.s)&&n.push(Ur(t,Zh,!0),"@"),n.push(encodeURIComponent(String(e)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e=this.m,e!=null&&n.push(":",String(e))),(e=this.l)&&(this.g&&e.charAt(0)!="/"&&n.push("/"),n.push(Ur(e,e.charAt(0)=="/"?cy:uy,!0))),(e=this.i.toString())&&n.push("?",e),(e=this.o)&&n.push("#",Ur(e,hy)),n.join("")};function pe(n){return new Je(n)}function vi(n,t,e){n.j=e?Lr(t,!0):t,n.j&&(n.j=n.j.replace(/:$/,""))}function Ai(n,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);n.m=t}else n.m=null}function Jh(n,t,e){t instanceof Qr?(n.i=t,dy(n.i,n.h)):(e||(t=Ur(t,ly)),n.i=new Qr(t,n.h))}function W(n,t,e){n.i.set(t,e)}function Ui(n){return W(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Lr(n,t){return n?t?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Ur(n,t,e){return typeof n=="string"?(n=encodeURI(n).replace(t,ay),e&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function ay(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var Zh=/[#\/\?@]/g,uy=/[#\?:]/g,cy=/[#\?]/g,ly=/[#\?@]/g,hy=/#/g;function Qr(n,t){this.h=this.g=null,this.i=n||null,this.j=!!t}function xe(n){n.g||(n.g=new Map,n.h=0,n.i&&oy(n.i,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}A=Qr.prototype;A.add=function(n,t){xe(this),this.i=null,n=Fn(this,n);var e=this.g.get(n);return e||this.g.set(n,e=[]),e.push(t),this.h+=1,this};function Nd(n,t){xe(n),t=Fn(n,t),n.g.has(t)&&(n.i=null,n.h-=n.g.get(t).length,n.g.delete(t))}function Od(n,t){return xe(n),t=Fn(n,t),n.g.has(t)}A.forEach=function(n,t){xe(this),this.g.forEach(function(e,r){e.forEach(function(s){n.call(t,s,r,this)},this)},this)};A.ta=function(){xe(this);let n=Array.from(this.g.values()),t=Array.from(this.g.keys()),e=[];for(let r=0;r<t.length;r++){let s=n[r];for(let i=0;i<s.length;i++)e.push(t[r])}return e};A.Z=function(n){xe(this);let t=[];if(typeof n=="string")Od(this,n)&&(t=t.concat(this.g.get(Fn(this,n))));else{n=Array.from(this.g.values());for(let e=0;e<n.length;e++)t=t.concat(n[e])}return t};A.set=function(n,t){return xe(this),this.i=null,n=Fn(this,n),Od(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[t]),this.h+=1,this};A.get=function(n,t){return n?(n=this.Z(n),0<n.length?String(n[0]):t):t};function Fd(n,t,e){Nd(n,t),0<e.length&&(n.i=null,n.g.set(Fn(n,t),Ja(e)),n.h+=e.length)}A.toString=function(){if(this.i)return this.i;if(!this.g)return"";let n=[],t=Array.from(this.g.keys());for(var e=0;e<t.length;e++){var r=t[e];let i=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var s=i;o[r]!==""&&(s+="="+encodeURIComponent(String(o[r]))),n.push(s)}}return this.i=n.join("&")};function Fn(n,t){return t=String(t),n.j&&(t=t.toLowerCase()),t}function dy(n,t){t&&!n.j&&(xe(n),n.i=null,n.g.forEach(function(e,r){var s=r.toLowerCase();r!=s&&(Nd(this,r),Fd(this,s,e))},n)),n.j=t}var fy=class{constructor(n,t){this.g=n,this.map=t}};function Md(n){this.l=n||my,V.PerformanceNavigationTiming?(n=V.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(V.g&&V.g.Ka&&V.g.Ka()&&V.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var my=10;function Ld(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function Ud(n){return n.h?1:n.g?n.g.size:0}function Wa(n,t){return n.h?n.h==t:n.g?n.g.has(t):!1}function du(n,t){n.g?n.g.add(t):n.h=t}function qd(n,t){n.h&&n.h==t?n.h=null:n.g&&n.g.has(t)&&n.g.delete(t)}Md.prototype.cancel=function(){if(this.i=Bd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let n of this.g.values())n.cancel();this.g.clear()}};function Bd(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let t=n.i;for(let e of n.g.values())t=t.concat(e.F);return t}return Ja(n.i)}var gy=class{stringify(n){return V.JSON.stringify(n,void 0)}parse(n){return V.JSON.parse(n,void 0)}};function py(){this.g=new gy}function _y(n,t,e){let r=e||"";try{Vd(n,function(s,i){let o=s;Hr(s)&&(o=iu(s)),t.push(r+i+"="+encodeURIComponent(o))})}catch(s){throw t.push(r+"type="+encodeURIComponent("_badmap")),s}}function yy(n,t){let e=new Ni;if(V.Image){let r=new Image;r.onload=pi(Ii,e,r,"TestLoadImage: loaded",!0,t),r.onerror=pi(Ii,e,r,"TestLoadImage: error",!1,t),r.onabort=pi(Ii,e,r,"TestLoadImage: abort",!1,t),r.ontimeout=pi(Ii,e,r,"TestLoadImage: timeout",!1,t),V.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else t(!1)}function Ii(n,t,e,r,s){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,s(r)}catch{}}function es(n){this.l=n.ec||null,this.j=n.ob||!1}gt(es,cu);es.prototype.g=function(){return new qi(this.l,this.j)};es.prototype.i=function(n){return function(){return n}}({});function qi(n,t){mt.call(this),this.F=n,this.u=t,this.m=void 0,this.readyState=fu,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}gt(qi,mt);var fu=0;A=qi.prototype;A.open=function(n,t){if(this.readyState!=fu)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=t,this.readyState=1,Wr(this)};A.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(t.body=n),(this.F||V).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))};A.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ns(this)),this.readyState=fu};A.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Wr(this)),this.g&&(this.readyState=3,Wr(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof V.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;jd(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function jd(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}A.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var t=n.value?n.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!n.done}))&&(this.response=this.responseText+=t)}n.done?ns(this):Wr(this),this.readyState==3&&jd(this)}};A.Za=function(n){this.g&&(this.response=this.responseText=n,ns(this))};A.Ya=function(n){this.g&&(this.response=n,ns(this))};A.ka=function(){this.g&&ns(this)};function ns(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Wr(n)}A.setRequestHeader=function(n,t){this.v.append(n,t)};A.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};A.getAllResponseHeaders=function(){if(!this.h)return"";let n=[],t=this.h.entries();for(var e=t.next();!e.done;)e=e.value,n.push(e[0]+": "+e[1]),e=t.next();return n.join(`\r
`)};function Wr(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(qi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var wy=V.JSON.parse;function et(n){mt.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Gd,this.L=this.M=!1}gt(et,mt);var Gd="",Ty=/^https?$/i,Iy=["POST","PUT"];A=et.prototype;A.Oa=function(n){this.M=n};A.ha=function(n,t,e,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);t=t?t.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():za.g(),this.C=this.u?Xh(this.u):Xh(za),this.g.onreadystatechange=Et(this.La,this);try{this.G=!0,this.g.open(t,String(n),!0),this.G=!1}catch(i){td(this,i);return}if(n=e||"",e=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)e.set(s,r[s]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(let i of r.keys())e.set(i,r.get(i));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(e.keys()).find(i=>i.toLowerCase()=="content-type"),s=V.FormData&&n instanceof V.FormData,!(0<=id(Iy,t))||r||s||e.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[i,o]of e)this.g.setRequestHeader(i,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Kd(this),0<this.B&&((this.L=Ey(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Et(this.ua,this)):this.A=uu(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(i){td(this,i)}};function Ey(n){return On&&typeof n.timeout=="number"&&n.ontimeout!==void 0}A.ua=function(){typeof Xa<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,wt(this,"timeout"),this.abort(8))};function td(n,t){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=t,n.m=5,zd(n),Bi(n)}function zd(n){n.F||(n.F=!0,wt(n,"complete"),wt(n,"error"))}A.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,wt(this,"complete"),wt(this,"abort"),Bi(this))};A.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Bi(this,!0)),et.$.N.call(this)};A.La=function(){this.s||(this.G||this.v||this.l?$d(this):this.kb())};A.kb=function(){$d(this)};function $d(n){if(n.h&&typeof Xa<"u"&&(!n.C[1]||ee(n)!=4||n.da()!=2)){if(n.v&&ee(n)==4)uu(n.La,0,n);else if(wt(n,"readystatechange"),ee(n)==4){n.h=!1;try{let o=n.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break t;default:t=!1}var e;if(!(e=t)){var r;if(r=o===0){var s=String(n.I).match(kd)[1]||null;!s&&V.self&&V.self.location&&(s=V.self.location.protocol.slice(0,-1)),r=!Ty.test(s?s.toLowerCase():"")}e=r}if(e)wt(n,"complete"),wt(n,"success");else{n.m=6;try{var i=2<ee(n)?n.g.statusText:""}catch{i=""}n.j=i+" ["+n.da()+"]",zd(n)}}finally{Bi(n)}}}}function Bi(n,t){if(n.g){Kd(n);let e=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,t||wt(n,"ready");try{e.onreadystatechange=r}catch{}}}function Kd(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(V.clearTimeout(n.A),n.A=null)}A.isActive=function(){return!!this.g};function ee(n){return n.g?n.g.readyState:0}A.da=function(){try{return 2<ee(this)?this.g.status:-1}catch{return-1}};A.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};A.Wa=function(n){if(this.g){var t=this.g.responseText;return n&&t.indexOf(n)==0&&(t=t.substring(n.length)),wy(t)}};function ed(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case Gd:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function vy(n){let t={};n=(n.g&&2<=ee(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<n.length;r++){if(Br(n[r]))continue;var e=H_(n[r]);let s=e[0];if(e=e[1],typeof e!="string")continue;e=e.trim();let i=t[s]||[];t[s]=i,i.push(e)}$_(t,function(r){return r.join(", ")})}A.Ia=function(){return this.m};A.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function Qd(n){let t="";return tu(n,function(e,r){t+=r,t+=":",t+=e,t+=`\r
`}),t}function mu(n,t,e){t:{for(r in e){var r=!1;break t}r=!0}r||(e=Qd(e),typeof n=="string"?e!=null&&encodeURIComponent(String(e)):W(n,t,e))}function Fr(n,t,e){return e&&e.internalChannelParams&&e.internalChannelParams[n]||t}function Wd(n){this.Ga=0,this.j=[],this.l=new Ni,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Fr("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Fr("baseRetryDelayMs",5e3,n),this.hb=Fr("retryDelaySeedMs",1e4,n),this.eb=Fr("forwardChannelMaxRetries",2,n),this.xa=Fr("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new Md(n&&n.concurrentRequestLimit),this.Ja=new py,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}A=Wd.prototype;A.ra=8;A.H=1;function gu(n){if(Hd(n),n.H==3){var t=n.W++,e=pe(n.I);if(W(e,"SID",n.K),W(e,"RID",t),W(e,"TYPE","terminate"),rs(n,e),t=new Zr(n,n.l,t),t.L=2,t.A=Ui(pe(e)),e=!1,V.navigator&&V.navigator.sendBeacon)try{e=V.navigator.sendBeacon(t.A.toString(),"")}catch{}!e&&V.Image&&(new Image().src=t.A,e=!0),e||(t.g=rf(t.l,null),t.g.ha(t.A)),t.G=Date.now(),ts(t)}ef(n)}function ji(n){n.g&&(_u(n),n.g.cancel(),n.g=null)}function Hd(n){ji(n),n.u&&(V.clearTimeout(n.u),n.u=null),Si(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&V.clearTimeout(n.m),n.m=null)}function Gi(n){if(!Ld(n.i)&&!n.m){n.m=!0;var t=n.Na;Gr||_d(),zr||(Gr(),zr=!0),ou.add(t,n),n.C=0}}function Ay(n,t){return Ud(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=t.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=Xr(Et(n.Na,n,t),tf(n,n.C)),n.C++,!0)}A.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;let s=new Zr(this,this.l,n),i=this.s;if(this.U&&(i?(i=cd(i),ld(i,this.U)):i=this.U),this.o!==null||this.O||(s.I=i,i=null),this.P)t:{for(var t=0,e=0;e<this.j.length;e++){e:{var r=this.j[e];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break e}r=void 0}if(r===void 0)break;if(t+=r,4096<t){t=e;break t}if(t===4096||e===this.j.length-1){t=e+1;break t}}t=1e3}else t=1e3;t=Yd(this,s,t),e=pe(this.I),W(e,"RID",n),W(e,"CVER",22),this.F&&W(e,"X-HTTP-Session-Id",this.F),rs(this,e),i&&(this.O?t="headers="+encodeURIComponent(String(Qd(i)))+"&"+t:this.o&&mu(e,this.o,i)),du(this.i,s),this.bb&&W(e,"TYPE","init"),this.P?(W(e,"$req",t),W(e,"SID","null"),s.aa=!0,Ka(s,e,null)):Ka(s,e,t),this.H=2}}else this.H==3&&(n?nd(this,n):this.j.length==0||Ld(this.i)||nd(this))};function nd(n,t){var e;t?e=t.m:e=n.W++;let r=pe(n.I);W(r,"SID",n.K),W(r,"RID",e),W(r,"AID",n.V),rs(n,r),n.o&&n.s&&mu(r,n.o,n.s),e=new Zr(n,n.l,e,n.C+1),n.o===null&&(e.I=n.s),t&&(n.j=t.F.concat(n.j)),t=Yd(n,e,1e3),e.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),du(n.i,e),Ka(e,r,t)}function rs(n,t){n.na&&tu(n.na,function(e,r){W(t,r,e)}),n.h&&Vd({},function(e,r){W(t,r,e)})}function Yd(n,t,e){e=Math.min(n.j.length,e);var r=n.h?Et(n.h.Va,n.h,n):null;t:{var s=n.j;let i=-1;for(;;){let o=["count="+e];i==-1?0<e?(i=s[0].g,o.push("ofs="+i)):i=0:o.push("ofs="+i);let a=!0;for(let u=0;u<e;u++){let c=s[u].g,l=s[u].map;if(c-=i,0>c)i=Math.max(0,s[u].g-100),a=!1;else try{_y(l,o,"req"+c+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break t}}}return n=n.j.splice(0,e),t.F=n,r}function Xd(n){if(!n.g&&!n.u){n.ba=1;var t=n.Ma;Gr||_d(),zr||(Gr(),zr=!0),ou.add(t,n),n.A=0}}function pu(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=Xr(Et(n.Ma,n),tf(n,n.A)),n.A++,!0)}A.Ma=function(){if(this.u=null,Jd(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=Xr(Et(this.jb,this),n)}};A.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Pt(10),ji(this),Jd(this))};function _u(n){n.B!=null&&(V.clearTimeout(n.B),n.B=null)}function Jd(n){n.g=new Zr(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var t=pe(n.wa);W(t,"RID","rpc"),W(t,"SID",n.K),W(t,"AID",n.V),W(t,"CI",n.G?"0":"1"),!n.G&&n.qa&&W(t,"TO",n.qa),W(t,"TYPE","xmlhttp"),rs(n,t),n.o&&n.s&&mu(t,n.o,n.s),n.L&&n.g.setTimeout(n.L);var e=n.g;n=n.pa,e.L=1,e.A=Ui(pe(t)),e.u=null,e.S=!0,Pd(e,n)}A.ib=function(){this.v!=null&&(this.v=null,ji(this),pu(this),Pt(19))};function Si(n){n.v!=null&&(V.clearTimeout(n.v),n.v=null)}function Zd(n,t){var e=null;if(n.g==t){Si(n),_u(n),n.g=null;var r=2}else if(Wa(n.i,t))e=t.F,qd(n.i,t),r=1;else return;if(n.H!=0){if(t.i)if(r==1){e=t.u?t.u.length:0,t=Date.now()-t.G;var s=n.C;r=Oi(),wt(r,new vd(r,e)),Gi(n)}else Xd(n);else if(s=t.s,s==3||s==0&&0<t.ca||!(r==1&&Ay(n,t)||r==2&&pu(n)))switch(e&&0<e.length&&(t=n.i,t.i=t.i.concat(e)),s){case 1:Xe(n,5);break;case 4:Xe(n,10);break;case 3:Xe(n,6);break;default:Xe(n,2)}}}function tf(n,t){let e=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(e*=2),e*t}function Xe(n,t){if(n.l.info("Error code "+t),t==2){var e=null;n.h&&(e=null);var r=Et(n.pb,n);e||(e=new Je("//www.google.com/images/cleardot.gif"),V.location&&V.location.protocol=="http"||vi(e,"https"),Ui(e)),yy(e.toString(),r)}else Pt(2);n.H=0,n.h&&n.h.za(t),ef(n),Hd(n)}A.pb=function(n){n?(this.l.info("Successfully pinged google.com"),Pt(2)):(this.l.info("Failed to ping google.com"),Pt(1))};function ef(n){if(n.H=0,n.ma=[],n.h){let t=Bd(n.i);(t.length!=0||n.j.length!=0)&&(Qh(n.ma,t),Qh(n.ma,n.j),n.i.i.length=0,Ja(n.j),n.j.length=0),n.h.ya()}}function nf(n,t,e){var r=e instanceof Je?pe(e):new Je(e);if(r.g!="")t&&(r.g=t+"."+r.g),Ai(r,r.m);else{var s=V.location;r=s.protocol,t=t?t+"."+s.hostname:s.hostname,s=+s.port;var i=new Je(null);r&&vi(i,r),t&&(i.g=t),s&&Ai(i,s),e&&(i.l=e),r=i}return e=n.F,t=n.Da,e&&t&&W(r,e,t),W(r,"VER",n.ra),rs(n,r),r}function rf(n,t,e){if(t&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return t=n.Ha&&!n.va?new et(new es({ob:e})):new et(n.va),t.Oa(n.J),t}A.isActive=function(){return!!this.h&&this.h.isActive(this)};function sf(){}A=sf.prototype;A.Ba=function(){};A.Aa=function(){};A.za=function(){};A.ya=function(){};A.isActive=function(){return!0};A.Va=function(){};function Ri(){if(On&&!(10<=Number(B_)))throw Error("Environmental error: no available transport.")}Ri.prototype.g=function(n,t){return new Ot(n,t)};function Ot(n,t){mt.call(this),this.g=new Wd(t),this.l=n,this.h=t&&t.messageUrlParams||null,n=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(n?n["X-WebChannel-Content-Type"]=t.messageContentType:n={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(n?n["X-WebChannel-Client-Profile"]=t.Ca:n={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=n,(n=t&&t.cc)&&!Br(n)&&(this.g.o=n),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Br(t)&&(this.g.F=t,n=this.h,n!==null&&t in n&&(n=this.h,t in n&&delete n[t])),this.j=new Mn(this)}gt(Ot,mt);Ot.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,t=this.l,e=this.h||void 0;Pt(0),n.Y=t,n.na=e||{},n.G=n.aa,n.I=nf(n,null,n.Y),Gi(n)};Ot.prototype.close=function(){gu(this.g)};Ot.prototype.u=function(n){var t=this.g;if(typeof n=="string"){var e={};e.__data__=n,n=e}else this.v&&(e={},e.__data__=iu(n),n=e);t.j.push(new fy(t.fb++,n)),t.H==3&&Gi(t)};Ot.prototype.N=function(){this.g.h=null,delete this.j,gu(this.g),delete this.g,Ot.$.N.call(this)};function of(n){lu.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var t=n.__sm__;if(t){t:{for(let e in t){n=e;break t}n=void 0}(this.i=n)&&(n=this.i,t=t!==null&&n in t?t[n]:void 0),this.data=t}else this.data=n}gt(of,lu);function af(){hu.call(this),this.status=1}gt(af,hu);function Mn(n){this.g=n}gt(Mn,sf);Mn.prototype.Ba=function(){wt(this.g,"a")};Mn.prototype.Aa=function(n){wt(this.g,new of(n))};Mn.prototype.za=function(n){wt(this.g,new af)};Mn.prototype.ya=function(){wt(this.g,"b")};function Sy(){this.blockSize=-1}function zt(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}gt(zt,Sy);zt.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function Na(n,t,e){e||(e=0);var r=Array(16);if(typeof t=="string")for(var s=0;16>s;++s)r[s]=t.charCodeAt(e++)|t.charCodeAt(e++)<<8|t.charCodeAt(e++)<<16|t.charCodeAt(e++)<<24;else for(s=0;16>s;++s)r[s]=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24;t=n.g[0],e=n.g[1],s=n.g[2];var i=n.g[3],o=t+(i^e&(s^i))+r[0]+3614090360&4294967295;t=e+(o<<7&4294967295|o>>>25),o=i+(s^t&(e^s))+r[1]+3905402710&4294967295,i=t+(o<<12&4294967295|o>>>20),o=s+(e^i&(t^e))+r[2]+606105819&4294967295,s=i+(o<<17&4294967295|o>>>15),o=e+(t^s&(i^t))+r[3]+3250441966&4294967295,e=s+(o<<22&4294967295|o>>>10),o=t+(i^e&(s^i))+r[4]+4118548399&4294967295,t=e+(o<<7&4294967295|o>>>25),o=i+(s^t&(e^s))+r[5]+1200080426&4294967295,i=t+(o<<12&4294967295|o>>>20),o=s+(e^i&(t^e))+r[6]+2821735955&4294967295,s=i+(o<<17&4294967295|o>>>15),o=e+(t^s&(i^t))+r[7]+4249261313&4294967295,e=s+(o<<22&4294967295|o>>>10),o=t+(i^e&(s^i))+r[8]+1770035416&4294967295,t=e+(o<<7&4294967295|o>>>25),o=i+(s^t&(e^s))+r[9]+2336552879&4294967295,i=t+(o<<12&4294967295|o>>>20),o=s+(e^i&(t^e))+r[10]+4294925233&4294967295,s=i+(o<<17&4294967295|o>>>15),o=e+(t^s&(i^t))+r[11]+2304563134&4294967295,e=s+(o<<22&4294967295|o>>>10),o=t+(i^e&(s^i))+r[12]+1804603682&4294967295,t=e+(o<<7&4294967295|o>>>25),o=i+(s^t&(e^s))+r[13]+4254626195&4294967295,i=t+(o<<12&4294967295|o>>>20),o=s+(e^i&(t^e))+r[14]+2792965006&4294967295,s=i+(o<<17&4294967295|o>>>15),o=e+(t^s&(i^t))+r[15]+1236535329&4294967295,e=s+(o<<22&4294967295|o>>>10),o=t+(s^i&(e^s))+r[1]+4129170786&4294967295,t=e+(o<<5&4294967295|o>>>27),o=i+(e^s&(t^e))+r[6]+3225465664&4294967295,i=t+(o<<9&4294967295|o>>>23),o=s+(t^e&(i^t))+r[11]+643717713&4294967295,s=i+(o<<14&4294967295|o>>>18),o=e+(i^t&(s^i))+r[0]+3921069994&4294967295,e=s+(o<<20&4294967295|o>>>12),o=t+(s^i&(e^s))+r[5]+3593408605&4294967295,t=e+(o<<5&4294967295|o>>>27),o=i+(e^s&(t^e))+r[10]+38016083&4294967295,i=t+(o<<9&4294967295|o>>>23),o=s+(t^e&(i^t))+r[15]+3634488961&4294967295,s=i+(o<<14&4294967295|o>>>18),o=e+(i^t&(s^i))+r[4]+3889429448&4294967295,e=s+(o<<20&4294967295|o>>>12),o=t+(s^i&(e^s))+r[9]+568446438&4294967295,t=e+(o<<5&4294967295|o>>>27),o=i+(e^s&(t^e))+r[14]+3275163606&4294967295,i=t+(o<<9&4294967295|o>>>23),o=s+(t^e&(i^t))+r[3]+4107603335&4294967295,s=i+(o<<14&4294967295|o>>>18),o=e+(i^t&(s^i))+r[8]+1163531501&4294967295,e=s+(o<<20&4294967295|o>>>12),o=t+(s^i&(e^s))+r[13]+2850285829&4294967295,t=e+(o<<5&4294967295|o>>>27),o=i+(e^s&(t^e))+r[2]+4243563512&4294967295,i=t+(o<<9&4294967295|o>>>23),o=s+(t^e&(i^t))+r[7]+1735328473&4294967295,s=i+(o<<14&4294967295|o>>>18),o=e+(i^t&(s^i))+r[12]+2368359562&4294967295,e=s+(o<<20&4294967295|o>>>12),o=t+(e^s^i)+r[5]+4294588738&4294967295,t=e+(o<<4&4294967295|o>>>28),o=i+(t^e^s)+r[8]+2272392833&4294967295,i=t+(o<<11&4294967295|o>>>21),o=s+(i^t^e)+r[11]+1839030562&4294967295,s=i+(o<<16&4294967295|o>>>16),o=e+(s^i^t)+r[14]+4259657740&4294967295,e=s+(o<<23&4294967295|o>>>9),o=t+(e^s^i)+r[1]+2763975236&4294967295,t=e+(o<<4&4294967295|o>>>28),o=i+(t^e^s)+r[4]+1272893353&4294967295,i=t+(o<<11&4294967295|o>>>21),o=s+(i^t^e)+r[7]+4139469664&4294967295,s=i+(o<<16&4294967295|o>>>16),o=e+(s^i^t)+r[10]+3200236656&4294967295,e=s+(o<<23&4294967295|o>>>9),o=t+(e^s^i)+r[13]+681279174&4294967295,t=e+(o<<4&4294967295|o>>>28),o=i+(t^e^s)+r[0]+3936430074&4294967295,i=t+(o<<11&4294967295|o>>>21),o=s+(i^t^e)+r[3]+3572445317&4294967295,s=i+(o<<16&4294967295|o>>>16),o=e+(s^i^t)+r[6]+76029189&4294967295,e=s+(o<<23&4294967295|o>>>9),o=t+(e^s^i)+r[9]+3654602809&4294967295,t=e+(o<<4&4294967295|o>>>28),o=i+(t^e^s)+r[12]+3873151461&4294967295,i=t+(o<<11&4294967295|o>>>21),o=s+(i^t^e)+r[15]+530742520&4294967295,s=i+(o<<16&4294967295|o>>>16),o=e+(s^i^t)+r[2]+3299628645&4294967295,e=s+(o<<23&4294967295|o>>>9),o=t+(s^(e|~i))+r[0]+4096336452&4294967295,t=e+(o<<6&4294967295|o>>>26),o=i+(e^(t|~s))+r[7]+1126891415&4294967295,i=t+(o<<10&4294967295|o>>>22),o=s+(t^(i|~e))+r[14]+2878612391&4294967295,s=i+(o<<15&4294967295|o>>>17),o=e+(i^(s|~t))+r[5]+4237533241&4294967295,e=s+(o<<21&4294967295|o>>>11),o=t+(s^(e|~i))+r[12]+1700485571&4294967295,t=e+(o<<6&4294967295|o>>>26),o=i+(e^(t|~s))+r[3]+2399980690&4294967295,i=t+(o<<10&4294967295|o>>>22),o=s+(t^(i|~e))+r[10]+4293915773&4294967295,s=i+(o<<15&4294967295|o>>>17),o=e+(i^(s|~t))+r[1]+2240044497&4294967295,e=s+(o<<21&4294967295|o>>>11),o=t+(s^(e|~i))+r[8]+1873313359&4294967295,t=e+(o<<6&4294967295|o>>>26),o=i+(e^(t|~s))+r[15]+4264355552&4294967295,i=t+(o<<10&4294967295|o>>>22),o=s+(t^(i|~e))+r[6]+2734768916&4294967295,s=i+(o<<15&4294967295|o>>>17),o=e+(i^(s|~t))+r[13]+1309151649&4294967295,e=s+(o<<21&4294967295|o>>>11),o=t+(s^(e|~i))+r[4]+4149444226&4294967295,t=e+(o<<6&4294967295|o>>>26),o=i+(e^(t|~s))+r[11]+3174756917&4294967295,i=t+(o<<10&4294967295|o>>>22),o=s+(t^(i|~e))+r[2]+718787259&4294967295,s=i+(o<<15&4294967295|o>>>17),o=e+(i^(s|~t))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+t&4294967295,n.g[1]=n.g[1]+(s+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+s&4294967295,n.g[3]=n.g[3]+i&4294967295}zt.prototype.j=function(n,t){t===void 0&&(t=n.length);for(var e=t-this.blockSize,r=this.m,s=this.h,i=0;i<t;){if(s==0)for(;i<=e;)Na(this,n,i),i+=this.blockSize;if(typeof n=="string"){for(;i<t;)if(r[s++]=n.charCodeAt(i++),s==this.blockSize){Na(this,r),s=0;break}}else for(;i<t;)if(r[s++]=n[i++],s==this.blockSize){Na(this,r),s=0;break}}this.h=s,this.i+=t};zt.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var t=1;t<n.length-8;++t)n[t]=0;var e=8*this.i;for(t=n.length-8;t<n.length;++t)n[t]=e&255,e/=256;for(this.j(n),n=Array(16),t=e=0;4>t;++t)for(var r=0;32>r;r+=8)n[e++]=this.g[t]>>>r&255;return n};function G(n,t){this.h=t;for(var e=[],r=!0,s=n.length-1;0<=s;s--){var i=n[s]|0;r&&i==t||(e[s]=i,r=!1)}this.g=e}var Ry={};function yu(n){return-128<=n&&128>n?L_(n,function(t){return new G([t|0],0>t?-1:0)}):new G([n|0],0>n?-1:0)}function ne(n){if(isNaN(n)||!isFinite(n))return Nn;if(0>n)return yt(ne(-n));for(var t=[],e=1,r=0;n>=e;r++)t[r]=n/e|0,e*=Ha;return new G(t,0)}function uf(n,t){if(n.length==0)throw Error("number format error: empty string");if(t=t||10,2>t||36<t)throw Error("radix out of range: "+t);if(n.charAt(0)=="-")return yt(uf(n.substring(1),t));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var e=ne(Math.pow(t,8)),r=Nn,s=0;s<n.length;s+=8){var i=Math.min(8,n.length-s),o=parseInt(n.substring(s,s+i),t);8>i?(i=ne(Math.pow(t,i)),r=r.R(i).add(ne(o))):(r=r.R(e),r=r.add(ne(o)))}return r}var Ha=4294967296,Nn=yu(0),Ya=yu(1),rd=yu(16777216);A=G.prototype;A.ea=function(){if(Ut(this))return-yt(this).ea();for(var n=0,t=1,e=0;e<this.g.length;e++){var r=this.D(e);n+=(0<=r?r:Ha+r)*t,t*=Ha}return n};A.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(ge(this))return"0";if(Ut(this))return"-"+yt(this).toString(n);for(var t=ne(Math.pow(n,6)),e=this,r="";;){var s=Pi(e,t).g;e=bi(e,s.R(t));var i=((0<e.g.length?e.g[0]:e.h)>>>0).toString(n);if(e=s,ge(e))return i+r;for(;6>i.length;)i="0"+i;r=i+r}};A.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function ge(n){if(n.h!=0)return!1;for(var t=0;t<n.g.length;t++)if(n.g[t]!=0)return!1;return!0}function Ut(n){return n.h==-1}A.X=function(n){return n=bi(this,n),Ut(n)?-1:ge(n)?0:1};function yt(n){for(var t=n.g.length,e=[],r=0;r<t;r++)e[r]=~n.g[r];return new G(e,~n.h).add(Ya)}A.abs=function(){return Ut(this)?yt(this):this};A.add=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],r=0,s=0;s<=t;s++){var i=r+(this.D(s)&65535)+(n.D(s)&65535),o=(i>>>16)+(this.D(s)>>>16)+(n.D(s)>>>16);r=o>>>16,i&=65535,o&=65535,e[s]=o<<16|i}return new G(e,e[e.length-1]&-2147483648?-1:0)};function bi(n,t){return n.add(yt(t))}A.R=function(n){if(ge(this)||ge(n))return Nn;if(Ut(this))return Ut(n)?yt(this).R(yt(n)):yt(yt(this).R(n));if(Ut(n))return yt(this.R(yt(n)));if(0>this.X(rd)&&0>n.X(rd))return ne(this.ea()*n.ea());for(var t=this.g.length+n.g.length,e=[],r=0;r<2*t;r++)e[r]=0;for(r=0;r<this.g.length;r++)for(var s=0;s<n.g.length;s++){var i=this.D(r)>>>16,o=this.D(r)&65535,a=n.D(s)>>>16,u=n.D(s)&65535;e[2*r+2*s]+=o*u,Ei(e,2*r+2*s),e[2*r+2*s+1]+=i*u,Ei(e,2*r+2*s+1),e[2*r+2*s+1]+=o*a,Ei(e,2*r+2*s+1),e[2*r+2*s+2]+=i*a,Ei(e,2*r+2*s+2)}for(r=0;r<t;r++)e[r]=e[2*r+1]<<16|e[2*r];for(r=t;r<2*t;r++)e[r]=0;return new G(e,0)};function Ei(n,t){for(;(n[t]&65535)!=n[t];)n[t+1]+=n[t]>>>16,n[t]&=65535,t++}function Mr(n,t){this.g=n,this.h=t}function Pi(n,t){if(ge(t))throw Error("division by zero");if(ge(n))return new Mr(Nn,Nn);if(Ut(n))return t=Pi(yt(n),t),new Mr(yt(t.g),yt(t.h));if(Ut(t))return t=Pi(n,yt(t)),new Mr(yt(t.g),t.h);if(30<n.g.length){if(Ut(n)||Ut(t))throw Error("slowDivide_ only works with positive integers.");for(var e=Ya,r=t;0>=r.X(n);)e=sd(e),r=sd(r);var s=Vn(e,1),i=Vn(r,1);for(r=Vn(r,2),e=Vn(e,2);!ge(r);){var o=i.add(r);0>=o.X(n)&&(s=s.add(e),i=o),r=Vn(r,1),e=Vn(e,1)}return t=bi(n,s.R(t)),new Mr(s,t)}for(s=Nn;0<=n.X(t);){for(e=Math.max(1,Math.floor(n.ea()/t.ea())),r=Math.ceil(Math.log(e)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),i=ne(e),o=i.R(t);Ut(o)||0<o.X(n);)e-=r,i=ne(e),o=i.R(t);ge(i)&&(i=Ya),s=s.add(i),n=bi(n,o)}return new Mr(s,n)}A.gb=function(n){return Pi(this,n).h};A.and=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],r=0;r<t;r++)e[r]=this.D(r)&n.D(r);return new G(e,this.h&n.h)};A.or=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],r=0;r<t;r++)e[r]=this.D(r)|n.D(r);return new G(e,this.h|n.h)};A.xor=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],r=0;r<t;r++)e[r]=this.D(r)^n.D(r);return new G(e,this.h^n.h)};function sd(n){for(var t=n.g.length+1,e=[],r=0;r<t;r++)e[r]=n.D(r)<<1|n.D(r-1)>>>31;return new G(e,n.h)}function Vn(n,t){var e=t>>5;t%=32;for(var r=n.g.length-e,s=[],i=0;i<r;i++)s[i]=0<t?n.D(i+e)>>>t|n.D(i+e+1)<<32-t:n.D(i+e);return new G(s,n.h)}Ri.prototype.createWebChannel=Ri.prototype.g;Ot.prototype.send=Ot.prototype.u;Ot.prototype.open=Ot.prototype.m;Ot.prototype.close=Ot.prototype.close;Fi.NO_ERROR=0;Fi.TIMEOUT=8;Fi.HTTP_ERROR=6;Ad.COMPLETE="complete";Sd.EventType=Jr;Jr.OPEN="a";Jr.CLOSE="b";Jr.ERROR="c";Jr.MESSAGE="d";mt.prototype.listen=mt.prototype.O;et.prototype.listenOnce=et.prototype.P;et.prototype.getLastError=et.prototype.Sa;et.prototype.getLastErrorCode=et.prototype.Ia;et.prototype.getStatus=et.prototype.da;et.prototype.getResponseJson=et.prototype.Wa;et.prototype.getResponseText=et.prototype.ja;et.prototype.send=et.prototype.ha;et.prototype.setWithCredentials=et.prototype.Oa;zt.prototype.digest=zt.prototype.l;zt.prototype.reset=zt.prototype.reset;zt.prototype.update=zt.prototype.j;G.prototype.add=G.prototype.add;G.prototype.multiply=G.prototype.R;G.prototype.modulo=G.prototype.gb;G.prototype.compare=G.prototype.X;G.prototype.toNumber=G.prototype.ea;G.prototype.toString=G.prototype.toString;G.prototype.getBits=G.prototype.D;G.fromNumber=ne;G.fromString=uf;var cf=$t.createWebChannelTransport=function(){return new Ri},lf=$t.getStatEventTarget=function(){return Oi()},zi=$t.ErrorCode=Fi,hf=$t.EventType=Ad,df=$t.Event=Ze,wu=$t.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},cE=$t.FetchXmlHttpFactory=es,ss=$t.WebChannel=Sd,ff=$t.XhrIo=et,mf=$t.Md5=zt,tn=$t.Integer=G;var gf="@firebase/firestore";var ct=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};ct.UNAUTHENTICATED=new ct(null),ct.GOOGLE_CREDENTIALS=new ct("google-credentials-uid"),ct.FIRST_PARTY=new ct("first-party-uid"),ct.MOCK_USER=new ct("mock-user");var mr="10.11.0";var Me=new Lh("@firebase/firestore");function jn(){return Me.logLevel}function gm(n){Me.setLogLevel(n)}function y(n,...t){if(Me.logLevel<=Zt.DEBUG){let e=t.map(El);Me.debug(`Firestore (${mr}): ${n}`,...e)}}function st(n,...t){if(Me.logLevel<=Zt.ERROR){let e=t.map(El);Me.error(`Firestore (${mr}): ${n}`,...e)}}function Bt(n,...t){if(Me.logLevel<=Zt.WARN){let e=t.map(El);Me.warn(`Firestore (${mr}): ${n}`,...e)}}function El(n){if(typeof n=="string")return n;try{return function(e){return JSON.stringify(e)}(n)}catch{return n}}function S(n="Unexpected state"){let t=`FIRESTORE (${mr}) INTERNAL ASSERTION FAILED: `+n;throw st(t),new Error(t)}function R(n,t){n||S()}function pm(n,t){n||S()}function v(n,t){return n}var g={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},_=class extends oi{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var lt=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var eo=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},Au=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(ct.UNAUTHENTICATED))}shutdown(){}},Su=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},Ru=class{constructor(t){this.t=t,this.currentUser=ct.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let r=this.i,s=u=>this.i!==r?(r=this.i,e(u)):Promise.resolve(),i=new lt;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new lt,t.enqueueRetryable(()=>s(this.currentUser))};let o=()=>{let u=i;t.enqueueRetryable(()=>p(this,null,function*(){yield u.promise,yield s(this.currentUser)}))},a=u=>{y("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(u=>a(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?a(u):(y("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new lt)}},0),o()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(r=>this.i!==t?(y("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(R(typeof r.accessToken=="string"),new eo(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let t=this.auth&&this.auth.getUid();return R(t===null||typeof t=="string"),new ct(t)}},bu=class{constructor(t,e,r){this.l=t,this.h=e,this.P=r,this.type="FirstParty",this.user=ct.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Pu=class{constructor(t,e,r){this.l=t,this.h=e,this.P=r}getToken(){return Promise.resolve(new bu(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable(()=>e(ct.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Cu=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},xu=class{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){let r=i=>{i.error!=null&&y("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);let o=i.token!==this.R;return this.R=i.token,y("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?e(i.token):Promise.resolve()};this.o=i=>{t.enqueueRetryable(()=>r(i))};let s=i=>{y("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){let i=this.A.getImmediate({optional:!0});i?s(i):y("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(R(typeof e.token=="string"),this.R=e.token,new Cu(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function xy(n){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let r=0;r<n;r++)e[r]=Math.floor(256*Math.random());return e}var no=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,r="";for(;r.length<20;){let s=xy(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<e&&(r+=t.charAt(s[i]%t.length))}return r}};function N(n,t){return n<t?-1:n>t?1:0}function Xn(n,t,e){return n.length===t.length&&n.every((r,s)=>e(r,t[s]))}function _m(n){return n+"\0"}var Z=class n{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new _(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new _(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new _(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new _(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return n.fromMillis(Date.now())}static fromDate(t){return n.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),r=Math.floor(1e6*(t-1e3*e));return new n(e,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?N(this.nanoseconds,t.nanoseconds):N(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var P=class n{constructor(t){this.timestamp=t}static fromTimestamp(t){return new n(t)}static min(){return new n(new Z(0,0))}static max(){return new n(new Z(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var ro=class n{constructor(t,e,r){e===void 0?e=0:e>t.length&&S(),r===void 0?r=t.length-e:r>t.length-e&&S(),this.segments=t,this.offset=e,this.len=r}get length(){return this.len}isEqual(t){return n.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof n?t.forEach(r=>{e.push(r)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,r=this.limit();e<r;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let r=Math.min(t.length,e.length);for(let s=0;s<r;s++){let i=t.get(s),o=e.get(s);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0}},U=class n extends ro{construct(t,e,r){return new n(t,e,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let r of t){if(r.indexOf("//")>=0)throw new _(g.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);e.push(...r.split("/").filter(s=>s.length>0))}return new n(e)}static emptyPath(){return new n([])}},Dy=/^[_a-zA-Z][_a-zA-Z0-9]*$/,it=class n extends ro{construct(t,e,r){return new n(t,e,r)}static isValidIdentifier(t){return Dy.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(t){let e=[],r="",s=0,i=()=>{if(r.length===0)throw new _(g.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(r),r=""},o=!1;for(;s<t.length;){let a=t[s];if(a==="\\"){if(s+1===t.length)throw new _(g.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let u=t[s+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new _(g.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new _(g.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)}static emptyPath(){return new n([])}};var E=class n{constructor(t){this.path=t}static fromPath(t){return new n(U.fromString(t))}static fromName(t){return new n(U.fromString(t).popFirst(5))}static empty(){return new n(U.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&U.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return U.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new n(new U(t.slice()))}};var Jn=class{constructor(t,e,r,s){this.indexId=t,this.collectionGroup=e,this.fields=r,this.indexState=s}};function Du(n){return n.fields.find(t=>t.kind===2)}function nn(n){return n.fields.filter(t=>t.kind!==2)}Jn.UNKNOWN_ID=-1;var Wn=class{constructor(t,e){this.fieldPath=t,this.kind=e}};var ps=class n{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new n(0,jt.min())}};function ym(n,t){let e=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=P.fromTimestamp(r===1e9?new Z(e+1,0):new Z(e,r));return new jt(s,E.empty(),t)}function wm(n){return new jt(n.readTime,n.key,-1)}var jt=class n{constructor(t,e,r){this.readTime=t,this.documentKey=e,this.largestBatchId=r}static min(){return new n(P.min(),E.empty(),-1)}static max(){return new n(P.max(),E.empty(),-1)}};function vl(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=E.comparator(n.documentKey,t.documentKey),e!==0?e:N(n.largestBatchId,t.largestBatchId))}var Tm="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",so=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function Ke(n){return p(this,null,function*(){if(n.code!==g.FAILED_PRECONDITION||n.message!==Tm)throw n;y("LocalStore","Unexpectedly lost primary lease")})}var m=class n{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&S(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new n((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(t,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(e,i).next(r,s)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof n?e:n.resolve(e)}catch(e){return n.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):n.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):n.reject(e)}static resolve(t){return new n((e,r)=>{e(t)})}static reject(t){return new n((e,r)=>{r(t)})}static waitFor(t){return new n((e,r)=>{let s=0,i=0,o=!1;t.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&e()},u=>r(u))}),o=!0,i===s&&e()})}static or(t){let e=n.resolve(!1);for(let r of t)e=e.next(s=>s?n.resolve(s):r());return e}static forEach(t,e){let r=[];return t.forEach((s,i)=>{r.push(e.call(this,s,i))}),this.waitFor(r)}static mapArray(t,e){return new n((r,s)=>{let i=t.length,o=new Array(i),a=0;for(let u=0;u<i;u++){let c=u;e(t[c]).next(l=>{o[c]=l,++a,a===i&&r(o)},l=>s(l))}})}static doWhile(t,e){return new n((r,s)=>{let i=()=>{t()===!0?e().next(()=>{i()},s):r()};i()})}};var io=class n{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.V=new lt,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{e.error?this.V.reject(new cn(t,e.error)):this.V.resolve()},this.transaction.onerror=r=>{let s=Al(r.target.error);this.V.reject(new cn(t,s))}}static open(t,e,r,s){try{return new n(e,t.transaction(s,r))}catch(i){throw new cn(e,i)}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(y("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){let e=this.transaction.objectStore(t);return new ku(e)}},we=class n{constructor(t,e,r){this.name=t,this.version=e,this.p=r,n.S(Or())===12.2&&st("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return y("SimpleDb","Removing database:",t),rn(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!Mh())return!1;if(n.C())return!0;let t=Or(),e=n.S(t),r=0<e&&e<10,s=n.v(t),i=0<s&&s<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||i)}static C(){var t;return typeof process<"u"&&((t=process.__PRIVATE_env)===null||t===void 0?void 0:t.F)==="YES"}static M(t,e){return t.store(e)}static S(t){let e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static v(t){let e=t.match(/Android ([\d.]+)/i),r=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(r)}O(t){return p(this,null,function*(){return this.db||(y("SimpleDb","Opening database:",this.name),this.db=yield new Promise((e,r)=>{let s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{let o=i.target.result;e(o)},s.onblocked=()=>{r(new cn(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{let o=i.target.error;o.name==="VersionError"?r(new _(g.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new _(g.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new cn(t,o))},s.onupgradeneeded=i=>{y("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);let o=i.target.result;this.p.N(o,s.transaction,i.oldVersion,this.version).next(()=>{y("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.L&&(this.db.onversionchange=e=>this.L(e)),this.db})}B(t){this.L=t,this.db&&(this.db.onversionchange=e=>t(e))}runTransaction(t,e,r,s){return p(this,null,function*(){let i=e==="readonly",o=0;for(;;){++o;try{this.db=yield this.O(t);let a=io.open(this.db,t,i?"readonly":"readwrite",r),u=s(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),m.reject(c))).toPromise();return u.catch(()=>{}),yield a.m,u}catch(a){let u=a,c=u.name!=="FirebaseError"&&o<3;if(y("SimpleDb","Transaction failed with error:",u.message,"Retrying:",c),this.close(),!c)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}},Vu=class{constructor(t){this.k=t,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(t){this.k=t}done(){this.q=!0}U(t){this.K=t}delete(){return rn(this.k.delete())}},cn=class extends _{constructor(t,e){super(g.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}};function Qe(n){return n.name==="IndexedDbTransactionError"}var ku=class{constructor(t){this.store=t}put(t,e){let r;return e!==void 0?(y("SimpleDb","PUT",this.store.name,t,e),r=this.store.put(e,t)):(y("SimpleDb","PUT",this.store.name,"<auto-key>",t),r=this.store.put(t)),rn(r)}add(t){return y("SimpleDb","ADD",this.store.name,t,t),rn(this.store.add(t))}get(t){return rn(this.store.get(t)).next(e=>(e===void 0&&(e=null),y("SimpleDb","GET",this.store.name,t,e),e))}delete(t){return y("SimpleDb","DELETE",this.store.name,t),rn(this.store.delete(t))}count(){return y("SimpleDb","COUNT",this.store.name),rn(this.store.count())}W(t,e){let r=this.options(t,e),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){let i=s.getAll(r.range);return new m((o,a)=>{i.onerror=u=>{a(u.target.error)},i.onsuccess=u=>{o(u.target.result)}})}{let i=this.cursor(r),o=[];return this.G(i,(a,u)=>{o.push(u)}).next(()=>o)}}j(t,e){let r=this.store.getAll(t,e===null?void 0:e);return new m((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}H(t,e){y("SimpleDb","DELETE ALL",this.store.name);let r=this.options(t,e);r.J=!1;let s=this.cursor(r);return this.G(s,(i,o,a)=>a.delete())}Y(t,e){let r;e?r=t:(r={},e=t);let s=this.cursor(r);return this.G(s,e)}Z(t){let e=this.cursor({});return new m((r,s)=>{e.onerror=i=>{let o=Al(i.target.error);s(o)},e.onsuccess=i=>{let o=i.target.result;o?t(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}G(t,e){let r=[];return new m((s,i)=>{t.onerror=o=>{i(o.target.error)},t.onsuccess=o=>{let a=o.target.result;if(!a)return void s();let u=new Vu(a),c=e(a.primaryKey,a.value,u);if(c instanceof m){let l=c.catch(h=>(u.done(),m.reject(h)));r.push(l)}u.isDone?s():u.$===null?a.continue():a.continue(u.$)}}).next(()=>m.waitFor(r))}options(t,e){let r;return t!==void 0&&(typeof t=="string"?r=t:e=t),{index:r,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){let r=this.store.index(t.index);return t.J?r.openKeyCursor(t.range,e):r.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}};function rn(n){return new m((t,e)=>{n.onsuccess=r=>{let s=r.target.result;t(s)},n.onerror=r=>{let s=Al(r.target.error);e(s)}})}var pf=!1;function Al(n){let t=we.S(Or());if(t>=12.2&&t<13){let e="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(e)>=0){let r=new _("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return pf||(pf=!0,setTimeout(()=>{throw r},0)),r}}return n}var Nu=class{constructor(t,e){this.asyncQueue=t,this.X=e,this.task=null}start(){this.ee(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}ee(t){y("IndexBackfiller",`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,()=>p(this,null,function*(){this.task=null;try{y("IndexBackfiller",`Documents written: ${yield this.X.te()}`)}catch(e){Qe(e)?y("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",e):yield Ke(e)}yield this.ee(6e4)}))}},Ou=class{constructor(t,e){this.localStore=t,this.persistence=e}te(t=50){return p(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.ne(e,t))})}ne(t,e){let r=new Set,s=e,i=!0;return m.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next(o=>{if(o!==null&&!r.has(o))return y("IndexBackfiller",`Processing collection: ${o}`),this.re(t,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>e-s)}re(t,e,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next(s=>this.localStore.localDocuments.getNextDocuments(t,e,s,r).next(i=>{let o=i.changes;return this.localStore.indexManager.updateIndexEntries(t,o).next(()=>this.ie(s,i)).next(a=>(y("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(t,e,a))).next(()=>o.size)}))}ie(t,e){let r=t;return e.changes.forEach((s,i)=>{let o=wm(i);vl(o,r)>0&&(r=o)}),new jt(r.readTime,r.documentKey,Math.max(e.batchId,t.largestBatchId))}};var Ft=(()=>{class n{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=s=>this.se(s),this.oe=s=>r.writeSequenceNumber(s))}se(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.oe&&this.oe(e),e}}return n._e=-1,n})();function Ls(n){return n==null}function _s(n){return n===0&&1/n==-1/0}function Im(n){return typeof n=="number"&&Number.isInteger(n)&&!_s(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function Ct(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=_f(t)),t=Vy(n.get(e),t);return _f(t)}function Vy(n,t){let e=t,r=n.length;for(let s=0;s<r;s++){let i=n.charAt(s);switch(i){case"\0":e+="";break;case"":e+="";break;default:e+=i}}return e}function _f(n){return n+""}function re(n){let t=n.length;if(R(t>=2),t===2)return R(n.charAt(0)===""&&n.charAt(1)===""),U.emptyPath();let e=t-2,r=[],s="";for(let i=0;i<t;){let o=n.indexOf("",i);switch((o<0||o>e)&&S(),n.charAt(o+1)){case"":let a=n.substring(i,o),u;s.length===0?u=a:(s+=a,u=s,s=""),r.push(u);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:S()}i=o+2}return new U(r)}var yf=["userId","batchId"];function Hi(n,t){return[n,Ct(t)]}function Em(n,t,e){return[n,Ct(t),e]}var ky={},Ny=["prefixPath","collectionGroup","readTime","documentId"],Oy=["prefixPath","collectionGroup","documentId"],Fy=["collectionGroup","readTime","prefixPath","documentId"],My=["canonicalId","targetId"],Ly=["targetId","path"],Uy=["path","targetId"],qy=["collectionId","parent"],By=["indexId","uid"],jy=["uid","sequenceNumber"],Gy=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],zy=["indexId","uid","orderedDocumentKey"],$y=["userId","collectionPath","documentId"],Ky=["userId","collectionPath","largestBatchId"],Qy=["userId","collectionGroup","largestBatchId"],vm=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Wy=[...vm,"documentOverlays"],Am=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Sm=Am,Rm=[...Sm,"indexConfiguration","indexState","indexEntries"],Hy=Rm;var ys=class extends so{constructor(t,e){super(),this.ae=t,this.currentSequenceNumber=e}};function _t(n,t){let e=v(n);return we.M(e.ae,t)}function wf(n){let t=0;for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function In(n,t){for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function bm(n){for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}var H=class n{constructor(t,e){this.comparator=t,this.root=e||ie.EMPTY}insert(t,e){return new n(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,ie.BLACK,null,null))}remove(t){return new n(this.comparator,this.root.remove(t,this.comparator).copy(null,null,ie.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let r=this.comparator(t,e.key);if(r===0)return e.value;r<0?e=e.left:r>0&&(e=e.right)}return null}indexOf(t){let e=0,r=this.root;for(;!r.isEmpty();){let s=this.comparator(t,r.key);if(s===0)return e+r.left.size;s<0?r=r.left:(e+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,r)=>(t(e,r),!1))}toString(){let t=[];return this.inorderTraversal((e,r)=>(t.push(`${e}:${r}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Qn(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Qn(this.root,t,this.comparator,!1)}getReverseIterator(){return new Qn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Qn(this.root,t,this.comparator,!0)}},Qn=class{constructor(t,e,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?r(t.key,e):1,e&&s&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(i===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},ie=class n{constructor(t,e,r,s,i){this.key=t,this.value=e,this.color=r!=null?r:n.RED,this.left=s!=null?s:n.EMPTY,this.right=i!=null?i:n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,r,s,i){return new n(t!=null?t:this.key,e!=null?e:this.value,r!=null?r:this.color,s!=null?s:this.left,i!=null?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,r){let s=this,i=r(t,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(t,e,r),null):i===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let r,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw S();let t=this.left.check();if(t!==this.right.check())throw S();return t+(this.isRed()?0:1)}};ie.EMPTY=null,ie.RED=!0,ie.BLACK=!1;ie.EMPTY=new class{constructor(){this.size=0}get key(){throw S()}get value(){throw S()}get color(){throw S()}get left(){throw S()}get right(){throw S()}copy(t,e,r,s,i){return this}insert(t,e,r){return new ie(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var $=class n{constructor(t){this.comparator=t,this.data=new H(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,r)=>(t(e),!1))}forEachInRange(t,e){let r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){let s=r.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let r;for(r=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new oo(this.data.getIterator())}getIteratorFrom(t){return new oo(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(r=>{e=e.add(r)}),e}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.data.getIterator(),r=t.data.getIterator();for(;e.hasNext();){let s=e.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new n(this.comparator);return e.data=t,e}},oo=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Ln(n){return n.hasNext()?n.getNext():void 0}var Mt=class n{constructor(t){this.fields=t,t.sort(it.comparator)}static empty(){return new n([])}unionWith(t){let e=new $(it.comparator);for(let r of this.fields)e=e.add(r);for(let r of t)e=e.add(r);return new n(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Xn(this.fields,t.fields,(e,r)=>e.isEqual(r))}};var ao=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function Pm(){return typeof atob<"u"}var pt=class n{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new ao("Invalid base64 string: "+i):i}}(t);return new n(e)}static fromUint8Array(t){let e=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(t);return new n(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let r=new Uint8Array(e.length);for(let s=0;s<e.length;s++)r[s]=e.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return N(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};pt.EMPTY_BYTE_STRING=new pt("");var Yy=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Te(n){if(R(!!n),typeof n=="string"){let t=0,e=Yy.exec(n);if(R(!!e),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:nt(n.seconds),nanos:nt(n.nanos)}}function nt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Le(n){return typeof n=="string"?pt.fromBase64String(n):pt.fromUint8Array(n)}function Jo(n){var t,e;return((e=(((t=n==null?void 0:n.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="server_timestamp"}function Sl(n){let t=n.mapValue.fields.__previous_value__;return Jo(t)?Sl(t):t}function ws(n){let t=Te(n.mapValue.fields.__local_write_time__.timestampValue);return new Z(t.seconds,t.nanos)}var Fu=class{constructor(t,e,r,s,i,o,a,u,c){this.databaseId=t,this.appId=e,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}},Ue=class n{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof n&&t.projectId===this.projectId&&t.database===this.database}};var Oe={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Yi={nullValue:"NULL_VALUE"};function ln(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Jo(n)?4:Cm(n)?9007199254740991:10:S()}function ue(n,t){if(n===t)return!0;let e=ln(n);if(e!==ln(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return ws(n).isEqual(ws(t));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;let o=Te(s.timestampValue),a=Te(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return function(s,i){return Le(s.bytesValue).isEqual(Le(i.bytesValue))}(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return function(s,i){return nt(s.geoPointValue.latitude)===nt(i.geoPointValue.latitude)&&nt(s.geoPointValue.longitude)===nt(i.geoPointValue.longitude)}(n,t);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return nt(s.integerValue)===nt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){let o=nt(s.doubleValue),a=nt(i.doubleValue);return o===a?_s(o)===_s(a):isNaN(o)&&isNaN(a)}return!1}(n,t);case 9:return Xn(n.arrayValue.values||[],t.arrayValue.values||[],ue);case 10:return function(s,i){let o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(wf(o)!==wf(a))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(a[u]===void 0||!ue(o[u],a[u])))return!1;return!0}(n,t);default:return S()}}function Ts(n,t){return(n.values||[]).find(e=>ue(e,t))!==void 0}function qe(n,t){if(n===t)return 0;let e=ln(n),r=ln(t);if(e!==r)return N(e,r);switch(e){case 0:case 9007199254740991:return 0;case 1:return N(n.booleanValue,t.booleanValue);case 2:return function(i,o){let a=nt(i.integerValue||i.doubleValue),u=nt(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,t);case 3:return Tf(n.timestampValue,t.timestampValue);case 4:return Tf(ws(n),ws(t));case 5:return N(n.stringValue,t.stringValue);case 6:return function(i,o){let a=Le(i),u=Le(o);return a.compareTo(u)}(n.bytesValue,t.bytesValue);case 7:return function(i,o){let a=i.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){let l=N(a[c],u[c]);if(l!==0)return l}return N(a.length,u.length)}(n.referenceValue,t.referenceValue);case 8:return function(i,o){let a=N(nt(i.latitude),nt(o.latitude));return a!==0?a:N(nt(i.longitude),nt(o.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return function(i,o){let a=i.values||[],u=o.values||[];for(let c=0;c<a.length&&c<u.length;++c){let l=qe(a[c],u[c]);if(l)return l}return N(a.length,u.length)}(n.arrayValue,t.arrayValue);case 10:return function(i,o){if(i===Oe.mapValue&&o===Oe.mapValue)return 0;if(i===Oe.mapValue)return 1;if(o===Oe.mapValue)return-1;let a=i.fields||{},u=Object.keys(a),c=o.fields||{},l=Object.keys(c);u.sort(),l.sort();for(let h=0;h<u.length&&h<l.length;++h){let d=N(u[h],l[h]);if(d!==0)return d;let f=qe(a[u[h]],c[l[h]]);if(f!==0)return f}return N(u.length,l.length)}(n.mapValue,t.mapValue);default:throw S()}}function Tf(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return N(n,t);let e=Te(n),r=Te(t),s=N(e.seconds,r.seconds);return s!==0?s:N(e.nanos,r.nanos)}function Zn(n){return Mu(n)}function Mu(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(e){let r=Te(e);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(e){return Le(e).toBase64()}(n.bytesValue):"referenceValue"in n?function(e){return E.fromName(e).toString()}(n.referenceValue):"geoPointValue"in n?function(e){return`geo(${e.latitude},${e.longitude})`}(n.geoPointValue):"arrayValue"in n?function(e){let r="[",s=!0;for(let i of e.values||[])s?s=!1:r+=",",r+=Mu(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(e){let r=Object.keys(e.fields||{}).sort(),s="{",i=!0;for(let o of r)i?i=!1:s+=",",s+=`${o}:${Mu(e.fields[o])}`;return s+"}"}(n.mapValue):S()}function hn(n,t){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${t.path.canonicalString()}`}}function Lu(n){return!!n&&"integerValue"in n}function Is(n){return!!n&&"arrayValue"in n}function If(n){return!!n&&"nullValue"in n}function Ef(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Xi(n){return!!n&&"mapValue"in n}function hs(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let t={mapValue:{fields:{}}};return In(n.mapValue.fields,(e,r)=>t.mapValue.fields[e]=hs(r)),t}if(n.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=hs(n.arrayValue.values[e]);return t}return Object.assign({},n)}function Cm(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function Xy(n){return"nullValue"in n?Yi:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?hn(Ue.empty(),E.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:S()}function Jy(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?hn(Ue.empty(),E.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Oe:S()}function vf(n,t){let e=qe(n.value,t.value);return e!==0?e:n.inclusive&&!t.inclusive?-1:!n.inclusive&&t.inclusive?1:0}function Af(n,t){let e=qe(n.value,t.value);return e!==0?e:n.inclusive&&!t.inclusive?1:!n.inclusive&&t.inclusive?-1:0}var St=class n{constructor(t){this.value=t}static empty(){return new n({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let r=0;r<t.length-1;++r)if(e=(e.mapValue.fields||{})[t.get(r)],!Xi(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=hs(e)}setAll(t){let e=it.emptyPath(),r={},s=[];t.forEach((o,a)=>{if(!e.isImmediateParentOf(a)){let u=this.getFieldsMap(e);this.applyChanges(u,r,s),r={},s=[],e=a.popLast()}o?r[a.lastSegment()]=hs(o):s.push(a.lastSegment())});let i=this.getFieldsMap(e);this.applyChanges(i,r,s)}delete(t){let e=this.field(t.popLast());Xi(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return ue(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let r=0;r<t.length;++r){let s=e.mapValue.fields[t.get(r)];Xi(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(r)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,r){In(e,(s,i)=>t[s]=i);for(let s of r)delete t[s]}clone(){return new n(hs(this.value))}};function xm(n){let t=[];return In(n.fields,(e,r)=>{let s=new it([e]);if(Xi(r)){let i=xm(r.mapValue).fields;if(i.length===0)t.push(s);else for(let o of i)t.push(s.child(o))}else t.push(s)}),new Mt(t)}var ht=class n{constructor(t,e,r,s,i,o,a){this.key=t,this.documentType=e,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(t){return new n(t,0,P.min(),P.min(),P.min(),St.empty(),0)}static newFoundDocument(t,e,r,s){return new n(t,1,e,P.min(),r,s,0)}static newNoDocument(t,e){return new n(t,2,e,P.min(),P.min(),St.empty(),0)}static newUnknownDocument(t,e){return new n(t,3,e,P.min(),P.min(),St.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(P.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=St.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=St.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=P.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof n&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var ce=class{constructor(t,e){this.position=t,this.inclusive=e}};function Sf(n,t,e){let r=0;for(let s=0;s<n.position.length;s++){let i=t[s],o=n.position[s];if(i.field.isKeyField()?r=E.comparator(E.fromName(o.referenceValue),e.key):r=qe(o,e.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function Rf(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!ue(n.position[e],t.position[e]))return!1;return!0}var dn=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function Zy(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}var uo=class{},F=class n extends uo{constructor(t,e,r){super(),this.field=t,this.op=e,this.value=r}static create(t,e,r){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,r):new Bu(t,e,r):e==="array-contains"?new zu(t,r):e==="in"?new co(t,r):e==="not-in"?new $u(t,r):e==="array-contains-any"?new Ku(t,r):new n(t,e,r)}static createKeyFieldInFilter(t,e,r){return e==="in"?new ju(t,r):new Gu(t,r)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&this.matchesComparison(qe(e,this.value)):e!==null&&ln(this.value)===ln(e)&&this.matchesComparison(qe(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return S()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},z=class n extends uo{constructor(t,e){super(),this.filters=t,this.op=e,this.ue=null}static create(t,e){return new n(t,e)}matches(t){return tr(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.ue!==null||(this.ue=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}};function tr(n){return n.op==="and"}function Uu(n){return n.op==="or"}function Rl(n){return Dm(n)&&tr(n)}function Dm(n){for(let t of n.filters)if(t instanceof z)return!1;return!0}function qu(n){if(n instanceof F)return n.field.canonicalString()+n.op.toString()+Zn(n.value);if(Rl(n))return n.filters.map(t=>qu(t)).join(",");{let t=n.filters.map(e=>qu(e)).join(",");return`${n.op}(${t})`}}function Vm(n,t){return n instanceof F?function(r,s){return s instanceof F&&r.op===s.op&&r.field.isEqual(s.field)&&ue(r.value,s.value)}(n,t):n instanceof z?function(r,s){return s instanceof z&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&Vm(o,s.filters[a]),!0):!1}(n,t):void S()}function km(n,t){let e=n.filters.concat(t);return z.create(e,n.op)}function Nm(n){return n instanceof F?function(e){return`${e.field.canonicalString()} ${e.op} ${Zn(e.value)}`}(n):n instanceof z?function(e){return e.op.toString()+" {"+e.getFilters().map(Nm).join(" ,")+"}"}(n):"Filter"}var Bu=class extends F{constructor(t,e,r){super(t,e,r),this.key=E.fromName(r.referenceValue)}matches(t){let e=E.comparator(t.key,this.key);return this.matchesComparison(e)}},ju=class extends F{constructor(t,e){super(t,"in",e),this.keys=Om("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},Gu=class extends F{constructor(t,e){super(t,"not-in",e),this.keys=Om("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function Om(n,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(r=>E.fromName(r.referenceValue))}var zu=class extends F{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return Is(e)&&Ts(e.arrayValue,this.value)}},co=class extends F{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&Ts(this.value.arrayValue,e)}},$u=class extends F{constructor(t,e){super(t,"not-in",e)}matches(t){if(Ts(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&!Ts(this.value.arrayValue,e)}},Ku=class extends F{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!Is(e)||!e.arrayValue.values)&&e.arrayValue.values.some(r=>Ts(this.value.arrayValue,r))}};var Qu=class{constructor(t,e=null,r=[],s=[],i=null,o=null,a=null){this.path=t,this.collectionGroup=e,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ce=null}};function Wu(n,t=null,e=[],r=[],s=null,i=null,o=null){return new Qu(n,t,e,r,s,i,o)}function fn(n){let t=v(n);if(t.ce===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(r=>qu(r)).join(","),e+="|ob:",e+=t.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Ls(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(r=>Zn(r)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(r=>Zn(r)).join(",")),t.ce=e}return t.ce}function Us(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!Zy(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!Vm(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!Rf(n.startAt,t.startAt)&&Rf(n.endAt,t.endAt)}function lo(n){return E.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function ho(n,t){return n.filters.filter(e=>e instanceof F&&e.field.isEqual(t))}function bf(n,t,e){let r=Yi,s=!0;for(let i of ho(n,t)){let o=Yi,a=!0;switch(i.op){case"<":case"<=":o=Xy(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=Yi}vf({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(e!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(t)){let o=e.position[i];vf({value:r,inclusive:s},{value:o,inclusive:e.inclusive})<0&&(r=o,s=e.inclusive);break}}return{value:r,inclusive:s}}function Pf(n,t,e){let r=Oe,s=!0;for(let i of ho(n,t)){let o=Oe,a=!0;switch(i.op){case">=":case">":o=Jy(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=Oe}Af({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(e!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(t)){let o=e.position[i];Af({value:r,inclusive:s},{value:o,inclusive:e.inclusive})>0&&(r=o,s=e.inclusive);break}}return{value:r,inclusive:s}}var Kt=class{constructor(t,e=null,r=[],s=[],i=null,o="F",a=null,u=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=u,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}};function Fm(n,t,e,r,s,i,o,a){return new Kt(n,t,e,r,s,i,o,a)}function gr(n){return new Kt(n)}function Cf(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function bl(n){return n.collectionGroup!==null}function Hn(n){let t=v(n);if(t.le===null){t.le=[];let e=new Set;for(let i of t.explicitOrderBy)t.le.push(i),e.add(i.field.canonicalString());let r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new $(it.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(t).forEach(i=>{e.has(i.canonicalString())||i.isKeyField()||t.le.push(new dn(i,r))}),e.has(it.keyField().canonicalString())||t.le.push(new dn(it.keyField(),r))}return t.le}function xt(n){let t=v(n);return t.he||(t.he=tw(t,Hn(n))),t.he}function tw(n,t){if(n.limitType==="F")return Wu(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(s=>{let i=s.dir==="desc"?"asc":"desc";return new dn(s.field,i)});let e=n.endAt?new ce(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new ce(n.startAt.position,n.startAt.inclusive):null;return Wu(n.path,n.collectionGroup,t,n.filters,n.limit,e,r)}}function Hu(n,t){let e=n.filters.concat([t]);return new Kt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),e,n.limit,n.limitType,n.startAt,n.endAt)}function fo(n,t,e){return new Kt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function qs(n,t){return Us(xt(n),xt(t))&&n.limitType===t.limitType}function Mm(n){return`${fn(xt(n))}|lt:${n.limitType}`}function Gn(n){return`Query(target=${function(e){let r=e.path.canonicalString();return e.collectionGroup!==null&&(r+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(r+=`, filters: [${e.filters.map(s=>Nm(s)).join(", ")}]`),Ls(e.limit)||(r+=", limit: "+e.limit),e.orderBy.length>0&&(r+=`, orderBy: [${e.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),e.startAt&&(r+=", startAt: ",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(s=>Zn(s)).join(",")),e.endAt&&(r+=", endAt: ",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(s=>Zn(s)).join(",")),`Target(${r})`}(xt(n))}; limitType=${n.limitType})`}function Bs(n,t){return t.isFoundDocument()&&function(r,s){let i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):E.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,t)&&function(r,s){for(let i of Hn(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,t)&&function(r,s){for(let i of r.filters)if(!i.matches(s))return!1;return!0}(n,t)&&function(r,s){return!(r.startAt&&!function(o,a,u){let c=Sf(o,a,u);return o.inclusive?c<=0:c<0}(r.startAt,Hn(r),s)||r.endAt&&!function(o,a,u){let c=Sf(o,a,u);return o.inclusive?c>=0:c>0}(r.endAt,Hn(r),s))}(n,t)}function Lm(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Um(n){return(t,e)=>{let r=!1;for(let s of Hn(n)){let i=ew(s,t,e);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function ew(n,t,e){let r=n.field.isKeyField()?E.comparator(t.key,e.key):function(i,o,a){let u=o.data.field(i),c=a.data.field(i);return u!==null&&c!==null?qe(u,c):S()}(n.field,t,e);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return S()}}var le=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r!==void 0){for(let[s,i]of r)if(this.equalsFn(s,t))return i}}has(t){return this.get(t)!==void 0}set(t,e){let r=this.mapKeyFn(t),s=this.inner[r];if(s===void 0)return this.inner[r]=[[t,e]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],t))return void(s[i]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],t))return r.length===1?delete this.inner[e]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(t){In(this.inner,(e,r)=>{for(let[s,i]of r)t(s,i)})}isEmpty(){return bm(this.inner)}size(){return this.innerSize}};var nw=new H(E.comparator);function kt(){return nw}var qm=new H(E.comparator);function cs(...n){let t=qm;for(let e of n)t=t.insert(e.key,e);return t}function Bm(n){let t=qm;return n.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function se(){return ds()}function jm(){return ds()}function ds(){return new le(n=>n.toString(),(n,t)=>n.isEqual(t))}var rw=new H(E.comparator),sw=new $(E.comparator);function O(...n){let t=sw;for(let e of n)t=t.add(e);return t}var iw=new $(N);function Pl(){return iw}function Gm(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:_s(t)?"-0":t}}function zm(n){return{integerValue:""+n}}function $m(n,t){return Im(t)?zm(t):Gm(n,t)}var er=class{constructor(){this._=void 0}};function ow(n,t,e){return n instanceof Be?function(s,i){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Jo(i)&&(i=Sl(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(e,t):n instanceof Ie?Qm(n,t):n instanceof Ee?Wm(n,t):function(s,i){let o=Km(s,i),a=xf(o)+xf(s.Ie);return Lu(o)&&Lu(s.Ie)?zm(a):Gm(s.serializer,a)}(n,t)}function aw(n,t,e){return n instanceof Ie?Qm(n,t):n instanceof Ee?Wm(n,t):e}function Km(n,t){return n instanceof je?function(r){return Lu(r)||function(i){return!!i&&"doubleValue"in i}(r)}(t)?t:{integerValue:0}:null}var Be=class extends er{},Ie=class extends er{constructor(t){super(),this.elements=t}};function Qm(n,t){let e=Hm(t);for(let r of n.elements)e.some(s=>ue(s,r))||e.push(r);return{arrayValue:{values:e}}}var Ee=class extends er{constructor(t){super(),this.elements=t}};function Wm(n,t){let e=Hm(t);for(let r of n.elements)e=e.filter(s=>!ue(s,r));return{arrayValue:{values:e}}}var je=class extends er{constructor(t,e){super(),this.serializer=t,this.Ie=e}};function xf(n){return nt(n.integerValue||n.doubleValue)}function Hm(n){return Is(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var mn=class{constructor(t,e){this.field=t,this.transform=e}};function uw(n,t){return n.field.isEqual(t.field)&&function(r,s){return r instanceof Ie&&s instanceof Ie||r instanceof Ee&&s instanceof Ee?Xn(r.elements,s.elements,ue):r instanceof je&&s instanceof je?ue(r.Ie,s.Ie):r instanceof Be&&s instanceof Be}(n.transform,t.transform)}var Yu=class{constructor(t,e){this.version=t,this.transformResults=e}},rt=class n{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new n}static exists(t){return new n(void 0,t)}static updateTime(t){return new n(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function Ji(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}var nr=class{};function Ym(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new ze(n.key,rt.none()):new Ge(n.key,n.data,rt.none());{let e=n.data,r=St.empty(),s=new $(it.comparator);for(let i of t.fields)if(!s.has(i)){let o=e.field(i);o===null&&i.length>1&&(i=i.popLast(),o=e.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new Qt(n.key,r,new Mt(s.toArray()),rt.none())}}function cw(n,t,e){n instanceof Ge?function(s,i,o){let a=s.value.clone(),u=Vf(s.fieldTransforms,i,o.transformResults);a.setAll(u),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,t,e):n instanceof Qt?function(s,i,o){if(!Ji(s.precondition,i))return void i.convertToUnknownDocument(o.version);let a=Vf(s.fieldTransforms,i,o.transformResults),u=i.data;u.setAll(Xm(s)),u.setAll(a),i.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,t,e):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,t,e)}function fs(n,t,e,r){return n instanceof Ge?function(i,o,a,u){if(!Ji(i.precondition,o))return a;let c=i.value.clone(),l=kf(i.fieldTransforms,u,o);return c.setAll(l),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,t,e,r):n instanceof Qt?function(i,o,a,u){if(!Ji(i.precondition,o))return a;let c=kf(i.fieldTransforms,u,o),l=o.data;return l.setAll(Xm(i)),l.setAll(c),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(h=>h.field))}(n,t,e,r):function(i,o,a){return Ji(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,t,e)}function lw(n,t){let e=null;for(let r of n.fieldTransforms){let s=t.data.field(r.field),i=Km(r.transform,s||null);i!=null&&(e===null&&(e=St.empty()),e.set(r.field,i))}return e||null}function Df(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Xn(r,s,(i,o)=>uw(i,o))}(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}var Ge=class extends nr{constructor(t,e,r,s=[]){super(),this.key=t,this.value=e,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}},Qt=class extends nr{constructor(t,e,r,s,i=[]){super(),this.key=t,this.data=e,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}};function Xm(n){let t=new Map;return n.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let r=n.data.field(e);t.set(e,r)}}),t}function Vf(n,t,e){let r=new Map;R(n.length===e.length);for(let s=0;s<e.length;s++){let i=n[s],o=i.transform,a=t.data.field(i.field);r.set(i.field,aw(o,a,e[s]))}return r}function kf(n,t,e){let r=new Map;for(let s of n){let i=s.transform,o=e.data.field(s.field);r.set(s.field,ow(i,o,t))}return r}var ze=class extends nr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Es=class extends nr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var vs=class{constructor(t,e,r,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(t,e){let r=e.mutationResults;for(let s=0;s<this.mutations.length;s++){let i=this.mutations[s];i.key.isEqual(t.key)&&cw(i,t,r[s])}}applyToLocalView(t,e){for(let r of this.baseMutations)r.key.isEqual(t.key)&&(e=fs(r,t,e,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(t.key)&&(e=fs(r,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let r=jm();return this.mutations.forEach(s=>{let i=t.get(s.key),o=i.overlayedDocument,a=this.applyToLocalView(o,i.mutatedFields);a=e.has(s.key)?null:a;let u=Ym(o,a);u!==null&&r.set(s.key,u),o.isValidDocument()||o.convertToNoDocument(P.min())}),r}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),O())}isEqual(t){return this.batchId===t.batchId&&Xn(this.mutations,t.mutations,(e,r)=>Df(e,r))&&Xn(this.baseMutations,t.baseMutations,(e,r)=>Df(e,r))}},Xu=class n{constructor(t,e,r,s){this.batch=t,this.commitVersion=e,this.mutationResults=r,this.docVersions=s}static from(t,e,r){R(t.mutations.length===r.length);let s=function(){return rw}(),i=t.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new n(t,e,r,s)}};var As=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Ju=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var at,L;function Jm(n){switch(n){default:return S();case g.CANCELLED:case g.UNKNOWN:case g.DEADLINE_EXCEEDED:case g.RESOURCE_EXHAUSTED:case g.INTERNAL:case g.UNAVAILABLE:case g.UNAUTHENTICATED:return!1;case g.INVALID_ARGUMENT:case g.NOT_FOUND:case g.ALREADY_EXISTS:case g.PERMISSION_DENIED:case g.FAILED_PRECONDITION:case g.ABORTED:case g.OUT_OF_RANGE:case g.UNIMPLEMENTED:case g.DATA_LOSS:return!0}}function Zm(n){if(n===void 0)return st("GRPC error has no .code"),g.UNKNOWN;switch(n){case at.OK:return g.OK;case at.CANCELLED:return g.CANCELLED;case at.UNKNOWN:return g.UNKNOWN;case at.DEADLINE_EXCEEDED:return g.DEADLINE_EXCEEDED;case at.RESOURCE_EXHAUSTED:return g.RESOURCE_EXHAUSTED;case at.INTERNAL:return g.INTERNAL;case at.UNAVAILABLE:return g.UNAVAILABLE;case at.UNAUTHENTICATED:return g.UNAUTHENTICATED;case at.INVALID_ARGUMENT:return g.INVALID_ARGUMENT;case at.NOT_FOUND:return g.NOT_FOUND;case at.ALREADY_EXISTS:return g.ALREADY_EXISTS;case at.PERMISSION_DENIED:return g.PERMISSION_DENIED;case at.FAILED_PRECONDITION:return g.FAILED_PRECONDITION;case at.ABORTED:return g.ABORTED;case at.OUT_OF_RANGE:return g.OUT_OF_RANGE;case at.UNIMPLEMENTED:return g.UNIMPLEMENTED;case at.DATA_LOSS:return g.DATA_LOSS;default:return S()}}(L=at||(at={}))[L.OK=0]="OK",L[L.CANCELLED=1]="CANCELLED",L[L.UNKNOWN=2]="UNKNOWN",L[L.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",L[L.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",L[L.NOT_FOUND=5]="NOT_FOUND",L[L.ALREADY_EXISTS=6]="ALREADY_EXISTS",L[L.PERMISSION_DENIED=7]="PERMISSION_DENIED",L[L.UNAUTHENTICATED=16]="UNAUTHENTICATED",L[L.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",L[L.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",L[L.ABORTED=10]="ABORTED",L[L.OUT_OF_RANGE=11]="OUT_OF_RANGE",L[L.UNIMPLEMENTED=12]="UNIMPLEMENTED",L[L.INTERNAL=13]="INTERNAL",L[L.UNAVAILABLE=14]="UNAVAILABLE",L[L.DATA_LOSS=15]="DATA_LOSS";var Nf=null;function tg(){return new TextEncoder}var hw=new tn([4294967295,4294967295],0);function Of(n){let t=tg().encode(n),e=new mf;return e.update(t),new Uint8Array(e.digest())}function Ff(n){let t=new DataView(n.buffer),e=t.getUint32(0,!0),r=t.getUint32(4,!0),s=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new tn([e,r],0),new tn([s,i],0)]}var Zu=class n{constructor(t,e,r){if(this.bitmap=t,this.padding=e,this.hashCount=r,e<0||e>=8)throw new un(`Invalid padding: ${e}`);if(r<0)throw new un(`Invalid hash count: ${r}`);if(t.length>0&&this.hashCount===0)throw new un(`Invalid hash count: ${r}`);if(t.length===0&&e!==0)throw new un(`Invalid padding when bitmap length is 0: ${e}`);this.Te=8*t.length-e,this.Ee=tn.fromNumber(this.Te)}de(t,e,r){let s=t.add(e.multiply(tn.fromNumber(r)));return s.compare(hw)===1&&(s=new tn([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Ee).toNumber()}Ae(t){return(this.bitmap[Math.floor(t/8)]&1<<t%8)!=0}mightContain(t){if(this.Te===0)return!1;let e=Of(t),[r,s]=Ff(e);for(let i=0;i<this.hashCount;i++){let o=this.de(r,s,i);if(!this.Ae(o))return!1}return!0}static create(t,e,r){let s=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),o=new n(i,s,e);return r.forEach(a=>o.insert(a)),o}insert(t){if(this.Te===0)return;let e=Of(t),[r,s]=Ff(e);for(let i=0;i<this.hashCount;i++){let o=this.de(r,s,i);this.Re(o)}}Re(t){let e=Math.floor(t/8),r=t%8;this.bitmap[e]|=1<<r}},un=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Ss=class n{constructor(t,e,r,s,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,r){let s=new Map;return s.set(t,Rs.createSynthesizedTargetChangeForCurrentChange(t,e,r)),new n(P.min(),s,new H(N),kt(),O())}},Rs=class n{constructor(t,e,r,s,i){this.resumeToken=t,this.current=e,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,r){return new n(r,e,O(),O(),O())}};var Yn=class{constructor(t,e,r,s){this.Ve=t,this.removedTargetIds=e,this.key=r,this.me=s}},mo=class{constructor(t,e){this.targetId=t,this.fe=e}},go=class{constructor(t,e,r=pt.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=r,this.cause=s}},po=class{constructor(){this.ge=0,this.pe=Lf(),this.ye=pt.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return this.ge!==0}get De(){return this.Se}Ce(t){t.approximateByteSize()>0&&(this.Se=!0,this.ye=t)}ve(){let t=O(),e=O(),r=O();return this.pe.forEach((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:r=r.add(s);break;default:S()}}),new Rs(this.ye,this.we,t,e,r)}Fe(){this.Se=!1,this.pe=Lf()}Me(t,e){this.Se=!0,this.pe=this.pe.insert(t,e)}xe(t){this.Se=!0,this.pe=this.pe.remove(t)}Oe(){this.ge+=1}Ne(){this.ge-=1,R(this.ge>=0)}Le(){this.Se=!0,this.we=!0}},tc=class{constructor(t){this.Be=t,this.ke=new Map,this.qe=kt(),this.Qe=Mf(),this.Ke=new H(N)}$e(t){for(let e of t.Ve)t.me&&t.me.isFoundDocument()?this.Ue(e,t.me):this.We(e,t.key,t.me);for(let e of t.removedTargetIds)this.We(e,t.key,t.me)}Ge(t){this.forEachTarget(t,e=>{let r=this.ze(e);switch(t.state){case 0:this.je(e)&&r.Ce(t.resumeToken);break;case 1:r.Ne(),r.be||r.Fe(),r.Ce(t.resumeToken);break;case 2:r.Ne(),r.be||this.removeTarget(e);break;case 3:this.je(e)&&(r.Le(),r.Ce(t.resumeToken));break;case 4:this.je(e)&&(this.He(e),r.Ce(t.resumeToken));break;default:S()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ke.forEach((r,s)=>{this.je(s)&&e(s)})}Je(t){let e=t.targetId,r=t.fe.count,s=this.Ye(e);if(s){let i=s.target;if(lo(i))if(r===0){let o=new E(i.path);this.We(e,o,ht.newNoDocument(o,P.min()))}else R(r===1);else{let o=this.Ze(e);if(o!==r){let a=this.Xe(t),u=a?this.et(a,t,o):1;if(u!==0){this.He(e);let c=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(e,c)}Nf==null||Nf.tt(function(l,h,d,f,T){var I,w,C,D,b,x;let M={localCacheCount:l,existenceFilterCount:h.count,databaseId:d.database,projectId:d.projectId},k=h.unchangedNames;return k&&(M.bloomFilter={applied:T===0,hashCount:(I=k==null?void 0:k.hashCount)!==null&&I!==void 0?I:0,bitmapLength:(D=(C=(w=k==null?void 0:k.bits)===null||w===void 0?void 0:w.bitmap)===null||C===void 0?void 0:C.length)!==null&&D!==void 0?D:0,padding:(x=(b=k==null?void 0:k.bits)===null||b===void 0?void 0:b.padding)!==null&&x!==void 0?x:0,mightContain:Y=>{var ft;return(ft=f==null?void 0:f.mightContain(Y))!==null&&ft!==void 0&&ft}}),M}(o,t.fe,this.Be.nt(),a,u))}}}}Xe(t){let e=t.fe.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=e,o,a;try{o=Le(r).toUint8Array()}catch(u){if(u instanceof ao)return Bt("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new Zu(o,s,i)}catch(u){return Bt(u instanceof un?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return a.Te===0?null:a}et(t,e,r){return e.fe.count===r-this.rt(t,e.targetId)?0:2}rt(t,e){let r=this.Be.getRemoteKeysForTarget(e),s=0;return r.forEach(i=>{let o=this.Be.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;t.mightContain(a)||(this.We(e,i,null),s++)}),s}it(t){let e=new Map;this.ke.forEach((i,o)=>{let a=this.Ye(o);if(a){if(i.current&&lo(a.target)){let u=new E(a.target.path);this.qe.get(u)!==null||this.st(o,u)||this.We(o,u,ht.newNoDocument(u,t))}i.De&&(e.set(o,i.ve()),i.Fe())}});let r=O();this.Qe.forEach((i,o)=>{let a=!0;o.forEachWhile(u=>{let c=this.Ye(u);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.qe.forEach((i,o)=>o.setReadTime(t));let s=new Ss(t,e,this.Ke,this.qe,r);return this.qe=kt(),this.Qe=Mf(),this.Ke=new H(N),s}Ue(t,e){if(!this.je(t))return;let r=this.st(t,e.key)?2:0;this.ze(t).Me(e.key,r),this.qe=this.qe.insert(e.key,e),this.Qe=this.Qe.insert(e.key,this.ot(e.key).add(t))}We(t,e,r){if(!this.je(t))return;let s=this.ze(t);this.st(t,e)?s.Me(e,1):s.xe(e),this.Qe=this.Qe.insert(e,this.ot(e).delete(t)),r&&(this.qe=this.qe.insert(e,r))}removeTarget(t){this.ke.delete(t)}Ze(t){let e=this.ze(t).ve();return this.Be.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Oe(t){this.ze(t).Oe()}ze(t){let e=this.ke.get(t);return e||(e=new po,this.ke.set(t,e)),e}ot(t){let e=this.Qe.get(t);return e||(e=new $(N),this.Qe=this.Qe.insert(t,e)),e}je(t){let e=this.Ye(t)!==null;return e||y("WatchChangeAggregator","Detected inactive target",t),e}Ye(t){let e=this.ke.get(t);return e&&e.be?null:this.Be._t(t)}He(t){this.ke.set(t,new po),this.Be.getRemoteKeysForTarget(t).forEach(e=>{this.We(t,e,null)})}st(t,e){return this.Be.getRemoteKeysForTarget(t).has(e)}};function Mf(){return new H(E.comparator)}function Lf(){return new H(E.comparator)}var dw={asc:"ASCENDING",desc:"DESCENDING"},fw={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},mw={and:"AND",or:"OR"},ec=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function nc(n,t){return n.useProto3Json||Ls(t)?t:{value:t}}function rr(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function eg(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function gw(n,t){return rr(n,t.toTimestamp())}function ot(n){return R(!!n),P.fromTimestamp(function(e){let r=Te(e);return new Z(r.seconds,r.nanos)}(n))}function Cl(n,t){return rc(n,t).canonicalString()}function rc(n,t){let e=function(s){return new U(["projects",s.projectId,"databases",s.database])}(n).child("documents");return t===void 0?e:e.child(t)}function ng(n){let t=U.fromString(n);return R(dg(t)),t}function bs(n,t){return Cl(n.databaseId,t.path)}function oe(n,t){let e=ng(t);if(e.get(1)!==n.databaseId.projectId)throw new _(g.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new _(g.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new E(ig(e))}function rg(n,t){return Cl(n.databaseId,t)}function sg(n){let t=ng(n);return t.length===4?U.emptyPath():ig(t)}function sc(n){return new U(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function ig(n){return R(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Uf(n,t,e){return{name:bs(n,t),fields:e.value.mapValue.fields}}function og(n,t,e){let r=oe(n,t.name),s=ot(t.updateTime),i=t.createTime?ot(t.createTime):P.min(),o=new St({mapValue:{fields:t.fields}}),a=ht.newFoundDocument(r,s,i,o);return e&&a.setHasCommittedMutations(),e?a.setHasCommittedMutations():a}function pw(n,t){return"found"in t?function(r,s){R(!!s.found),s.found.name,s.found.updateTime;let i=oe(r,s.found.name),o=ot(s.found.updateTime),a=s.found.createTime?ot(s.found.createTime):P.min(),u=new St({mapValue:{fields:s.found.fields}});return ht.newFoundDocument(i,o,a,u)}(n,t):"missing"in t?function(r,s){R(!!s.missing),R(!!s.readTime);let i=oe(r,s.missing),o=ot(s.readTime);return ht.newNoDocument(i,o)}(n,t):S()}function _w(n,t){let e;if("targetChange"in t){t.targetChange;let r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:S()}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],i=function(c,l){return c.useProto3Json?(R(l===void 0||typeof l=="string"),pt.fromBase64String(l||"")):(R(l===void 0||l instanceof Buffer||l instanceof Uint8Array),pt.fromUint8Array(l||new Uint8Array))}(n,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(c){let l=c.code===void 0?g.UNKNOWN:Zm(c.code);return new _(l,c.message||"")}(o);e=new go(r,s,i,a||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let s=oe(n,r.document.name),i=ot(r.document.updateTime),o=r.document.createTime?ot(r.document.createTime):P.min(),a=new St({mapValue:{fields:r.document.fields}}),u=ht.newFoundDocument(s,i,o,a),c=r.targetIds||[],l=r.removedTargetIds||[];e=new Yn(c,l,u.key,u)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let s=oe(n,r.document),i=r.readTime?ot(r.readTime):P.min(),o=ht.newNoDocument(s,i),a=r.removedTargetIds||[];e=new Yn([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let s=oe(n,r.document),i=r.removedTargetIds||[];e=new Yn([],i,s,null)}else{if(!("filter"in t))return S();{t.filter;let r=t.filter;r.targetId;let{count:s=0,unchangedNames:i}=r,o=new Ju(s,i),a=r.targetId;e=new mo(a,o)}}return e}function Ps(n,t){let e;if(t instanceof Ge)e={update:Uf(n,t.key,t.value)};else if(t instanceof ze)e={delete:bs(n,t.key)};else if(t instanceof Qt)e={update:Uf(n,t.key,t.data),updateMask:vw(t.fieldMask)};else{if(!(t instanceof Es))return S();e={verify:bs(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(r=>function(i,o){let a=o.transform;if(a instanceof Be)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Ie)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Ee)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof je)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw S()}(0,r))),t.precondition.isNone||(e.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:gw(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:S()}(n,t.precondition)),e}function ic(n,t){let e=t.currentDocument?function(i){return i.updateTime!==void 0?rt.updateTime(ot(i.updateTime)):i.exists!==void 0?rt.exists(i.exists):rt.none()}(t.currentDocument):rt.none(),r=t.updateTransforms?t.updateTransforms.map(s=>function(o,a){let u=null;if("setToServerValue"in a)R(a.setToServerValue==="REQUEST_TIME"),u=new Be;else if("appendMissingElements"in a){let l=a.appendMissingElements.values||[];u=new Ie(l)}else if("removeAllFromArray"in a){let l=a.removeAllFromArray.values||[];u=new Ee(l)}else"increment"in a?u=new je(o,a.increment):S();let c=it.fromServerFormat(a.fieldPath);return new mn(c,u)}(n,s)):[];if(t.update){t.update.name;let s=oe(n,t.update.name),i=new St({mapValue:{fields:t.update.fields}});if(t.updateMask){let o=function(u){let c=u.fieldPaths||[];return new Mt(c.map(l=>it.fromServerFormat(l)))}(t.updateMask);return new Qt(s,i,o,e,r)}return new Ge(s,i,e,r)}if(t.delete){let s=oe(n,t.delete);return new ze(s,e)}if(t.verify){let s=oe(n,t.verify);return new Es(s,e)}return S()}function yw(n,t){return n&&n.length>0?(R(t!==void 0),n.map(e=>function(s,i){let o=s.updateTime?ot(s.updateTime):ot(i);return o.isEqual(P.min())&&(o=ot(i)),new Yu(o,s.transformResults||[])}(e,t))):[]}function ag(n,t){return{documents:[rg(n,t.path)]}}function ug(n,t){let e={structuredQuery:{}},r=t.path,s;t.collectionGroup!==null?(s=r,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=r.popLast(),e.structuredQuery.from=[{collectionId:r.lastSegment()}]),e.parent=rg(n,s);let i=function(c){if(c.length!==0)return hg(z.create(c,"and"))}(t.filters);i&&(e.structuredQuery.where=i);let o=function(c){if(c.length!==0)return c.map(l=>function(d){return{field:zn(d.field),direction:Tw(d.dir)}}(l))}(t.orderBy);o&&(e.structuredQuery.orderBy=o);let a=nc(n,t.limit);return a!==null&&(e.structuredQuery.limit=a),t.startAt&&(e.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(t.endAt)),{ut:e,parent:s}}function cg(n){let t=sg(n.parent),e=n.structuredQuery,r=e.from?e.from.length:0,s=null;if(r>0){R(r===1);let l=e.from[0];l.allDescendants?s=l.collectionId:t=t.child(l.collectionId)}let i=[];e.where&&(i=function(h){let d=lg(h);return d instanceof z&&Rl(d)?d.getFilters():[d]}(e.where));let o=[];e.orderBy&&(o=function(h){return h.map(d=>function(T){return new dn($n(T.field),function(w){switch(w){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(T.direction))}(d))}(e.orderBy));let a=null;e.limit&&(a=function(h){let d;return d=typeof h=="object"?h.value:h,Ls(d)?null:d}(e.limit));let u=null;e.startAt&&(u=function(h){let d=!!h.before,f=h.values||[];return new ce(f,d)}(e.startAt));let c=null;return e.endAt&&(c=function(h){let d=!h.before,f=h.values||[];return new ce(f,d)}(e.endAt)),Fm(t,s,o,i,a,"F",u,c)}function ww(n,t){let e=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return S()}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function lg(n){return n.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let r=$n(e.unaryFilter.field);return F.create(r,"==",{doubleValue:NaN});case"IS_NULL":let s=$n(e.unaryFilter.field);return F.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let i=$n(e.unaryFilter.field);return F.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=$n(e.unaryFilter.field);return F.create(o,"!=",{nullValue:"NULL_VALUE"});default:return S()}}(n):n.fieldFilter!==void 0?function(e){return F.create($n(e.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return S()}}(e.fieldFilter.op),e.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(e){return z.create(e.compositeFilter.filters.map(r=>lg(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return S()}}(e.compositeFilter.op))}(n):S()}function Tw(n){return dw[n]}function Iw(n){return fw[n]}function Ew(n){return mw[n]}function zn(n){return{fieldPath:n.canonicalString()}}function $n(n){return it.fromServerFormat(n.fieldPath)}function hg(n){return n instanceof F?function(e){if(e.op==="=="){if(Ef(e.value))return{unaryFilter:{field:zn(e.field),op:"IS_NAN"}};if(If(e.value))return{unaryFilter:{field:zn(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(Ef(e.value))return{unaryFilter:{field:zn(e.field),op:"IS_NOT_NAN"}};if(If(e.value))return{unaryFilter:{field:zn(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:zn(e.field),op:Iw(e.op),value:e.value}}}(n):n instanceof z?function(e){let r=e.getFilters().map(s=>hg(s));return r.length===1?r[0]:{compositeFilter:{op:Ew(e.op),filters:r}}}(n):S()}function vw(n){let t=[];return n.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function dg(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var sr=class n{constructor(t,e,r,s,i=P.min(),o=P.min(),a=pt.EMPTY_BYTE_STRING,u=null){this.target=t,this.targetId=e,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(t){return new n(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var _o=class{constructor(t){this.ct=t}};function Aw(n,t){let e;if(t.document)e=og(n.ct,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let r=E.fromSegments(t.noDocument.path),s=pn(t.noDocument.readTime);e=ht.newNoDocument(r,s),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return S();{let r=E.fromSegments(t.unknownDocument.path),s=pn(t.unknownDocument.version);e=ht.newUnknownDocument(r,s)}}return t.readTime&&e.setReadTime(function(s){let i=new Z(s[0],s[1]);return P.fromTimestamp(i)}(t.readTime)),e}function qf(n,t){let e=t.key,r={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:yo(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(i,o){return{name:bs(i,o.key),fields:o.data.value.mapValue.fields,updateTime:rr(i,o.version.toTimestamp()),createTime:rr(i,o.createTime.toTimestamp())}}(n.ct,t);else if(t.isNoDocument())r.noDocument={path:e.path.toArray(),readTime:gn(t.version)};else{if(!t.isUnknownDocument())return S();r.unknownDocument={path:e.path.toArray(),version:gn(t.version)}}return r}function yo(n){let t=n.toTimestamp();return[t.seconds,t.nanoseconds]}function gn(n){let t=n.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function pn(n){let t=new Z(n.seconds,n.nanoseconds);return P.fromTimestamp(t)}function sn(n,t){let e=(t.baseMutations||[]).map(i=>ic(n.ct,i));for(let i=0;i<t.mutations.length-1;++i){let o=t.mutations[i];if(i+1<t.mutations.length&&t.mutations[i+1].transform!==void 0){let a=t.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,t.mutations.splice(i+1,1),++i}}let r=t.mutations.map(i=>ic(n.ct,i)),s=Z.fromMillis(t.localWriteTimeMs);return new vs(t.batchId,s,e,r)}function ls(n){let t=pn(n.readTime),e=n.lastLimboFreeSnapshotVersion!==void 0?pn(n.lastLimboFreeSnapshotVersion):P.min(),r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return R(i.documents.length===1),xt(gr(sg(i.documents[0])))}(n.query):function(i){return xt(cg(i))}(n.query),new sr(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,t,e,pt.fromBase64String(n.resumeToken))}function fg(n,t){let e=gn(t.snapshotVersion),r=gn(t.lastLimboFreeSnapshotVersion),s;s=lo(t.target)?ag(n.ct,t.target):ug(n.ct,t.target).ut;let i=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:fn(t.target),readTime:e,resumeToken:i,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function xl(n){let t=cg({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?fo(t,t.limit,"L"):t}function Tu(n,t){return new As(t.largestBatchId,ic(n.ct,t.overlayMutation))}function Bf(n,t){let e=t.path.lastSegment();return[n,Ct(t.path.popLast()),e]}function jf(n,t,e,r){return{indexId:n,uid:t,sequenceNumber:e,readTime:gn(r.readTime),documentKey:Ct(r.documentKey.path),largestBatchId:r.largestBatchId}}var oc=class{getBundleMetadata(t,e){return Gf(t).get(e).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:pn(i.createTime),version:i.version}}(r)})}saveBundleMetadata(t,e){return Gf(t).put(function(s){return{bundleId:s.id,createTime:gn(ot(s.createTime)),version:s.version}}(e))}getNamedQuery(t,e){return zf(t).get(e).next(r=>{if(r)return function(i){return{name:i.name,query:xl(i.bundledQuery),readTime:pn(i.readTime)}}(r)})}saveNamedQuery(t,e){return zf(t).put(function(s){return{name:s.name,readTime:gn(ot(s.readTime)),bundledQuery:s.bundledQuery}}(e))}};function Gf(n){return _t(n,"bundles")}function zf(n){return _t(n,"namedQueries")}var wo=class n{constructor(t,e){this.serializer=t,this.userId=e}static lt(t,e){let r=e.uid||"";return new n(t,r)}getOverlay(t,e){return is(t).get(Bf(this.userId,e)).next(r=>r?Tu(this.serializer,r):null)}getOverlays(t,e){let r=se();return m.forEach(e,s=>this.getOverlay(t,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(t,e,r){let s=[];return r.forEach((i,o)=>{let a=new As(e,o);s.push(this.ht(t,a))}),m.waitFor(s)}removeOverlaysForBatchId(t,e,r){let s=new Set;e.forEach(o=>s.add(Ct(o.getCollectionPath())));let i=[];return s.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(is(t).H("collectionPathOverlayIndex",a))}),m.waitFor(i)}getOverlaysForCollection(t,e,r){let s=se(),i=Ct(e),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return is(t).W("collectionPathOverlayIndex",o).next(a=>{for(let u of a){let c=Tu(this.serializer,u);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(t,e,r,s){let i=se(),o,a=IDBKeyRange.bound([this.userId,e,r],[this.userId,e,Number.POSITIVE_INFINITY],!0);return is(t).Y({index:"collectionGroupOverlayIndex",range:a},(u,c,l)=>{let h=Tu(this.serializer,c);i.size()<s||h.largestBatchId===o?(i.set(h.getKey(),h),o=h.largestBatchId):l.done()}).next(()=>i)}ht(t,e){return is(t).put(function(s,i,o){let[a,u,c]=Bf(i,o.mutation.key);return{userId:i,collectionPath:u,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Ps(s.ct,o.mutation)}}(this.serializer,this.userId,e))}};function is(n){return _t(n,"documentOverlays")}var _e=class{constructor(){}Pt(t,e){this.It(t,e),e.Tt()}It(t,e){if("nullValue"in t)this.Et(e,5);else if("booleanValue"in t)this.Et(e,10),e.dt(t.booleanValue?1:0);else if("integerValue"in t)this.Et(e,15),e.dt(nt(t.integerValue));else if("doubleValue"in t){let r=nt(t.doubleValue);isNaN(r)?this.Et(e,13):(this.Et(e,15),_s(r)?e.dt(0):e.dt(r))}else if("timestampValue"in t){let r=t.timestampValue;this.Et(e,20),typeof r=="string"&&(r=Te(r)),e.At(`${r.seconds||""}`),e.dt(r.nanos||0)}else if("stringValue"in t)this.Rt(t.stringValue,e),this.Vt(e);else if("bytesValue"in t)this.Et(e,30),e.ft(Le(t.bytesValue)),this.Vt(e);else if("referenceValue"in t)this.gt(t.referenceValue,e);else if("geoPointValue"in t){let r=t.geoPointValue;this.Et(e,45),e.dt(r.latitude||0),e.dt(r.longitude||0)}else"mapValue"in t?Cm(t)?this.Et(e,Number.MAX_SAFE_INTEGER):(this.yt(t.mapValue,e),this.Vt(e)):"arrayValue"in t?(this.wt(t.arrayValue,e),this.Vt(e)):S()}Rt(t,e){this.Et(e,25),this.St(t,e)}St(t,e){e.At(t)}yt(t,e){let r=t.fields||{};this.Et(e,55);for(let s of Object.keys(r))this.Rt(s,e),this.It(r[s],e)}wt(t,e){let r=t.values||[];this.Et(e,50);for(let s of r)this.It(s,e)}gt(t,e){this.Et(e,37),E.fromName(t).path.forEach(r=>{this.Et(e,60),this.St(r,e)})}Et(t,e){t.dt(e)}Vt(t){t.dt(2)}};_e.bt=new _e;function Sw(n){if(n===0)return 8;let t=0;return!(n>>4)&&(t+=4,n<<=4),!(n>>6)&&(t+=2,n<<=2),!(n>>7)&&(t+=1),t}function $f(n){let t=64-function(r){let s=0;for(let i=0;i<8;++i){let o=Sw(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(t/8)}var ac=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(t){let e=t[Symbol.iterator](),r=e.next();for(;!r.done;)this.Ct(r.value),r=e.next();this.vt()}Ft(t){let e=t[Symbol.iterator](),r=e.next();for(;!r.done;)this.Mt(r.value),r=e.next();this.xt()}Ot(t){for(let e of t){let r=e.charCodeAt(0);if(r<128)this.Ct(r);else if(r<2048)this.Ct(960|r>>>6),this.Ct(128|63&r);else if(e<"\uD800"||"\uDBFF"<e)this.Ct(480|r>>>12),this.Ct(128|63&r>>>6),this.Ct(128|63&r);else{let s=e.codePointAt(0);this.Ct(240|s>>>18),this.Ct(128|63&s>>>12),this.Ct(128|63&s>>>6),this.Ct(128|63&s)}}this.vt()}Nt(t){for(let e of t){let r=e.charCodeAt(0);if(r<128)this.Mt(r);else if(r<2048)this.Mt(960|r>>>6),this.Mt(128|63&r);else if(e<"\uD800"||"\uDBFF"<e)this.Mt(480|r>>>12),this.Mt(128|63&r>>>6),this.Mt(128|63&r);else{let s=e.codePointAt(0);this.Mt(240|s>>>18),this.Mt(128|63&s>>>12),this.Mt(128|63&s>>>6),this.Mt(128|63&s)}}this.xt()}Lt(t){let e=this.Bt(t),r=$f(e);this.kt(1+r),this.buffer[this.position++]=255&r;for(let s=e.length-r;s<e.length;++s)this.buffer[this.position++]=255&e[s]}qt(t){let e=this.Bt(t),r=$f(e);this.kt(1+r),this.buffer[this.position++]=~(255&r);for(let s=e.length-r;s<e.length;++s)this.buffer[this.position++]=~(255&e[s])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(t){this.kt(t.length),this.buffer.set(t,this.position),this.position+=t.length}Wt(){return this.buffer.slice(0,this.position)}Bt(t){let e=function(i){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(t),r=(128&e[0])!=0;e[0]^=r?255:128;for(let s=1;s<e.length;++s)e[s]^=r?255:0;return e}Ct(t){let e=255&t;e===0?(this.Kt(0),this.Kt(255)):e===255?(this.Kt(255),this.Kt(0)):this.Kt(e)}Mt(t){let e=255&t;e===0?(this.Ut(0),this.Ut(255)):e===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(t){this.kt(1),this.buffer[this.position++]=t}Ut(t){this.kt(1),this.buffer[this.position++]=~t}kt(t){let e=t+this.position;if(e<=this.buffer.length)return;let r=2*this.buffer.length;r<e&&(r=e);let s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}},uc=class{constructor(t){this.Gt=t}ft(t){this.Gt.Dt(t)}At(t){this.Gt.Ot(t)}dt(t){this.Gt.Lt(t)}Tt(){this.Gt.Qt()}},cc=class{constructor(t){this.Gt=t}ft(t){this.Gt.Ft(t)}At(t){this.Gt.Nt(t)}dt(t){this.Gt.qt(t)}Tt(){this.Gt.$t()}},on=class{constructor(){this.Gt=new ac,this.zt=new uc(this.Gt),this.jt=new cc(this.Gt)}seed(t){this.Gt.seed(t)}Ht(t){return t===0?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}};var an=class n{constructor(t,e,r,s){this.indexId=t,this.documentKey=e,this.arrayValue=r,this.directionalValue=s}Jt(){let t=this.directionalValue.length,e=t===0||this.directionalValue[t-1]===255?t+1:t,r=new Uint8Array(e);return r.set(this.directionalValue,0),e!==t?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function De(n,t){let e=n.indexId-t.indexId;return e!==0?e:(e=Kf(n.arrayValue,t.arrayValue),e!==0?e:(e=Kf(n.directionalValue,t.directionalValue),e!==0?e:E.comparator(n.documentKey,t.documentKey)))}function Kf(n,t){for(let e=0;e<n.length&&e<t.length;++e){let r=n[e]-t[e];if(r!==0)return r}return n.length-t.length}var To=class{constructor(t){this.Yt=new $((e,r)=>it.comparator(e.field,r.field)),this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.Zt=t.orderBy,this.Xt=[];for(let e of t.filters){let r=e;r.isInequality()?this.Yt=this.Yt.add(r):this.Xt.push(r)}}get en(){return this.Yt.size>1}tn(t){if(R(t.collectionGroup===this.collectionId),this.en)return!1;let e=Du(t);if(e!==void 0&&!this.nn(e))return!1;let r=nn(t),s=new Set,i=0,o=0;for(;i<r.length&&this.nn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Yt.size>0){let a=this.Yt.getIterator().getNext();if(!s.has(a.field.canonicalString())){let u=r[i];if(!this.rn(a,u)||!this.sn(this.Zt[o++],u))return!1}++i}for(;i<r.length;++i){let a=r[i];if(o>=this.Zt.length||!this.sn(this.Zt[o++],a))return!1}return!0}on(){if(this.en)return null;let t=new $(it.comparator),e=[];for(let r of this.Xt)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")e.push(new Wn(r.field,2));else{if(t.has(r.field))continue;t=t.add(r.field),e.push(new Wn(r.field,0))}for(let r of this.Zt)r.field.isKeyField()||t.has(r.field)||(t=t.add(r.field),e.push(new Wn(r.field,r.dir==="asc"?0:1)));return new Jn(Jn.UNKNOWN_ID,this.collectionId,e,ps.empty())}nn(t){for(let e of this.Xt)if(this.rn(e,t))return!0;return!1}rn(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;let r=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===r}sn(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}};function mg(n){var t,e;if(R(n instanceof F||n instanceof z),n instanceof F){if(n instanceof co){let s=((e=(t=n.value.arrayValue)===null||t===void 0?void 0:t.values)===null||e===void 0?void 0:e.map(i=>F.create(n.field,"==",i)))||[];return z.create(s,"or")}return n}let r=n.filters.map(s=>mg(s));return z.create(r,n.op)}function Rw(n){if(n.getFilters().length===0)return[];let t=dc(mg(n));return R(gg(t)),lc(t)||hc(t)?[t]:t.getFilters()}function lc(n){return n instanceof F}function hc(n){return n instanceof z&&Rl(n)}function gg(n){return lc(n)||hc(n)||function(e){if(e instanceof z&&Uu(e)){for(let r of e.getFilters())if(!lc(r)&&!hc(r))return!1;return!0}return!1}(n)}function dc(n){if(R(n instanceof F||n instanceof z),n instanceof F)return n;if(n.filters.length===1)return dc(n.filters[0]);let t=n.filters.map(r=>dc(r)),e=z.create(t,n.op);return e=Io(e),gg(e)?e:(R(e instanceof z),R(tr(e)),R(e.filters.length>1),e.filters.reduce((r,s)=>Dl(r,s)))}function Dl(n,t){let e;return R(n instanceof F||n instanceof z),R(t instanceof F||t instanceof z),e=n instanceof F?t instanceof F?function(s,i){return z.create([s,i],"and")}(n,t):Qf(n,t):t instanceof F?Qf(t,n):function(s,i){if(R(s.filters.length>0&&i.filters.length>0),tr(s)&&tr(i))return km(s,i.getFilters());let o=Uu(s)?s:i,a=Uu(s)?i:s,u=o.filters.map(c=>Dl(c,a));return z.create(u,"or")}(n,t),Io(e)}function Qf(n,t){if(tr(t))return km(t,n.getFilters());{let e=t.filters.map(r=>Dl(n,r));return z.create(e,"or")}}function Io(n){if(R(n instanceof F||n instanceof z),n instanceof F)return n;let t=n.getFilters();if(t.length===1)return Io(t[0]);if(Dm(n))return n;let e=t.map(s=>Io(s)),r=[];return e.forEach(s=>{s instanceof F?r.push(s):s instanceof z&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:z.create(r,n.op)}var fc=class{constructor(){this._n=new Cs}addToCollectionParentIndex(t,e){return this._n.add(e),m.resolve()}getCollectionParents(t,e){return m.resolve(this._n.getEntries(e))}addFieldIndex(t,e){return m.resolve()}deleteFieldIndex(t,e){return m.resolve()}deleteAllFieldIndexes(t){return m.resolve()}createTargetIndexes(t,e){return m.resolve()}getDocumentsMatchingTarget(t,e){return m.resolve(null)}getIndexType(t,e){return m.resolve(0)}getFieldIndexes(t,e){return m.resolve([])}getNextCollectionGroupToUpdate(t){return m.resolve(null)}getMinOffset(t,e){return m.resolve(jt.min())}getMinOffsetFromCollectionGroup(t,e){return m.resolve(jt.min())}updateCollectionGroup(t,e,r){return m.resolve()}updateIndexEntries(t,e){return m.resolve()}},Cs=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),r=t.popLast(),s=this.index[e]||new $(U.comparator),i=!s.has(r);return this.index[e]=s.add(r),i}has(t){let e=t.lastSegment(),r=t.popLast(),s=this.index[e];return s&&s.has(r)}getEntries(t){return(this.index[t]||new $(U.comparator)).toArray()}};var $i=new Uint8Array(0),mc=class{constructor(t,e){this.databaseId=e,this.an=new Cs,this.un=new le(r=>fn(r),(r,s)=>Us(r,s)),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.an.has(e)){let r=e.lastSegment(),s=e.popLast();t.addOnCommittedListener(()=>{this.an.add(e)});let i={collectionId:r,parent:Ct(s)};return Wf(t).put(i)}return m.resolve()}getCollectionParents(t,e){let r=[],s=IDBKeyRange.bound([e,""],[_m(e),""],!1,!0);return Wf(t).W(s).next(i=>{for(let o of i){if(o.collectionId!==e)break;r.push(re(o.parent))}return r})}addFieldIndex(t,e){let r=os(t),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(e);delete s.indexId;let i=r.add(s);if(e.indexState){let o=qn(t);return i.next(a=>{o.put(jf(a,this.uid,e.indexState.sequenceNumber,e.indexState.offset))})}return i.next()}deleteFieldIndex(t,e){let r=os(t),s=qn(t),i=Un(t);return r.delete(e.indexId).next(()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))}deleteAllFieldIndexes(t){let e=os(t),r=Un(t),s=qn(t);return e.H().next(()=>r.H()).next(()=>s.H())}createTargetIndexes(t,e){return m.forEach(this.cn(e),r=>this.getIndexType(t,r).next(s=>{if(s===0||s===1){let i=new To(r).on();if(i!=null)return this.addFieldIndex(t,i)}}))}getDocumentsMatchingTarget(t,e){let r=Un(t),s=!0,i=new Map;return m.forEach(this.cn(e),o=>this.ln(t,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=O(),a=[];return m.forEach(i,(u,c)=>{y("IndexedDbIndexManager",`Using index ${function(b){return`id=${b.indexId}|cg=${b.collectionGroup}|f=${b.fields.map(x=>`${x.fieldPath}:${x.kind}`).join(",")}`}(u)} to execute ${fn(e)}`);let l=function(b,x){let M=Du(x);if(M===void 0)return null;for(let k of ho(b,M.fieldPath))switch(k.op){case"array-contains-any":return k.value.arrayValue.values||[];case"array-contains":return[k.value]}return null}(c,u),h=function(b,x){let M=new Map;for(let k of nn(x))for(let Y of ho(b,k.fieldPath))switch(Y.op){case"==":case"in":M.set(k.fieldPath.canonicalString(),Y.value);break;case"not-in":case"!=":return M.set(k.fieldPath.canonicalString(),Y.value),Array.from(M.values())}return null}(c,u),d=function(b,x){let M=[],k=!0;for(let Y of nn(x)){let ft=Y.kind===0?bf(b,Y.fieldPath,b.startAt):Pf(b,Y.fieldPath,b.startAt);M.push(ft.value),k&&(k=ft.inclusive)}return new ce(M,k)}(c,u),f=function(b,x){let M=[],k=!0;for(let Y of nn(x)){let ft=Y.kind===0?Pf(b,Y.fieldPath,b.endAt):bf(b,Y.fieldPath,b.endAt);M.push(ft.value),k&&(k=ft.inclusive)}return new ce(M,k)}(c,u),T=this.hn(u,c,d),I=this.hn(u,c,f),w=this.Pn(u,c,h),C=this.In(u.indexId,l,T,d.inclusive,I,f.inclusive,w);return m.forEach(C,D=>r.j(D,e.limit).next(b=>{b.forEach(x=>{let M=E.fromSegments(x.documentKey);o.has(M)||(o=o.add(M),a.push(M))})}))}).next(()=>a)}return m.resolve(null)})}cn(t){let e=this.un.get(t);return e||(t.filters.length===0?e=[t]:e=Rw(z.create(t.filters,"and")).map(r=>Wu(t.path,t.collectionGroup,t.orderBy,r.getFilters(),t.limit,t.startAt,t.endAt)),this.un.set(t,e),e)}In(t,e,r,s,i,o,a){let u=(e!=null?e.length:1)*Math.max(r.length,i.length),c=u/(e!=null?e.length:1),l=[];for(let h=0;h<u;++h){let d=e?this.Tn(e[h/c]):$i,f=this.En(t,d,r[h%c],s),T=this.dn(t,d,i[h%c],o),I=a.map(w=>this.En(t,d,w,!0));l.push(...this.createRange(f,T,I))}return l}En(t,e,r,s){let i=new an(t,E.empty(),e,r);return s?i:i.Jt()}dn(t,e,r,s){let i=new an(t,E.empty(),e,r);return s?i.Jt():i}ln(t,e){let r=new To(e),s=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,s).next(i=>{let o=null;for(let a of i)r.tn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(t,e){let r=2,s=this.cn(e);return m.forEach(s,i=>this.ln(t,i).next(o=>{o?r!==0&&o.fields.length<function(u){let c=new $(it.comparator),l=!1;for(let h of u.filters)for(let d of h.getFlattenedFilters())d.field.isKeyField()||(d.op==="array-contains"||d.op==="array-contains-any"?l=!0:c=c.add(d.field));for(let h of u.orderBy)h.field.isKeyField()||(c=c.add(h.field));return c.size+(l?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(e)&&s.length>1&&r===2?1:r)}An(t,e){let r=new on;for(let s of nn(t)){let i=e.data.field(s.fieldPath);if(i==null)return null;let o=r.Ht(s.kind);_e.bt.Pt(i,o)}return r.Wt()}Tn(t){let e=new on;return _e.bt.Pt(t,e.Ht(0)),e.Wt()}Rn(t,e){let r=new on;return _e.bt.Pt(hn(this.databaseId,e),r.Ht(function(i){let o=nn(i);return o.length===0?0:o[o.length-1].kind}(t))),r.Wt()}Pn(t,e,r){if(r===null)return[];let s=[];s.push(new on);let i=0;for(let o of nn(t)){let a=r[i++];for(let u of s)if(this.Vn(e,o.fieldPath)&&Is(a))s=this.mn(s,o,a);else{let c=u.Ht(o.kind);_e.bt.Pt(a,c)}}return this.fn(s)}hn(t,e,r){return this.Pn(t,e,r.position)}fn(t){let e=[];for(let r=0;r<t.length;++r)e[r]=t[r].Wt();return e}mn(t,e,r){let s=[...t],i=[];for(let o of r.arrayValue.values||[])for(let a of s){let u=new on;u.seed(a.Wt()),_e.bt.Pt(o,u.Ht(e.kind)),i.push(u)}return i}Vn(t,e){return!!t.filters.find(r=>r instanceof F&&r.field.isEqual(e)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(t,e){let r=os(t),s=qn(t);return(e?r.W("collectionGroupIndex",IDBKeyRange.bound(e,e)):r.W()).next(i=>{let o=[];return m.forEach(i,a=>s.get([a.indexId,this.uid]).next(u=>{o.push(function(l,h){let d=h?new ps(h.sequenceNumber,new jt(pn(h.readTime),new E(re(h.documentKey)),h.largestBatchId)):ps.empty(),f=l.fields.map(([T,I])=>new Wn(it.fromServerFormat(T),I));return new Jn(l.indexId,l.collectionGroup,f,d)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next(e=>e.length===0?null:(e.sort((r,s)=>{let i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:N(r.collectionGroup,s.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(t,e,r){let s=os(t),i=qn(t);return this.gn(t).next(o=>s.W("collectionGroupIndex",IDBKeyRange.bound(e,e)).next(a=>m.forEach(a,u=>i.put(jf(u.indexId,this.uid,o,r)))))}updateIndexEntries(t,e){let r=new Map;return m.forEach(e,(s,i)=>{let o=r.get(s.collectionGroup);return(o?m.resolve(o):this.getFieldIndexes(t,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),m.forEach(a,u=>this.pn(t,s,u).next(c=>{let l=this.yn(i,u);return c.isEqual(l)?m.resolve():this.wn(t,i,u,c,l)}))))})}Sn(t,e,r,s){return Un(t).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.Rn(r,e.key),documentKey:e.key.path.toArray()})}bn(t,e,r,s){return Un(t).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.Rn(r,e.key),e.key.path.toArray()])}pn(t,e,r){let s=Un(t),i=new $(De);return s.Y({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.Rn(r,e)])},(o,a)=>{i=i.add(new an(r.indexId,e,a.arrayValue,a.directionalValue))}).next(()=>i)}yn(t,e){let r=new $(De),s=this.An(e,t);if(s==null)return r;let i=Du(e);if(i!=null){let o=t.data.field(i.fieldPath);if(Is(o))for(let a of o.arrayValue.values||[])r=r.add(new an(e.indexId,t.key,this.Tn(a),s))}else r=r.add(new an(e.indexId,t.key,$i,s));return r}wn(t,e,r,s,i){y("IndexedDbIndexManager","Updating index entries for document '%s'",e.key);let o=[];return function(u,c,l,h,d){let f=u.getIterator(),T=c.getIterator(),I=Ln(f),w=Ln(T);for(;I||w;){let C=!1,D=!1;if(I&&w){let b=l(I,w);b<0?D=!0:b>0&&(C=!0)}else I!=null?D=!0:C=!0;C?(h(w),w=Ln(T)):D?(d(I),I=Ln(f)):(I=Ln(f),w=Ln(T))}}(s,i,De,a=>{o.push(this.Sn(t,e,r,a))},a=>{o.push(this.bn(t,e,r,a))}),m.waitFor(o)}gn(t){let e=1;return qn(t).Y({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),e=s.sequenceNumber+1}).next(()=>e)}createRange(t,e,r){r=r.sort((o,a)=>De(o,a)).filter((o,a,u)=>!a||De(o,u[a-1])!==0);let s=[];s.push(t);for(let o of r){let a=De(o,t),u=De(o,e);if(a===0)s[0]=t.Jt();else if(a>0&&u<0)s.push(o),s.push(o.Jt());else if(u>0)break}s.push(e);let i=[];for(let o=0;o<s.length;o+=2){if(this.Dn(s[o],s[o+1]))return[];let a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,$i,[]],u=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,$i,[]];i.push(IDBKeyRange.bound(a,u))}return i}Dn(t,e){return De(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(Hf)}getMinOffset(t,e){return m.mapArray(this.cn(e),r=>this.ln(t,r).next(s=>s||S())).next(Hf)}};function Wf(n){return _t(n,"collectionParents")}function Un(n){return _t(n,"indexEntries")}function os(n){return _t(n,"indexConfiguration")}function qn(n){return _t(n,"indexState")}function Hf(n){R(n.length!==0);let t=n[0].indexState.offset,e=t.largestBatchId;for(let r=1;r<n.length;r++){let s=n[r].indexState.offset;vl(s,t)<0&&(t=s),e<s.largestBatchId&&(e=s.largestBatchId)}return new jt(t.readTime,t.documentKey,e)}var Yf={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},qt=class n{constructor(t,e,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=r}static withCacheSize(t){return new n(t,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function pg(n,t,e){let r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(e.batchId),a=0,u=r.Y({range:o},(l,h,d)=>(a++,d.delete()));i.push(u.next(()=>{R(a===1)}));let c=[];for(let l of e.mutations){let h=Em(t,l.key.path,e.batchId);i.push(s.delete(h)),c.push(l.key)}return m.waitFor(i).next(()=>c)}function Eo(n){if(!n)return 0;let t;if(n.document)t=n.document;else if(n.unknownDocument)t=n.unknownDocument;else{if(!n.noDocument)throw S();t=n.noDocument}return JSON.stringify(t).length}qt.DEFAULT_COLLECTION_PERCENTILE=10,qt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,qt.DEFAULT=new qt(41943040,qt.DEFAULT_COLLECTION_PERCENTILE,qt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),qt.DISABLED=new qt(-1,0,0);var vo=class n{constructor(t,e,r,s){this.userId=t,this.serializer=e,this.indexManager=r,this.referenceDelegate=s,this.Cn={}}static lt(t,e,r,s){R(t.uid!=="");let i=t.isAuthenticated()?t.uid:"";return new n(i,e,r,s)}checkEmpty(t){let e=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ve(t).Y({index:"userMutationsIndex",range:r},(s,i,o)=>{e=!1,o.done()}).next(()=>e)}addMutationBatch(t,e,r,s){let i=Kn(t),o=Ve(t);return o.add({}).next(a=>{R(typeof a=="number");let u=new vs(a,e,r,s),c=function(f,T,I){let w=I.baseMutations.map(D=>Ps(f.ct,D)),C=I.mutations.map(D=>Ps(f.ct,D));return{userId:T,batchId:I.batchId,localWriteTimeMs:I.localWriteTime.toMillis(),baseMutations:w,mutations:C}}(this.serializer,this.userId,u),l=[],h=new $((d,f)=>N(d.canonicalString(),f.canonicalString()));for(let d of s){let f=Em(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),l.push(o.put(c)),l.push(i.put(f,ky))}return h.forEach(d=>{l.push(this.indexManager.addToCollectionParentIndex(t,d))}),t.addOnCommittedListener(()=>{this.Cn[a]=u.keys()}),m.waitFor(l).next(()=>u)})}lookupMutationBatch(t,e){return Ve(t).get(e).next(r=>r?(R(r.userId===this.userId),sn(this.serializer,r)):null)}vn(t,e){return this.Cn[e]?m.resolve(this.Cn[e]):this.lookupMutationBatch(t,e).next(r=>{if(r){let s=r.keys();return this.Cn[e]=s,s}return null})}getNextMutationBatchAfterBatchId(t,e){let r=e+1,s=IDBKeyRange.lowerBound([this.userId,r]),i=null;return Ve(t).Y({index:"userMutationsIndex",range:s},(o,a,u)=>{a.userId===this.userId&&(R(a.batchId>=r),i=sn(this.serializer,a)),u.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(t){let e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Ve(t).Y({index:"userMutationsIndex",range:e,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(t){let e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ve(t).W("userMutationsIndex",e).next(r=>r.map(s=>sn(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(t,e){let r=Hi(this.userId,e.path),s=IDBKeyRange.lowerBound(r),i=[];return Kn(t).Y({range:s},(o,a,u)=>{let[c,l,h]=o,d=re(l);if(c===this.userId&&e.path.isEqual(d))return Ve(t).get(h).next(f=>{if(!f)throw S();R(f.userId===this.userId),i.push(sn(this.serializer,f))});u.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new $(N),s=[];return e.forEach(i=>{let o=Hi(this.userId,i.path),a=IDBKeyRange.lowerBound(o),u=Kn(t).Y({range:a},(c,l,h)=>{let[d,f,T]=c,I=re(f);d===this.userId&&i.path.isEqual(I)?r=r.add(T):h.done()});s.push(u)}),m.waitFor(s).next(()=>this.Fn(t,r))}getAllMutationBatchesAffectingQuery(t,e){let r=e.path,s=r.length+1,i=Hi(this.userId,r),o=IDBKeyRange.lowerBound(i),a=new $(N);return Kn(t).Y({range:o},(u,c,l)=>{let[h,d,f]=u,T=re(d);h===this.userId&&r.isPrefixOf(T)?T.length===s&&(a=a.add(f)):l.done()}).next(()=>this.Fn(t,a))}Fn(t,e){let r=[],s=[];return e.forEach(i=>{s.push(Ve(t).get(i).next(o=>{if(o===null)throw S();R(o.userId===this.userId),r.push(sn(this.serializer,o))}))}),m.waitFor(s).next(()=>r)}removeMutationBatch(t,e){return pg(t.ae,this.userId,e).next(r=>(t.addOnCommittedListener(()=>{this.Mn(e.batchId)}),m.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(t,s))))}Mn(t){delete this.Cn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return m.resolve();let r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return Kn(t).Y({range:r},(i,o,a)=>{if(i[0]===this.userId){let u=re(i[1]);s.push(u)}else a.done()}).next(()=>{R(s.length===0)})})}containsKey(t,e){return _g(t,this.userId,e)}xn(t){return yg(t).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function _g(n,t,e){let r=Hi(t,e.path),s=r[1],i=IDBKeyRange.lowerBound(r),o=!1;return Kn(n).Y({range:i,J:!0},(a,u,c)=>{let[l,h,d]=a;l===t&&h===s&&(o=!0),c.done()}).next(()=>o)}function Ve(n){return _t(n,"mutations")}function Kn(n){return _t(n,"documentMutations")}function yg(n){return _t(n,"mutationQueues")}var ir=class n{constructor(t){this.On=t}next(){return this.On+=2,this.On}static Nn(){return new n(0)}static Ln(){return new n(-1)}};var gc=class{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.Bn(t).next(e=>{let r=new ir(e.highestTargetId);return e.highestTargetId=r.next(),this.kn(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t){return this.Bn(t).next(e=>P.fromTimestamp(new Z(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t){return this.Bn(t).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,e,r){return this.Bn(t).next(s=>(s.highestListenSequenceNumber=e,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.kn(t,s)))}addTargetData(t,e){return this.qn(t,e).next(()=>this.Bn(t).next(r=>(r.targetCount+=1,this.Qn(e,r),this.kn(t,r))))}updateTargetData(t,e){return this.qn(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>Bn(t).delete(e.targetId)).next(()=>this.Bn(t)).next(r=>(R(r.targetCount>0),r.targetCount-=1,this.kn(t,r)))}removeTargets(t,e,r){let s=0,i=[];return Bn(t).Y((o,a)=>{let u=ls(a);u.sequenceNumber<=e&&r.get(u.targetId)===null&&(s++,i.push(this.removeTargetData(t,u)))}).next(()=>m.waitFor(i)).next(()=>s)}forEachTarget(t,e){return Bn(t).Y((r,s)=>{let i=ls(s);e(i)})}Bn(t){return Xf(t).get("targetGlobalKey").next(e=>(R(e!==null),e))}kn(t,e){return Xf(t).put("targetGlobalKey",e)}qn(t,e){return Bn(t).put(fg(this.serializer,e))}Qn(t,e){let r=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,r=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,r=!0),r}getTargetCount(t){return this.Bn(t).next(e=>e.targetCount)}getTargetData(t,e){let r=fn(e),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),i=null;return Bn(t).Y({range:s,index:"queryTargetsIndex"},(o,a,u)=>{let c=ls(a);Us(e,c.target)&&(i=c,u.done())}).next(()=>i)}addMatchingKeys(t,e,r){let s=[],i=ke(t);return e.forEach(o=>{let a=Ct(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(t,r,o))}),m.waitFor(s)}removeMatchingKeys(t,e,r){let s=ke(t);return m.forEach(e,i=>{let o=Ct(i.path);return m.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(t,r,i)])})}removeMatchingKeysForTargetId(t,e){let r=ke(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(t,e){let r=IDBKeyRange.bound([e],[e+1],!1,!0),s=ke(t),i=O();return s.Y({range:r,J:!0},(o,a,u)=>{let c=re(o[1]),l=new E(c);i=i.add(l)}).next(()=>i)}containsKey(t,e){let r=Ct(e.path),s=IDBKeyRange.bound([r],[_m(r)],!1,!0),i=0;return ke(t).Y({index:"documentTargetsIndex",J:!0,range:s},([o,a],u,c)=>{o!==0&&(i++,c.done())}).next(()=>i>0)}_t(t,e){return Bn(t).get(e).next(r=>r?ls(r):null)}};function Bn(n){return _t(n,"targets")}function Xf(n){return _t(n,"targetGlobal")}function ke(n){return _t(n,"targetDocuments")}function Jf([n,t],[e,r]){let s=N(n,e);return s===0?N(t,r):s}var pc=class{constructor(t){this.Kn=t,this.buffer=new $(Jf),this.$n=0}Un(){return++this.$n}Wn(t){let e=[t,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(e);else{let r=this.buffer.last();Jf(e,r)<0&&(this.buffer=this.buffer.delete(r).add(e))}}get maxValue(){return this.buffer.last()[0]}},_c=class{constructor(t,e,r){this.garbageCollector=t,this.asyncQueue=e,this.localStore=r,this.Gn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return this.Gn!==null}zn(t){y("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,()=>p(this,null,function*(){this.Gn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){Qe(e)?y("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):yield Ke(e)}yield this.zn(3e5)}))}},yc=class{constructor(t,e){this.jn=t,this.params=e}calculateTargetCount(t,e){return this.jn.Hn(t).next(r=>Math.floor(e/100*r))}nthSequenceNumber(t,e){if(e===0)return m.resolve(Ft._e);let r=new pc(e);return this.jn.forEachTarget(t,s=>r.Wn(s.sequenceNumber)).next(()=>this.jn.Jn(t,s=>r.Wn(s))).next(()=>r.maxValue)}removeTargets(t,e,r){return this.jn.removeTargets(t,e,r)}removeOrphanedDocuments(t,e){return this.jn.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(y("LruGarbageCollector","Garbage collection skipped; disabled"),m.resolve(Yf)):this.getCacheSize(t).next(r=>r<this.params.cacheSizeCollectionThreshold?(y("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Yf):this.Yn(t,e))}getCacheSize(t){return this.jn.getCacheSize(t)}Yn(t,e){let r,s,i,o,a,u,c,l=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(y("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),s=this.params.maximumSequenceNumbersToCollect):s=h,o=Date.now(),this.nthSequenceNumber(t,s))).next(h=>(r=h,a=Date.now(),this.removeTargets(t,r,e))).next(h=>(i=h,u=Date.now(),this.removeOrphanedDocuments(t,r))).next(h=>(c=Date.now(),jn()<=Zt.DEBUG&&y("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-l}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(u-a)+`ms
	Removed ${h} documents in `+(c-u)+`ms
Total Duration: ${c-l}ms`),m.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:h})))}};function bw(n,t){return new yc(n,t)}var wc=class{constructor(t,e){this.db=t,this.garbageCollector=bw(this,e)}Hn(t){let e=this.Zn(t);return this.db.getTargetCache().getTargetCount(t).next(r=>e.next(s=>r+s))}Zn(t){let e=0;return this.Jn(t,r=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}Jn(t,e){return this.Xn(t,(r,s)=>e(s))}addReference(t,e,r){return Ki(t,r)}removeReference(t,e,r){return Ki(t,r)}removeTargets(t,e,r){return this.db.getTargetCache().removeTargets(t,e,r)}markPotentiallyOrphaned(t,e){return Ki(t,e)}er(t,e){return function(s,i){let o=!1;return yg(s).Z(a=>_g(s,a,i).next(u=>(u&&(o=!0),m.resolve(!u)))).next(()=>o)}(t,e)}removeOrphanedDocuments(t,e){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],i=0;return this.Xn(t,(o,a)=>{if(a<=e){let u=this.er(t,o).next(c=>{if(!c)return i++,r.getEntry(t,o).next(()=>(r.removeEntry(o,P.min()),ke(t).delete(function(h){return[0,Ct(h.path)]}(o))))});s.push(u)}}).next(()=>m.waitFor(s)).next(()=>r.apply(t)).next(()=>i)}removeTarget(t,e){let r=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,r)}updateLimboDocument(t,e){return Ki(t,e)}Xn(t,e){let r=ke(t),s,i=Ft._e;return r.Y({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{o===0?(i!==Ft._e&&e(new E(re(s)),i),i=c,s=u):i=Ft._e}).next(()=>{i!==Ft._e&&e(new E(re(s)),i)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}};function Ki(n,t){return ke(n).put(function(r,s){return{targetId:0,path:Ct(r.path),sequenceNumber:s}}(t,n.currentSequenceNumber))}var Ao=class{constructor(){this.changes=new le(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,ht.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let r=this.changes.get(e);return r!==void 0?m.resolve(r):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var Tc=class{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,r){return en(t).put(r)}removeEntry(t,e,r){return en(t).delete(function(i,o){let a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],yo(o),a[a.length-1]]}(e,r))}updateMetadata(t,e){return this.getMetadata(t).next(r=>(r.byteSize+=e,this.tr(t,r)))}getEntry(t,e){let r=ht.newInvalidDocument(e);return en(t).Y({index:"documentKeyIndex",range:IDBKeyRange.only(as(e))},(s,i)=>{r=this.nr(e,i)}).next(()=>r)}rr(t,e){let r={size:0,document:ht.newInvalidDocument(e)};return en(t).Y({index:"documentKeyIndex",range:IDBKeyRange.only(as(e))},(s,i)=>{r={document:this.nr(e,i),size:Eo(i)}}).next(()=>r)}getEntries(t,e){let r=kt();return this.ir(t,e,(s,i)=>{let o=this.nr(s,i);r=r.insert(s,o)}).next(()=>r)}sr(t,e){let r=kt(),s=new H(E.comparator);return this.ir(t,e,(i,o)=>{let a=this.nr(i,o);r=r.insert(i,a),s=s.insert(i,Eo(o))}).next(()=>({documents:r,_r:s}))}ir(t,e,r){if(e.isEmpty())return m.resolve();let s=new $(em);e.forEach(u=>s=s.add(u));let i=IDBKeyRange.bound(as(s.first()),as(s.last())),o=s.getIterator(),a=o.getNext();return en(t).Y({index:"documentKeyIndex",range:i},(u,c,l)=>{let h=E.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&em(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?l.U(as(a)):l.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(t,e,r,s,i){let o=e.path,a=[o.popLast().toArray(),o.lastSegment(),yo(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return en(t).W(IDBKeyRange.bound(a,u,!0)).next(c=>{i==null||i.incrementDocumentReadCount(c.length);let l=kt();for(let h of c){let d=this.nr(E.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);d.isFoundDocument()&&(Bs(e,d)||s.has(d.key))&&(l=l.insert(d.key,d))}return l})}getAllFromCollectionGroup(t,e,r,s){let i=kt(),o=tm(e,r),a=tm(e,jt.max());return en(t).Y({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,l)=>{let h=this.nr(E.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(h.key,h),i.size===s&&l.done()}).next(()=>i)}newChangeBuffer(t){return new Ic(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next(e=>e.byteSize)}getMetadata(t){return Zf(t).get("remoteDocumentGlobalKey").next(e=>(R(!!e),e))}tr(t,e){return Zf(t).put("remoteDocumentGlobalKey",e)}nr(t,e){if(e){let r=Aw(this.serializer,e);if(!(r.isNoDocument()&&r.version.isEqual(P.min())))return r}return ht.newInvalidDocument(t)}};function wg(n){return new Tc(n)}var Ic=class extends Ao{constructor(t,e){super(),this.ar=t,this.trackRemovals=e,this.ur=new le(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(t){let e=[],r=0,s=new $((i,o)=>N(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{let a=this.ur.get(i);if(e.push(this.ar.removeEntry(t,i,a.readTime)),o.isValidDocument()){let u=qf(this.ar.serializer,o);s=s.add(i.path.popLast());let c=Eo(u);r+=c-a.size,e.push(this.ar.addEntry(t,i,u))}else if(r-=a.size,this.trackRemovals){let u=qf(this.ar.serializer,o.convertToNoDocument(P.min()));e.push(this.ar.addEntry(t,i,u))}}),s.forEach(i=>{e.push(this.ar.indexManager.addToCollectionParentIndex(t,i))}),e.push(this.ar.updateMetadata(t,r)),m.waitFor(e)}getFromCache(t,e){return this.ar.rr(t,e).next(r=>(this.ur.set(e,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(t,e){return this.ar.sr(t,e).next(({documents:r,_r:s})=>(s.forEach((i,o)=>{this.ur.set(i,{size:o,readTime:r.get(i).readTime})}),r))}};function Zf(n){return _t(n,"remoteDocumentGlobal")}function en(n){return _t(n,"remoteDocumentsV14")}function as(n){let t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function tm(n,t){let e=t.documentKey.path.toArray();return[n,yo(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function em(n,t){let e=n.path.toArray(),r=t.path.toArray(),s=0;for(let i=0;i<e.length-2&&i<r.length-2;++i)if(s=N(e[i],r[i]),s)return s;return s=N(e.length,r.length),s||(s=N(e[e.length-2],r[r.length-2]),s||N(e[e.length-1],r[r.length-1]))}var Ec=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var So=class{constructor(t,e,r,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=r,this.indexManager=s}getDocument(t,e){let r=null;return this.documentOverlayCache.getOverlay(t,e).next(s=>(r=s,this.remoteDocumentCache.getEntry(t,e))).next(s=>(r!==null&&fs(r.mutation,s,Mt.empty(),Z.now()),s))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.getLocalViewOfDocuments(t,r,O()).next(()=>r))}getLocalViewOfDocuments(t,e,r=O()){let s=se();return this.populateOverlays(t,s,e).next(()=>this.computeViews(t,e,s,r).next(i=>{let o=cs();return i.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(t,e){let r=se();return this.populateOverlays(t,r,e).next(()=>this.computeViews(t,e,r,O()))}populateOverlays(t,e,r){let s=[];return r.forEach(i=>{e.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(t,s).next(i=>{i.forEach((o,a)=>{e.set(o,a)})})}computeViews(t,e,r,s){let i=kt(),o=ds(),a=function(){return ds()}();return e.forEach((u,c)=>{let l=r.get(c.key);s.has(c.key)&&(l===void 0||l.mutation instanceof Qt)?i=i.insert(c.key,c):l!==void 0?(o.set(c.key,l.mutation.getFieldMask()),fs(l.mutation,c,l.mutation.getFieldMask(),Z.now())):o.set(c.key,Mt.empty())}),this.recalculateAndSaveOverlays(t,i).next(u=>(u.forEach((c,l)=>o.set(c,l)),e.forEach((c,l)=>{var h;return a.set(c,new Ec(l,(h=o.get(c))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(t,e){let r=ds(),s=new H((o,a)=>o-a),i=O();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(o=>{for(let a of o)a.keys().forEach(u=>{let c=e.get(u);if(c===null)return;let l=r.get(u)||Mt.empty();l=a.applyToLocalView(c,l),r.set(u,l);let h=(s.get(a.batchId)||O()).add(u);s=s.insert(a.batchId,h)})}).next(()=>{let o=[],a=s.getReverseIterator();for(;a.hasNext();){let u=a.getNext(),c=u.key,l=u.value,h=jm();l.forEach(d=>{if(!i.has(d)){let f=Ym(e.get(d),r.get(d));f!==null&&h.set(d,f),i=i.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(t,c,h))}return m.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.recalculateAndSaveOverlays(t,r))}getDocumentsMatchingQuery(t,e,r,s){return function(o){return E.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):bl(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,r,s):this.getDocumentsMatchingCollectionQuery(t,e,r,s)}getNextDocuments(t,e,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,r,s).next(i=>{let o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,r.largestBatchId,s-i.size):m.resolve(se()),a=-1,u=i;return o.next(c=>m.forEach(c,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),i.get(l)?m.resolve():this.remoteDocumentCache.getEntry(t,l).next(d=>{u=u.insert(l,d)}))).next(()=>this.populateOverlays(t,c,i)).next(()=>this.computeViews(t,u,c,O())).next(l=>({batchId:a,changes:Bm(l)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new E(e)).next(r=>{let s=cs();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(t,e,r,s){let i=e.collectionGroup,o=cs();return this.indexManager.getCollectionParents(t,i).next(a=>m.forEach(a,u=>{let c=function(h,d){return new Kt(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(e,u.child(i));return this.getDocumentsMatchingCollectionQuery(t,c,r,s).next(l=>{l.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(t,e,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,r,i,s))).next(o=>{i.forEach((u,c)=>{let l=c.getKey();o.get(l)===null&&(o=o.insert(l,ht.newInvalidDocument(l)))});let a=cs();return o.forEach((u,c)=>{let l=i.get(u);l!==void 0&&fs(l.mutation,c,Mt.empty(),Z.now()),Bs(e,c)&&(a=a.insert(u,c))}),a})}};var vc=class{constructor(t){this.serializer=t,this.cr=new Map,this.lr=new Map}getBundleMetadata(t,e){return m.resolve(this.cr.get(e))}saveBundleMetadata(t,e){return this.cr.set(e.id,function(s){return{id:s.id,version:s.version,createTime:ot(s.createTime)}}(e)),m.resolve()}getNamedQuery(t,e){return m.resolve(this.lr.get(e))}saveNamedQuery(t,e){return this.lr.set(e.name,function(s){return{name:s.name,query:xl(s.bundledQuery),readTime:ot(s.readTime)}}(e)),m.resolve()}};var Ac=class{constructor(){this.overlays=new H(E.comparator),this.hr=new Map}getOverlay(t,e){return m.resolve(this.overlays.get(e))}getOverlays(t,e){let r=se();return m.forEach(e,s=>this.getOverlay(t,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(t,e,r){return r.forEach((s,i)=>{this.ht(t,e,i)}),m.resolve()}removeOverlaysForBatchId(t,e,r){let s=this.hr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.hr.delete(r)),m.resolve()}getOverlaysForCollection(t,e,r){let s=se(),i=e.length+1,o=new E(e.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let u=a.getNext().value,c=u.getKey();if(!e.isPrefixOf(c.path))break;c.path.length===i&&u.largestBatchId>r&&s.set(u.getKey(),u)}return m.resolve(s)}getOverlaysForCollectionGroup(t,e,r,s){let i=new H((c,l)=>c-l),o=this.overlays.getIterator();for(;o.hasNext();){let c=o.getNext().value;if(c.getKey().getCollectionGroup()===e&&c.largestBatchId>r){let l=i.get(c.largestBatchId);l===null&&(l=se(),i=i.insert(c.largestBatchId,l)),l.set(c.getKey(),c)}}let a=se(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,l)=>a.set(c,l)),!(a.size()>=s)););return m.resolve(a)}ht(t,e,r){let s=this.overlays.get(r.key);if(s!==null){let o=this.hr.get(s.largestBatchId).delete(r.key);this.hr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new As(e,r));let i=this.hr.get(e);i===void 0&&(i=O(),this.hr.set(e,i)),this.hr.set(e,i.add(r.key))}};var xs=class{constructor(){this.Pr=new $(ut.Ir),this.Tr=new $(ut.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(t,e){let r=new ut(t,e);this.Pr=this.Pr.add(r),this.Tr=this.Tr.add(r)}dr(t,e){t.forEach(r=>this.addReference(r,e))}removeReference(t,e){this.Ar(new ut(t,e))}Rr(t,e){t.forEach(r=>this.removeReference(r,e))}Vr(t){let e=new E(new U([])),r=new ut(e,t),s=new ut(e,t+1),i=[];return this.Tr.forEachInRange([r,s],o=>{this.Ar(o),i.push(o.key)}),i}mr(){this.Pr.forEach(t=>this.Ar(t))}Ar(t){this.Pr=this.Pr.delete(t),this.Tr=this.Tr.delete(t)}gr(t){let e=new E(new U([])),r=new ut(e,t),s=new ut(e,t+1),i=O();return this.Tr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(t){let e=new ut(t,0),r=this.Pr.firstAfterOrEqual(e);return r!==null&&t.isEqual(r.key)}},ut=class{constructor(t,e){this.key=t,this.pr=e}static Ir(t,e){return E.comparator(t.key,e.key)||N(t.pr,e.pr)}static Er(t,e){return N(t.pr,e.pr)||E.comparator(t.key,e.key)}};var Sc=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.yr=1,this.wr=new $(ut.Ir)}checkEmpty(t){return m.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,r,s){let i=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new vs(i,e,r,s);this.mutationQueue.push(o);for(let a of s)this.wr=this.wr.add(new ut(a.key,i)),this.indexManager.addToCollectionParentIndex(t,a.key.path.popLast());return m.resolve(o)}lookupMutationBatch(t,e){return m.resolve(this.Sr(e))}getNextMutationBatchAfterBatchId(t,e){let r=e+1,s=this.br(r),i=s<0?0:s;return m.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return m.resolve(this.mutationQueue.length===0?-1:this.yr-1)}getAllMutationBatches(t){return m.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let r=new ut(e,0),s=new ut(e,Number.POSITIVE_INFINITY),i=[];return this.wr.forEachInRange([r,s],o=>{let a=this.Sr(o.pr);i.push(a)}),m.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new $(N);return e.forEach(s=>{let i=new ut(s,0),o=new ut(s,Number.POSITIVE_INFINITY);this.wr.forEachInRange([i,o],a=>{r=r.add(a.pr)})}),m.resolve(this.Dr(r))}getAllMutationBatchesAffectingQuery(t,e){let r=e.path,s=r.length+1,i=r;E.isDocumentKey(i)||(i=i.child(""));let o=new ut(new E(i),0),a=new $(N);return this.wr.forEachWhile(u=>{let c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(u.pr)),!0)},o),m.resolve(this.Dr(a))}Dr(t){let e=[];return t.forEach(r=>{let s=this.Sr(r);s!==null&&e.push(s)}),e}removeMutationBatch(t,e){R(this.Cr(e.batchId,"removed")===0),this.mutationQueue.shift();let r=this.wr;return m.forEach(e.mutations,s=>{let i=new ut(s.key,e.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)}).next(()=>{this.wr=r})}Mn(t){}containsKey(t,e){let r=new ut(e,0),s=this.wr.firstAfterOrEqual(r);return m.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,m.resolve()}Cr(t,e){return this.br(t)}br(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Sr(t){let e=this.br(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var Rc=class{constructor(t){this.vr=t,this.docs=function(){return new H(E.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let r=e.key,s=this.docs.get(r),i=s?s.size:0,o=this.vr(e);return this.docs=this.docs.insert(r,{document:e.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let r=this.docs.get(e);return m.resolve(r?r.document.mutableCopy():ht.newInvalidDocument(e))}getEntries(t,e){let r=kt();return e.forEach(s=>{let i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():ht.newInvalidDocument(s))}),m.resolve(r)}getDocumentsMatchingQuery(t,e,r,s){let i=kt(),o=e.path,a=new E(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){let{key:c,value:{document:l}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||vl(wm(l),r)<=0||(s.has(l.key)||Bs(e,l))&&(i=i.insert(l.key,l.mutableCopy()))}return m.resolve(i)}getAllFromCollectionGroup(t,e,r,s){S()}Fr(t,e){return m.forEach(this.docs,r=>e(r))}newChangeBuffer(t){return new bc(this)}getSize(t){return m.resolve(this.size)}},bc=class extends Ao{constructor(t){super(),this.ar=t}applyChanges(t){let e=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?e.push(this.ar.addEntry(t,s)):this.ar.removeEntry(r)}),m.waitFor(e)}getFromCache(t,e){return this.ar.getEntry(t,e)}getAllFromCache(t,e){return this.ar.getEntries(t,e)}};var Pc=class{constructor(t){this.persistence=t,this.Mr=new le(e=>fn(e),Us),this.lastRemoteSnapshotVersion=P.min(),this.highestTargetId=0,this.Or=0,this.Nr=new xs,this.targetCount=0,this.Lr=ir.Nn()}forEachTarget(t,e){return this.Mr.forEach((r,s)=>e(s)),m.resolve()}getLastRemoteSnapshotVersion(t){return m.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return m.resolve(this.Or)}allocateTargetId(t){return this.highestTargetId=this.Lr.next(),m.resolve(this.highestTargetId)}setTargetsMetadata(t,e,r){return r&&(this.lastRemoteSnapshotVersion=r),e>this.Or&&(this.Or=e),m.resolve()}qn(t){this.Mr.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this.Lr=new ir(e),this.highestTargetId=e),t.sequenceNumber>this.Or&&(this.Or=t.sequenceNumber)}addTargetData(t,e){return this.qn(e),this.targetCount+=1,m.resolve()}updateTargetData(t,e){return this.qn(e),m.resolve()}removeTargetData(t,e){return this.Mr.delete(e.target),this.Nr.Vr(e.targetId),this.targetCount-=1,m.resolve()}removeTargets(t,e,r){let s=0,i=[];return this.Mr.forEach((o,a)=>{a.sequenceNumber<=e&&r.get(a.targetId)===null&&(this.Mr.delete(o),i.push(this.removeMatchingKeysForTargetId(t,a.targetId)),s++)}),m.waitFor(i).next(()=>s)}getTargetCount(t){return m.resolve(this.targetCount)}getTargetData(t,e){let r=this.Mr.get(e)||null;return m.resolve(r)}addMatchingKeys(t,e,r){return this.Nr.dr(e,r),m.resolve()}removeMatchingKeys(t,e,r){this.Nr.Rr(e,r);let s=this.persistence.referenceDelegate,i=[];return s&&e.forEach(o=>{i.push(s.markPotentiallyOrphaned(t,o))}),m.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.Nr.Vr(e),m.resolve()}getMatchingKeysForTargetId(t,e){let r=this.Nr.gr(e);return m.resolve(r)}containsKey(t,e){return m.resolve(this.Nr.containsKey(e))}};var Ro=class{constructor(t,e){this.Br={},this.overlays={},this.kr=new Ft(0),this.qr=!1,this.qr=!0,this.referenceDelegate=t(this),this.Qr=new Pc(this),this.indexManager=new fc,this.remoteDocumentCache=function(s){return new Rc(s)}(r=>this.referenceDelegate.Kr(r)),this.serializer=new _o(e),this.$r=new vc(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Ac,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let r=this.Br[t.toKey()];return r||(r=new Sc(e,this.referenceDelegate),this.Br[t.toKey()]=r),r}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(t,e,r){y("MemoryPersistence","Starting transaction:",t);let s=new Cc(this.kr.next());return this.referenceDelegate.Ur(),r(s).next(i=>this.referenceDelegate.Wr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Gr(t,e){return m.or(Object.values(this.Br).map(r=>()=>r.containsKey(t,e)))}},Cc=class extends so{constructor(t){super(),this.currentSequenceNumber=t}},bo=class n{constructor(t){this.persistence=t,this.zr=new xs,this.jr=null}static Hr(t){return new n(t)}get Jr(){if(this.jr)return this.jr;throw S()}addReference(t,e,r){return this.zr.addReference(r,e),this.Jr.delete(r.toString()),m.resolve()}removeReference(t,e,r){return this.zr.removeReference(r,e),this.Jr.add(r.toString()),m.resolve()}markPotentiallyOrphaned(t,e){return this.Jr.add(e.toString()),m.resolve()}removeTarget(t,e){this.zr.Vr(e.targetId).forEach(s=>this.Jr.add(s.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(s=>{s.forEach(i=>this.Jr.add(i.toString()))}).next(()=>r.removeTargetData(t,e))}Ur(){this.jr=new Set}Wr(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return m.forEach(this.Jr,r=>{let s=E.fromPath(r);return this.Yr(t,s).next(i=>{i||e.removeEntry(s,P.min())})}).next(()=>(this.jr=null,e.apply(t)))}updateLimboDocument(t,e){return this.Yr(t,e).next(r=>{r?this.Jr.delete(e.toString()):this.Jr.add(e.toString())})}Kr(t){return 0}Yr(t,e){return m.or([()=>m.resolve(this.zr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Gr(t,e)])}};var xc=class{constructor(t){this.serializer=t}N(t,e,r,s){let i=new io("createOrUpgrade",e);r<1&&s>=1&&(function(u){u.createObjectStore("owner")}(t),function(u){u.createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",yf,{unique:!0}),u.createObjectStore("documentMutations")}(t),nm(t),function(u){u.createObjectStore("remoteDocuments")}(t));let o=m.resolve();return r<3&&s>=3&&(r!==0&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(t),nm(t)),o=o.next(()=>function(u){let c=u.store("targetGlobal"),l={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:P.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",l)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(u,c){return c.store("mutations").W().next(l=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",yf,{unique:!0});let h=c.store("mutations"),d=l.map(f=>h.put(f));return m.waitFor(d)})}(t,i))),o=o.next(()=>{(function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})})(t)})),r<5&&s>=5&&(o=o.next(()=>this.Xr(i))),r<6&&s>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(t),this.ei(i)))),r<7&&s>=7&&(o=o.next(()=>this.ti(i))),r<8&&s>=8&&(o=o.next(()=>this.ni(t,i))),r<9&&s>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(t)})),r<10&&s>=10&&(o=o.next(()=>this.ri(i))),r<11&&s>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(t),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(t)})),r<12&&s>=12&&(o=o.next(()=>{(function(u){let c=u.createObjectStore("documentOverlays",{keyPath:$y});c.createIndex("collectionPathOverlayIndex",Ky,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",Qy,{unique:!1})})(t)})),r<13&&s>=13&&(o=o.next(()=>function(u){let c=u.createObjectStore("remoteDocumentsV14",{keyPath:Ny});c.createIndex("documentKeyIndex",Oy),c.createIndex("collectionGroupIndex",Fy)}(t)).next(()=>this.ii(t,i)).next(()=>t.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.si(t,i))),r<15&&s>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:By}).createIndex("sequenceNumberIndex",jy,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:Gy}).createIndex("documentKeyIndex",zy,{unique:!1})}(t))),r<16&&s>=16&&(o=o.next(()=>{e.objectStore("indexState").clear()}).next(()=>{e.objectStore("indexEntries").clear()})),o}ei(t){let e=0;return t.store("remoteDocuments").Y((r,s)=>{e+=Eo(s)}).next(()=>{let r={byteSize:e};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Xr(t){let e=t.store("mutationQueues"),r=t.store("mutations");return e.W().next(s=>m.forEach(s,i=>{let o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",o).next(a=>m.forEach(a,u=>{R(u.userId===i.userId);let c=sn(this.serializer,u);return pg(t,i.userId,c).next(()=>{})}))}))}ti(t){let e=t.store("targetDocuments"),r=t.store("remoteDocuments");return t.store("targetGlobal").get("targetGlobalKey").next(s=>{let i=[];return r.Y((o,a)=>{let u=new U(o),c=function(h){return[0,Ct(h)]}(u);i.push(e.get(c).next(l=>l?m.resolve():(h=>e.put({targetId:0,path:Ct(h),sequenceNumber:s.highestListenSequenceNumber}))(u)))}).next(()=>m.waitFor(i))})}ni(t,e){t.createObjectStore("collectionParents",{keyPath:qy});let r=e.store("collectionParents"),s=new Cs,i=o=>{if(s.add(o)){let a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:Ct(u)})}};return e.store("remoteDocuments").Y({J:!0},(o,a)=>{let u=new U(o);return i(u.popLast())}).next(()=>e.store("documentMutations").Y({J:!0},([o,a,u],c)=>{let l=re(a);return i(l.popLast())}))}ri(t){let e=t.store("targets");return e.Y((r,s)=>{let i=ls(s),o=fg(this.serializer,i);return e.put(o)})}ii(t,e){let r=e.store("remoteDocuments"),s=[];return r.Y((i,o)=>{let a=e.store("remoteDocumentsV14"),u=function(h){return h.document?new E(U.fromString(h.document.name).popFirst(5)):h.noDocument?E.fromSegments(h.noDocument.path):h.unknownDocument?E.fromSegments(h.unknownDocument.path):S()}(o).path.toArray(),c={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(c))}).next(()=>m.waitFor(s))}si(t,e){let r=e.store("mutations"),s=wg(this.serializer),i=new Ro(bo.Hr,this.serializer.ct);return r.W().next(o=>{let a=new Map;return o.forEach(u=>{var c;let l=(c=a.get(u.userId))!==null&&c!==void 0?c:O();sn(this.serializer,u).keys().forEach(h=>l=l.add(h)),a.set(u.userId,l)}),m.forEach(a,(u,c)=>{let l=new ct(c),h=wo.lt(this.serializer,l),d=i.getIndexManager(l),f=vo.lt(l,this.serializer,d,i.referenceDelegate);return new So(s,f,h,d).recalculateAndSaveOverlaysForDocumentKeys(new ys(e,Ft._e),u).next()})})}};function nm(n){n.createObjectStore("targetDocuments",{keyPath:Ly}).createIndex("documentTargetsIndex",Uy,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",My,{unique:!0}),n.createObjectStore("targetGlobal")}var Iu="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Dc=class n{constructor(t,e,r,s,i,o,a,u,c,l,h=16){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=r,this.oi=i,this.window=o,this.document=a,this._i=c,this.ai=l,this.ui=h,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=d=>Promise.resolve(),!n.D())throw new _(g.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new wc(this,s),this.Ti=e+"main",this.serializer=new _o(u),this.Ei=new we(this.Ti,this.ui,new xc(this.serializer)),this.Qr=new gc(this.referenceDelegate,this.serializer),this.remoteDocumentCache=wg(this.serializer),this.$r=new oc,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,l===!1&&st("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new _(g.FAILED_PRECONDITION,Iu);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.Qr.getHighestSequenceNumber(t))}).then(t=>{this.kr=new Ft(t,this._i)}).then(()=>{this.qr=!0}).catch(t=>(this.Ei&&this.Ei.close(),Promise.reject(t)))}fi(t){return this.Ii=e=>p(this,null,function*(){if(this.started)return t(e)}),t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ei.B(e=>p(this,null,function*(){e.newVersion===null&&(yield t())}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.oi.enqueueAndForget(()=>p(this,null,function*(){this.started&&(yield this.Ai())})))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Qi(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.gi(t).next(e=>{e||(this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)))})}).next(()=>this.pi(t)).next(e=>this.isPrimary&&!e?this.yi(t).next(()=>!1):!!e&&this.wi(t).next(()=>!0))).catch(t=>{if(Qe(t))return y("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return y("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.oi.enqueueRetryable(()=>this.Ii(t)),this.isPrimary=t})}gi(t){return us(t).get("owner").next(e=>m.resolve(this.Si(e)))}bi(t){return Qi(t).delete(this.clientId)}Di(){return p(this,null,function*(){if(this.isPrimary&&!this.Ci(this.Pi,18e5)){this.Pi=Date.now();let t=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let r=_t(e,"clientMetadata");return r.W().next(s=>{let i=this.vi(s,18e5),o=s.filter(a=>i.indexOf(a)===-1);return m.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.di)for(let e of t)this.di.removeItem(this.Fi(e.clientId))}})}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ai().then(()=>this.Di()).then(()=>this.mi()))}Si(t){return!!t&&t.ownerId===this.clientId}pi(t){return this.ai?m.resolve(!0):us(t).get("owner").next(e=>{if(e!==null&&this.Ci(e.leaseTimestampMs,5e3)&&!this.Mi(e.ownerId)){if(this.Si(e)&&this.networkEnabled)return!0;if(!this.Si(e)){if(!e.allowTabSynchronization)throw new _(g.FAILED_PRECONDITION,Iu);return!1}}return!(!this.networkEnabled||!this.inForeground)||Qi(t).W().next(r=>this.vi(r,5e3).find(s=>{if(this.clientId!==s.clientId){let i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(e=>(this.isPrimary!==e&&y("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}shutdown(){return p(this,null,function*(){this.qr=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Oi(),this.Ni(),yield this.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{let e=new ys(t,Ft._e);return this.yi(e).next(()=>this.bi(e))}),this.Ei.close(),this.Li()})}vi(t,e){return t.filter(r=>this.Ci(r.updateTimeMs,e)&&!this.Mi(r.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",t=>Qi(t).W().next(e=>this.vi(e,18e5).map(r=>r.clientId)))}get started(){return this.qr}getMutationQueue(t,e){return vo.lt(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new mc(t,this.serializer.ct.databaseId)}getDocumentOverlayCache(t){return wo.lt(this.serializer,t)}getBundleCache(){return this.$r}runTransaction(t,e,r){y("IndexedDbPersistence","Starting transaction:",t);let s=e==="readonly"?"readonly":"readwrite",i=function(u){return u===16?Hy:u===15?Rm:u===14?Sm:u===13?Am:u===12?Wy:u===11?vm:void S()}(this.ui),o;return this.Ei.runTransaction(t,s,i,a=>(o=new ys(a,this.kr?this.kr.next():Ft._e),e==="readwrite-primary"?this.gi(o).next(u=>!!u||this.pi(o)).next(u=>{if(!u)throw st(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)),new _(g.FAILED_PRECONDITION,Tm);return r(o)}).next(u=>this.wi(o).next(()=>u)):this.ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}ki(t){return us(t).get("owner").next(e=>{if(e!==null&&this.Ci(e.leaseTimestampMs,5e3)&&!this.Mi(e.ownerId)&&!this.Si(e)&&!(this.ai||this.allowTabSynchronization&&e.allowTabSynchronization))throw new _(g.FAILED_PRECONDITION,Iu)})}wi(t){let e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return us(t).put("owner",e)}static D(){return we.D()}yi(t){let e=us(t);return e.get("owner").next(r=>this.Si(r)?(y("IndexedDbPersistence","Releasing primary lease."),e.delete("owner")):m.resolve())}Ci(t,e){let r=Date.now();return!(t<r-e)&&(!(t>r)||(st(`Detected an update time that is in the future: ${t} > ${r}`),!1))}Ri(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.li=()=>{this.oi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Ai()))},this.document.addEventListener("visibilitychange",this.li),this.inForeground=this.document.visibilityState==="visible")}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var t;typeof((t=this.window)===null||t===void 0?void 0:t.addEventListener)=="function"&&(this.ci=()=>{this.xi();let e=/(?:Version|Mobile)\/1[456]/;ba()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(t){var e;try{let r=((e=this.di)===null||e===void 0?void 0:e.getItem(this.Fi(t)))!==null;return y("IndexedDbPersistence",`Client '${t}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return st("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(t){st("Failed to set zombie client id.",t)}}Li(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch{}}Fi(t){return`firestore_zombie_${this.persistenceKey}_${t}`}};function us(n){return _t(n,"owner")}function Qi(n){return _t(n,"clientMetadata")}function Vl(n,t){let e=n.projectId;return n.isDefaultDatabase||(e+="."+n.database),"firestore/"+t+"/"+e+"/"}var Vc=class n{constructor(t,e,r,s){this.targetId=t,this.fromCache=e,this.qi=r,this.Qi=s}static Ki(t,e){let r=O(),s=O();for(let i of e.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new n(t,e.fromCache,r,s)}};var kc=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var Po=class{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){return ba()?8:we.v(Or())>0?6:4}()}initialize(t,e){this.zi=t,this.indexManager=e,this.$i=!0}getDocumentsMatchingQuery(t,e,r,s){let i={result:null};return this.ji(t,e).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Hi(t,e,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;let o=new kc;return this.Ji(t,e,o).next(a=>{if(i.result=a,this.Ui)return this.Yi(t,e,o,a.size)})}).next(()=>i.result)}Yi(t,e,r,s){return r.documentReadCount<this.Wi?(jn()<=Zt.DEBUG&&y("QueryEngine","SDK will not create cache indexes for query:",Gn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),m.resolve()):(jn()<=Zt.DEBUG&&y("QueryEngine","Query:",Gn(e),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Gi*s?(jn()<=Zt.DEBUG&&y("QueryEngine","The SDK decides to create cache indexes for query:",Gn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,xt(e))):m.resolve())}ji(t,e){if(Cf(e))return m.resolve(null);let r=xt(e);return this.indexManager.getIndexType(t,r).next(s=>s===0?null:(e.limit!==null&&s===1&&(e=fo(e,null,"F"),r=xt(e)),this.indexManager.getDocumentsMatchingTarget(t,r).next(i=>{let o=O(...i);return this.zi.getDocuments(t,o).next(a=>this.indexManager.getMinOffset(t,r).next(u=>{let c=this.Zi(e,a);return this.Xi(e,c,o,u.readTime)?this.ji(t,fo(e,null,"F")):this.es(t,c,e,u)}))})))}Hi(t,e,r,s){return Cf(e)||s.isEqual(P.min())?m.resolve(null):this.zi.getDocuments(t,r).next(i=>{let o=this.Zi(e,i);return this.Xi(e,o,r,s)?m.resolve(null):(jn()<=Zt.DEBUG&&y("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Gn(e)),this.es(t,o,e,ym(s,-1)).next(a=>a))})}Zi(t,e){let r=new $(Um(t));return e.forEach((s,i)=>{Bs(t,i)&&(r=r.add(i))}),r}Xi(t,e,r,s){if(t.limit===null)return!1;if(r.size!==e.size)return!0;let i=t.limitType==="F"?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ji(t,e,r){return jn()<=Zt.DEBUG&&y("QueryEngine","Using full collection scan to execute query:",Gn(e)),this.zi.getDocumentsMatchingQuery(t,e,jt.min(),r)}es(t,e,r,s){return this.zi.getDocumentsMatchingQuery(t,r,s).next(i=>(e.forEach(o=>{i=i.insert(o.key,o)}),i))}};var Nc=class{constructor(t,e,r,s){this.persistence=t,this.ts=e,this.serializer=s,this.ns=new H(N),this.rs=new le(i=>fn(i),Us),this.ss=new Map,this.os=t.getRemoteDocumentCache(),this.Qr=t.getTargetCache(),this.$r=t.getBundleCache(),this._s(r)}_s(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new So(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.ns))}};function Tg(n,t,e,r){return new Nc(n,t,e,r)}function Ig(n,t){return p(this,null,function*(){let e=v(n);return yield e.persistence.runTransaction("Handle user change","readonly",r=>{let s;return e.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,e._s(t),e.mutationQueue.getAllMutationBatches(r))).next(i=>{let o=[],a=[],u=O();for(let c of s){o.push(c.batchId);for(let l of c.mutations)u=u.add(l.key)}for(let c of i){a.push(c.batchId);for(let l of c.mutations)u=u.add(l.key)}return e.localDocuments.getDocuments(r,u).next(c=>({us:c,removedBatchIds:o,addedBatchIds:a}))})})})}function Pw(n,t){let e=v(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let s=t.batch.keys(),i=e.os.newChangeBuffer({trackRemovals:!0});return function(a,u,c,l){let h=c.batch,d=h.keys(),f=m.resolve();return d.forEach(T=>{f=f.next(()=>l.getEntry(u,T)).next(I=>{let w=c.docVersions.get(T);R(w!==null),I.version.compareTo(w)<0&&(h.applyToRemoteDocument(I,c),I.isValidDocument()&&(I.setReadTime(c.commitVersion),l.addEntry(I)))})}),f.next(()=>a.mutationQueue.removeMutationBatch(u,h))}(e,r,t,i).next(()=>i.apply(r)).next(()=>e.mutationQueue.performConsistencyCheck(r)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(r,s,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=O();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(t))).next(()=>e.localDocuments.getDocuments(r,s))})}function Eg(n){let t=v(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Qr.getLastRemoteSnapshotVersion(e))}function Cw(n,t){let e=v(n),r=t.snapshotVersion,s=e.ns;return e.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{let o=e.os.newChangeBuffer({trackRemovals:!0});s=e.ns;let a=[];t.targetChanges.forEach((l,h)=>{let d=s.get(h);if(!d)return;a.push(e.Qr.removeMatchingKeys(i,l.removedDocuments,h).next(()=>e.Qr.addMatchingKeys(i,l.addedDocuments,h)));let f=d.withSequenceNumber(i.currentSequenceNumber);t.targetMismatches.get(h)!==null?f=f.withResumeToken(pt.EMPTY_BYTE_STRING,P.min()).withLastLimboFreeSnapshotVersion(P.min()):l.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(l.resumeToken,r)),s=s.insert(h,f),function(I,w,C){return I.resumeToken.approximateByteSize()===0||w.snapshotVersion.toMicroseconds()-I.snapshotVersion.toMicroseconds()>=3e8?!0:C.addedDocuments.size+C.modifiedDocuments.size+C.removedDocuments.size>0}(d,f,l)&&a.push(e.Qr.updateTargetData(i,f))});let u=kt(),c=O();if(t.documentUpdates.forEach(l=>{t.resolvedLimboDocuments.has(l)&&a.push(e.persistence.referenceDelegate.updateLimboDocument(i,l))}),a.push(vg(i,o,t.documentUpdates).next(l=>{u=l.cs,c=l.ls})),!r.isEqual(P.min())){let l=e.Qr.getLastRemoteSnapshotVersion(i).next(h=>e.Qr.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(l)}return m.waitFor(a).next(()=>o.apply(i)).next(()=>e.localDocuments.getLocalViewOfDocuments(i,u,c)).next(()=>u)}).then(i=>(e.ns=s,i))}function vg(n,t,e){let r=O(),s=O();return e.forEach(i=>r=r.add(i)),t.getEntries(n,r).next(i=>{let o=kt();return e.forEach((a,u)=>{let c=i.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),u.isNoDocument()&&u.version.isEqual(P.min())?(t.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||u.version.compareTo(c.version)===0&&c.hasPendingWrites?(t.addEntry(u),o=o.insert(a,u)):y("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{cs:o,ls:s}})}function xw(n,t){let e=v(n);return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(t===void 0&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}function or(n,t){let e=v(n);return e.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return e.Qr.getTargetData(r,t).next(i=>i?(s=i,m.resolve(s)):e.Qr.allocateTargetId(r).next(o=>(s=new sr(t,o,"TargetPurposeListen",r.currentSequenceNumber),e.Qr.addTargetData(r,s).next(()=>s))))}).then(r=>{let s=e.ns.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.ns=e.ns.insert(r.targetId,r),e.rs.set(t,r.targetId)),r})}function ar(n,t,e){return p(this,null,function*(){let r=v(n),s=r.ns.get(t),i=e?"readwrite":"readwrite-primary";try{e||(yield r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s)))}catch(o){if(!Qe(o))throw o;y("LocalStore",`Failed to update sequence numbers for target ${t}: ${o}`)}r.ns=r.ns.remove(t),r.rs.delete(s.target)})}function Co(n,t,e){let r=v(n),s=P.min(),i=O();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,c,l){let h=v(u),d=h.rs.get(l);return d!==void 0?m.resolve(h.ns.get(d)):h.Qr.getTargetData(c,l)}(r,o,xt(t)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(o,a.targetId).next(u=>{i=u})}).next(()=>r.ts.getDocumentsMatchingQuery(o,t,e?s:P.min(),e?i:O())).next(a=>(Rg(r,Lm(t),a),{documents:a,hs:i})))}function Ag(n,t){let e=v(n),r=v(e.Qr),s=e.ns.get(t);return s?Promise.resolve(s.target):e.persistence.runTransaction("Get target data","readonly",i=>r._t(i,t).next(o=>o?o.target:null))}function Sg(n,t){let e=v(n),r=e.ss.get(t)||P.min();return e.persistence.runTransaction("Get new document changes","readonly",s=>e.os.getAllFromCollectionGroup(s,t,ym(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(Rg(e,t,s),s))}function Rg(n,t,e){let r=n.ss.get(t)||P.min();e.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.ss.set(t,r)}function Dw(n,t,e,r){return p(this,null,function*(){let s=v(n),i=O(),o=kt();for(let c of e){let l=t.Ps(c.metadata.name);c.document&&(i=i.add(l));let h=t.Is(c);h.setReadTime(t.Ts(c.metadata.readTime)),o=o.insert(l,h)}let a=s.os.newChangeBuffer({trackRemovals:!0}),u=yield or(s,function(l){return xt(gr(U.fromString(`__bundle__/docs/${l}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>vg(c,a,o).next(l=>(a.apply(c),l)).next(l=>s.Qr.removeMatchingKeysForTargetId(c,u.targetId).next(()=>s.Qr.addMatchingKeys(c,i,u.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(c,l.cs,l.ls)).next(()=>l.cs)))})}function Vw(r,s){return p(this,arguments,function*(n,t,e=O()){let i=yield or(n,xt(xl(t.bundledQuery))),o=v(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let u=ot(t.readTime);if(i.snapshotVersion.compareTo(u)>=0)return o.$r.saveNamedQuery(a,t);let c=i.withResumeToken(pt.EMPTY_BYTE_STRING,u);return o.ns=o.ns.insert(c.targetId,c),o.Qr.updateTargetData(a,c).next(()=>o.Qr.removeMatchingKeysForTargetId(a,i.targetId)).next(()=>o.Qr.addMatchingKeys(a,e,i.targetId)).next(()=>o.$r.saveNamedQuery(a,t))})})}function rm(n,t){return`firestore_clients_${n}_${t}`}function sm(n,t,e){let r=`firestore_mutations_${n}_${e}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function Eu(n,t){return`firestore_targets_${n}_${t}`}var xo=class n{constructor(t,e,r,s){this.user=t,this.batchId=e,this.state=r,this.error=s}static Es(t,e,r){let s=JSON.parse(r),i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new _(s.error.code,s.error.message))),o?new n(t,e,s.state,i):(st("SharedClientState",`Failed to parse mutation state for ID '${e}': ${r}`),null)}ds(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},ms=class n{constructor(t,e,r){this.targetId=t,this.state=e,this.error=r}static Es(t,e){let r=JSON.parse(e),s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new _(r.error.code,r.error.message))),i?new n(t,r.state,s):(st("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}ds(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},Do=class n{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Es(t,e){let r=JSON.parse(e),s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=Pl();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=Im(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new n(t,i):(st("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}},Oc=class n{constructor(t,e){this.clientId=t,this.onlineState=e}static Es(t){let e=JSON.parse(t);return typeof e=="object"&&["Unknown","Online","Offline"].indexOf(e.onlineState)!==-1&&typeof e.clientId=="string"?new n(e.clientId,e.onlineState):(st("SharedClientState",`Failed to parse online state: ${t}`),null)}},Ds=class{constructor(){this.activeTargetIds=Pl()}As(t){this.activeTargetIds=this.activeTargetIds.add(t)}Rs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ds(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}},gs=class{constructor(t,e,r,s,i){this.window=t,this.oi=e,this.persistenceKey=r,this.Vs=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new H(N),this.started=!1,this.ys=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.ws=rm(this.persistenceKey,this.Vs),this.Ss=function(u){return`firestore_sequence_number_${u}`}(this.persistenceKey),this.ps=this.ps.insert(this.Vs,new Ds),this.bs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Ds=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Cs=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.vs=function(u){return`firestore_online_state_${u}`}(this.persistenceKey),this.Fs=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.fs)}static D(t){return!(!t||!t.localStorage)}start(){return p(this,null,function*(){let t=yield this.syncEngine.Bi();for(let r of t){if(r===this.Vs)continue;let s=this.getItem(rm(this.persistenceKey,r));if(s){let i=Do.Es(r,s);i&&(this.ps=this.ps.insert(i.clientId,i))}}this.Ms();let e=this.storage.getItem(this.vs);if(e){let r=this.xs(e);r&&this.Os(r)}for(let r of this.ys)this.gs(r);this.ys=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(t){this.setItem(this.Ss,JSON.stringify(t))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(t){let e=!1;return this.ps.forEach((r,s)=>{s.activeTargetIds.has(t)&&(e=!0)}),e}addPendingMutation(t){this.Ls(t,"pending")}updateMutationState(t,e,r){this.Ls(t,e,r),this.Bs(t)}addLocalQueryTarget(t){let e="not-current";if(this.isActiveQueryTarget(t)){let r=this.storage.getItem(Eu(this.persistenceKey,t));if(r){let s=ms.Es(t,r);s&&(e=s.state)}}return this.ks.As(t),this.Ms(),e}removeLocalQueryTarget(t){this.ks.Rs(t),this.Ms()}isLocalQueryTarget(t){return this.ks.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(Eu(this.persistenceKey,t))}updateQueryState(t,e,r){this.qs(t,e,r)}handleUserChange(t,e,r){e.forEach(s=>{this.Bs(s)}),this.currentUser=t,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(t){this.Qs(t)}notifyBundleLoaded(t){this.Ks(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(t){let e=this.storage.getItem(t);return y("SharedClientState","READ",t,e),e}setItem(t,e){y("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){y("SharedClientState","REMOVE",t),this.storage.removeItem(t)}gs(t){let e=t;if(e.storageArea===this.storage){if(y("SharedClientState","EVENT",e.key,e.newValue),e.key===this.ws)return void st("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable(()=>p(this,null,function*(){if(this.started){if(e.key!==null){if(this.bs.test(e.key)){if(e.newValue==null){let r=this.$s(e.key);return this.Us(r,null)}{let r=this.Ws(e.key,e.newValue);if(r)return this.Us(r.clientId,r)}}else if(this.Ds.test(e.key)){if(e.newValue!==null){let r=this.Gs(e.key,e.newValue);if(r)return this.zs(r)}}else if(this.Cs.test(e.key)){if(e.newValue!==null){let r=this.js(e.key,e.newValue);if(r)return this.Hs(r)}}else if(e.key===this.vs){if(e.newValue!==null){let r=this.xs(e.newValue);if(r)return this.Os(r)}}else if(e.key===this.Ss){let r=function(i){let o=Ft._e;if(i!=null)try{let a=JSON.parse(i);R(typeof a=="number"),o=a}catch(a){st("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(e.newValue);r!==Ft._e&&this.sequenceNumberHandler(r)}else if(e.key===this.Fs){let r=this.Js(e.newValue);yield Promise.all(r.map(s=>this.syncEngine.Ys(s)))}}}else this.ys.push(e)}))}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Ls(t,e,r){let s=new xo(this.currentUser,t,e,r),i=sm(this.persistenceKey,this.currentUser,t);this.setItem(i,s.ds())}Bs(t){let e=sm(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Qs(t){let e={clientId:this.Vs,onlineState:t};this.storage.setItem(this.vs,JSON.stringify(e))}qs(t,e,r){let s=Eu(this.persistenceKey,t),i=new ms(t,e,r);this.setItem(s,i.ds())}Ks(t){let e=JSON.stringify(Array.from(t));this.setItem(this.Fs,e)}$s(t){let e=this.bs.exec(t);return e?e[1]:null}Ws(t,e){let r=this.$s(t);return Do.Es(r,e)}Gs(t,e){let r=this.Ds.exec(t),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return xo.Es(new ct(i),s,e)}js(t,e){let r=this.Cs.exec(t),s=Number(r[1]);return ms.Es(s,e)}xs(t){return Oc.Es(t)}Js(t){return JSON.parse(t)}zs(t){return p(this,null,function*(){if(t.user.uid===this.currentUser.uid)return this.syncEngine.Zs(t.batchId,t.state,t.error);y("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)})}Hs(t){return this.syncEngine.Xs(t.targetId,t.state,t.error)}Us(t,e){let r=e?this.ps.insert(t,e):this.ps.remove(t),s=this.Ns(this.ps),i=this.Ns(r),o=[],a=[];return i.forEach(u=>{s.has(u)||o.push(u)}),s.forEach(u=>{i.has(u)||a.push(u)}),this.syncEngine.eo(o,a).then(()=>{this.ps=r})}Os(t){this.ps.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}Ns(t){let e=Pl();return t.forEach((r,s)=>{e=e.unionWith(s.activeTargetIds)}),e}},Vo=class{constructor(){this.no=new Ds,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,r){}addLocalQueryTarget(t){return this.no.As(t),this.ro[t]||"not-current"}updateQueryState(t,e,r){this.ro[t]=e}removeLocalQueryTarget(t){this.no.Rs(t)}isLocalQueryTarget(t){return this.no.activeTargetIds.has(t)}clearQueryState(t){delete this.ro[t]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(t){return this.no.activeTargetIds.has(t)}start(){return this.no=new Ds,Promise.resolve()}handleUserChange(t,e,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var Fc=class{io(t){}shutdown(){}};var ko=class{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(t){this.uo.push(t)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){y("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let t of this.uo)t(0)}ao(){y("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let t of this.uo)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Wi=null;function vu(){return Wi===null?Wi=function(){return 268435456+Math.round(2147483648*Math.random())}():Wi++,"0x"+Wi.toString(16)}var kw={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var Mc=class{constructor(t){this.lo=t.lo,this.ho=t.ho}Po(t){this.Io=t}To(t){this.Eo=t}onMessage(t){this.Ao=t}close(){this.ho()}send(t){this.lo(t)}Ro(){this.Io()}Vo(t){this.Eo(t)}mo(t){this.Ao(t)}};var At="WebChannelConnection",Lc=class extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let r=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.fo=r+"://"+e.host,this.po=`projects/${s}/databases/${i}`,this.yo=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get wo(){return!1}So(e,r,s,i,o){let a=vu(),u=this.bo(e,r.toUriEncodedString());y("RestConnection",`Sending RPC '${e}' ${a}:`,u,s);let c={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(c,i,o),this.Co(e,u,c,s).then(l=>(y("RestConnection",`Received RPC '${e}' ${a}: `,l),l),l=>{throw Bt("RestConnection",`RPC '${e}' ${a} failed with error: `,l,"url: ",u,"request:",s),l})}vo(e,r,s,i,o,a){return this.So(e,r,s,i,o)}Do(e,r,s){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+mr}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>e[o]=i),s&&s.headers.forEach((i,o)=>e[o]=i)}bo(e,r){let s=kw[e];return`${this.fo}/v1/${r}:${s}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Co(t,e,r,s){let i=vu();return new Promise((o,a)=>{let u=new ff;u.setWithCredentials(!0),u.listenOnce(hf.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case zi.NO_ERROR:let l=u.getResponseJson();y(At,`XHR for RPC '${t}' ${i} received:`,JSON.stringify(l)),o(l);break;case zi.TIMEOUT:y(At,`RPC '${t}' ${i} timed out`),a(new _(g.DEADLINE_EXCEEDED,"Request time out"));break;case zi.HTTP_ERROR:let h=u.getStatus();if(y(At,`RPC '${t}' ${i} failed with status:`,h,"response text:",u.getResponseText()),h>0){let d=u.getResponseJson();Array.isArray(d)&&(d=d[0]);let f=d==null?void 0:d.error;if(f&&f.status&&f.message){let T=function(w){let C=w.toLowerCase().replace(/_/g,"-");return Object.values(g).indexOf(C)>=0?C:g.UNKNOWN}(f.status);a(new _(T,f.message))}else a(new _(g.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new _(g.UNAVAILABLE,"Connection failed."));break;default:S()}}finally{y(At,`RPC '${t}' ${i} completed.`)}});let c=JSON.stringify(s);y(At,`RPC '${t}' ${i} sending request:`,s),u.send(e,"POST",c,r,15)})}Fo(t,e,r){let s=vu(),i=[this.fo,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=cf(),a=lf(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Do(u.initMessageHeaders,e,r),u.encodeInitMessageHeaders=!0;let l=i.join("");y(At,`Creating RPC '${t}' stream ${s}: ${l}`,u);let h=o.createWebChannel(l,u),d=!1,f=!1,T=new Mc({lo:w=>{f?y(At,`Not sending because RPC '${t}' stream ${s} is closed:`,w):(d||(y(At,`Opening RPC '${t}' stream ${s} transport.`),h.open(),d=!0),y(At,`RPC '${t}' stream ${s} sending:`,w),h.send(w))},ho:()=>h.close()}),I=(w,C,D)=>{w.listen(C,b=>{try{D(b)}catch(x){setTimeout(()=>{throw x},0)}})};return I(h,ss.EventType.OPEN,()=>{f||y(At,`RPC '${t}' stream ${s} transport opened.`)}),I(h,ss.EventType.CLOSE,()=>{f||(f=!0,y(At,`RPC '${t}' stream ${s} transport closed`),T.Vo())}),I(h,ss.EventType.ERROR,w=>{f||(f=!0,Bt(At,`RPC '${t}' stream ${s} transport errored:`,w),T.Vo(new _(g.UNAVAILABLE,"The operation could not be completed")))}),I(h,ss.EventType.MESSAGE,w=>{var C;if(!f){let D=w.data[0];R(!!D);let b=D,x=b.error||((C=b[0])===null||C===void 0?void 0:C.error);if(x){y(At,`RPC '${t}' stream ${s} received error:`,x);let M=x.status,k=function(Vr){let Vh=at[Vr];if(Vh!==void 0)return Zm(Vh)}(M),Y=x.message;k===void 0&&(k=g.INTERNAL,Y="Unknown error status: "+M+" with message "+x.message),f=!0,T.Vo(new _(k,Y)),h.close()}else y(At,`RPC '${t}' stream ${s} received:`,D),T.mo(D)}}),I(a,df.STAT_EVENT,w=>{w.stat===wu.PROXY?y(At,`RPC '${t}' stream ${s} detected buffering proxy`):w.stat===wu.NOPROXY&&y(At,`RPC '${t}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{T.Ro()},0),T}};function bg(){return typeof window<"u"?window:null}function Zi(){return typeof document<"u"?document:null}function js(n){return new ec(n,!0)}var Vs=class{constructor(t,e,r=1e3,s=1.5,i=6e4){this.oi=t,this.timerId=e,this.Mo=r,this.xo=s,this.Oo=i,this.No=0,this.Lo=null,this.Bo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(t){this.cancel();let e=Math.floor(this.No+this.Qo()),r=Math.max(0,Date.now()-this.Bo),s=Math.max(0,e-r);s>0&&y("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.No} ms, delay with jitter: ${e} ms, last attempt: ${r} ms ago)`),this.Lo=this.oi.enqueueAfterDelay(this.timerId,s,()=>(this.Bo=Date.now(),t())),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){this.Lo!==null&&(this.Lo.skipDelay(),this.Lo=null)}cancel(){this.Lo!==null&&(this.Lo.cancel(),this.Lo=null)}Qo(){return(Math.random()-.5)*this.No}};var No=class{constructor(t,e,r,s,i,o,a,u){this.oi=t,this.$o=r,this.Uo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new Vs(t,e)}Ho(){return this.state===1||this.state===5||this.Jo()}Jo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Yo()}stop(){return p(this,null,function*(){this.Ho()&&(yield this.close(0))})}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&this.Go===null&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,()=>this.e_()))}t_(t){this.n_(),this.stream.send(t)}e_(){return p(this,null,function*(){if(this.Jo())return this.close(0)})}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}close(t,e){return p(this,null,function*(){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,t!==4?this.jo.reset():e&&e.code===g.RESOURCE_EXHAUSTED?(st(e.toString()),st("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):e&&e.code===g.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.i_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.To(e)})}i_(){}auth(){this.state=1;let t=this.s_(this.Wo),e=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Wo===e&&this.o_(r,s)},r=>{t(()=>{let s=new _(g.UNKNOWN,"Fetching auth token failed: "+r.message);return this.__(s)})})}o_(t,e){let r=this.s_(this.Wo);this.stream=this.a_(t,e),this.stream.Po(()=>{r(()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,()=>(this.Jo()&&(this.state=3),Promise.resolve())),this.listener.Po()))}),this.stream.To(s=>{r(()=>this.__(s))}),this.stream.onMessage(s=>{r(()=>this.onMessage(s))})}Yo(){this.state=5,this.jo.qo(()=>p(this,null,function*(){this.state=0,this.start()}))}__(t){return y("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}s_(t){return e=>{this.oi.enqueueAndForget(()=>this.Wo===t?e():(y("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Uc=class extends No{constructor(t,e,r,s,i,o){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,r,s,o),this.serializer=i}a_(t,e){return this.connection.Fo("Listen",t,e)}onMessage(t){this.jo.reset();let e=_w(this.serializer,t),r=function(i){if(!("targetChange"in i))return P.min();let o=i.targetChange;return o.targetIds&&o.targetIds.length?P.min():o.readTime?ot(o.readTime):P.min()}(t);return this.listener.u_(e,r)}c_(t){let e={};e.database=sc(this.serializer),e.addTarget=function(i,o){let a,u=o.target;if(a=lo(u)?{documents:ag(i,u)}:{query:ug(i,u).ut},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=eg(i,o.resumeToken);let c=nc(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(P.min())>0){a.readTime=rr(i,o.snapshotVersion.toTimestamp());let c=nc(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,t);let r=ww(this.serializer,t);r&&(e.labels=r),this.t_(e)}l_(t){let e={};e.database=sc(this.serializer),e.removeTarget=t,this.t_(e)}},qc=class extends No{constructor(t,e,r,s,i,o){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,r,s,o),this.serializer=i,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(t,e){return this.connection.Fo("Write",t,e)}onMessage(t){if(R(!!t.streamToken),this.lastStreamToken=t.streamToken,this.h_){this.jo.reset();let e=yw(t.writeResults,t.commitTime),r=ot(t.commitTime);return this.listener.T_(r,e)}return R(!t.writeResults||t.writeResults.length===0),this.h_=!0,this.listener.E_()}d_(){let t={};t.database=sc(this.serializer),this.t_(t)}I_(t){let e={streamToken:this.lastStreamToken,writes:t.map(r=>Ps(this.serializer,r))};this.t_(e)}};var Bc=class extends class{}{constructor(t,e,r,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=r,this.serializer=s,this.A_=!1}R_(){if(this.A_)throw new _(g.FAILED_PRECONDITION,"The client has already been terminated.")}So(t,e,r,s){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.So(t,rc(e,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new _(g.UNKNOWN,i.toString())})}vo(t,e,r,s,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.vo(t,rc(e,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new _(g.UNKNOWN,o.toString())})}terminate(){this.A_=!0,this.connection.terminate()}};var jc=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){this.m_===0&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve())))}S_(t){this.state==="Online"?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.y_("Offline")))}set(t){this.b_(),this.m_=0,t==="Online"&&(this.g_=!1),this.y_(t)}y_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}w_(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(st(e),this.g_=!1):y("OnlineStateTracker",e)}b_(){this.f_!==null&&(this.f_.cancel(),this.f_=null)}};var Gc=class{constructor(t,e,r,s,i){this.localStore=t,this.datastore=e,this.asyncQueue=r,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=i,this.M_.io(o=>{r.enqueueAndForget(()=>p(this,null,function*(){We(this)&&(y("RemoteStore","Restarting streams for network reachability change."),yield function(u){return p(this,null,function*(){let c=v(u);c.v_.add(4),yield pr(c),c.x_.set("Unknown"),c.v_.delete(4),yield Gs(c)})}(this))}))}),this.x_=new jc(r,s)}};function Gs(n){return p(this,null,function*(){if(We(n))for(let t of n.F_)yield t(!0)})}function pr(n){return p(this,null,function*(){for(let t of n.F_)yield t(!1)})}function Zo(n,t){let e=v(n);e.C_.has(t.targetId)||(e.C_.set(t.targetId,t),Ol(e)?Nl(e):yr(e).Jo()&&kl(e,t))}function ur(n,t){let e=v(n),r=yr(e);e.C_.delete(t),r.Jo()&&Pg(e,t),e.C_.size===0&&(r.Jo()?r.Xo():We(e)&&e.x_.set("Unknown"))}function kl(n,t){if(n.O_.Oe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(P.min())>0){let e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}yr(n).c_(t)}function Pg(n,t){n.O_.Oe(t),yr(n).l_(t)}function Nl(n){n.O_=new tc({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),_t:t=>n.C_.get(t)||null,nt:()=>n.datastore.serializer.databaseId}),yr(n).start(),n.x_.p_()}function Ol(n){return We(n)&&!yr(n).Ho()&&n.C_.size>0}function We(n){return v(n).v_.size===0}function Cg(n){n.O_=void 0}function Nw(n){return p(this,null,function*(){n.C_.forEach((t,e)=>{kl(n,t)})})}function Ow(n,t){return p(this,null,function*(){Cg(n),Ol(n)?(n.x_.S_(t),Nl(n)):n.x_.set("Unknown")})}function Fw(n,t,e){return p(this,null,function*(){if(n.x_.set("Online"),t instanceof go&&t.state===2&&t.cause)try{yield function(s,i){return p(this,null,function*(){let o=i.cause;for(let a of i.targetIds)s.C_.has(a)&&(yield s.remoteSyncer.rejectListen(a,o),s.C_.delete(a),s.O_.removeTarget(a))})}(n,t)}catch(r){y("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),r),yield Oo(n,r)}else if(t instanceof Yn?n.O_.$e(t):t instanceof mo?n.O_.Je(t):n.O_.Ge(t),!e.isEqual(P.min()))try{let r=yield Eg(n.localStore);e.compareTo(r)>=0&&(yield function(i,o){let a=i.O_.it(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){let l=i.C_.get(c);l&&i.C_.set(c,l.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{let l=i.C_.get(u);if(!l)return;i.C_.set(u,l.withResumeToken(pt.EMPTY_BYTE_STRING,l.snapshotVersion)),Pg(i,u);let h=new sr(l.target,u,c,l.sequenceNumber);kl(i,h)}),i.remoteSyncer.applyRemoteEvent(a)}(n,e))}catch(r){y("RemoteStore","Failed to raise snapshot:",r),yield Oo(n,r)}})}function Oo(n,t,e){return p(this,null,function*(){if(!Qe(t))throw t;n.v_.add(1),yield pr(n),n.x_.set("Offline"),e||(e=()=>Eg(n.localStore)),n.asyncQueue.enqueueRetryable(()=>p(this,null,function*(){y("RemoteStore","Retrying IndexedDB access"),yield e(),n.v_.delete(1),yield Gs(n)}))})}function xg(n,t){return t().catch(e=>Oo(n,e,t))}function _r(n){return p(this,null,function*(){let t=v(n),e=$e(t),r=t.D_.length>0?t.D_[t.D_.length-1].batchId:-1;for(;Mw(t);)try{let s=yield xw(t.localStore,r);if(s===null){t.D_.length===0&&e.Xo();break}r=s.batchId,Lw(t,s)}catch(s){yield Oo(t,s)}Dg(t)&&Vg(t)})}function Mw(n){return We(n)&&n.D_.length<10}function Lw(n,t){n.D_.push(t);let e=$e(n);e.Jo()&&e.P_&&e.I_(t.mutations)}function Dg(n){return We(n)&&!$e(n).Ho()&&n.D_.length>0}function Vg(n){$e(n).start()}function Uw(n){return p(this,null,function*(){$e(n).d_()})}function qw(n){return p(this,null,function*(){let t=$e(n);for(let e of n.D_)t.I_(e.mutations)})}function Bw(n,t,e){return p(this,null,function*(){let r=n.D_.shift(),s=Xu.from(r,t,e);yield xg(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),yield _r(n)})}function jw(n,t){return p(this,null,function*(){t&&$e(n).P_&&(yield function(r,s){return p(this,null,function*(){if(function(o){return Jm(o)&&o!==g.ABORTED}(s.code)){let i=r.D_.shift();$e(r).Zo(),yield xg(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),yield _r(r)}})}(n,t)),Dg(n)&&Vg(n)})}function im(n,t){return p(this,null,function*(){let e=v(n);e.asyncQueue.verifyOperationInProgress(),y("RemoteStore","RemoteStore received new credentials");let r=We(e);e.v_.add(3),yield pr(e),r&&e.x_.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.v_.delete(3),yield Gs(e)})}function zc(n,t){return p(this,null,function*(){let e=v(n);t?(e.v_.delete(2),yield Gs(e)):t||(e.v_.add(2),yield pr(e),e.x_.set("Unknown"))})}function yr(n){return n.N_||(n.N_=function(e,r,s){let i=v(e);return i.R_(),new Uc(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Po:Nw.bind(null,n),To:Ow.bind(null,n),u_:Fw.bind(null,n)}),n.F_.push(t=>p(this,null,function*(){t?(n.N_.Zo(),Ol(n)?Nl(n):n.x_.set("Unknown")):(yield n.N_.stop(),Cg(n))}))),n.N_}function $e(n){return n.L_||(n.L_=function(e,r,s){let i=v(e);return i.R_(),new qc(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Po:Uw.bind(null,n),To:jw.bind(null,n),E_:qw.bind(null,n),T_:Bw.bind(null,n)}),n.F_.push(t=>p(this,null,function*(){t?(n.L_.Zo(),yield _r(n)):(yield n.L_.stop(),n.D_.length>0&&(y("RemoteStore",`Stopping write stream with ${n.D_.length} pending writes`),n.D_=[]))}))),n.L_}var $c=class n{constructor(t,e,r,s,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new lt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,r,s,i){let o=Date.now()+r,a=new n(t,e,o,s,i);return a.start(r),a}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new _(g.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function wr(n,t){if(st("AsyncQueue",`${t}: ${n}`),Qe(n))return new _(g.UNAVAILABLE,`${t}: ${n}`);throw n}var Fo=class n{constructor(t){this.comparator=t?(e,r)=>t(e,r)||E.comparator(e.key,r.key):(e,r)=>E.comparator(e.key,r.key),this.keyedMap=cs(),this.sortedSet=new H(this.comparator)}static emptySet(t){return new n(t.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,r)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;e.hasNext();){let s=e.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let r=new n;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=e,r}};var Mo=class{constructor(){this.B_=new H(E.comparator)}track(t){let e=t.doc.key,r=this.B_.get(e);r?t.type!==0&&r.type===3?this.B_=this.B_.insert(e,t):t.type===3&&r.type!==1?this.B_=this.B_.insert(e,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.B_=this.B_.insert(e,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.B_=this.B_.insert(e,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.B_=this.B_.remove(e):t.type===1&&r.type===2?this.B_=this.B_.insert(e,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.B_=this.B_.insert(e,{type:2,doc:t.doc}):S():this.B_=this.B_.insert(e,t)}k_(){let t=[];return this.B_.inorderTraversal((e,r)=>{t.push(r)}),t}},cr=class n{constructor(t,e,r,s,i,o,a,u,c){this.query=t,this.docs=e,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(t,e,r,s,i){let o=[];return e.forEach(a=>{o.push({type:0,doc:a})}),new n(t,e,Fo.emptySet(e),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&qs(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,r=t.docChanges;if(e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==r[s].type||!e[s].doc.isEqual(r[s].doc))return!1;return!0}};var Kc=class{constructor(){this.q_=void 0,this.Q_=[]}K_(){return this.Q_.some(t=>t.U_())}},Qc=class{constructor(){this.queries=new le(t=>Mm(t),qs),this.onlineState="Unknown",this.W_=new Set}};function Fl(n,t){return p(this,null,function*(){let e=v(n),r=3,s=t.query,i=e.queries.get(s);i?!i.K_()&&t.U_()&&(r=2):(i=new Kc,r=t.U_()?0:1);try{switch(r){case 0:i.q_=yield e.onListen(s,!0);break;case 1:i.q_=yield e.onListen(s,!1);break;case 2:yield e.onFirstRemoteStoreListen(s)}}catch(o){let a=wr(o,`Initialization of query '${Gn(t.query)}' failed`);return void t.onError(a)}e.queries.set(s,i),i.Q_.push(t),t.G_(e.onlineState),i.q_&&t.z_(i.q_)&&Ll(e)})}function Ml(n,t){return p(this,null,function*(){let e=v(n),r=t.query,s=3,i=e.queries.get(r);if(i){let o=i.Q_.indexOf(t);o>=0&&(i.Q_.splice(o,1),i.Q_.length===0?s=t.U_()?0:1:!i.K_()&&t.U_()&&(s=2))}switch(s){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}})}function Gw(n,t){let e=v(n),r=!1;for(let s of t){let i=s.query,o=e.queries.get(i);if(o){for(let a of o.Q_)a.z_(s)&&(r=!0);o.q_=s}}r&&Ll(e)}function zw(n,t,e){let r=v(n),s=r.queries.get(t);if(s)for(let i of s.Q_)i.onError(e);r.queries.delete(t)}function Ll(n){n.W_.forEach(t=>{t.next()})}var Wc,om;(om=Wc||(Wc={})).j_="default",om.Cache="cache";var ks=class{constructor(t,e,r){this.query=t,this.H_=e,this.J_=!1,this.Y_=null,this.onlineState="Unknown",this.options=r||{}}z_(t){if(!this.options.includeMetadataChanges){let r=[];for(let s of t.docChanges)s.type!==3&&r.push(s);t=new cr(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.J_?this.Z_(t)&&(this.H_.next(t),e=!0):this.X_(t,this.onlineState)&&(this.ea(t),e=!0),this.Y_=t,e}onError(t){this.H_.error(t)}G_(t){this.onlineState=t;let e=!1;return this.Y_&&!this.J_&&this.X_(this.Y_,t)&&(this.ea(this.Y_),e=!0),e}X_(t,e){if(!t.fromCache||!this.U_())return!0;let r=e!=="Offline";return(!this.options.ta||!r)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Z_(t){if(t.docChanges.length>0)return!0;let e=this.Y_&&this.Y_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}ea(t){t=cr.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.J_=!0,this.H_.next(t)}U_(){return this.options.source!==Wc.Cache}};var Hc=class{constructor(t,e){this.na=t,this.byteLength=e}ra(){return"metadata"in this.na}};var Lo=class{constructor(t){this.serializer=t}Ps(t){return oe(this.serializer,t)}Is(t){return t.metadata.exists?og(this.serializer,t.document,!1):ht.newNoDocument(this.Ps(t.metadata.name),this.Ts(t.metadata.readTime))}Ts(t){return ot(t)}},Yc=class{constructor(t,e,r){this.ia=t,this.localStore=e,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=kg(t)}sa(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.na.namedQuery)this.queries.push(t.na.namedQuery);else if(t.na.documentMetadata){this.documents.push({metadata:t.na.documentMetadata}),t.na.documentMetadata.exists||++e;let r=U.fromString(t.na.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else t.na.document&&(this.documents[this.documents.length-1].document=t.na.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}oa(t){let e=new Map,r=new Lo(this.serializer);for(let s of t)if(s.metadata.queries){let i=r.Ps(s.metadata.name);for(let o of s.metadata.queries){let a=(e.get(o)||O()).add(i);e.set(o,a)}}return e}complete(){return p(this,null,function*(){let t=yield Dw(this.localStore,new Lo(this.serializer),this.documents,this.ia.id),e=this.oa(this.documents);for(let r of this.queries)yield Vw(this.localStore,r,e.get(r.name));return this.progress.taskState="Success",{progress:this.progress,_a:this.collectionGroups,aa:t}})}};function kg(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var Uo=class{constructor(t){this.key=t}},qo=class{constructor(t){this.key=t}},Bo=class{constructor(t,e){this.query=t,this.ua=e,this.ca=null,this.hasCachedResults=!1,this.current=!1,this.la=O(),this.mutatedKeys=O(),this.ha=Um(t),this.Pa=new Fo(this.ha)}get Ia(){return this.ua}Ta(t,e){let r=e?e.Ea:new Mo,s=e?e.Pa:this.Pa,i=e?e.mutatedKeys:this.mutatedKeys,o=s,a=!1,u=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal((l,h)=>{let d=s.get(l),f=Bs(this.query,h)?h:null,T=!!d&&this.mutatedKeys.has(d.key),I=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations),w=!1;d&&f?d.data.isEqual(f.data)?T!==I&&(r.track({type:3,doc:f}),w=!0):this.da(d,f)||(r.track({type:2,doc:f}),w=!0,(u&&this.ha(f,u)>0||c&&this.ha(f,c)<0)&&(a=!0)):!d&&f?(r.track({type:0,doc:f}),w=!0):d&&!f&&(r.track({type:1,doc:d}),w=!0,(u||c)&&(a=!0)),w&&(f?(o=o.add(f),i=I?i.add(l):i.delete(l)):(o=o.delete(l),i=i.delete(l)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let l=this.query.limitType==="F"?o.last():o.first();o=o.delete(l.key),i=i.delete(l.key),r.track({type:1,doc:l})}return{Pa:o,Ea:r,Xi:a,mutatedKeys:i}}da(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,r,s){let i=this.Pa;this.Pa=t.Pa,this.mutatedKeys=t.mutatedKeys;let o=t.Ea.k_();o.sort((l,h)=>function(f,T){let I=w=>{switch(w){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return S()}};return I(f)-I(T)}(l.type,h.type)||this.ha(l.doc,h.doc)),this.Aa(r),s=s!=null&&s;let a=e&&!s?this.Ra():[],u=this.la.size===0&&this.current&&!s?1:0,c=u!==this.ca;return this.ca=u,o.length!==0||c?{snapshot:new cr(this.query,t.Pa,i,o,t.mutatedKeys,u===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),Va:a}:{Va:a}}G_(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({Pa:this.Pa,Ea:new Mo,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{Va:[]}}ma(t){return!this.ua.has(t)&&!!this.Pa.has(t)&&!this.Pa.get(t).hasLocalMutations}Aa(t){t&&(t.addedDocuments.forEach(e=>this.ua=this.ua.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.ua=this.ua.delete(e)),this.current=t.current)}Ra(){if(!this.current)return[];let t=this.la;this.la=O(),this.Pa.forEach(r=>{this.ma(r.key)&&(this.la=this.la.add(r.key))});let e=[];return t.forEach(r=>{this.la.has(r)||e.push(new qo(r))}),this.la.forEach(r=>{t.has(r)||e.push(new Uo(r))}),e}fa(t){this.ua=t.hs,this.la=O();let e=this.Ta(t.documents);return this.applyChanges(e,!0)}ga(){return cr.fromInitialDocuments(this.query,this.Pa,this.mutatedKeys,this.ca===0,this.hasCachedResults)}},Xc=class{constructor(t,e,r){this.query=t,this.targetId=e,this.view=r}},Jc=class{constructor(t){this.key=t,this.pa=!1}},Zc=class{constructor(t,e,r,s,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.ya={},this.wa=new le(a=>Mm(a),qs),this.Sa=new Map,this.ba=new Set,this.Da=new H(E.comparator),this.Ca=new Map,this.va=new xs,this.Fa={},this.Ma=new Map,this.xa=ir.Ln(),this.onlineState="Unknown",this.Oa=void 0}get isPrimaryClient(){return this.Oa===!0}};function $w(n,t,e=!0){return p(this,null,function*(){let r=ta(n),s,i=r.wa.get(t);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.ga()):s=yield Ng(r,t,e,!0),s})}function Kw(n,t){return p(this,null,function*(){let e=ta(n);yield Ng(e,t,!0,!1)})}function Ng(n,t,e,r){return p(this,null,function*(){let s=yield or(n.localStore,xt(t)),i=s.targetId,o=e?n.sharedClientState.addLocalQueryTarget(i):"not-current",a;return r&&(a=yield Ul(n,t,i,o==="current",s.resumeToken)),n.isPrimaryClient&&e&&Zo(n.remoteStore,s),a})}function Ul(n,t,e,r,s){return p(this,null,function*(){n.Na=(h,d,f)=>function(I,w,C,D){return p(this,null,function*(){let b=w.view.Ta(C);b.Xi&&(b=yield Co(I.localStore,w.query,!1).then(({documents:Y})=>w.view.Ta(Y,b)));let x=D&&D.targetChanges.get(w.targetId),M=D&&D.targetMismatches.get(w.targetId)!=null,k=w.view.applyChanges(b,I.isPrimaryClient,x,M);return tl(I,w.targetId,k.Va),k.snapshot})}(n,h,d,f);let i=yield Co(n.localStore,t,!0),o=new Bo(t,i.hs),a=o.Ta(i.documents),u=Rs.createSynthesizedTargetChangeForCurrentChange(e,r&&n.onlineState!=="Offline",s),c=o.applyChanges(a,n.isPrimaryClient,u);tl(n,e,c.Va);let l=new Xc(t,e,o);return n.wa.set(t,l),n.Sa.has(e)?n.Sa.get(e).push(t):n.Sa.set(e,[t]),c.snapshot})}function Qw(n,t,e){return p(this,null,function*(){let r=v(n),s=r.wa.get(t),i=r.Sa.get(s.targetId);if(i.length>1)return r.Sa.set(s.targetId,i.filter(o=>!qs(o,t))),void r.wa.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||(yield ar(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),e&&ur(r.remoteStore,s.targetId),lr(r,s.targetId)}).catch(Ke))):(lr(r,s.targetId),yield ar(r.localStore,s.targetId,!0))})}function Ww(n,t){return p(this,null,function*(){let e=v(n),r=e.wa.get(t),s=e.Sa.get(r.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),ur(e.remoteStore,r.targetId))})}function Hw(n,t,e){return p(this,null,function*(){let r=Gl(n);try{let s=yield function(o,a){let u=v(o),c=Z.now(),l=a.reduce((f,T)=>f.add(T.key),O()),h,d;return u.persistence.runTransaction("Locally write mutations","readwrite",f=>{let T=kt(),I=O();return u.os.getEntries(f,l).next(w=>{T=w,T.forEach((C,D)=>{D.isValidDocument()||(I=I.add(C))})}).next(()=>u.localDocuments.getOverlayedDocuments(f,T)).next(w=>{h=w;let C=[];for(let D of a){let b=lw(D,h.get(D.key).overlayedDocument);b!=null&&C.push(new Qt(D.key,b,xm(b.value.mapValue),rt.exists(!0)))}return u.mutationQueue.addMutationBatch(f,c,C,a)}).next(w=>{d=w;let C=w.applyToLocalDocumentSet(h,I);return u.documentOverlayCache.saveOverlays(f,w.batchId,C)})}).then(()=>({batchId:d.batchId,changes:Bm(h)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,u){let c=o.Fa[o.currentUser.toKey()];c||(c=new H(N)),c=c.insert(a,u),o.Fa[o.currentUser.toKey()]=c}(r,s.batchId,e),yield Se(r,s.changes),yield _r(r.remoteStore)}catch(s){let i=wr(s,"Failed to persist write");e.reject(i)}})}function Og(n,t){return p(this,null,function*(){let e=v(n);try{let r=yield Cw(e.localStore,t);t.targetChanges.forEach((s,i)=>{let o=e.Ca.get(i);o&&(R(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.pa=!0:s.modifiedDocuments.size>0?R(o.pa):s.removedDocuments.size>0&&(R(o.pa),o.pa=!1))}),yield Se(e,r,t)}catch(r){yield Ke(r)}})}function am(n,t,e){let r=v(n);if(r.isPrimaryClient&&e===0||!r.isPrimaryClient&&e===1){let s=[];r.wa.forEach((i,o)=>{let a=o.view.G_(t);a.snapshot&&s.push(a.snapshot)}),function(o,a){let u=v(o);u.onlineState=a;let c=!1;u.queries.forEach((l,h)=>{for(let d of h.Q_)d.G_(a)&&(c=!0)}),c&&Ll(u)}(r.eventManager,t),s.length&&r.ya.u_(s),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function Yw(n,t,e){return p(this,null,function*(){let r=v(n);r.sharedClientState.updateQueryState(t,"rejected",e);let s=r.Ca.get(t),i=s&&s.key;if(i){let o=new H(E.comparator);o=o.insert(i,ht.newNoDocument(i,P.min()));let a=O().add(i),u=new Ss(P.min(),new Map,new H(N),o,a);yield Og(r,u),r.Da=r.Da.remove(i),r.Ca.delete(t),jl(r)}else yield ar(r.localStore,t,!1).then(()=>lr(r,t,e)).catch(Ke)})}function Xw(n,t){return p(this,null,function*(){let e=v(n),r=t.batch.batchId;try{let s=yield Pw(e.localStore,t);Bl(e,r,null),ql(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),yield Se(e,s)}catch(s){yield Ke(s)}})}function Jw(n,t,e){return p(this,null,function*(){let r=v(n);try{let s=yield function(o,a){let u=v(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let l;return u.mutationQueue.lookupMutationBatch(c,a).next(h=>(R(h!==null),l=h.keys(),u.mutationQueue.removeMutationBatch(c,h))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,l,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,l)).next(()=>u.localDocuments.getDocuments(c,l))})}(r.localStore,t);Bl(r,t,e),ql(r,t),r.sharedClientState.updateMutationState(t,"rejected",e),yield Se(r,s)}catch(s){yield Ke(s)}})}function Zw(n,t){return p(this,null,function*(){let e=v(n);We(e.remoteStore)||y("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield function(o){let a=v(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>a.mutationQueue.getHighestUnacknowledgedBatchId(u))}(e.localStore);if(r===-1)return void t.resolve();let s=e.Ma.get(r)||[];s.push(t),e.Ma.set(r,s)}catch(r){let s=wr(r,"Initialization of waitForPendingWrites() operation failed");t.reject(s)}})}function ql(n,t){(n.Ma.get(t)||[]).forEach(e=>{e.resolve()}),n.Ma.delete(t)}function Bl(n,t,e){let r=v(n),s=r.Fa[r.currentUser.toKey()];if(s){let i=s.get(t);i&&(e?i.reject(e):i.resolve(),s=s.remove(t)),r.Fa[r.currentUser.toKey()]=s}}function lr(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(let r of n.Sa.get(t))n.wa.delete(r),e&&n.ya.La(r,e);n.Sa.delete(t),n.isPrimaryClient&&n.va.Vr(t).forEach(r=>{n.va.containsKey(r)||Fg(n,r)})}function Fg(n,t){n.ba.delete(t.path.canonicalString());let e=n.Da.get(t);e!==null&&(ur(n.remoteStore,e),n.Da=n.Da.remove(t),n.Ca.delete(e),jl(n))}function tl(n,t,e){for(let r of e)r instanceof Uo?(n.va.addReference(r.key,t),tT(n,r)):r instanceof qo?(y("SyncEngine","Document no longer in limbo: "+r.key),n.va.removeReference(r.key,t),n.va.containsKey(r.key)||Fg(n,r.key)):S()}function tT(n,t){let e=t.key,r=e.path.canonicalString();n.Da.get(e)||n.ba.has(r)||(y("SyncEngine","New document in limbo: "+e),n.ba.add(r),jl(n))}function jl(n){for(;n.ba.size>0&&n.Da.size<n.maxConcurrentLimboResolutions;){let t=n.ba.values().next().value;n.ba.delete(t);let e=new E(U.fromString(t)),r=n.xa.next();n.Ca.set(r,new Jc(e)),n.Da=n.Da.insert(e,r),Zo(n.remoteStore,new sr(xt(gr(e.path)),r,"TargetPurposeLimboResolution",Ft._e))}}function Se(n,t,e){return p(this,null,function*(){let r=v(n),s=[],i=[],o=[];r.wa.isEmpty()||(r.wa.forEach((a,u)=>{o.push(r.Na(u,t,e).then(c=>{if((c||e)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,c!=null&&c.fromCache?"not-current":"current"),c){s.push(c);let l=Vc.Ki(u.targetId,c);i.push(l)}}))}),yield Promise.all(o),r.ya.u_(s),yield function(u,c){return p(this,null,function*(){let l=v(u);try{yield l.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>m.forEach(c,d=>m.forEach(d.qi,f=>l.persistence.referenceDelegate.addReference(h,d.targetId,f)).next(()=>m.forEach(d.Qi,f=>l.persistence.referenceDelegate.removeReference(h,d.targetId,f)))))}catch(h){if(!Qe(h))throw h;y("LocalStore","Failed to update sequence numbers: "+h)}for(let h of c){let d=h.targetId;if(!h.fromCache){let f=l.ns.get(d),T=f.snapshotVersion,I=f.withLastLimboFreeSnapshotVersion(T);l.ns=l.ns.insert(d,I)}}})}(r.localStore,i))})}function eT(n,t){return p(this,null,function*(){let e=v(n);if(!e.currentUser.isEqual(t)){y("SyncEngine","User change. New user:",t.toKey());let r=yield Ig(e.localStore,t);e.currentUser=t,function(i,o){i.Ma.forEach(a=>{a.forEach(u=>{u.reject(new _(g.CANCELLED,o))})}),i.Ma.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),yield Se(e,r.us)}})}function nT(n,t){let e=v(n),r=e.Ca.get(t);if(r&&r.pa)return O().add(r.key);{let s=O(),i=e.Sa.get(t);if(!i)return s;for(let o of i){let a=e.wa.get(o);s=s.unionWith(a.view.Ia)}return s}}function rT(n,t){return p(this,null,function*(){let e=v(n),r=yield Co(e.localStore,t.query,!0),s=t.view.fa(r);return e.isPrimaryClient&&tl(e,t.targetId,s.Va),s})}function sT(n,t){return p(this,null,function*(){let e=v(n);return Sg(e.localStore,t).then(r=>Se(e,r))})}function iT(n,t,e,r){return p(this,null,function*(){let s=v(n),i=yield function(a,u){let c=v(a),l=v(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",h=>l.vn(h,u).next(d=>d?c.localDocuments.getDocuments(h,d):m.resolve(null)))}(s.localStore,t);i!==null?(e==="pending"?yield _r(s.remoteStore):e==="acknowledged"||e==="rejected"?(Bl(s,t,r||null),ql(s,t),function(a,u){v(v(a).mutationQueue).Mn(u)}(s.localStore,t)):S(),yield Se(s,i)):y("SyncEngine","Cannot apply mutation batch with id: "+t)})}function oT(n,t){return p(this,null,function*(){let e=v(n);if(ta(e),Gl(e),t===!0&&e.Oa!==!0){let r=e.sharedClientState.getAllActiveQueryTargets(),s=yield um(e,r.toArray());e.Oa=!0,yield zc(e.remoteStore,!0);for(let i of s)Zo(e.remoteStore,i)}else if(t===!1&&e.Oa!==!1){let r=[],s=Promise.resolve();e.Sa.forEach((i,o)=>{e.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(lr(e,o),ar(e.localStore,o,!0))),ur(e.remoteStore,o)}),yield s,yield um(e,r),function(o){let a=v(o);a.Ca.forEach((u,c)=>{ur(a.remoteStore,c)}),a.va.mr(),a.Ca=new Map,a.Da=new H(E.comparator)}(e),e.Oa=!1,yield zc(e.remoteStore,!1)}})}function um(n,t,e){return p(this,null,function*(){let r=v(n),s=[],i=[];for(let o of t){let a,u=r.Sa.get(o);if(u&&u.length!==0){a=yield or(r.localStore,xt(u[0]));for(let c of u){let l=r.wa.get(c),h=yield rT(r,l);h.snapshot&&i.push(h.snapshot)}}else{let c=yield Ag(r.localStore,o);a=yield or(r.localStore,c),yield Ul(r,Mg(c),o,!1,a.resumeToken)}s.push(a)}return r.ya.u_(i),s})}function Mg(n){return Fm(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function aT(n){return function(e){return v(v(e).persistence).Bi()}(v(n).localStore)}function uT(n,t,e,r){return p(this,null,function*(){let s=v(n);if(s.Oa)return void y("SyncEngine","Ignoring unexpected query state notification.");let i=s.Sa.get(t);if(i&&i.length>0)switch(e){case"current":case"not-current":{let o=yield Sg(s.localStore,Lm(i[0])),a=Ss.createSynthesizedRemoteEventForCurrentChange(t,e==="current",pt.EMPTY_BYTE_STRING);yield Se(s,o,a);break}case"rejected":yield ar(s.localStore,t,!0),lr(s,t,r);break;default:S()}})}function cT(n,t,e){return p(this,null,function*(){let r=ta(n);if(r.Oa){for(let s of t){if(r.Sa.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){y("SyncEngine","Adding an already active target "+s);continue}let i=yield Ag(r.localStore,s),o=yield or(r.localStore,i);yield Ul(r,Mg(i),o.targetId,!1,o.resumeToken),Zo(r.remoteStore,o)}for(let s of e)r.Sa.has(s)&&(yield ar(r.localStore,s,!1).then(()=>{ur(r.remoteStore,s),lr(r,s)}).catch(Ke))}})}function ta(n){let t=v(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=Og.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=nT.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Yw.bind(null,t),t.ya.u_=Gw.bind(null,t.eventManager),t.ya.La=zw.bind(null,t.eventManager),t}function Gl(n){let t=v(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Xw.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Jw.bind(null,t),t}function lT(n,t,e){let r=v(n);(function(i,o,a){return p(this,null,function*(){try{let u=yield o.getMetadata();if(yield function(f,T){let I=v(f),w=ot(T.createTime);return I.persistence.runTransaction("hasNewerBundle","readonly",C=>I.$r.getBundleMetadata(C,T.id)).then(C=>!!C&&C.createTime.compareTo(w)>=0)}(i.localStore,u))return yield o.close(),a._completeWith(function(f){return{taskState:"Success",documentsLoaded:f.totalDocuments,bytesLoaded:f.totalBytes,totalDocuments:f.totalDocuments,totalBytes:f.totalBytes}}(u)),Promise.resolve(new Set);a._updateProgress(kg(u));let c=new Yc(u,i.localStore,o.serializer),l=yield o.Ba();for(;l;){let d=yield c.sa(l);d&&a._updateProgress(d),l=yield o.Ba()}let h=yield c.complete();return yield Se(i,h.aa,void 0),yield function(f,T){let I=v(f);return I.persistence.runTransaction("Save bundle","readwrite",w=>I.$r.saveBundleMetadata(w,T))}(i.localStore,u),a._completeWith(h.progress),Promise.resolve(h._a)}catch(u){return Bt("SyncEngine",`Loading bundle failed with ${u}`),a._failWith(u),Promise.resolve(new Set)}})})(r,t,e).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}var Ns=class{constructor(){this.synchronizeTabs=!1}initialize(t){return p(this,null,function*(){this.serializer=js(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),yield this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)})}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return Tg(this.persistence,new Po,t.initialUser,this.serializer)}createPersistence(t){return new Ro(bo.Hr,this.serializer)}createSharedClientState(t){return new Vo}terminate(){return p(this,null,function*(){var t,e;(t=this.gcScheduler)===null||t===void 0||t.stop(),(e=this.indexBackfillerScheduler)===null||e===void 0||e.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var jo=class n extends Ns{constructor(t,e,r){super(),this.ka=t,this.cacheSizeBytes=e,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(t){return p(this,null,function*(){yield Aa(n.prototype,this,"initialize").call(this,t),yield this.ka.initialize(this,t),yield Gl(this.ka.syncEngine),yield _r(this.ka.remoteStore),yield this.persistence.fi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(t){return Tg(this.persistence,new Po,t.initialUser,this.serializer)}createGarbageCollectionScheduler(t,e){let r=this.persistence.referenceDelegate.garbageCollector;return new _c(r,t.asyncQueue,e)}createIndexBackfillerScheduler(t,e){let r=new Ou(e,this.persistence);return new Nu(t.asyncQueue,r)}createPersistence(t){let e=Vl(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?qt.withCacheSize(this.cacheSizeBytes):qt.DEFAULT;return new Dc(this.synchronizeTabs,e,t.clientId,r,t.asyncQueue,bg(),Zi(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(t){return new Vo}},el=class n extends jo{constructor(t,e){super(t,e,!1),this.ka=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}initialize(t){return p(this,null,function*(){yield Aa(n.prototype,this,"initialize").call(this,t);let e=this.ka.syncEngine;this.sharedClientState instanceof gs&&(this.sharedClientState.syncEngine={Zs:iT.bind(null,e),Xs:uT.bind(null,e),eo:cT.bind(null,e),Bi:aT.bind(null,e),Ys:sT.bind(null,e)},yield this.sharedClientState.start()),yield this.persistence.fi(r=>p(this,null,function*(){yield oT(this.ka.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(t){let e=bg();if(!gs.D(e))throw new _(g.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=Vl(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new gs(e,t.asyncQueue,r,t.clientId,t.initialUser)}},Os=class{initialize(t,e){return p(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>am(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=eT.bind(null,this.syncEngine),yield zc(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new Qc}()}createDatastore(t){let e=js(t.databaseInfo.databaseId),r=function(i){return new Lc(i)}(t.databaseInfo);return function(i,o,a,u){return new Bc(i,o,a,u)}(t.authCredentials,t.appCheckCredentials,r,e)}createRemoteStore(t){return function(r,s,i,o,a){return new Gc(r,s,i,o,a)}(this.localStore,this.datastore,t.asyncQueue,e=>am(this.syncEngine,e,0),function(){return ko.D()?new ko:new Fc}())}createSyncEngine(t,e){return function(s,i,o,a,u,c,l){let h=new Zc(s,i,o,a,u,c);return l&&(h.Oa=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return p(this,null,function*(){var t;yield function(r){return p(this,null,function*(){let s=v(r);y("RemoteStore","RemoteStore shutting down."),s.v_.add(5),yield pr(s),s.M_.shutdown(),s.x_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate()})}};function cm(n,t=10240){let e=0;return{read(){return p(this,null,function*(){if(e<n.byteLength){let s={value:n.slice(e,e+t),done:!1};return e+=t,s}return{done:!0}})},cancel(){return p(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var hr=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.qa(this.observer.next,t)}error(t){this.observer.error?this.qa(this.observer.error,t):st("Uncaught Error in snapshot listener:",t.toString())}Qa(){this.muted=!0}qa(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}};var nl=class{constructor(t,e){this.Ka=t,this.serializer=e,this.metadata=new lt,this.buffer=new Uint8Array,this.$a=function(){return new TextDecoder("utf-8")}(),this.Ua().then(r=>{r&&r.ra()?this.metadata.resolve(r.na.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.na)}`))},r=>this.metadata.reject(r))}close(){return this.Ka.cancel()}getMetadata(){return p(this,null,function*(){return this.metadata.promise})}Ba(){return p(this,null,function*(){return yield this.getMetadata(),this.Ua()})}Ua(){return p(this,null,function*(){let t=yield this.Wa();if(t===null)return null;let e=this.$a.decode(t),r=Number(e);isNaN(r)&&this.Ga(`length string (${e}) is not valid number`);let s=yield this.za(r);return new Hc(JSON.parse(s),t.length+r)})}ja(){return this.buffer.findIndex(t=>t===123)}Wa(){return p(this,null,function*(){for(;this.ja()<0&&!(yield this.Ha()););if(this.buffer.length===0)return null;let t=this.ja();t<0&&this.Ga("Reached the end of bundle when a length string is expected.");let e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e})}za(t){return p(this,null,function*(){for(;this.buffer.length<t;)(yield this.Ha())&&this.Ga("Reached the end of bundle when more is expected.");let e=this.$a.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e})}Ga(t){throw this.Ka.cancel(),new Error(`Invalid bundle format: ${t}`)}Ha(){return p(this,null,function*(){let t=yield this.Ka.read();if(!t.done){let e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done})}};var rl=class{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(t){return p(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new _(g.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let e=yield function(s,i){return p(this,null,function*(){let o=v(s),a={documents:i.map(h=>bs(o.serializer,h))},u=yield o.vo("BatchGetDocuments",o.serializer.databaseId,U.emptyPath(),a,i.length),c=new Map;u.forEach(h=>{let d=pw(o.serializer,h);c.set(d.key.toString(),d)});let l=[];return i.forEach(h=>{let d=c.get(h.toString());R(!!d),l.push(d)}),l})}(this.datastore,t);return e.forEach(r=>this.recordVersion(r)),e})}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(t.toString())}delete(t){this.write(new ze(t,this.precondition(t))),this.writtenDocs.add(t.toString())}commit(){return p(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,r)=>{let s=E.fromPath(r);this.mutations.push(new Es(s,this.precondition(s)))}),yield function(r,s){return p(this,null,function*(){let i=v(r),o={writes:s.map(a=>Ps(i.serializer,a))};yield i.So("Commit",i.serializer.databaseId,U.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw S();e=P.min()}let r=this.readVersions.get(t.key.toString());if(r){if(!e.isEqual(r))throw new _(g.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){let e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(P.min())?rt.exists(!1):rt.updateTime(e):rt.none()}preconditionForUpdate(t){let e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(P.min()))throw new _(g.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return rt.updateTime(e)}return rt.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}};var sl=class{constructor(t,e,r,s,i){this.asyncQueue=t,this.datastore=e,this.options=r,this.updateFunction=s,this.deferred=i,this.Ja=r.maxAttempts,this.jo=new Vs(this.asyncQueue,"transaction_retry")}Ya(){this.Ja-=1,this.Za()}Za(){this.jo.qo(()=>p(this,null,function*(){let t=new rl(this.datastore),e=this.Xa(t);e&&e.then(r=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.eu(s)}))}).catch(r=>{this.eu(r)})}))}Xa(t){try{let e=this.updateFunction(t);return!Ls(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}eu(t){this.Ja>0&&this.tu(t)?(this.Ja-=1,this.asyncQueue.enqueueAndForget(()=>(this.Za(),Promise.resolve()))):this.deferred.reject(t)}tu(t){if(t.name==="FirebaseError"){let e=t.code;return e==="aborted"||e==="failed-precondition"||e==="already-exists"||!Jm(e)}return!1}};var il=class{constructor(t,e,r,s){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=r,this.databaseInfo=s,this.user=ct.UNAUTHENTICATED,this.clientId=no.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,i=>p(this,null,function*(){y("FirestoreClient","Received user=",i.uid),yield this.authCredentialListener(i),this.user=i})),this.appCheckCredentials.start(r,i=>(y("FirestoreClient","Received new app check token=",i),this.appCheckCredentialListener(i,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new _(g.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let t=new lt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>p(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let r=wr(e,"Failed to shutdown persistence");t.reject(r)}})),t.promise}};function to(n,t){return p(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),y("FirestoreClient","Initializing OfflineComponentProvider");let e=n.configuration;yield t.initialize(e);let r=e.initialUser;n.setCredentialChangeListener(s=>p(this,null,function*(){r.isEqual(s)||(yield Ig(t.localStore,s),r=s)})),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=t})}function ol(n,t){return p(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let e=yield zl(n);y("FirestoreClient","Initializing OnlineComponentProvider"),yield t.initialize(e,n.configuration),n.setCredentialChangeListener(r=>im(t.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>im(t.remoteStore,s)),n._onlineComponents=t})}function Lg(n){return n.name==="FirebaseError"?n.code===g.FAILED_PRECONDITION||n.code===g.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}function zl(n){return p(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){y("FirestoreClient","Using user provided OfflineComponentProvider");try{yield to(n,n._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!Lg(e))throw e;Bt("Error using user provided cache. Falling back to memory cache: "+e),yield to(n,new Ns)}}else y("FirestoreClient","Using default OfflineComponentProvider"),yield to(n,new Ns);return n._offlineComponents})}function ea(n){return p(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(y("FirestoreClient","Using user provided OnlineComponentProvider"),yield ol(n,n._uninitializedComponentsProvider._online)):(y("FirestoreClient","Using default OnlineComponentProvider"),yield ol(n,new Os))),n._onlineComponents})}function Ug(n){return zl(n).then(t=>t.persistence)}function $l(n){return zl(n).then(t=>t.localStore)}function qg(n){return ea(n).then(t=>t.remoteStore)}function Kl(n){return ea(n).then(t=>t.syncEngine)}function hT(n){return ea(n).then(t=>t.datastore)}function dr(n){return p(this,null,function*(){let t=yield ea(n),e=t.eventManager;return e.onListen=$w.bind(null,t.syncEngine),e.onUnlisten=Qw.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=Kw.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=Ww.bind(null,t.syncEngine),e})}function dT(n){return n.asyncQueue.enqueue(()=>p(this,null,function*(){let t=yield Ug(n),e=yield qg(n);return t.setNetworkEnabled(!0),function(s){let i=v(s);return i.v_.delete(0),Gs(i)}(e)}))}function fT(n){return n.asyncQueue.enqueue(()=>p(this,null,function*(){let t=yield Ug(n),e=yield qg(n);return t.setNetworkEnabled(!1),function(s){return p(this,null,function*(){let i=v(s);i.v_.add(0),yield pr(i),i.x_.set("Offline")})}(e)}))}function mT(n,t){let e=new lt;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(s,i,o){return p(this,null,function*(){try{let a=yield function(c,l){let h=v(c);return h.persistence.runTransaction("read document","readonly",d=>h.localDocuments.getDocument(d,l))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new _(g.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let u=wr(a,`Failed to get document '${i} from cache`);o.reject(u)}})}(yield $l(n),t,e)})),e.promise}function Bg(n,t,e={}){let r=new lt;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(i,o,a,u,c){let l=new hr({next:d=>{o.enqueueAndForget(()=>Ml(i,h));let f=d.docs.has(a);!f&&d.fromCache?c.reject(new _(g.UNAVAILABLE,"Failed to get document because the client is offline.")):f&&d.fromCache&&u&&u.source==="server"?c.reject(new _(g.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new ks(gr(a.path),l,{includeMetadataChanges:!0,ta:!0});return Fl(i,h)}(yield dr(n),n.asyncQueue,t,e,r)})),r.promise}function gT(n,t){let e=new lt;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(s,i,o){return p(this,null,function*(){try{let a=yield Co(s,i,!0),u=new Bo(i,a.hs),c=u.Ta(a.documents),l=u.applyChanges(c,!1);o.resolve(l.snapshot)}catch(a){let u=wr(a,`Failed to execute query '${i} against cache`);o.reject(u)}})}(yield $l(n),t,e)})),e.promise}function jg(n,t,e={}){let r=new lt;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(i,o,a,u,c){let l=new hr({next:d=>{o.enqueueAndForget(()=>Ml(i,h)),d.fromCache&&u.source==="server"?c.reject(new _(g.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new ks(a,l,{includeMetadataChanges:!0,ta:!0});return Fl(i,h)}(yield dr(n),n.asyncQueue,t,e,r)})),r.promise}function pT(n,t){let e=new hr(t);return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(s,i){v(s).W_.add(i),i.next()}(yield dr(n),e)})),()=>{e.Qa(),n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(s,i){v(s).W_.delete(i)}(yield dr(n),e)}))}}function _T(n,t,e,r){let s=function(o,a){let u;return u=typeof o=="string"?tg().encode(o):o,function(l,h){return new nl(l,h)}(function(l,h){if(l instanceof Uint8Array)return cm(l,h);if(l instanceof ArrayBuffer)return cm(new Uint8Array(l),h);if(l instanceof ReadableStream)return l.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),a)}(e,js(t));n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){lT(yield Kl(n),s,r)}))}function yT(n,t){return n.asyncQueue.enqueue(()=>p(this,null,function*(){return function(r,s){let i=v(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.$r.getNamedQuery(o,s))}(yield $l(n),t)}))}function Gg(n){let t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}var lm=new Map;function Ql(n,t,e){if(!e)throw new _(g.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function Wl(n,t,e,r){if(t===!0&&r===!0)throw new _(g.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function hm(n){if(!E.isDocumentKey(n))throw new _(g.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function dm(n){if(E.isDocumentKey(n))throw new _(g.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function na(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let t=function(r){return r.constructor?r.constructor.name:null}(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":S()}function q(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new _(g.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=na(n);throw new _(g.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}function zg(n,t){if(t<=0)throw new _(g.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${t}.`)}var Go=class{constructor(t){var e,r;if(t.host===void 0){if(t.ssl!==void 0)throw new _(g.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(e=t.ssl)===null||e===void 0||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new _(g.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}Wl("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Gg((r=t.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new _(g.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new _(g.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new _(g.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},_n=class{constructor(t,e,r,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Go({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new _(g.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(t){if(this._settingsFrozen)throw new _(g.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Go(t),t.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Au;switch(r.type){case"firstParty":return new Pu(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new _(g.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let r=lm.get(e);r&&(y("ComponentProvider","Removing Datastore"),lm.delete(e),r.terminate())}(this),Promise.resolve()}};function $g(n,t,e,r={}){var s;let i=(n=q(n,_n))._getSettings(),o=`${t}:${e}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&Bt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,u;if(typeof r.mockUserToken=="string")a=r.mockUserToken,u=ct.MOCK_USER;else{a=ii(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new _(g.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new ct(c)}n._authCredentials=new Su(new eo(a,u))}}var Tt=class n{constructor(t,e,r){this.converter=e,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new n(this.firestore,t,this._query)}},Q=class n{constructor(t,e,r){this.converter=e,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ae(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new n(this.firestore,t,this._key)}},ae=class n extends Tt{constructor(t,e,r){super(t,e,gr(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new Q(this.firestore,null,new E(t))}withConverter(t){return new n(this.firestore,t,this._path)}};function Hl(n,t,...e){if(n=B(n),Ql("collection","path",t),n instanceof _n){let r=U.fromString(t,...e);return dm(r),new ae(n,null,r)}{if(!(n instanceof Q||n instanceof ae))throw new _(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(U.fromString(t,...e));return dm(r),new ae(n.firestore,null,r)}}function Kg(n,t){if(n=q(n,_n),Ql("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new _(g.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Tt(n,null,function(r){return new Kt(U.emptyPath(),r)}(t))}function zs(n,t,...e){if(n=B(n),arguments.length===1&&(t=no.newId()),Ql("doc","path",t),n instanceof _n){let r=U.fromString(t,...e);return hm(r),new Q(n,null,new E(r))}{if(!(n instanceof Q||n instanceof ae))throw new _(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(U.fromString(t,...e));return hm(r),new Q(n.firestore,n instanceof ae?n.converter:null,new E(r))}}function Yl(n,t){return n=B(n),t=B(t),(n instanceof Q||n instanceof ae)&&(t instanceof Q||t instanceof ae)&&n.firestore===t.firestore&&n.path===t.path&&n.converter===t.converter}function Xl(n,t){return n=B(n),t=B(t),n instanceof Tt&&t instanceof Tt&&n.firestore===t.firestore&&qs(n._query,t._query)&&n.converter===t.converter}var al=class{constructor(){this.nu=Promise.resolve(),this.ru=[],this.iu=!1,this.su=[],this.ou=null,this._u=!1,this.au=!1,this.uu=[],this.jo=new Vs(this,"async_queue_retry"),this.cu=()=>{let e=Zi();e&&y("AsyncQueue","Visibility state changed to "+e.visibilityState),this.jo.Ko()};let t=Zi();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.cu)}get isShuttingDown(){return this.iu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.lu(),this.hu(t)}enterRestrictedMode(t){if(!this.iu){this.iu=!0,this.au=t||!1;let e=Zi();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.cu)}}enqueue(t){if(this.lu(),this.iu)return new Promise(()=>{});let e=new lt;return this.hu(()=>this.iu&&this.au?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.ru.push(t),this.Pu()))}Pu(){return p(this,null,function*(){if(this.ru.length!==0){try{yield this.ru[0](),this.ru.shift(),this.jo.reset()}catch(t){if(!Qe(t))throw t;y("AsyncQueue","Operation failed with retryable error: "+t)}this.ru.length>0&&this.jo.qo(()=>this.Pu())}})}hu(t){let e=this.nu.then(()=>(this._u=!0,t().catch(r=>{this.ou=r,this._u=!1;let s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw st("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this._u=!1,r))));return this.nu=e,e}enqueueAfterDelay(t,e,r){this.lu(),this.uu.indexOf(t)>-1&&(e=0);let s=$c.createAndSchedule(this,t,e,r,i=>this.Iu(i));return this.su.push(s),s}lu(){this.ou&&S()}verifyOperationInProgress(){}Tu(){return p(this,null,function*(){let t;do t=this.nu,yield t;while(t!==this.nu)})}Eu(t){for(let e of this.su)if(e.timerId===t)return!0;return!1}du(t){return this.Tu().then(()=>{this.su.sort((e,r)=>e.targetTimeMs-r.targetTimeMs);for(let e of this.su)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Tu()})}Au(t){this.uu.push(t)}Iu(t){let e=this.su.indexOf(t);this.su.splice(e,1)}};function ul(n){return function(e,r){if(typeof e!="object"||e===null)return!1;let s=e;for(let i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}var cl=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new lt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,r){this._progressObserver={next:t,error:e,complete:r}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}};var Qg=-1,X=class extends _n{constructor(t,e,r,s){super(t,e,r,s),this.type="firestore",this._queue=function(){return new al}(),this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Wg(this),this._firestoreClient.terminate()}};function dt(n){return n._firestoreClient||Wg(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function Wg(n){var t,e,r;let s=n._freezeSettings(),i=function(a,u,c,l){return new Fu(a,u,c,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,Gg(l.experimentalLongPollingOptions),l.useFetchStreams)}(n._databaseId,((t=n._app)===null||t===void 0?void 0:t.options.appId)||"",n._persistenceKey,s);n._firestoreClient=new il(n._authCredentials,n._appCheckCredentials,n._queue,i),!((e=s.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.localCache.kind,_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider})}function Hg(n,t){sp(n=q(n,X));let e=dt(n);if(e._uninitializedComponentsProvider)throw new _(g.FAILED_PRECONDITION,"SDK cache is already specified.");Bt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),s=new Os;return Xg(e,s,new jo(s,r.cacheSizeBytes,t==null?void 0:t.forceOwnership))}function Yg(n){sp(n=q(n,X));let t=dt(n);if(t._uninitializedComponentsProvider)throw new _(g.FAILED_PRECONDITION,"SDK cache is already specified.");Bt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=n._freezeSettings(),r=new Os;return Xg(t,r,new el(r,e.cacheSizeBytes))}function Xg(n,t,e){let r=new lt;return n.asyncQueue.enqueue(()=>p(this,null,function*(){try{yield to(n,e),yield ol(n,t),r.resolve()}catch(s){let i=s;if(!Lg(i))throw i;Bt("Error enabling indexeddb cache. Falling back to memory cache: "+i),r.reject(i)}})).then(()=>r.promise)}function Jg(n){if(n._initialized&&!n._terminated)throw new _(g.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new lt;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>p(this,null,function*(){try{yield function(r){return p(this,null,function*(){if(!we.D())return Promise.resolve();let s=r+"main";yield we.delete(s)})}(Vl(n._databaseId,n._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}function Zg(n){return function(e){let r=new lt;return e.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return Zw(yield Kl(e),r)})),r.promise}(dt(n=q(n,X)))}function tp(n){return dT(dt(n=q(n,X)))}function ep(n){return fT(dt(n=q(n,X)))}function np(n,t){let e=dt(n=q(n,X)),r=new cl;return _T(e,n._databaseId,t,r),r}function rp(n,t){return yT(dt(n=q(n,X)),t).then(e=>e?new Tt(n,null,e.query):null)}function sp(n){if(n._initialized||n._terminated)throw new _(g.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var he=class n{constructor(t){this._byteString=t}static fromBase64String(t){try{return new n(pt.fromBase64String(t))}catch(e){throw new _(g.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new n(pt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}};var Wt=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new _(g.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new it(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var ve=class{constructor(t){this._methodName=t}};var yn=class{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new _(g.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new _(g.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return N(this._lat,t._lat)||N(this._long,t._long)}};var wT=/^__.*__$/,ll=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return this.fieldMask!==null?new Qt(t,this.data,this.fieldMask,e,this.fieldTransforms):new Ge(t,this.data,e,this.fieldTransforms)}},zo=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return new Qt(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function ip(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw S()}}var $o=class n{constructor(t,e,r,s,i,o){this.settings=t,this.databaseId=e,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Ru(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Vu(){return this.settings.Vu}mu(t){return new n(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}fu(t){var e;let r=(e=this.path)===null||e===void 0?void 0:e.child(t),s=this.mu({path:r,gu:!1});return s.pu(t),s}yu(t){var e;let r=(e=this.path)===null||e===void 0?void 0:e.child(t),s=this.mu({path:r,gu:!1});return s.Ru(),s}wu(t){return this.mu({path:void 0,gu:!0})}Su(t){return Ko(t,this.settings.methodName,this.settings.bu||!1,this.path,this.settings.Du)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Ru(){if(this.path)for(let t=0;t<this.path.length;t++)this.pu(this.path.get(t))}pu(t){if(t.length===0)throw this.Su("Document fields must not be empty");if(ip(this.Vu)&&wT.test(t))throw this.Su('Document fields cannot begin and end with "__"')}},hl=class{constructor(t,e,r){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=r||js(t)}Cu(t,e,r,s=!1){return new $o({Vu:t,methodName:e,Du:r,path:it.emptyPath(),gu:!1,bu:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function En(n){let t=n._freezeSettings(),e=js(n._databaseId);return new hl(n._databaseId,!!t.ignoreUndefinedProperties,e)}function ra(n,t,e,r,s,i={}){let o=n.Cu(i.merge||i.mergeFields?2:0,t,e,s);th("Data must be an object, but it was:",o,r);let a=up(r,o),u,c;if(i.merge)u=new Mt(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){let l=[];for(let h of i.mergeFields){let d=pl(t,h,e);if(!o.contains(d))throw new _(g.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);lp(l,d)||l.push(d)}u=new Mt(l),c=o.fieldTransforms.filter(h=>u.covers(h.field))}else u=null,c=o.fieldTransforms;return new ll(new St(a),u,c)}var Fs=class n extends ve{_toFieldTransform(t){if(t.Vu!==2)throw t.Vu===1?t.Su(`${this._methodName}() can only appear at the top level of your update data`):t.Su(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof n}};function op(n,t,e){return new $o({Vu:3,Du:t.settings.Du,methodName:n._methodName,gu:e},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}var dl=class n extends ve{_toFieldTransform(t){return new mn(t.path,new Be)}isEqual(t){return t instanceof n}},fl=class n extends ve{constructor(t,e){super(t),this.vu=e}_toFieldTransform(t){let e=op(this,t,!0),r=this.vu.map(i=>vn(i,e)),s=new Ie(r);return new mn(t.path,s)}isEqual(t){return t instanceof n&&Pa(this.vu,t.vu)}},ml=class n extends ve{constructor(t,e){super(t),this.vu=e}_toFieldTransform(t){let e=op(this,t,!0),r=this.vu.map(i=>vn(i,e)),s=new Ee(r);return new mn(t.path,s)}isEqual(t){return t instanceof n&&Pa(this.vu,t.vu)}},gl=class n extends ve{constructor(t,e){super(t),this.Fu=e}_toFieldTransform(t){let e=new je(t.serializer,$m(t.serializer,this.Fu));return new mn(t.path,e)}isEqual(t){return t instanceof n&&this.Fu===t.Fu}};function Jl(n,t,e,r){let s=n.Cu(1,t,e);th("Data must be an object, but it was:",s,r);let i=[],o=St.empty();In(r,(u,c)=>{let l=eh(t,u,e);c=B(c);let h=s.yu(l);if(c instanceof Fs)i.push(l);else{let d=vn(c,h);d!=null&&(i.push(l),o.set(l,d))}});let a=new Mt(i);return new zo(o,a,s.fieldTransforms)}function Zl(n,t,e,r,s,i){let o=n.Cu(1,t,e),a=[pl(t,r,e)],u=[s];if(i.length%2!=0)throw new _(g.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<i.length;d+=2)a.push(pl(t,i[d])),u.push(i[d+1]);let c=[],l=St.empty();for(let d=a.length-1;d>=0;--d)if(!lp(c,a[d])){let f=a[d],T=u[d];T=B(T);let I=o.yu(f);if(T instanceof Fs)c.push(f);else{let w=vn(T,I);w!=null&&(c.push(f),l.set(f,w))}}let h=new Mt(c);return new zo(l,h,o.fieldTransforms)}function ap(n,t,e,r=!1){return vn(e,n.Cu(r?4:3,t))}function vn(n,t){if(cp(n=B(n)))return th("Unsupported field value:",t,n),up(n,t);if(n instanceof ve)return function(r,s){if(!ip(s.Vu))throw s.Su(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Su(`${r._methodName}() is not currently supported inside arrays`);let i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.gu&&t.Vu!==4)throw t.Su("Nested arrays are not supported");return function(r,s){let i=[],o=0;for(let a of r){let u=vn(a,s.wu(o));u==null&&(u={nullValue:"NULL_VALUE"}),i.push(u),o++}return{arrayValue:{values:i}}}(n,t)}return function(r,s){if((r=B(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return $m(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let i=Z.fromDate(r);return{timestampValue:rr(s.serializer,i)}}if(r instanceof Z){let i=new Z(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:rr(s.serializer,i)}}if(r instanceof yn)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof he)return{bytesValue:eg(s.serializer,r._byteString)};if(r instanceof Q){let i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Su(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Cl(r.firestore._databaseId||s.databaseId,r._key.path)}}throw s.Su(`Unsupported field value: ${na(r)}`)}(n,t)}function up(n,t){let e={};return bm(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):In(n,(r,s)=>{let i=vn(s,t.fu(r));i!=null&&(e[r]=i)}),{mapValue:{fields:e}}}function cp(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Z||n instanceof yn||n instanceof he||n instanceof Q||n instanceof ve)}function th(n,t,e){if(!cp(e)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(e)){let r=na(e);throw r==="an object"?t.Su(n+" a custom object"):t.Su(n+" "+r)}}function pl(n,t,e){if((t=B(t))instanceof Wt)return t._internalPath;if(typeof t=="string")return eh(n,t);throw Ko("Field path arguments must be of type string or ",n,!1,void 0,e)}var TT=new RegExp("[~\\*/\\[\\]]");function eh(n,t,e){if(t.search(TT)>=0)throw Ko(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new Wt(...t.split("."))._internalPath}catch{throw Ko(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function Ko(n,t,e,r,s){let i=r&&!r.isEmpty(),o=s!==void 0,a=`Function ${t}() called with invalid data`;e&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(i||o)&&(u+=" (found",i&&(u+=` in field ${r}`),o&&(u+=` in document ${s}`),u+=")"),new _(g.INVALID_ARGUMENT,a+n+u)}function lp(n,t){return n.some(e=>e.isEqual(t))}var wn=class{constructor(t,e,r,s,i){this._firestore=t,this._userDataWriter=e,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Q(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new _l(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(sa("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},_l=class extends wn{data(){return super.data()}};function sa(n,t){return typeof t=="string"?eh(n,t):t instanceof Wt?t._internalPath:t._delegate._internalPath}function hp(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new _(g.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Ms=class{},Tn=class extends Ms{};function Re(n,t,...e){let r=[];t instanceof Ms&&r.push(t),r=r.concat(e),function(i){let o=i.filter(u=>u instanceof yl).length,a=i.filter(u=>u instanceof Qo).length;if(o>1||o>0&&a>0)throw new _(g.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let s of r)n=s._apply(n);return n}var Qo=class n extends Tn{constructor(t,e,r){super(),this._field=t,this._op=e,this._value=r,this.type="where"}static _create(t,e,r){return new n(t,e,r)}_apply(t){let e=this._parse(t);return Ip(t._query,e),new Tt(t.firestore,t.converter,Hu(t._query,e))}_parse(t){let e=En(t.firestore);return function(i,o,a,u,c,l,h){let d;if(c.isKeyField()){if(l==="array-contains"||l==="array-contains-any")throw new _(g.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if(l==="in"||l==="not-in"){mm(h,l);let f=[];for(let T of h)f.push(fm(u,i,T));d={arrayValue:{values:f}}}else d=fm(u,i,h)}else l!=="in"&&l!=="not-in"&&l!=="array-contains-any"||mm(h,l),d=ap(a,o,h,l==="in"||l==="not-in");return F.create(c,l,d)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}};function dp(n,t,e){let r=t,s=sa("where",n);return Qo._create(s,r,e)}var yl=class n extends Ms{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new n(t,e)}_parse(t){let e=this._queryConstraints.map(r=>r._parse(t)).filter(r=>r.getFilters().length>0);return e.length===1?e[0]:z.create(e,this._getOperator())}_apply(t){let e=this._parse(t);return e.getFilters().length===0?t:(function(s,i){let o=s,a=i.getFlattenedFilters();for(let u of a)Ip(o,u),o=Hu(o,u)}(t._query,e),new Tt(t.firestore,t.converter,Hu(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var wl=class n extends Tn{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new n(t,e)}_apply(t){let e=function(s,i,o){if(s.startAt!==null)throw new _(g.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new _(g.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new dn(i,o)}(t._query,this._field,this._direction);return new Tt(t.firestore,t.converter,function(s,i){let o=s.explicitOrderBy.concat([i]);return new Kt(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(t._query,e))}};function fp(n,t="asc"){let e=t,r=sa("orderBy",n);return wl._create(r,e)}var Wo=class n extends Tn{constructor(t,e,r){super(),this.type=t,this._limit=e,this._limitType=r}static _create(t,e,r){return new n(t,e,r)}_apply(t){return new Tt(t.firestore,t.converter,fo(t._query,this._limit,this._limitType))}};function mp(n){return zg("limit",n),Wo._create("limit",n,"F")}function gp(n){return zg("limitToLast",n),Wo._create("limitToLast",n,"L")}var Ho=class n extends Tn{constructor(t,e,r){super(),this.type=t,this._docOrFields=e,this._inclusive=r}static _create(t,e,r){return new n(t,e,r)}_apply(t){let e=Tp(t,this.type,this._docOrFields,this._inclusive);return new Tt(t.firestore,t.converter,function(s,i){return new Kt(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(t._query,e))}};function pp(...n){return Ho._create("startAt",n,!0)}function _p(...n){return Ho._create("startAfter",n,!1)}var Yo=class n extends Tn{constructor(t,e,r){super(),this.type=t,this._docOrFields=e,this._inclusive=r}static _create(t,e,r){return new n(t,e,r)}_apply(t){let e=Tp(t,this.type,this._docOrFields,this._inclusive);return new Tt(t.firestore,t.converter,function(s,i){return new Kt(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(t._query,e))}};function yp(...n){return Yo._create("endBefore",n,!1)}function wp(...n){return Yo._create("endAt",n,!0)}function Tp(n,t,e,r){if(e[0]=B(e[0]),e[0]instanceof wn)return function(i,o,a,u,c){if(!u)throw new _(g.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let l=[];for(let h of Hn(i))if(h.field.isKeyField())l.push(hn(o,u.key));else{let d=u.data.field(h.field);if(Jo(d))throw new _(g.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(d===null){let f=h.field.canonicalString();throw new _(g.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${f}' (used as the orderBy) does not exist.`)}l.push(d)}return new ce(l,c)}(n._query,n.firestore._databaseId,t,e[0]._document,r);{let s=En(n.firestore);return function(o,a,u,c,l,h){let d=o.explicitOrderBy;if(l.length>d.length)throw new _(g.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let f=[];for(let T=0;T<l.length;T++){let I=l[T];if(d[T].field.isKeyField()){if(typeof I!="string")throw new _(g.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof I}`);if(!bl(o)&&I.indexOf("/")!==-1)throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${I}' contains a slash.`);let w=o.path.child(U.fromString(I));if(!E.isDocumentKey(w))throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${w}' is not because it contains an odd number of segments.`);let C=new E(w);f.push(hn(a,C))}else{let w=ap(u,c,I);f.push(w)}}return new ce(f,h)}(n._query,n.firestore._databaseId,s,t,e,r)}}function fm(n,t,e){if(typeof(e=B(e))=="string"){if(e==="")throw new _(g.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!bl(t)&&e.indexOf("/")!==-1)throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);let r=t.path.child(U.fromString(e));if(!E.isDocumentKey(r))throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return hn(n,new E(r))}if(e instanceof Q)return hn(n,e._key);throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${na(e)}.`)}function mm(n,t){if(!Array.isArray(n)||n.length===0)throw new _(g.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Ip(n,t){let e=function(s,i){for(let o of s)for(let a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(e!==null)throw e===t.op?new _(g.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new _(g.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}var fr=class{convertValue(t,e="none"){switch(ln(t)){case 0:return null;case 1:return t.booleanValue;case 2:return nt(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Le(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw S()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let r={};return In(t,(s,i)=>{r[s]=this.convertValue(i,e)}),r}convertGeoPoint(t){return new yn(nt(t.latitude),nt(t.longitude))}convertArray(t,e){return(t.values||[]).map(r=>this.convertValue(r,e))}convertServerTimestamp(t,e){switch(e){case"previous":let r=Sl(t);return r==null?null:this.convertValue(r,e);case"estimate":return this.convertTimestamp(ws(t));default:return null}}convertTimestamp(t){let e=Te(t);return new Z(e.seconds,e.nanos)}convertDocumentKey(t,e){let r=U.fromString(t);R(dg(r));let s=new Ue(r.get(1),r.get(3)),i=new E(r.popFirst(5));return s.isEqual(e)||st(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}};function ia(n,t,e){let r;return r=n?e&&(e.merge||e.mergeFields)?n.toFirestore(t,e):n.toFirestore(t):t,r}var Tl=class extends fr{constructor(t){super(),this.firestore=t}convertBytes(t){return new he(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new Q(this.firestore,null,e)}};var ye=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},Gt=class extends wn{constructor(t,e,r,s,i,o){super(t,e,r,s,o),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new Fe(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let r=this._document.data.field(sa("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,e.serverTimestamps)}}},Fe=class extends Gt{data(t={}){return super.data(t)}},Ht=class{constructor(t,e,r,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new ye(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(r=>{t.call(e,new Fe(this._firestore,this._userDataWriter,r.key,r,new ye(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new _(g.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{let u=new Fe(s._firestore,s._userDataWriter,a.doc.key,a.doc,new ye(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{let u=new Fe(s._firestore,s._userDataWriter,a.doc.key,a.doc,new ye(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter),c=-1,l=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:IT(a.type),doc:u,oldIndex:c,newIndex:l}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}};function IT(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return S()}}function nh(n,t){return n instanceof Gt&&t instanceof Gt?n._firestore===t._firestore&&n._key.isEqual(t._key)&&(n._document===null?t._document===null:n._document.isEqual(t._document))&&n._converter===t._converter:n instanceof Ht&&t instanceof Ht&&n._firestore===t._firestore&&Xl(n.query,t.query)&&n.metadata.isEqual(t.metadata)&&n._snapshot.isEqual(t._snapshot)}function Ep(n){n=q(n,Q);let t=q(n.firestore,X);return Bg(dt(t),n._key).then(e=>oh(t,n,e))}var Ae=class extends fr{constructor(t){super(),this.firestore=t}convertBytes(t){return new he(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new Q(this.firestore,null,e)}};function vp(n){n=q(n,Q);let t=q(n.firestore,X),e=dt(t),r=new Ae(t);return mT(e,n._key).then(s=>new Gt(t,r,n._key,s,new ye(s!==null&&s.hasLocalMutations,!0),n.converter))}function Ap(n){n=q(n,Q);let t=q(n.firestore,X);return Bg(dt(t),n._key,{source:"server"}).then(e=>oh(t,n,e))}function Sp(n){n=q(n,Tt);let t=q(n.firestore,X),e=dt(t),r=new Ae(t);return hp(n._query),jg(e,n._query).then(s=>new Ht(t,r,n,s))}function Rp(n){n=q(n,Tt);let t=q(n.firestore,X),e=dt(t),r=new Ae(t);return gT(e,n._query).then(s=>new Ht(t,r,n,s))}function bp(n){n=q(n,Tt);let t=q(n.firestore,X),e=dt(t),r=new Ae(t);return jg(e,n._query,{source:"server"}).then(s=>new Ht(t,r,n,s))}function rh(n,t,e){n=q(n,Q);let r=q(n.firestore,X),s=ia(n.converter,t,e);return Tr(r,[ra(En(r),"setDoc",n._key,s,n.converter!==null,e).toMutation(n._key,rt.none())])}function sh(n,t,e,...r){n=q(n,Q);let s=q(n.firestore,X),i=En(s),o;return o=typeof(t=B(t))=="string"||t instanceof Wt?Zl(i,"updateDoc",n._key,t,e,r):Jl(i,"updateDoc",n._key,t),Tr(s,[o.toMutation(n._key,rt.exists(!0))])}function Pp(n){return Tr(q(n.firestore,X),[new ze(n._key,rt.none())])}function Cp(n,t){let e=q(n.firestore,X),r=zs(n),s=ia(n.converter,t);return Tr(e,[ra(En(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,rt.exists(!1))]).then(()=>r)}function ih(n,...t){var e,r,s;n=B(n);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof t[o]!="object"||ul(t[o])||(i=t[o],o++);let a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(ul(t[o])){let h=t[o];t[o]=(e=h.next)===null||e===void 0?void 0:e.bind(h),t[o+1]=(r=h.error)===null||r===void 0?void 0:r.bind(h),t[o+2]=(s=h.complete)===null||s===void 0?void 0:s.bind(h)}let u,c,l;if(n instanceof Q)c=q(n.firestore,X),l=gr(n._key.path),u={next:h=>{t[o]&&t[o](oh(c,n,h))},error:t[o+1],complete:t[o+2]};else{let h=q(n,Tt);c=q(h.firestore,X),l=h._query;let d=new Ae(c);u={next:f=>{t[o]&&t[o](new Ht(c,d,h,f))},error:t[o+1],complete:t[o+2]},hp(n._query)}return function(d,f,T,I){let w=new hr(I),C=new ks(f,w,T);return d.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return Fl(yield dr(d),C)})),()=>{w.Qa(),d.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return Ml(yield dr(d),C)}))}}(dt(c),l,a,u)}function xp(n,t){return pT(dt(n=q(n,X)),ul(t)?t:{next:t})}function Tr(n,t){return function(r,s){let i=new lt;return r.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return Hw(yield Kl(r),s,i)})),i.promise}(dt(n),t)}function oh(n,t,e){let r=e.docs.get(t._key),s=new Ae(n);return new Gt(n,s,t._key,r,new ye(e.hasPendingWrites,e.fromCache),t.converter)}var ET={maxAttempts:5};var Xo=class{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=En(t)}set(t,e,r){this._verifyNotCommitted();let s=Ne(t,this._firestore),i=ia(s.converter,e,r),o=ra(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,rt.none())),this}update(t,e,r,...s){this._verifyNotCommitted();let i=Ne(t,this._firestore),o;return o=typeof(e=B(e))=="string"||e instanceof Wt?Zl(this._dataReader,"WriteBatch.update",i._key,e,r,s):Jl(this._dataReader,"WriteBatch.update",i._key,e),this._mutations.push(o.toMutation(i._key,rt.exists(!0))),this}delete(t){this._verifyNotCommitted();let e=Ne(t,this._firestore);return this._mutations=this._mutations.concat(new ze(e._key,rt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new _(g.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Ne(n,t){if((n=B(n)).firestore!==t)throw new _(g.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var Il=class extends class{constructor(e,r){this._firestore=e,this._transaction=r,this._dataReader=En(e)}get(e){let r=Ne(e,this._firestore),s=new Tl(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return S();let o=i[0];if(o.isFoundDocument())return new wn(this._firestore,s,o.key,o,r.converter);if(o.isNoDocument())return new wn(this._firestore,s,r._key,null,r.converter);throw S()})}set(e,r,s){let i=Ne(e,this._firestore),o=ia(i.converter,r,s),a=ra(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,s);return this._transaction.set(i._key,a),this}update(e,r,s,...i){let o=Ne(e,this._firestore),a;return a=typeof(r=B(r))=="string"||r instanceof Wt?Zl(this._dataReader,"Transaction.update",o._key,r,s,i):Jl(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(e){let r=Ne(e,this._firestore);return this._transaction.delete(r._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){let e=Ne(t,this._firestore),r=new Ae(this._firestore);return super.get(t).then(s=>new Gt(this._firestore,r,e._key,s._document,new ye(!1,!1),e.converter))}};function Dp(n,t,e){n=q(n,X);let r=Object.assign(Object.assign({},ET),e);return function(i){if(i.maxAttempts<1)throw new _(g.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){let u=new lt;return i.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){let c=yield hT(i);new sl(i.asyncQueue,c,a,o,u).Ya()})),u.promise}(dt(n),s=>t(new Il(n,s)),r)}function Vp(){return new Fs("deleteField")}function kp(){return new dl("serverTimestamp")}function Np(...n){return new fl("arrayUnion",n)}function Op(...n){return new ml("arrayRemove",n)}function Fp(n){return new gl("increment",n)}(function(t,e=!0){(function(s){mr=s})(ui),ai(new be("firestore",(r,{instanceIdentifier:s,options:i})=>{let o=r.getProvider("app").getImmediate(),a=new X(new Ru(r.getProvider("auth-internal")),new xu(r.getProvider("app-check-internal")),function(c,l){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new _(g.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ue(c.options.projectId,l)}(o,s),o);return i=Object.assign({useFetchStreams:e},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Dn(gf,"4.6.0",t),Dn(gf,"4.6.0","esm2017")})();var vT="@firebase/firestore-compat",AT="0.3.29";function dh(n,t){if(t===void 0)return{merge:!1};if(t.mergeFields!==void 0&&t.merge!==void 0)throw new _("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return t}function Mp(){if(typeof Uint8Array>"u")throw new _("unimplemented","Uint8Arrays are not available in this environment.")}function Lp(){if(!Pm())throw new _("unimplemented","Blobs are unavailable in Firestore in this environment.")}var oa=class n{constructor(t){this._delegate=t}static fromBase64String(t){return Lp(),new n(he.fromBase64String(t))}static fromUint8Array(t){return Mp(),new n(he.fromUint8Array(t))}toBase64(){return Lp(),this._delegate.toBase64()}toUint8Array(){return Mp(),this._delegate.toUint8Array()}isEqual(t){return this._delegate.isEqual(t._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function ah(n){return ST(n,["next","error","complete"])}function ST(n,t){if(typeof n!="object"||n===null)return!1;let e=n;for(let r of t)if(r in e&&typeof e[r]=="function")return!0;return!1}var uh=class{enableIndexedDbPersistence(t,e){return Hg(t._delegate,{forceOwnership:e})}enableMultiTabIndexedDbPersistence(t){return Yg(t._delegate)}clearIndexedDbPersistence(t){return Jg(t._delegate)}},aa=class{constructor(t,e,r){this._delegate=e,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},t instanceof Ue||(this._appCompat=t)}get _databaseId(){return this._delegate._databaseId}settings(t){let e=this._delegate._getSettings();!t.merge&&e.host!==t.host&&Bt("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&(t=Object.assign(Object.assign({},e),t),delete t.merge),this._delegate._setSettings(t)}useEmulator(t,e,r={}){$g(this._delegate,t,e,r)}enableNetwork(){return tp(this._delegate)}disableNetwork(){return ep(this._delegate)}enablePersistence(t){let e=!1,r=!1;return t&&(e=!!t.synchronizeTabs,r=!!t.experimentalForceOwningTab,Wl("synchronizeTabs",e,"experimentalForceOwningTab",r)),e?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return Zg(this._delegate)}onSnapshotsInSync(t){return xp(this._delegate,t)}get app(){if(!this._appCompat)throw new _("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(t){try{return new vr(this,Hl(this._delegate,t))}catch(e){throw Dt(e,"collection()","Firestore.collection()")}}doc(t){try{return new de(this,zs(this._delegate,t))}catch(e){throw Dt(e,"doc()","Firestore.doc()")}}collectionGroup(t){try{return new bn(this,Kg(this._delegate,t))}catch(e){throw Dt(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return Dp(this._delegate,e=>t(new ua(this,e)))}batch(){return dt(this._delegate),new ca(new Xo(this._delegate,t=>Tr(this._delegate,t)))}loadBundle(t){return np(this._delegate,t)}namedQuery(t){return rp(this._delegate,t).then(e=>e?new bn(this,e):null)}},Ir=class extends fr{constructor(t){super(),this.firestore=t}convertBytes(t){return new oa(new he(t))}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return de.forKey(e,this.firestore,null)}};function RT(n){gm(n)}var ua=class{constructor(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new Ir(t)}get(t){let e=An(t);return this._delegate.get(e).then(r=>new Sn(this._firestore,new Gt(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,e.converter)))}set(t,e,r){let s=An(t);return r?(dh("Transaction.set",r),this._delegate.set(s,e,r)):this._delegate.set(s,e),this}update(t,e,r,...s){let i=An(t);return arguments.length===2?this._delegate.update(i,e):this._delegate.update(i,e,r,...s),this}delete(t){let e=An(t);return this._delegate.delete(e),this}},ca=class{constructor(t){this._delegate=t}set(t,e,r){let s=An(t);return r?(dh("WriteBatch.set",r),this._delegate.set(s,e,r)):this._delegate.set(s,e),this}update(t,e,r,...s){let i=An(t);return arguments.length===2?this._delegate.update(i,e):this._delegate.update(i,e,r,...s),this}delete(t){let e=An(t);return this._delegate.delete(e),this}commit(){return this._delegate.commit()}},Er=class n{constructor(t,e,r){this._firestore=t,this._userDataWriter=e,this._delegate=r}fromFirestore(t,e){let r=new Fe(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new Rn(this._firestore,r),e!=null?e:{})}toFirestore(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)}static getInstance(t,e){let r=n.INSTANCES,s=r.get(t);s||(s=new WeakMap,r.set(t,s));let i=s.get(e);return i||(i=new n(t,new Ir(t),e),s.set(e,i)),i}};Er.INSTANCES=new WeakMap;var de=class n{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Ir(t)}static forPath(t,e,r){if(t.length%2!==0)throw new _("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${t.canonicalString()} has ${t.length}`);return new n(e,new Q(e._delegate,r,new E(t)))}static forKey(t,e,r){return new n(e,new Q(e._delegate,r,t))}get id(){return this._delegate.id}get parent(){return new vr(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(t){try{return new vr(this.firestore,Hl(this._delegate,t))}catch(e){throw Dt(e,"collection()","DocumentReference.collection()")}}isEqual(t){return t=B(t),t instanceof Q?Yl(this._delegate,t):!1}set(t,e){e=dh("DocumentReference.set",e);try{return e?rh(this._delegate,t,e):rh(this._delegate,t)}catch(r){throw Dt(r,"setDoc()","DocumentReference.set()")}}update(t,e,...r){try{return arguments.length===1?sh(this._delegate,t):sh(this._delegate,t,e,...r)}catch(s){throw Dt(s,"updateDoc()","DocumentReference.update()")}}delete(){return Pp(this._delegate)}onSnapshot(...t){let e=Up(t),r=qp(t,s=>new Sn(this.firestore,new Gt(this.firestore._delegate,this._userDataWriter,s._key,s._document,s.metadata,this._delegate.converter)));return ih(this._delegate,e,r)}get(t){let e;return(t==null?void 0:t.source)==="cache"?e=vp(this._delegate):(t==null?void 0:t.source)==="server"?e=Ap(this._delegate):e=Ep(this._delegate),e.then(r=>new Sn(this.firestore,new Gt(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(t){return new n(this.firestore,t?this._delegate.withConverter(Er.getInstance(this.firestore,t)):this._delegate.withConverter(null))}};function Dt(n,t,e){return n.message=n.message.replace(t,e),n}function Up(n){for(let t of n)if(typeof t=="object"&&!ah(t))return t;return{}}function qp(n,t){var e,r;let s;return ah(n[0])?s=n[0]:ah(n[1])?s=n[1]:typeof n[0]=="function"?s={next:n[0],error:n[1],complete:n[2]}:s={next:n[1],error:n[2],complete:n[3]},{next:i=>{s.next&&s.next(t(i))},error:(e=s.error)===null||e===void 0?void 0:e.bind(s),complete:(r=s.complete)===null||r===void 0?void 0:r.bind(s)}}var Sn=class{constructor(t,e){this._firestore=t,this._delegate=e}get ref(){return new de(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(t){return this._delegate.data(t)}get(t,e){return this._delegate.get(t,e)}isEqual(t){return nh(this._delegate,t._delegate)}},Rn=class extends Sn{data(t){let e=this._delegate.data(t);return this._delegate._converter||pm(e!==void 0,"Document in a QueryDocumentSnapshot should exist"),e}},bn=class n{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Ir(t)}where(t,e,r){try{return new n(this.firestore,Re(this._delegate,dp(t,e,r)))}catch(s){throw Dt(s,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(t,e){try{return new n(this.firestore,Re(this._delegate,fp(t,e)))}catch(r){throw Dt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(t){try{return new n(this.firestore,Re(this._delegate,mp(t)))}catch(e){throw Dt(e,"limit()","Query.limit()")}}limitToLast(t){try{return new n(this.firestore,Re(this._delegate,gp(t)))}catch(e){throw Dt(e,"limitToLast()","Query.limitToLast()")}}startAt(...t){try{return new n(this.firestore,Re(this._delegate,pp(...t)))}catch(e){throw Dt(e,"startAt()","Query.startAt()")}}startAfter(...t){try{return new n(this.firestore,Re(this._delegate,_p(...t)))}catch(e){throw Dt(e,"startAfter()","Query.startAfter()")}}endBefore(...t){try{return new n(this.firestore,Re(this._delegate,yp(...t)))}catch(e){throw Dt(e,"endBefore()","Query.endBefore()")}}endAt(...t){try{return new n(this.firestore,Re(this._delegate,wp(...t)))}catch(e){throw Dt(e,"endAt()","Query.endAt()")}}isEqual(t){return Xl(this._delegate,t._delegate)}get(t){let e;return(t==null?void 0:t.source)==="cache"?e=Rp(this._delegate):(t==null?void 0:t.source)==="server"?e=bp(this._delegate):e=Sp(this._delegate),e.then(r=>new $s(this.firestore,new Ht(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...t){let e=Up(t),r=qp(t,s=>new $s(this.firestore,new Ht(this.firestore._delegate,this._userDataWriter,this._delegate,s._snapshot)));return ih(this._delegate,e,r)}withConverter(t){return new n(this.firestore,t?this._delegate.withConverter(Er.getInstance(this.firestore,t)):this._delegate.withConverter(null))}},ch=class{constructor(t,e){this._firestore=t,this._delegate=e}get type(){return this._delegate.type}get doc(){return new Rn(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},$s=class{constructor(t,e){this._firestore=t,this._delegate=e}get query(){return new bn(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(t=>new Rn(this._firestore,t))}docChanges(t){return this._delegate.docChanges(t).map(e=>new ch(this._firestore,e))}forEach(t,e){this._delegate.forEach(r=>{t.call(e,new Rn(this._firestore,r))})}isEqual(t){return nh(this._delegate,t._delegate)}},vr=class n extends bn{constructor(t,e){super(t,e),this.firestore=t,this._delegate=e}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let t=this._delegate.parent;return t?new de(this.firestore,t):null}doc(t){try{return t===void 0?new de(this.firestore,zs(this._delegate)):new de(this.firestore,zs(this._delegate,t))}catch(e){throw Dt(e,"doc()","CollectionReference.doc()")}}add(t){return Cp(this._delegate,t).then(e=>new de(this.firestore,e))}isEqual(t){return Yl(this._delegate,t._delegate)}withConverter(t){return new n(this.firestore,t?this._delegate.withConverter(Er.getInstance(this.firestore,t)):this._delegate.withConverter(null))}};function An(n){return q(n,Q)}var lh=class n{constructor(...t){this._delegate=new Wt(...t)}static documentId(){return new n(it.keyField().canonicalString())}isEqual(t){return t=B(t),t instanceof Wt?this._delegate._internalPath.isEqual(t._internalPath):!1}};var hh=class n{constructor(t){this._delegate=t}static serverTimestamp(){let t=kp();return t._methodName="FieldValue.serverTimestamp",new n(t)}static delete(){let t=Vp();return t._methodName="FieldValue.delete",new n(t)}static arrayUnion(...t){let e=Np(...t);return e._methodName="FieldValue.arrayUnion",new n(e)}static arrayRemove(...t){let e=Op(...t);return e._methodName="FieldValue.arrayRemove",new n(e)}static increment(t){let e=Fp(t);return e._methodName="FieldValue.increment",new n(e)}isEqual(t){return this._delegate.isEqual(t._delegate)}};var bT={Firestore:aa,GeoPoint:yn,Timestamp:Z,Blob:oa,Transaction:ua,WriteBatch:ca,DocumentReference:de,DocumentSnapshot:Sn,Query:bn,QueryDocumentSnapshot:Rn,QuerySnapshot:$s,CollectionReference:vr,FieldPath:lh,FieldValue:hh,setLogLevel:RT,CACHE_SIZE_UNLIMITED:Qg};function PT(n,t){n.INTERNAL.registerComponent(new be("firestore-compat",e=>{let r=e.getProvider("app-compat").getImmediate(),s=e.getProvider("firestore").getImmediate();return t(r,s)},"PUBLIC").setServiceProps(Object.assign({},bT)))}function CT(n){PT(n,(t,e)=>new aa(t,e,new uh)),n.registerVersion(vT,AT)}CT(Pe);function kT(n,t=kh){return new Js(e=>{let r;return t!=null?t.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},e)}):r=n.onSnapshot({includeMetadataChanges:!0},e),()=>{r!=null&&r()}})}function Bp(n,t){return kT(n,t)}function NT(n,t){return Bp(n,t).pipe(ei(void 0),Zs(),Nt(e=>{let[r,s]=e;return s.exists?r!=null&&r.exists?{payload:s,type:"modified"}:{payload:s,type:"added"}:{payload:s,type:"removed"}}))}function gh(n,t){return Bp(n,t).pipe(Nt(e=>({payload:e,type:"query"})))}var la=class{constructor(t,e){K(this,"ref");K(this,"afs");this.ref=t,this.afs=e}set(t,e){return this.ref.set(t,e)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,e){let r=this.ref.collection(t),{ref:s,query:i}=Kp(r,e);return new da(s,i,this.afs)}snapshotChanges(){return NT(this.ref,this.afs.schedulers.outsideAngular).pipe(bt)}valueChanges(t={}){return this.snapshotChanges().pipe(Nt(({payload:e})=>t.idField?va(Xs({},e.data()),{[t.idField]:e.id}):e.data()))}get(t){return Xt(this.ref.get(t)).pipe(bt)}};function ha(n,t){return gh(n,t).pipe(ei(void 0),Zs(),Nt(e=>{let[r,s]=e,i=s.payload.docChanges(),o=i.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(s.payload.metadata)&&s.payload.docs.forEach((a,u)=>{let c=i.find(h=>h.doc.ref.isEqual(a.ref)),l=r==null?void 0:r.payload.docs.find(h=>h.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&l&&JSON.stringify(l.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:u,newIndex:u,type:"modified",doc:a}})}),o}))}function jp(n,t,e){return ha(n,e).pipe(ti((r,s)=>OT(r,s.map(i=>i.payload),t),[]),Oh(),Nt(r=>r.map(s=>({type:s.type,payload:s}))))}function OT(n,t,e){return t.forEach(r=>{e.indexOf(r.type)>-1&&(n=FT(n,r))}),n}function fh(n,t,e,...r){let s=n.slice();return s.splice(t,e,...r),s}function FT(n,t){switch(t.type){case"added":if(!(n[t.newIndex]&&n[t.newIndex].doc.ref.isEqual(t.doc.ref)))return fh(n,t.newIndex,0,t);break;case"modified":if(n[t.oldIndex]==null||n[t.oldIndex].doc.ref.isEqual(t.doc.ref))if(t.oldIndex!==t.newIndex){let e=n.slice();return e.splice(t.oldIndex,1),e.splice(t.newIndex,0,t),e}else return fh(n,t.newIndex,1,t);break;case"removed":if(n[t.oldIndex]&&n[t.oldIndex].doc.ref.isEqual(t.doc.ref))return fh(n,t.oldIndex,1);break}return n}function Gp(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var da=class{constructor(t,e,r){K(this,"ref");K(this,"query");K(this,"afs");this.ref=t,this.query=e,this.afs=r}stateChanges(t){let e=ha(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe(Nt(r=>r.filter(s=>t.indexOf(s.type)>-1)))),e.pipe(ei(void 0),Zs(),Sa(([r,s])=>s.length>0||!r),Nt(([,r])=>r),bt)}auditTrail(t){return this.stateChanges(t).pipe(ti((e,r)=>[...e,...r],[]))}snapshotChanges(t){let e=Gp(t);return jp(this.query,e,this.afs.schedulers.outsideAngular).pipe(bt)}valueChanges(t={}){return gh(this.query,this.afs.schedulers.outsideAngular).pipe(Nt(e=>e.payload.docs.map(r=>t.idField?va(Xs({},r.data()),{[t.idField]:r.id}):r.data())),bt)}get(t){return Xt(this.query.get(t)).pipe(bt)}add(t){return this.ref.add(t)}doc(t){return new la(this.ref.doc(t),this.afs)}},mh=class{constructor(t,e){K(this,"query");K(this,"afs");this.query=t,this.afs=e}stateChanges(t){return!t||t.length===0?ha(this.query,this.afs.schedulers.outsideAngular).pipe(bt):ha(this.query,this.afs.schedulers.outsideAngular).pipe(Nt(e=>e.filter(r=>t.indexOf(r.type)>-1)),Sa(e=>e.length>0),bt)}auditTrail(t){return this.stateChanges(t).pipe(ti((e,r)=>[...e,...r],[]))}snapshotChanges(t){let e=Gp(t);return jp(this.query,e,this.afs.schedulers.outsideAngular).pipe(bt)}valueChanges(t={}){return gh(this.query,this.afs.schedulers.outsideAngular).pipe(Nt(r=>r.payload.docs.map(s=>t.idField?Xs({[t.idField]:s.id},s.data()):s.data())),bt)}get(t){return Xt(this.query.get(t)).pipe(bt)}},zp=new Jt("angularfire2.enableFirestorePersistence"),$p=new Jt("angularfire2.firestore.persistenceSettings"),MT=new Jt("angularfire2.firestore.settings"),LT=new Jt("angularfire2.firestore.use-emulator");function Kp(n,t=e=>e){return{query:t(n),ref:n}}var UT=(()=>{let t=class t{constructor(r,s,i,o,a,u,c,l,h,d,f,T,I,w,C,D,b){K(this,"schedulers");K(this,"firestore");K(this,"persistenceEnabled$");this.schedulers=c;let x=mi(r,u,s),M=h;d&&$h(x,u,f,I,w,C,T,D),[this.firestore,this.persistenceEnabled$]=gi(`${x.name}.firestore`,"AngularFirestore",x.name,()=>{let k=u.runOutsideAngular(()=>x.firestore());if(o&&k.settings(o),M&&k.useEmulator(...M),i&&!Fh(a)){let Y=()=>{try{return Xt(k.enablePersistence(l||void 0).then(()=>!0,()=>!1))}catch(ft){return typeof console<"u"&&console.warn(ft),xn(!1)}};return[k,u.runOutsideAngular(Y)]}else return[k,xn(!1)]},[o,M,i])}collection(r,s){let i;typeof r=="string"?i=this.firestore.collection(r):i=r;let{ref:o,query:a}=Kp(i,s),u=this.schedulers.ngZone.run(()=>o);return new da(u,a,this)}collectionGroup(r,s){let i=s||(a=>a),o=this.firestore.collectionGroup(r);return new mh(i(o),this)}doc(r){let s;typeof r=="string"?s=this.firestore.doc(r):s=r;let i=this.schedulers.ngZone.run(()=>s);return new la(i,this)}createId(){return this.firestore.collection("_").doc().id}};K(t,"\u0275fac",function(s){return new(s||t)(j(di),j(fi,8),j(zp,8),j(MT,8),j(ri),j(si),j(hi),j($p,8),j(LT,8),j(Kh,8),j(Uh,8),j(qh,8),j(Bh,8),j(jh,8),j(Gh,8),j(zh,8),j(li,8))}),K(t,"\u0275prov",ni({token:t,factory:t.\u0275fac,providedIn:"any"}));let n=t;return n})(),KE=(()=>{let t=class t{constructor(){Pe.registerVersion("angularfire",ci.full,"fst-compat")}static enablePersistence(r){return{ngModule:t,providers:[{provide:zp,useValue:!0},{provide:$p,useValue:r}]}}};K(t,"\u0275fac",function(s){return new(s||t)}),K(t,"\u0275mod",Nr({type:t})),K(t,"\u0275inj",kr({providers:[UT]}));let n=t;return n})();var e_="firebasestorage.googleapis.com",n_="storageBucket",qT=2*60*1e3,BT=10*60*1e3,jT=1e3;var tt=class n extends oi{constructor(t,e,r=0){super(ph(t),`Firebase Storage: ${e} (${ph(t)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,n.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return ph(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}},J=function(n){return n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment",n}(J||{});function ph(n){return"storage/"+n}function Ah(){let n="An unknown error occurred, please check the error payload for server response.";return new tt(J.UNKNOWN,n)}function GT(n){return new tt(J.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function zT(n){return new tt(J.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function $T(){let n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new tt(J.UNAUTHENTICATED,n)}function KT(){return new tt(J.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function QT(n){return new tt(J.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function r_(){return new tt(J.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function s_(){return new tt(J.CANCELED,"User canceled the upload/download.")}function WT(n){return new tt(J.INVALID_URL,"Invalid URL '"+n+"'.")}function HT(n){return new tt(J.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function YT(){return new tt(J.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+n_+"' property when initializing the app?")}function i_(){return new tt(J.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function XT(){return new tt(J.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function JT(){return new tt(J.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function ZT(n){return new tt(J.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Pn(n){return new tt(J.INVALID_ARGUMENT,n)}function o_(){return new tt(J.APP_DELETED,"The Firebase app was deleted.")}function Sh(n){return new tt(J.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Qs(n,t){return new tt(J.INVALID_FORMAT,"String does not match format '"+n+"': "+t)}function Ks(n){throw new tt(J.INTERNAL_ERROR,"Internal error: "+n)}var Vt=class n{constructor(t,e){this.bucket=t,this.path_=e}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){let t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,e){let r;try{r=n.makeFromUrl(t,e)}catch{return new n(t,"")}if(r.path==="")return r;throw HT(t)}static makeFromUrl(t,e){let r=null,s="([A-Za-z0-9.\\-_]+)";function i(x){x.path.charAt(x.path.length-1)==="/"&&(x.path_=x.path_.slice(0,-1))}let o="(/(.*))?$",a=new RegExp("^gs://"+s+o,"i"),u={bucket:1,path:3};function c(x){x.path_=decodeURIComponent(x.path)}let l="v[A-Za-z0-9_]+",h=e.replace(/[.]/g,"\\."),d="(/([^?#]*).*)?$",f=new RegExp(`^https?://${h}/${l}/b/${s}/o${d}`,"i"),T={bucket:1,path:3},I=e===e_?"(?:storage.googleapis.com|storage.cloud.google.com)":e,w="([^?#]*)",C=new RegExp(`^https?://${I}/${s}/${w}`,"i"),b=[{regex:a,indices:u,postModify:i},{regex:f,indices:T,postModify:c},{regex:C,indices:{bucket:1,path:2},postModify:c}];for(let x=0;x<b.length;x++){let M=b[x],k=M.regex.exec(t);if(k){let Y=k[M.indices.bucket],ft=k[M.indices.path];ft||(ft=""),r=new n(Y,ft),M.postModify(r);break}}if(r==null)throw WT(t);return r}},yh=class{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}};function tI(n,t,e){let r=1,s=null,i=null,o=!1,a=0;function u(){return a===2}let c=!1;function l(...w){c||(c=!0,t.apply(null,w))}function h(w){s=setTimeout(()=>{s=null,n(f,u())},w)}function d(){i&&clearTimeout(i)}function f(w,...C){if(c){d();return}if(w){d(),l.call(null,w,...C);return}if(u()||o){d(),l.call(null,w,...C);return}r<64&&(r*=2);let b;a===1?(a=2,b=0):b=(r+Math.random())*1e3,h(b)}let T=!1;function I(w){T||(T=!0,d(),!c&&(s!==null?(w||(a=2),clearTimeout(s),h(0)):w||(a=1)))}return h(0),i=setTimeout(()=>{o=!0,I(!0)},e),I}function eI(n){n(!1)}function nI(n){return n!==void 0}function rI(n){return typeof n=="function"}function sI(n){return typeof n=="object"&&!Array.isArray(n)}function ga(n){return typeof n=="string"||n instanceof String}function Qp(n){return Rh()&&n instanceof Blob}function Rh(){return typeof Blob<"u"}function wh(n,t,e,r){if(r<t)throw Pn(`Invalid value for '${n}'. Expected ${t} or greater.`);if(r>e)throw Pn(`Invalid value for '${n}'. Expected ${e} or less.`)}function He(n,t,e){let r=t;return e==null&&(r=`https://${t}`),`${e}://${r}/v0${n}`}function a_(n){let t=encodeURIComponent,e="?";for(let r in n)if(n.hasOwnProperty(r)){let s=t(r)+"="+t(n[r]);e=e+s+"&"}return e=e.slice(0,-1),e}var Rr=function(n){return n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT",n}(Rr||{});function u_(n,t){let e=n>=500&&n<600,s=[408,429].indexOf(n)!==-1,i=t.indexOf(n)!==-1;return e||s||i}var Th=class{constructor(t,e,r,s,i,o,a,u,c,l,h,d=!0){this.url_=t,this.method_=e,this.headers_=r,this.body_=s,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=u,this.timeout_=c,this.progressCallback_=l,this.connectionFactory_=h,this.retry=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((f,T)=>{this.resolve_=f,this.reject_=T,this.start_()})}start_(){let t=(r,s)=>{if(s){r(!1,new Sr(!1,null,!0));return}let i=this.connectionFactory_();this.pendingConnection_=i;let o=a=>{let u=a.loaded,c=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(u,c)};this.progressCallback_!==null&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(o),this.pendingConnection_=null;let a=i.getErrorCode()===Rr.NO_ERROR,u=i.getStatus();if(!a||u_(u,this.additionalRetryCodes_)&&this.retry){let l=i.getErrorCode()===Rr.ABORT;r(!1,new Sr(!1,null,l));return}let c=this.successCodes_.indexOf(u)!==-1;r(!0,new Sr(c,i))})},e=(r,s)=>{let i=this.resolve_,o=this.reject_,a=s.connection;if(s.wasSuccessCode)try{let u=this.callback_(a,a.getResponse());nI(u)?i(u):i()}catch(u){o(u)}else if(a!==null){let u=Ah();u.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,u)):o(u)}else if(s.canceled){let u=this.appDelete_?o_():s_();o(u)}else{let u=r_();o(u)}};this.canceled_?e(!1,new Sr(!1,null,!0)):this.backoffId_=tI(t,e,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&eI(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}},Sr=class{constructor(t,e,r){this.wasSuccessCode=t,this.connection=e,this.canceled=!!r}};function iI(n,t){t!==null&&t.length>0&&(n.Authorization="Firebase "+t)}function oI(n,t){n["X-Firebase-Storage-Version"]="webjs/"+(t!=null?t:"AppManager")}function aI(n,t){t&&(n["X-Firebase-GMPID"]=t)}function uI(n,t){t!==null&&(n["X-Firebase-AppCheck"]=t)}function cI(n,t,e,r,s,i,o=!0){let a=a_(n.urlParams),u=n.url+a,c=Object.assign({},n.headers);return aI(c,t),iI(c,e),oI(c,i),uI(c,r),new Th(u,n.method,c,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,s,o)}function lI(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function hI(...n){let t=lI();if(t!==void 0){let e=new t;for(let r=0;r<n.length;r++)e.append(n[r]);return e.getBlob()}else{if(Rh())return new Blob(n);throw new tt(J.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function dI(n,t,e){return n.webkitSlice?n.webkitSlice(t,e):n.mozSlice?n.mozSlice(t,e):n.slice?n.slice(t,e):null}function fI(n){if(typeof atob>"u")throw ZT("base-64");return atob(n)}var Lt={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"},Ws=class{constructor(t,e){this.data=t,this.contentType=e||null}};function bh(n,t){switch(n){case Lt.RAW:return new Ws(c_(t));case Lt.BASE64:case Lt.BASE64URL:return new Ws(l_(n,t));case Lt.DATA_URL:return new Ws(gI(t),pI(t))}throw Ah()}function c_(n){let t=[];for(let e=0;e<n.length;e++){let r=n.charCodeAt(e);if(r<=127)t.push(r);else if(r<=2047)t.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(e<n.length-1&&(n.charCodeAt(e+1)&64512)===56320))t.push(239,191,189);else{let i=r,o=n.charCodeAt(++e);r=65536|(i&1023)<<10|o&1023,t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(t)}function mI(n){let t;try{t=decodeURIComponent(n)}catch{throw Qs(Lt.DATA_URL,"Malformed data URL.")}return c_(t)}function l_(n,t){switch(n){case Lt.BASE64:{let s=t.indexOf("-")!==-1,i=t.indexOf("_")!==-1;if(s||i)throw Qs(n,"Invalid character '"+(s?"-":"_")+"' found: is it base64url encoded?");break}case Lt.BASE64URL:{let s=t.indexOf("+")!==-1,i=t.indexOf("/")!==-1;if(s||i)throw Qs(n,"Invalid character '"+(s?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let e;try{e=fI(t)}catch(s){throw s.message.includes("polyfill")?s:Qs(n,"Invalid character found")}let r=new Uint8Array(e.length);for(let s=0;s<e.length;s++)r[s]=e.charCodeAt(s);return r}var ma=class{constructor(t){this.base64=!1,this.contentType=null;let e=t.match(/^data:([^,]+)?,/);if(e===null)throw Qs(Lt.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");let r=e[1]||null;r!=null&&(this.base64=_I(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=t.substring(t.indexOf(",")+1)}};function gI(n){let t=new ma(n);return t.base64?l_(Lt.BASE64,t.rest):mI(t.rest)}function pI(n){return new ma(n).contentType}function _I(n,t){return n.length>=t.length?n.substring(n.length-t.length)===t:!1}var br=class n{constructor(t,e){let r=0,s="";Qp(t)?(this.data_=t,r=t.size,s=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),r=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),r=t.length),this.size_=r,this.type_=s}size(){return this.size_}type(){return this.type_}slice(t,e){if(Qp(this.data_)){let r=this.data_,s=dI(r,t,e);return s===null?null:new n(s)}else{let r=new Uint8Array(this.data_.buffer,t,e-t);return new n(r,!0)}}static getBlob(...t){if(Rh()){let e=t.map(r=>r instanceof n?r.data_:r);return new n(hI.apply(null,e))}else{let e=t.map(o=>ga(o)?bh(Lt.RAW,o).data:o.data_),r=0;e.forEach(o=>{r+=o.byteLength});let s=new Uint8Array(r),i=0;return e.forEach(o=>{for(let a=0;a<o.length;a++)s[i++]=o[a]}),new n(s,!0)}}uploadData(){return this.data_}};function Ph(n){let t;try{t=JSON.parse(n)}catch{return null}return sI(t)?t:null}function yI(n){if(n.length===0)return null;let t=n.lastIndexOf("/");return t===-1?"":n.slice(0,t)}function wI(n,t){let e=t.split("/").filter(r=>r.length>0).join("/");return n.length===0?e:n+"/"+e}function h_(n){let t=n.lastIndexOf("/",n.length-2);return t===-1?n:n.slice(t+1)}function TI(n,t){return t}var It=class{constructor(t,e,r,s){this.server=t,this.local=e||t,this.writable=!!r,this.xform=s||TI}},fa=null;function II(n){return!ga(n)||n.length<2?n:h_(n)}function pa(){if(fa)return fa;let n=[];n.push(new It("bucket")),n.push(new It("generation")),n.push(new It("metageneration")),n.push(new It("name","fullPath",!0));function t(i,o){return II(o)}let e=new It("name");e.xform=t,n.push(e);function r(i,o){return o!==void 0?Number(o):o}let s=new It("size");return s.xform=r,n.push(s),n.push(new It("timeCreated")),n.push(new It("updated")),n.push(new It("md5Hash",null,!0)),n.push(new It("cacheControl",null,!0)),n.push(new It("contentDisposition",null,!0)),n.push(new It("contentEncoding",null,!0)),n.push(new It("contentLanguage",null,!0)),n.push(new It("contentType",null,!0)),n.push(new It("metadata","customMetadata",!0)),fa=n,fa}function EI(n,t){function e(){let r=n.bucket,s=n.fullPath,i=new Vt(r,s);return t._makeStorageReference(i)}Object.defineProperty(n,"ref",{get:e})}function vI(n,t,e){let r={};r.type="file";let s=e.length;for(let i=0;i<s;i++){let o=e[i];r[o.local]=o.xform(r,t[o.server])}return EI(r,n),r}function d_(n,t,e){let r=Ph(t);return r===null?null:vI(n,r,e)}function AI(n,t,e,r){let s=Ph(t);if(s===null||!ga(s.downloadTokens))return null;let i=s.downloadTokens;if(i.length===0)return null;let o=encodeURIComponent;return i.split(",").map(c=>{let l=n.bucket,h=n.fullPath,d="/b/"+o(l)+"/o/"+o(h),f=He(d,e,r),T=a_({alt:"media",token:c});return f+T})[0]}function Ch(n,t){let e={},r=t.length;for(let s=0;s<r;s++){let i=t[s];i.writable&&(e[i.server]=n[i.local])}return JSON.stringify(e)}var Wp="prefixes",Hp="items";function SI(n,t,e){let r={prefixes:[],items:[],nextPageToken:e.nextPageToken};if(e[Wp])for(let s of e[Wp]){let i=s.replace(/\/$/,""),o=n._makeStorageReference(new Vt(t,i));r.prefixes.push(o)}if(e[Hp])for(let s of e[Hp]){let i=n._makeStorageReference(new Vt(t,s.name));r.items.push(i)}return r}function RI(n,t,e){let r=Ph(e);return r===null?null:SI(n,t,r)}var Yt=class{constructor(t,e,r,s){this.url=t,this.method=e,this.handler=r,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}};function me(n){if(!n)throw Ah()}function _a(n,t){function e(r,s){let i=d_(n,s,t);return me(i!==null),i}return e}function bI(n,t){function e(r,s){let i=RI(n,t,s);return me(i!==null),i}return e}function PI(n,t){function e(r,s){let i=d_(n,s,t);return me(i!==null),AI(i,s,n.host,n._protocol)}return e}function xr(n){function t(e,r){let s;return e.getStatus()===401?e.getErrorText().includes("Firebase App Check token is invalid")?s=KT():s=$T():e.getStatus()===402?s=zT(n.bucket):e.getStatus()===403?s=QT(n.path):s=r,s.status=e.getStatus(),s.serverResponse=r.serverResponse,s}return t}function ya(n){let t=xr(n);function e(r,s){let i=t(r,s);return r.getStatus()===404&&(i=GT(n.path)),i.serverResponse=s.serverResponse,i}return e}function f_(n,t,e){let r=t.fullServerUrl(),s=He(r,n.host,n._protocol),i="GET",o=n.maxOperationRetryTime,a=new Yt(s,i,_a(n,e),o);return a.errorHandler=ya(t),a}function CI(n,t,e,r,s){let i={};t.isRoot?i.prefix="":i.prefix=t.path+"/",e&&e.length>0&&(i.delimiter=e),r&&(i.pageToken=r),s&&(i.maxResults=s);let o=t.bucketOnlyServerUrl(),a=He(o,n.host,n._protocol),u="GET",c=n.maxOperationRetryTime,l=new Yt(a,u,bI(n,t.bucket),c);return l.urlParams=i,l.errorHandler=xr(t),l}function xI(n,t,e){let r=t.fullServerUrl(),s=He(r,n.host,n._protocol),i="GET",o=n.maxOperationRetryTime,a=new Yt(s,i,PI(n,e),o);return a.errorHandler=ya(t),a}function DI(n,t,e,r){let s=t.fullServerUrl(),i=He(s,n.host,n._protocol),o="PATCH",a=Ch(e,r),u={"Content-Type":"application/json; charset=utf-8"},c=n.maxOperationRetryTime,l=new Yt(i,o,_a(n,r),c);return l.headers=u,l.body=a,l.errorHandler=ya(t),l}function VI(n,t){let e=t.fullServerUrl(),r=He(e,n.host,n._protocol),s="DELETE",i=n.maxOperationRetryTime;function o(u,c){}let a=new Yt(r,s,o,i);return a.successCodes=[200,204],a.errorHandler=ya(t),a}function kI(n,t){return n&&n.contentType||t&&t.type()||"application/octet-stream"}function m_(n,t,e){let r=Object.assign({},e);return r.fullPath=n.path,r.size=t.size(),r.contentType||(r.contentType=kI(null,t)),r}function NI(n,t,e,r,s){let i=t.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let b="";for(let x=0;x<2;x++)b=b+Math.random().toString().slice(2);return b}let u=a();o["Content-Type"]="multipart/related; boundary="+u;let c=m_(t,r,s),l=Ch(c,e),h="--"+u+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+l+`\r
--`+u+`\r
Content-Type: `+c.contentType+`\r
\r
`,d=`\r
--`+u+"--",f=br.getBlob(h,r,d);if(f===null)throw i_();let T={name:c.fullPath},I=He(i,n.host,n._protocol),w="POST",C=n.maxUploadRetryTime,D=new Yt(I,w,_a(n,e),C);return D.urlParams=T,D.headers=o,D.body=f.uploadData(),D.errorHandler=xr(t),D}var Pr=class{constructor(t,e,r,s){this.current=t,this.total=e,this.finalized=!!r,this.metadata=s||null}};function xh(n,t){let e=null;try{e=n.getResponseHeader("X-Goog-Upload-Status")}catch{me(!1)}return me(!!e&&(t||["active"]).indexOf(e)!==-1),e}function OI(n,t,e,r,s){let i=t.bucketOnlyServerUrl(),o=m_(t,r,s),a={name:o.fullPath},u=He(i,n.host,n._protocol),c="POST",l={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},h=Ch(o,e),d=n.maxUploadRetryTime;function f(I){xh(I);let w;try{w=I.getResponseHeader("X-Goog-Upload-URL")}catch{me(!1)}return me(ga(w)),w}let T=new Yt(u,c,f,d);return T.urlParams=a,T.headers=l,T.body=h,T.errorHandler=xr(t),T}function FI(n,t,e,r){let s={"X-Goog-Upload-Command":"query"};function i(c){let l=xh(c,["active","final"]),h=null;try{h=c.getResponseHeader("X-Goog-Upload-Size-Received")}catch{me(!1)}h||me(!1);let d=Number(h);return me(!isNaN(d)),new Pr(d,r.size(),l==="final")}let o="POST",a=n.maxUploadRetryTime,u=new Yt(e,o,i,a);return u.headers=s,u.errorHandler=xr(t),u}var Yp=256*1024;function MI(n,t,e,r,s,i,o,a){let u=new Pr(0,0);if(o?(u.current=o.current,u.total=o.total):(u.current=0,u.total=r.size()),r.size()!==u.total)throw XT();let c=u.total-u.current,l=c;s>0&&(l=Math.min(l,s));let h=u.current,d=h+l,f="";l===0?f="finalize":c===l?f="upload, finalize":f="upload";let T={"X-Goog-Upload-Command":f,"X-Goog-Upload-Offset":`${u.current}`},I=r.slice(h,d);if(I===null)throw i_();function w(x,M){let k=xh(x,["active","final"]),Y=u.current+l,ft=r.size(),Vr;return k==="final"?Vr=_a(t,i)(x,M):Vr=null,new Pr(Y,ft,k==="final",Vr)}let C="POST",D=t.maxUploadRetryTime,b=new Yt(e,C,w,D);return b.headers=T,b.body=I.uploadData(),b.progressCallback=a||null,b.errorHandler=xr(n),b}var g_={STATE_CHANGED:"state_changed"},Rt={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function _h(n){switch(n){case"running":case"pausing":case"canceling":return Rt.RUNNING;case"paused":return Rt.PAUSED;case"success":return Rt.SUCCESS;case"canceled":return Rt.CANCELED;case"error":return Rt.ERROR;default:return Rt.ERROR}}var Ih=class{constructor(t,e,r){if(rI(t)||e!=null||r!=null)this.next=t,this.error=e!=null?e:void 0,this.complete=r!=null?r:void 0;else{let i=t;this.next=i.next,this.error=i.error,this.complete=i.complete}}};function Ar(n){return(...t)=>{Promise.resolve().then(()=>n(...t))}}var Xp=null,Eh=class{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Rr.NO_ERROR,this.sendPromise_=new Promise(t=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Rr.ABORT,t()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Rr.NETWORK_ERROR,t()}),this.xhr_.addEventListener("load",()=>{t()})})}send(t,e,r,s){if(this.sent_)throw Ks("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),s!==void 0)for(let i in s)s.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,s[i].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Ks("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Ks("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Ks("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Ks("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",t)}removeUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",t)}},vh=class extends Eh{initXhr(){this.xhr_.responseType="text"}};function fe(){return Xp?Xp():new vh}var Hs=class{constructor(t,e,r=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=t,this._blob=e,this._metadata=r,this._mappings=pa(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=s=>{if(this._request=void 0,this._chunkMultiplier=1,s._codeEquals(J.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{let i=this.isExponentialBackoffExpired();if(u_(s.status,[]))if(i)s=r_();else{this.sleepTime=Math.max(this.sleepTime*2,jT),this._needToFetchStatus=!0,this.completeTransitions_();return}this._error=s,this._transition("error")}},this._metadataErrorHandler=s=>{this._request=void 0,s._codeEquals(J.CANCELED)?this.completeTransitions_():(this._error=s,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((s,i)=>{this._resolve=s,this._reject=i,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){let t=this._transferred;return e=>this._updateProgress(t+e)}_shouldDoResumable(t){return t.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(t){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([e,r])=>{switch(this._state){case"running":t(e,r);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((t,e)=>{let r=OI(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),s=this._ref.storage._makeRequest(r,fe,t,e);this._request=s,s.getPromise().then(i=>{this._request=void 0,this._uploadUrl=i,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){let t=this._uploadUrl;this._resolveToken((e,r)=>{let s=FI(this._ref.storage,this._ref._location,t,this._blob),i=this._ref.storage._makeRequest(s,fe,e,r);this._request=i,i.getPromise().then(o=>{o=o,this._request=void 0,this._updateProgress(o.current),this._needToFetchStatus=!1,o.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){let t=Yp*this._chunkMultiplier,e=new Pr(this._transferred,this._blob.size()),r=this._uploadUrl;this._resolveToken((s,i)=>{let o;try{o=MI(this._ref._location,this._ref.storage,r,this._blob,t,this._mappings,e,this._makeProgressCallback())}catch(u){this._error=u,this._transition("error");return}let a=this._ref.storage._makeRequest(o,fe,s,i,!1);this._request=a,a.getPromise().then(u=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(u.current),u.finalized?(this._metadata=u.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){Yp*this._chunkMultiplier*2<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((t,e)=>{let r=f_(this._ref.storage,this._ref._location,this._mappings),s=this._ref.storage._makeRequest(r,fe,t,e);this._request=s,s.getPromise().then(i=>{this._request=void 0,this._metadata=i,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((t,e)=>{let r=NI(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),s=this._ref.storage._makeRequest(r,fe,t,e);this._request=s,s.getPromise().then(i=>{this._request=void 0,this._metadata=i,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(t){let e=this._transferred;this._transferred=t,this._transferred!==e&&this._notifyObservers()}_transition(t){if(this._state!==t)switch(t){case"canceling":case"pausing":this._state=t,this._request!==void 0?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":let e=this._state==="paused";this._state=t,e&&(this._notifyObservers(),this._start());break;case"paused":this._state=t,this._notifyObservers();break;case"canceled":this._error=s_(),this._state=t,this._notifyObservers();break;case"error":this._state=t,this._notifyObservers();break;case"success":this._state=t,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){let t=_h(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:t,metadata:this._metadata,task:this,ref:this._ref}}on(t,e,r,s){let i=new Ih(e||void 0,r||void 0,s||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(t,e){return this._promise.then(t,e)}catch(t){return this.then(null,t)}_addObserver(t){this._observers.push(t),this._notifyObserver(t)}_removeObserver(t){let e=this._observers.indexOf(t);e!==-1&&this._observers.splice(e,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(e=>{this._notifyObserver(e)})}_finishPromise(){if(this._resolve!==void 0){let t=!0;switch(_h(this._state)){case Rt.SUCCESS:Ar(this._resolve.bind(null,this.snapshot))();break;case Rt.CANCELED:case Rt.ERROR:let e=this._reject;Ar(e.bind(null,this._error))();break;default:t=!1;break}t&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(t){switch(_h(this._state)){case Rt.RUNNING:case Rt.PAUSED:t.next&&Ar(t.next.bind(t,this.snapshot))();break;case Rt.SUCCESS:t.complete&&Ar(t.complete.bind(t))();break;case Rt.CANCELED:case Rt.ERROR:t.error&&Ar(t.error.bind(t,this._error))();break;default:t.error&&Ar(t.error.bind(t,this._error))()}}resume(){let t=this._state==="paused"||this._state==="pausing";return t&&this._transition("running"),t}pause(){let t=this._state==="running";return t&&this._transition("pausing"),t}cancel(){let t=this._state==="running"||this._state==="pausing";return t&&this._transition("canceling"),t}};var Cr=class n{constructor(t,e){this._service=t,e instanceof Vt?this._location=e:this._location=Vt.makeFromUrl(e,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,e){return new n(t,e)}get root(){let t=new Vt(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return h_(this._location.path)}get storage(){return this._service}get parent(){let t=yI(this._location.path);if(t===null)return null;let e=new Vt(this._location.bucket,t);return new n(this._service,e)}_throwIfRoot(t){if(this._location.path==="")throw Sh(t)}};function LI(n,t,e){return n._throwIfRoot("uploadBytesResumable"),new Hs(n,new br(t),e)}function UI(n){let t={prefixes:[],items:[]};return p_(n,t).then(()=>t)}function p_(n,t,e){return p(this,null,function*(){let s=yield __(n,{pageToken:e});t.prefixes.push(...s.prefixes),t.items.push(...s.items),s.nextPageToken!=null&&(yield p_(n,t,s.nextPageToken))})}function __(n,t){t!=null&&typeof t.maxResults=="number"&&wh("options.maxResults",1,1e3,t.maxResults);let e=t||{},r=CI(n.storage,n._location,"/",e.pageToken,e.maxResults);return n.storage.makeRequestWithTokens(r,fe)}function qI(n){n._throwIfRoot("getMetadata");let t=f_(n.storage,n._location,pa());return n.storage.makeRequestWithTokens(t,fe)}function BI(n,t){n._throwIfRoot("updateMetadata");let e=DI(n.storage,n._location,t,pa());return n.storage.makeRequestWithTokens(e,fe)}function jI(n){n._throwIfRoot("getDownloadURL");let t=xI(n.storage,n._location,pa());return n.storage.makeRequestWithTokens(t,fe).then(e=>{if(e===null)throw JT();return e})}function GI(n){n._throwIfRoot("deleteObject");let t=VI(n.storage,n._location);return n.storage.makeRequestWithTokens(t,fe)}function y_(n,t){let e=wI(n._location.path,t),r=new Vt(n._location.bucket,e);return new Cr(n.storage,r)}function zI(n){return/^[A-Za-z]+:\/\//.test(n)}function $I(n,t){return new Cr(n,t)}function w_(n,t){if(n instanceof Ys){let e=n;if(e._bucket==null)throw YT();let r=new Cr(e,e._bucket);return t!=null?w_(r,t):r}else return t!==void 0?y_(n,t):n}function KI(n,t){if(t&&zI(t)){if(n instanceof Ys)return $I(n,t);throw Pn("To use ref(service, url), the first argument must be a Storage instance.")}else return w_(n,t)}function Jp(n,t){let e=t==null?void 0:t[n_];return e==null?null:Vt.makeFromBucketSpec(e,n)}function QI(n,t,e,r={}){n.host=`${t}:${e}`,n._protocol="http";let{mockUserToken:s}=r;s&&(n._overrideAuthToken=typeof s=="string"?s:ii(s,n.app.options.projectId))}var Ys=class{constructor(t,e,r,s,i){this.app=t,this._authProvider=e,this._appCheckProvider=r,this._url=s,this._firebaseVersion=i,this._bucket=null,this._host=e_,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=qT,this._maxUploadRetryTime=BT,this._requests=new Set,s!=null?this._bucket=Vt.makeFromBucketSpec(s,this._host):this._bucket=Jp(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=Vt.makeFromBucketSpec(this._url,t):this._bucket=Jp(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){wh("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){wh("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}_getAuthToken(){return p(this,null,function*(){if(this._overrideAuthToken)return this._overrideAuthToken;let t=this._authProvider.getImmediate({optional:!0});if(t){let e=yield t.getToken();if(e!==null)return e.accessToken}return null})}_getAppCheckToken(){return p(this,null,function*(){let t=this._appCheckProvider.getImmediate({optional:!0});return t?(yield t.getToken()).token:null})}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new Cr(this,t)}_makeRequest(t,e,r,s,i=!0){if(this._deleted)return new yh(o_());{let o=cI(t,this._appId,r,s,e,this._firebaseVersion,i);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}makeRequestWithTokens(t,e){return p(this,null,function*(){let[r,s]=yield Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,e,r,s).getPromise()})}},Zp="@firebase/storage",t_="0.12.4";var WI="storage";function T_(n,t,e){return n=B(n),LI(n,t,e)}function I_(n){return n=B(n),qI(n)}function E_(n,t){return n=B(n),BI(n,t)}function v_(n,t){return n=B(n),__(n,t)}function A_(n){return n=B(n),UI(n)}function S_(n){return n=B(n),jI(n)}function R_(n){return n=B(n),GI(n)}function Dh(n,t){return n=B(n),KI(n,t)}function b_(n,t){return y_(n,t)}function P_(n,t,e,r={}){QI(n,t,e,r)}function HI(n,{instanceIdentifier:t}){let e=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),s=n.getProvider("app-check-internal");return new Ys(e,r,s,t,ui)}function YI(){ai(new be(WI,HI,"PUBLIC").setMultipleInstances(!0)),Dn(Zp,t_,""),Dn(Zp,t_,"esm2017")}YI();var Dr=class{constructor(t,e,r){this._delegate=t,this.task=e,this.ref=r}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}};var wa=class{constructor(t,e){this._delegate=t,this._ref=e,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new Dr(this._delegate.snapshot,this,this._ref)}then(t,e){return this._delegate.then(r=>{if(t)return t(new Dr(r,this,this._ref))},e)}on(t,e,r,s){let i;return e&&(typeof e=="function"?i=o=>e(new Dr(o,this,this._ref)):i={next:e.next?o=>e.next(new Dr(o,this,this._ref)):void 0,complete:e.complete||void 0,error:e.error||void 0}),this._delegate.on(t,i,r||void 0,s||void 0)}},Ta=class{constructor(t,e){this._delegate=t,this._service=e}get prefixes(){return this._delegate.prefixes.map(t=>new Cn(t,this._service))}get items(){return this._delegate.items.map(t=>new Cn(t,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}};var Cn=class n{constructor(t,e){this._delegate=t,this.storage=e}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(t){let e=b_(this._delegate,t);return new n(e,this.storage)}get root(){return new n(this._delegate.root,this.storage)}get parent(){let t=this._delegate.parent;return t==null?null:new n(t,this.storage)}put(t,e){return this._throwIfRoot("put"),new wa(T_(this._delegate,t,e),this)}putString(t,e=Lt.RAW,r){this._throwIfRoot("putString");let s=bh(e,t),i=Object.assign({},r);return i.contentType==null&&s.contentType!=null&&(i.contentType=s.contentType),new wa(new Hs(this._delegate,new br(s.data,!0),i),this)}listAll(){return A_(this._delegate).then(t=>new Ta(t,this.storage))}list(t){return v_(this._delegate,t||void 0).then(e=>new Ta(e,this.storage))}getMetadata(){return I_(this._delegate)}updateMetadata(t){return E_(this._delegate,t)}getDownloadURL(){return S_(this._delegate)}delete(){return this._throwIfRoot("delete"),R_(this._delegate)}_throwIfRoot(t){if(this._delegate._location.path==="")throw Sh(t)}};var Ia=class{constructor(t,e){this.app=t,this._delegate=e}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(t){if(C_(t))throw Pn("ref() expected a child path but got a URL, use refFromURL instead.");return new Cn(Dh(this._delegate,t),this)}refFromURL(t){if(!C_(t))throw Pn("refFromURL() expected a full URL but got a child path, use ref() instead.");try{Vt.makeFromUrl(t,this._delegate.host)}catch{throw Pn("refFromUrl() expected a valid full URL but got an invalid one.")}return new Cn(Dh(this._delegate,t),this)}setMaxUploadRetryTime(t){this._delegate.maxUploadRetryTime=t}setMaxOperationRetryTime(t){this._delegate.maxOperationRetryTime=t}useEmulator(t,e,r={}){P_(this._delegate,t,e,r)}};function C_(n){return/^[A-Za-z]+:\/\//.test(n)}var XI="@firebase/storage-compat",JI="0.3.7";var ZI="storage-compat";function tE(n,{instanceIdentifier:t}){let e=n.getProvider("app-compat").getImmediate(),r=n.getProvider("storage").getImmediate({identifier:t});return new Ia(e,r)}function eE(n){let t={TaskState:Rt,TaskEvent:g_,StringFormat:Lt,Storage:Ia,Reference:Cn};n.INTERNAL.registerComponent(new be(ZI,tE,"PUBLIC").setServiceProps(t).setMultipleInstances(!0)),n.registerVersion(XI,JI)}eE(Pe);function nE(n){return new Js(t=>{let e=o=>t.next(o),r=o=>t.error(o),s=()=>t.complete();e(n.snapshot);let i=n.on("state_changed",e);return n.then(o=>{e(o),s()},o=>{e(n.snapshot),r(o)}),function(){i()}}).pipe(Nh(0))}function x_(n){let t=nE(n);return{task:n,then:n.then.bind(n),catch:n.catch.bind(n),pause:n.pause.bind(n),cancel:n.cancel.bind(n),resume:n.resume.bind(n),snapshotChanges:()=>t,percentageChanges:()=>t.pipe(Nt(e=>e.bytesTransferred/e.totalBytes*100))}}function Ea(n){return{getDownloadURL:()=>xn(void 0).pipe(Ca,Ra(()=>n.getDownloadURL()),bt),getMetadata:()=>xn(void 0).pipe(Ca,Ra(()=>n.getMetadata()),bt),delete:()=>Xt(n.delete()),child:t=>Ea(n.child(t)),updateMetadata:t=>Xt(n.updateMetadata(t)),put:(t,e)=>{let r=n.put(t,e);return x_(r)},putString:(t,e,r)=>{let s=n.putString(t,e,r);return x_(s)},list:t=>Xt(n.list(t)),listAll:()=>Xt(n.listAll())}}var rE=new Jt("angularfire2.storageBucket"),sE=new Jt("angularfire2.storage.maxUploadRetryTime"),iE=new Jt("angularfire2.storage.maxOperationRetryTime"),oE=new Jt("angularfire2.storage.use-emulator"),aE=(()=>{let t=class t{constructor(r,s,i,o,a,u,c,l,h,d){K(this,"storage");let f=mi(r,a,s);this.storage=gi(`${f.name}.storage.${i}`,"AngularFireStorage",f.name,()=>{let T=a.runOutsideAngular(()=>f.storage(i||void 0)),I=h;return I&&T.useEmulator(...I),c&&T.setMaxUploadRetryTime(c),l&&T.setMaxOperationRetryTime(l),T},[c,l])}ref(r){return Ea(this.storage.ref(r))}refFromURL(r){return Ea(this.storage.refFromURL(r))}upload(r,s,i){let o=this.storage.ref(r);return Ea(o).put(s,i)}};K(t,"\u0275fac",function(s){return new(s||t)(j(di),j(fi,8),j(rE,8),j(ri),j(si),j(hi),j(sE,8),j(iE,8),j(oE,8),j(li,8))}),K(t,"\u0275prov",ni({token:t,factory:t.\u0275fac,providedIn:"any"}));let n=t;return n})();var uE=(()=>{let t=class t{};K(t,"\u0275fac",function(s){return new(s||t)}),K(t,"\u0275mod",Nr({type:t})),K(t,"\u0275inj",kr({}));let n=t;return n})(),Iv=(()=>{let t=class t{constructor(){Pe.registerVersion("angularfire",ci.full,"gcs-compat")}};K(t,"\u0275fac",function(s){return new(s||t)}),K(t,"\u0275mod",Nr({type:t})),K(t,"\u0275inj",kr({providers:[aE],imports:[uE]}));let n=t;return n})();export{UT as a,KE as b,aE as c,Iv as d};
