import{f as io,h as ro}from"./chunk-5UZVAEMW.js";import{b as no,d as so}from"./chunk-AHQAHTAS.js";import{$a as Xr,A as it,B as ce,C as rt,D as k,E as cr,F as he,G as hr,J as ur,Ja as Ir,K as ot,Ma as Sr,Na as Ur,O as Qt,Oa as Br,Pa as Vr,R as dr,Ra as Ie,S as fr,Sa as Gr,T as _r,Ta as jr,Ua as Hr,Va as Kr,Wa as Qr,Xa as Yr,Ya as qr,Za as zr,_a as $r,a as Xi,ab as Jr,b as Ji,ba as pr,bb as Zr,c as Zi,ca as gr,cb as eo,da as mr,db as to,e as De,f as er,g as U,h as tr,ha as zn,i as Qn,j as Yn,ja as yr,k as Me,ka as vr,l as Le,la as wr,m as Fe,na as Cr,o as Ee,oa as $n,p as nr,q as sr,s as ir,sa as Er,t as qn,u as rr,ua as Tr,v as or,x as Te,y as lr,z as ar}from"./chunk-QAHDMDZU.js";import{A as qt,B as lt,D as Or,E as Dr,F as g,G as B,H as A,I as Jn,J as Mr,K as at,L as V,M as Ue,N as zt,O as Zn,P as Lr,Q as $t,R as Fr,S as Wr,U as es,V as Xt,f,g as We,h as br,i as Nr,j as Rr,k as M,l as Pr,n as Xn,o as kr,p as J,u as Yt,v as R,w as Ar,x as xr,y as Q,z as ue}from"./chunk-F4FQDMWJ.js";import"./chunk-3STR3EXB.js";import"./chunk-G5YFBQQC.js";import"./chunk-LMXK6WMC.js";import"./chunk-4PGTP63H.js";import"./chunk-RXI45IKK.js";import"./chunk-HC6MZPB3.js";import"./chunk-U5TRODAZ.js";import"./chunk-HCPCAHMU.js";import"./chunk-CXMZVXPG.js";import"./chunk-O6QZTMED.js";import"./chunk-FERD25SW.js";import"./chunk-DGQDX2SM.js";import"./chunk-GBAD7PMF.js";import"./chunk-MM5QLNJM.js";import"./chunk-72KDLSWN.js";import"./chunk-5OMUW5VI.js";import"./chunk-OBXDPQ3V.js";import"./chunk-4UAGJSVW.js";import"./chunk-MCRJI3T3.js";import"./chunk-TLUQMX4X.js";import"./chunk-53QC3E2F.js";import{a as Kt,b as zi,e as ae,g as $i}from"./chunk-EGHARNWC.js";var Va=[{path:"tabs",loadChildren:()=>import("./chunk-VU43UIN6.js").then(n=>n.TabsPageModule)},{path:"login",loadChildren:()=>import("./chunk-QWVW2RXH.js").then(n=>n.AuthentPageModule)},{path:"",redirectTo:"login",pathMatch:"full"}],oo=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=he({type:e}),e.\u0275inj=ce({imports:[$n.forRoot(Va,{preloadingStrategy:Cr}),$n]});let n=e;return n})();var lo=(()=>{let e=class e{constructor(){}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=cr({type:e,selectors:[["app-root"]],decls:2,vars:0,template:function(i,r){i&1&&(dr(0,"ion-app"),_r(1,"ion-router-outlet"),fr())},dependencies:[Tr,Ir]});let n=e;return n})();var ao="@firebase/database",co="1.0.4";var di="";function fi(n){di=n}var as=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),R(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Yt(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var cs=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Q(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var Vo=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new as(e)}}catch{}return new cs},be=Vo("localStorage"),hs=Vo("sessionStorage");var je=new $t("@firebase/database"),Go=function(){let n=1;return function(){return n++}}(),jo=function(n){let e=Mr(n),t=new Dr;t.update(e);let s=t.digest();return br.encodeByteArray(s)},xt=function(...n){let e="";for(let t=0;t<n.length;t++){let s=n[t];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=xt.apply(null,s):typeof s=="object"?e+=R(s):e+=s,e+=" "}return e},Ne=null,ho=!0,Ho=function(n,e){f(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(je.logLevel=Lr.VERBOSE,Ne=je.log.bind(je),e&&hs.set("logging_enabled",!0)):typeof n=="function"?Ne=n:(Ne=null,hs.remove("logging_enabled"))},x=function(...n){if(ho===!0&&(ho=!1,Ne===null&&hs.get("logging_enabled")===!0&&Ho(!0)),Ne){let e=xt.apply(null,n);Ne(e)}},Ot=function(n){return function(...e){x(n,...e)}},us=function(...n){let e="FIREBASE INTERNAL ERROR: "+xt(...n);je.error(e)},te=function(...n){let e=`FIREBASE FATAL ERROR: ${xt(...n)}`;throw je.error(e),new Error(e)},D=function(...n){let e="FIREBASE WARNING: "+xt(...n);je.warn(e)},Ga=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&D("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Nn=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},ja=function(n){if(J()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},pe="[MIN_NAME]",ie="[MAX_NAME]",Pe=function(n,e){if(n===e)return 0;if(n===pe||e===ie)return-1;if(e===pe||n===ie)return 1;{let t=uo(n),s=uo(e);return t!==null?s!==null?t-s===0?n.length-e.length:t-s:-1:s!==null?1:n<e?-1:1}},Ha=function(n,e){return n===e?0:n<e?-1:1},ct=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+R(e))},_i=function(n){if(typeof n!="object"||n===null)return R(n);let e=[];for(let s in n)e.push(s);e.sort();let t="{";for(let s=0;s<e.length;s++)s!==0&&(t+=","),t+=R(e[s]),t+=":",t+=_i(n[e[s]]);return t+="}",t},Ko=function(n,e){let t=n.length;if(t<=e)return[n];let s=[];for(let i=0;i<t;i+=e)i+e>t?s.push(n.substring(i,t)):s.push(n.substring(i,i+e));return s};function O(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var Qo=function(n){f(!Nn(n),"Invalid JSON number");let e=11,t=52,s=(1<<e-1)-1,i,r,o,l,a;n===0?(r=0,o=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-s)?(l=Math.min(Math.floor(Math.log(n)/Math.LN2),s),r=l+s,o=Math.round(n*Math.pow(2,t-l)-Math.pow(2,t))):(r=0,o=Math.round(n/Math.pow(2,1-s-t))));let c=[];for(a=t;a;a-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(a=e;a;a-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(i?1:0),c.reverse();let h=c.join(""),u="";for(a=0;a<64;a+=8){let d=parseInt(h.substr(a,8),2).toString(16);d.length===1&&(d="0"+d),u=u+d}return u.toLowerCase()},Ka=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Qa=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Ya(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let s=new Error(n+" at "+e._path.toString()+": "+t);return s.code=n.toUpperCase(),s}var qa=new RegExp("^-?(0*)\\d{1,10}$"),za=-2147483648,$a=2147483647,uo=function(n){if(qa.test(n)){let e=Number(n);if(e>=za&&e<=$a)return e}return null},Je=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw D("Exception was thrown by user callback.",t),e},Math.floor(0))}},Xa=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},ft=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var ds=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||t==null||t.get().then(s=>this.appCheck=s)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(s=>s.addTokenListener(e))}notifyForInvalidToken(){D(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var fs=class{constructor(e,t,s){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(x("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',D(e)}},_t=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),en="5",Yo="v",qo="s",zo="r",$o="f",Xo=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Jo="ls",Zo="p",_s="ac",el="websocket",tl="long_polling";var tn=class{constructor(e,t,s,i,r=!1,o="",l=!1,a=!1){this.secure=t,this.namespace=s,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=be.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&be.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function Ja(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function nl(n,e,t){f(typeof e=="string","typeof type must == string"),f(typeof t=="object","typeof params must == object");let s;if(e===el)s=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===tl)s=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Ja(n)&&(t.ns=n.namespace);let i=[];return O(t,(r,o)=>{i.push(r+"="+o)}),s+i.join("&")}var ps=class{constructor(){this.counters_={}}incrementCounter(e,t=1){Q(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Rr(this.counters_)}};var ts={},ns={};function pi(n){let e=n.toString();return ts[e]||(ts[e]=new ps),ts[e]}function Za(n,e){let t=n.toString();return ns[t]||(ns[t]=e()),ns[t]}var gs=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<s.length;++i)s[i]&&Je(()=>{this.onMessage_(s[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var fo="start",ec="close",tc="pLPCommand",nc="pRTLPCB",sl="id",il="pw",rl="ser",sc="cb",ic="seg",rc="ts",oc="d",lc="dframe",ol=1870,ll=30,ac=ol-ll,cc=25e3,hc=3e4,yt=class n{constructor(e,t,s,i,r,o,l){this.connId=e,this.repoInfo=t,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.transportSessionId=o,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Ot(e),this.stats_=pi(t),this.urlFn=a=>(this.appCheckToken&&(a[_s]=this.appCheckToken),nl(t,tl,a))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new gs(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(hc)),ja(()=>{if(this.isClosed_)return;this.scriptTagHolder=new ms((...r)=>{let[o,l,a,c,h]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===fo)this.id=l,this.password=a;else if(o===ec)l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{let[o,l]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,l)},()=>{this.onClosed_()},this.urlFn);let s={};s[fo]="t",s[rl]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[sc]=this.scriptTagHolder.uniqueCallbackIdentifier),s[Yo]=en,this.transportSessionId&&(s[qo]=this.transportSessionId),this.lastSessionId&&(s[Jo]=this.lastSessionId),this.applicationId&&(s[Zo]=this.applicationId),this.appCheckToken&&(s[_s]=this.appCheckToken),typeof location<"u"&&location.hostname&&Xo.test(location.hostname)&&(s[zo]=$o);let i=this.urlFn(s);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return J()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Ka()&&!Qa()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=R(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let s=Nr(t),i=Ko(s,ac);for(let r=0;r<i.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(J())return;this.myDisconnFrame=document.createElement("iframe");let s={};s[lc]="t",s[sl]=e,s[il]=t,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=R(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},ms=class n{constructor(e,t,s,i){if(this.onDisconnect=s,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,J())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=Go(),window[tc+this.uniqueCallbackIdentifier]=e,window[nc+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(l){x("frame writing exception"),l.stack&&x(l.stack),x(l)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||x("No IE domain setting required")}catch{let s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[sl]=this.myID,e[il]=this.myPW,e[rl]=this.currentSerial;let t=this.urlFn(e),s="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+ll+s.length<=ol;){let o=this.pendingSegs.shift();s=s+"&"+ic+i+"="+o.seg+"&"+rc+i+"="+o.ts+"&"+oc+i+"="+o.d,i++}return t=t+s,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,s){this.pendingSegs.push({seg:e,ts:t,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let s=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(s,Math.floor(cc)),r=()=>{clearTimeout(i),s()};this.addTag(e,r)}addTag(e,t){J()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){let i=s.readyState;(!i||i==="loaded"||i==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),t())},s.onerror=()=>{x("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}};var uc=16384,dc=45e3,nn=null;typeof MozWebSocket<"u"?nn=MozWebSocket:typeof WebSocket<"u"&&(nn=WebSocket);var Ve=(()=>{class n{constructor(t,s,i,r,o,l,a){this.connId=t,this.applicationId=i,this.appCheckToken=r,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Ot(this.connId),this.stats_=pi(s),this.connURL=n.connectionURL_(s,l,a,r,i),this.nodeAdmin=s.nodeAdmin}static connectionURL_(t,s,i,r,o){let l={};return l[Yo]=en,!J()&&typeof location<"u"&&location.hostname&&Xo.test(location.hostname)&&(l[zo]=$o),s&&(l[qo]=s),i&&(l[Jo]=i),r&&(l[_s]=r),o&&(l[Zo]=o),nl(t,el,l)}open(t,s){this.onDisconnect=s,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,be.set("previous_websocket_failure",!0);try{let i;if(J()){let r=this.nodeAdmin?"AdminNode":"Node";i={headers:{"User-Agent":`Firebase/${en}/${di}/${process.platform}/${r}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(i.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(i.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,l=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;l&&(i.proxy={origin:l})}this.mySock=new nn(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");let r=i.message||i.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");let r=i.message||i.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let s=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(s);i&&i.length>1&&parseFloat(i[1])<4.4&&(t=!0)}return!t&&nn!==null&&!n.forceDisallow_}static previouslyFailed(){return be.isInMemoryStorage||be.get("previous_websocket_failure")===!0}markConnectionHealthy(){be.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let s=this.frames.join("");this.frames=null;let i=Yt(s);this.onMessage(i)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(f(this.frames===null,"We already have a frame buffer"),t.length<=6){let s=Number(t);if(!isNaN(s))return this.handleNewFrameCount_(s),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let s=t.data;if(this.bytesReceived+=s.length,this.stats_.incrementCounter("bytes_received",s.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(s);else{let i=this.extractFrameCount_(s);i!==null&&this.appendFrame_(i)}}send(t){this.resetKeepAlive();let s=R(t);this.bytesSent+=s.length,this.stats_.incrementCounter("bytes_sent",s.length);let i=Ko(s,uc);i.length>1&&this.sendString_(String(i.length));for(let r=0;r<i.length;r++)this.sendString_(i[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(dc))}sendString_(t){try{this.mySock.send(t)}catch(s){this.log_("Exception thrown from WebSocket.send():",s.message||s.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),al=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[yt,Ve]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){let s=Ve&&Ve.isAvailable(),i=s&&!Ve.previouslyFailed();if(t.webSocketOnly&&(s||D("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[Ve];else{let r=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&r.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),fc=6e4,_c=5e3,pc=10*1024,gc=100*1024,ss="t",_o="d",mc="s",po="r",yc="e",go="o",mo="a",yo="n",vo="p",vc="h",ys=class{constructor(e,t,s,i,r,o,l,a,c,h){this.id=e,this.repoInfo_=t,this.applicationId_=s,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=o,this.onReady_=l,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Ot("c:"+this.id+":"),this.transportManager_=new al(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,s)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=ft(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>gc?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>pc?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(ss in e){let t=e[ss];t===mo?this.upgradeIfSecondaryHealthy_():t===po?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===go&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=ct("t",e),s=ct("d",e);if(t==="c")this.onSecondaryControl_(s);else if(t==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:vo,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:mo,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:yo,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=ct("t",e),s=ct("d",e);t==="c"?this.onControl_(s):t==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=ct(ss,e);if(_o in e){let s=e[_o];if(t===vc){let i=Object.assign({},s);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===yo){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===mc?this.onConnectionShutdown_(s):t===po?this.onReset_(s):t===yc?us("Server Error: "+s):t===go?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):us("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,s=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),en!==s&&D("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,s),ft(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(fc))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ft(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(_c))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:vo,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(be.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var sn=class{put(e,t,s,i){}merge(e,t,s,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,s){}onDisconnectMerge(e,t,s){}onDisconnectCancel(e,t){}reportStats(e){}};var rn=class{constructor(e){this.allowedEvents_=e,this.listeners_={},f(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let s=[...this.listeners_[e]];for(let i=0;i<s.length;i++)s[i].callback.apply(s[i].context,t)}}on(e,t,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:s});let i=this.getInitialEvent(e);i&&t.apply(s,i)}off(e,t,s){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let r=0;r<i.length;r++)if(i[r].callback===t&&(!s||s===i[r].context)){i.splice(r,1);return}}validateEventType_(e){f(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var on=class n extends rn{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Xn()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new n}getInitialEvent(e){return f(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var wo=32,Co=768,E=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let s=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[s]=this.pieces_[i],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function C(){return new E("")}function y(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function ge(n){return n.pieces_.length-n.pieceNum_}function I(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new E(n.pieces_,e)}function gi(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function wc(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function vt(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function cl(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new E(e,0)}function b(n,e){let t=[];for(let s=n.pieceNum_;s<n.pieces_.length;s++)t.push(n.pieces_[s]);if(e instanceof E)for(let s=e.pieceNum_;s<e.pieces_.length;s++)t.push(e.pieces_[s]);else{let s=e.split("/");for(let i=0;i<s.length;i++)s[i].length>0&&t.push(s[i])}return new E(t,0)}function v(n){return n.pieceNum_>=n.pieces_.length}function L(n,e){let t=y(n),s=y(e);if(t===null)return e;if(t===s)return L(I(n),I(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function Cc(n,e){let t=vt(n,0),s=vt(e,0);for(let i=0;i<t.length&&i<s.length;i++){let r=Pe(t[i],s[i]);if(r!==0)return r}return t.length===s.length?0:t.length<s.length?-1:1}function mi(n,e){if(ge(n)!==ge(e))return!1;for(let t=n.pieceNum_,s=e.pieceNum_;t<=n.pieces_.length;t++,s++)if(n.pieces_[t]!==e.pieces_[s])return!1;return!0}function Y(n,e){let t=n.pieceNum_,s=e.pieceNum_;if(ge(n)>ge(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[s])return!1;++t,++s}return!0}var vs=class{constructor(e,t){this.errorPrefix_=t,this.parts_=vt(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=at(this.parts_[s]);hl(this)}};function Ec(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=at(e),hl(n)}function Tc(n){let e=n.parts_.pop();n.byteLength_-=at(e),n.parts_.length>0&&(n.byteLength_-=1)}function hl(n){if(n.byteLength_>Co)throw new Error(n.errorPrefix_+"has a key path longer than "+Co+" bytes ("+n.byteLength_+").");if(n.parts_.length>wo)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+wo+") or object contains a cycle "+Se(n))}function Se(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var ws=class n extends rn{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}static getInstance(){return new n}getInitialEvent(e){return f(e==="visible","Unknown event type: "+e),[this.visible_]}};var ht=1e3,Ic=60*5*1e3,Eo=30*1e3,Sc=1.3,bc=3e4,Nc="server_kill",To=3,yi=(()=>{class n extends sn{constructor(t,s,i,r,o,l,a,c){if(super(),this.repoInfo_=t,this.applicationId_=s,this.onDataUpdate_=i,this.onConnectStatus_=r,this.onServerInfoUpdate_=o,this.authTokenProvider_=l,this.appCheckTokenProvider_=a,this.authOverride_=c,this.id=n.nextPersistentConnectionId_++,this.log_=Ot("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=ht,this.maxReconnectDelay_=Ic,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!J())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");ws.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&on.getInstance().on("online",this.onOnline_,this)}sendRequest(t,s,i){let r=++this.requestNumber_,o={r,a:t,b:s};this.log_(R(o)),f(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),i&&(this.requestCBHash_[r]=i)}get(t){this.initConnection_();let s=new M,r={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:l=>{let a=l.d;l.s==="ok"?s.resolve(a):s.reject(a)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),s.promise}listen(t,s,i,r){this.initConnection_();let o=t._queryIdentifier,l=t._path.toString();this.log_("Listen called for "+l+" "+o),this.listens.has(l)||this.listens.set(l,new Map),f(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),f(!this.listens.get(l).has(o),"listen() called twice for same path/queryId.");let a={onComplete:r,hashFn:s,query:t,tag:i};this.listens.get(l).set(o,a),this.connected_&&this.sendListen_(a)}sendGet_(t){let s=this.outstandingGets_[t];this.sendRequest("g",s.request,i=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),s.onComplete&&s.onComplete(i)})}sendListen_(t){let s=t.query,i=s._path.toString(),r=s._queryIdentifier;this.log_("Listen on "+i+" for "+r);let o={p:i},l="q";t.tag&&(o.q=s._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(l,o,a=>{let c=a.d,h=a.s;n.warnOnListenWarnings_(c,s),(this.listens.get(i)&&this.listens.get(i).get(r))===t&&(this.log_("listen response",a),h!=="ok"&&this.removeListen_(i,r),t.onComplete&&t.onComplete(h,c))})}static warnOnListenWarnings_(t,s){if(t&&typeof t=="object"&&Q(t,"w")){let i=ue(t,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){let r='".indexOn": "'+s._queryParams.getIndex().toString()+'"',o=s._path.toString();D(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||xr(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Eo)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,s=Ar(t)?"auth":"gauth",i={cred:t};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(s,i,r=>{let o=r.s,l=r.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,l))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let s=t.s,i=t.d||"error";s==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(s,i)})}unlisten(t,s){let i=t._path.toString(),r=t._queryIdentifier;this.log_("Unlisten called for "+i+" "+r),f(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,r)&&this.connected_&&this.sendUnlisten_(i,r,t._queryObject,s)}sendUnlisten_(t,s,i,r){this.log_("Unlisten on "+t+" for "+s);let o={p:t},l="n";r&&(o.q=i,o.t=r),this.sendRequest(l,o)}onDisconnectPut(t,s,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,s,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:s,onComplete:i})}onDisconnectMerge(t,s,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,s,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:s,onComplete:i})}onDisconnectCancel(t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:s})}sendOnDisconnect_(t,s,i,r){let o={p:s,d:i};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,l=>{r&&setTimeout(()=>{r(l.s,l.d)},Math.floor(0))})}put(t,s,i,r){this.putInternal("p",t,s,i,r)}merge(t,s,i,r){this.putInternal("m",t,s,i,r)}putInternal(t,s,i,r,o){this.initConnection_();let l={p:s,d:i};o!==void 0&&(l.h=o),this.outstandingPuts_.push({action:t,request:l,onComplete:r}),this.outstandingPutCount_++;let a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+s)}sendPut_(t){let s=this.outstandingPuts_[t].action,i=this.outstandingPuts_[t].request,r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(s,i,o=>{this.log_(s+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(o.s,o.d)})}reportStats(t){if(this.connected_){let s={c:t};this.log_("reportStats",s),this.sendRequest("s",s,i=>{if(i.s!=="ok"){let o=i.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+R(t));let s=t.r,i=this.requestCBHash_[s];i&&(delete this.requestCBHash_[s],i(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,s){this.log_("handleServerMessage",t,s),t==="d"?this.onDataUpdate_(s.p,s.d,!1,s.t):t==="m"?this.onDataUpdate_(s.p,s.d,!0,s.t):t==="c"?this.onListenRevoked_(s.p,s.q):t==="ac"?this.onAuthRevoked_(s.s,s.d):t==="apc"?this.onAppCheckRevoked_(s.s,s.d):t==="sd"?this.onSecurityDebugPacket_(s):us("Unrecognized action received from server: "+R(t)+`
Are you using the latest client?`)}onReady_(t,s){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=s,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){f(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=ht,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=ht,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>bc&&(this.reconnectDelay_=ht),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,s=Math.max(0,this.reconnectDelay_-t);s=Math.random()*s,this.log_("Trying to reconnect in "+s+"ms"),this.scheduleConnect_(s),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Sc)}this.onConnectStatus_(!1)}establishConnection_(){return $i(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),s=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,l=!1,a=null,c=function(){a?a.close():(l=!0,i())},h=function(d){f(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(d)};this.realtime_={close:c,sendRequest:h};let u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[d,_]=yield Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);l?x("getToken() completed but was canceled"):(x("getToken() completed. Creating connection."),this.authToken_=d&&d.accessToken,this.appCheckToken_=_&&_.token,a=new ys(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,s,i,p=>{D(p+" ("+this.repoInfo_.toString()+")"),this.interrupt(Nc)},o))}catch(d){this.log_("Failed to get token: "+d),l||(this.repoInfo_.nodeAdmin&&D(d),c())}}})}interrupt(t){x("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){x("Resuming connection for reason: "+t),delete this.interruptReasons_[t],qt(this.interruptReasons_)&&(this.reconnectDelay_=ht,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let s=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:s})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let s=this.outstandingPuts_[t];s&&"h"in s.request&&s.queued&&(s.onComplete&&s.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,s){let i;s?i=s.map(o=>_i(o)).join("$"):i="default";let r=this.removeListen_(t,i);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(t,s){let i=new E(t).toString(),r;if(this.listens.has(i)){let o=this.listens.get(i);r=o.get(s),o.delete(s),o.size===0&&this.listens.delete(i)}else r=void 0;return r}onAuthRevoked_(t,s){x("Auth token revoked: "+t+"/"+s),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=To&&(this.reconnectDelay_=Eo,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,s){x("App check token revoked: "+t+"/"+s),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=To&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let s of t.values())this.sendListen_(s);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},s="js";J()&&(this.repoInfo_.nodeAdmin?s="admin_node":s="node"),t["sdk."+s+"."+di.replace(/\./g,"-")]=1,Xn()?t["framework.cordova"]=1:kr()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=on.getInstance().currentlyOnline();return qt(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),w=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var He=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let s=new w(pe,e),i=new w(pe,t);return this.compare(s,i)!==0}minPost(){return w.MIN}};var Zt,ln=class extends He{static get __EMPTY_NODE(){return Zt}static set __EMPTY_NODE(e){Zt=e}compare(e,t){return Pe(e.name,t.name)}isDefinedOn(e){throw We("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return w.MIN}maxPost(){return new w(ie,Zt)}makePost(e,t){return f(typeof e=="string","KeyIndex indexValue must always be a string."),new w(e,Zt)}toString(){return".key"}},ee=new ln;var Ge=class{constructor(e,t,s,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?s(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},$=(()=>{class n{constructor(t,s,i,r,o){this.key=t,this.value=s,this.color=i!=null?i:n.RED,this.left=r!=null?r:q.EMPTY_NODE,this.right=o!=null?o:q.EMPTY_NODE}copy(t,s,i,r,o){return new n(t!=null?t:this.key,s!=null?s:this.value,i!=null?i:this.color,r!=null?r:this.left,o!=null?o:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,s,i){let r=this,o=i(t,r.key);return o<0?r=r.copy(null,null,null,r.left.insert(t,s,i),null):o===0?r=r.copy(null,s,null,null,null):r=r.copy(null,null,null,null,r.right.insert(t,s,i)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return q.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,s){let i,r;if(i=this,s(t,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(t,s),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),s(t,i.key)===0){if(i.right.isEmpty())return q.EMPTY_NODE;r=i.right.min_(),i=i.copy(r.key,r.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(t,s))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),s=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,s)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),Cs=class{copy(e,t,s,i,r){return this}insert(e,t,s){return new $(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},q=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,$.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,$.BLACK,null,null))}get(e){let t,s=this.root_;for(;!s.isEmpty();){if(t=this.comparator_(e,s.key),t===0)return s.value;t<0?s=s.left:t>0&&(s=s.right)}return null}getPredecessorKey(e){let t,s=this.root_,i=null;for(;!s.isEmpty();)if(t=this.comparator_(e,s.key),t===0){if(s.left.isEmpty())return i?i.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else t<0?s=s.left:t>0&&(i=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Ge(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Ge(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Ge(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Ge(this.root_,null,this.comparator_,!0,e)}};q.EMPTY_NODE=new Cs;function Rc(n,e){return Pe(n.name,e.name)}function vi(n,e){return Pe(n,e)}var Es;function Pc(n){Es=n}var ul=function(n){return typeof n=="number"?"number:"+Qo(n):"string:"+n},dl=function(n){if(n.isLeafNode()){let e=n.val();f(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Q(e,".sv"),"Priority must be a string or number.")}else f(n===Es||n.isEmpty(),"priority of unexpected type.");f(n===Es||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var Io,Ke=(()=>{class n{constructor(t,s=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=s,this.lazyHash_=null,f(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),dl(this.priorityNode_)}static set __childrenNodeConstructor(t){Io=t}static get __childrenNodeConstructor(){return Io}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return v(t)?this:y(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,s){return null}updateImmediateChild(t,s){return t===".priority"?this.updatePriority(s):s.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,s).updatePriority(this.priorityNode_)}updateChild(t,s){let i=y(t);return i===null?s:s.isEmpty()&&i!==".priority"?this:(f(i!==".priority"||ge(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(I(t),s)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,s){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+ul(this.priorityNode_.val())+":");let s=typeof this.value_;t+=s+":",s==="number"?t+=Qo(this.value_):t+=this.value_,this.lazyHash_=jo(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(f(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let s=typeof t.value_,i=typeof this.value_,r=n.VALUE_TYPE_ORDER.indexOf(s),o=n.VALUE_TYPE_ORDER.indexOf(i);return f(r>=0,"Unknown leaf type: "+s),f(o>=0,"Unknown leaf type: "+i),r===o?i==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-r}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let s=t;return this.value_===s.value_&&this.priorityNode_.equals(s.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),fl,_l;function kc(n){fl=n}function Ac(n){_l=n}var Ts=class extends He{compare(e,t){let s=e.node.getPriority(),i=t.node.getPriority(),r=s.compareTo(i);return r===0?Pe(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return w.MIN}maxPost(){return new w(ie,new Ke("[PRIORITY-POST]",_l))}makePost(e,t){let s=fl(e);return new w(t,new Ke("[PRIORITY-POST]",s))}toString(){return".priority"}},S=new Ts;var xc=Math.log(2),Is=class{constructor(e){let t=r=>parseInt(Math.log(r)/xc,10),s=r=>parseInt(Array(r+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let i=s(this.count);this.bits_=e+1&i}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},an=function(n,e,t,s){n.sort(e);let i=function(a,c){let h=c-a,u,d;if(h===0)return null;if(h===1)return u=n[a],d=t?t(u):u,new $(d,u.node,$.BLACK,null,null);{let _=parseInt(h/2,10)+a,p=i(a,_),T=i(_+1,c);return u=n[_],d=t?t(u):u,new $(d,u.node,$.BLACK,p,T)}},r=function(a){let c=null,h=null,u=n.length,d=function(p,T){let P=u-p,Ce=u;u-=p;let oe=i(P+1,Ce),le=n[P],Ht=t?t(le):le;_(new $(Ht,le.node,T,null,oe))},_=function(p){c?(c.left=p,c=p):(h=p,c=p)};for(let p=0;p<a.count;++p){let T=a.nextBitIsOne(),P=Math.pow(2,a.count-(p+1));T?d(P,$.BLACK):(d(P,$.BLACK),d(P,$.RED))}return h},o=new Is(n.length),l=r(o);return new q(s||e,l)};var is,Be={},Qe=class n{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return f(Be&&S,"ChildrenNode.ts has not been loaded"),is=is||new n({".priority":Be},{".priority":S}),is}get(e){let t=ue(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof q?t:null}hasIndex(e){return Q(this.indexSet_,e.toString())}addIndex(e,t){f(e!==ee,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let s=[],i=!1,r=t.getIterator(w.Wrap),o=r.getNext();for(;o;)i=i||e.isDefinedOn(o.node),s.push(o),o=r.getNext();let l;i?l=an(s,e.getCompare()):l=Be;let a=e.toString(),c=Object.assign({},this.indexSet_);c[a]=e;let h=Object.assign({},this.indexes_);return h[a]=l,new n(h,c)}addToIndexes(e,t){let s=lt(this.indexes_,(i,r)=>{let o=ue(this.indexSet_,r);if(f(o,"Missing index implementation for "+r),i===Be)if(o.isDefinedOn(e.node)){let l=[],a=t.getIterator(w.Wrap),c=a.getNext();for(;c;)c.name!==e.name&&l.push(c),c=a.getNext();return l.push(e),an(l,o.getCompare())}else return Be;else{let l=t.get(e.name),a=i;return l&&(a=a.remove(new w(e.name,l))),a.insert(e,e.node)}});return new n(s,this.indexSet_)}removeFromIndexes(e,t){let s=lt(this.indexes_,i=>{if(i===Be)return i;{let r=t.get(e.name);return r?i.remove(new w(e.name,r)):i}});return new n(s,this.indexSet_)}};var ut,m=(()=>{class n{constructor(t,s,i){this.children_=t,this.priorityNode_=s,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&dl(this.priorityNode_),this.children_.isEmpty()&&f(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return ut||(ut=new n(new q(vi),null,Qe.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ut}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let s=this.children_.get(t);return s===null?ut:s}}getChild(t){let s=y(t);return s===null?this:this.getImmediateChild(s).getChild(I(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,s){if(f(s,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(s);{let i=new w(t,s),r,o;s.isEmpty()?(r=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(i,this.children_)):(r=this.children_.insert(t,s),o=this.indexMap_.addToIndexes(i,this.children_));let l=r.isEmpty()?ut:this.priorityNode_;return new n(r,l,o)}}updateChild(t,s){let i=y(t);if(i===null)return s;{f(y(t)!==".priority"||ge(t)===1,".priority must be the last token in a path");let r=this.getImmediateChild(i).updateChild(I(t),s);return this.updateImmediateChild(i,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let s={},i=0,r=0,o=!0;if(this.forEachChild(S,(l,a)=>{s[l]=a.val(t),i++,o&&n.INTEGER_REGEXP_.test(l)?r=Math.max(r,Number(l)):o=!1}),!t&&o&&r<2*i){let l=[];for(let a in s)l[a]=s[a];return l}else return t&&!this.getPriority().isEmpty()&&(s[".priority"]=this.getPriority().val()),s}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+ul(this.getPriority().val())+":"),this.forEachChild(S,(s,i)=>{let r=i.hash();r!==""&&(t+=":"+s+":"+r)}),this.lazyHash_=t===""?"":jo(t)}return this.lazyHash_}getPredecessorChildName(t,s,i){let r=this.resolveIndex_(i);if(r){let o=r.getPredecessorKey(new w(t,s));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let s=this.resolveIndex_(t);if(s){let i=s.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(t){let s=this.getFirstChildName(t);return s?new w(s,this.children_.get(s)):null}getLastChildName(t){let s=this.resolveIndex_(t);if(s){let i=s.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(t){let s=this.getLastChildName(t);return s?new w(s,this.children_.get(s)):null}forEachChild(t,s){let i=this.resolveIndex_(t);return i?i.inorderTraversal(r=>s(r.name,r.node)):this.children_.inorderTraversal(s)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,s){let i=this.resolveIndex_(s);if(i)return i.getIteratorFrom(t,r=>r);{let r=this.children_.getIteratorFrom(t.name,w.Wrap),o=r.peek();for(;o!=null&&s.compare(o,t)<0;)r.getNext(),o=r.peek();return r}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,s){let i=this.resolveIndex_(s);if(i)return i.getReverseIteratorFrom(t,r=>r);{let r=this.children_.getReverseIteratorFrom(t.name,w.Wrap),o=r.peek();for(;o!=null&&s.compare(o,t)>0;)r.getNext(),o=r.peek();return r}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Dt?-1:0}withIndex(t){if(t===ee||this.indexMap_.hasIndex(t))return this;{let s=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,s)}}isIndexed(t){return t===ee||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let s=t;if(this.getPriority().equals(s.getPriority()))if(this.children_.count()===s.children_.count()){let i=this.getIterator(S),r=s.getIterator(S),o=i.getNext(),l=r.getNext();for(;o&&l;){if(o.name!==l.name||!o.node.equals(l.node))return!1;o=i.getNext(),l=r.getNext()}return o===null&&l===null}else return!1;else return!1}}resolveIndex_(t){return t===ee?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),Ss=class extends m{constructor(){super(new q(vi),m.EMPTY_NODE,Qe.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return m.EMPTY_NODE}isEmpty(){return!1}},Dt=new Ss;Object.defineProperties(w,{MIN:{value:new w(pe,m.EMPTY_NODE)},MAX:{value:new w(ie,Dt)}});ln.__EMPTY_NODE=m.EMPTY_NODE;Ke.__childrenNodeConstructor=m;Pc(Dt);Ac(Dt);var Oc=!0;function N(n,e=null){if(n===null)return m.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),f(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new Ke(t,N(e))}if(!(n instanceof Array)&&Oc){let t=[],s=!1;if(O(n,(o,l)=>{if(o.substring(0,1)!=="."){let a=N(l);a.isEmpty()||(s=s||!a.getPriority().isEmpty(),t.push(new w(o,a)))}}),t.length===0)return m.EMPTY_NODE;let r=an(t,Rc,o=>o.name,vi);if(s){let o=an(t,S.getCompare());return new m(r,N(e),new Qe({".priority":o},{".priority":S}))}else return new m(r,N(e),Qe.Default)}else{let t=m.EMPTY_NODE;return O(n,(s,i)=>{if(Q(n,s)&&s.substring(0,1)!=="."){let r=N(i);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(s,r))}}),t.updatePriority(N(e))}}kc(N);var wt=class extends He{constructor(e){super(),this.indexPath_=e,f(!v(e)&&y(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let s=this.extractChild(e.node),i=this.extractChild(t.node),r=s.compareTo(i);return r===0?Pe(e.name,t.name):r}makePost(e,t){let s=N(e),i=m.EMPTY_NODE.updateChild(this.indexPath_,s);return new w(t,i)}maxPost(){let e=m.EMPTY_NODE.updateChild(this.indexPath_,Dt);return new w(ie,e)}toString(){return vt(this.indexPath_,0).join("/")}};var bs=class extends He{compare(e,t){let s=e.node.compareTo(t.node);return s===0?Pe(e.name,t.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return w.MIN}maxPost(){return w.MAX}makePost(e,t){let s=N(e);return new w(t,s)}toString(){return".value"}},wi=new bs;function pl(n){return{type:"value",snapshotNode:n}}function Ye(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Ct(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Et(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function Dc(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var Tt=class{constructor(e){this.index_=e}updateChild(e,t,s,i,r,o){f(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let l=e.getImmediateChild(t);return l.getChild(i).equals(s.getChild(i))&&l.isEmpty()===s.isEmpty()||(o!=null&&(s.isEmpty()?e.hasChild(t)?o.trackChildChange(Ct(t,l)):f(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?o.trackChildChange(Ye(t,s)):o.trackChildChange(Et(t,s,l))),e.isLeafNode()&&s.isEmpty())?e:e.updateImmediateChild(t,s).withIndex(this.index_)}updateFullNode(e,t,s){return s!=null&&(e.isLeafNode()||e.forEachChild(S,(i,r)=>{t.hasChild(i)||s.trackChildChange(Ct(i,r))}),t.isLeafNode()||t.forEachChild(S,(i,r)=>{if(e.hasChild(i)){let o=e.getImmediateChild(i);o.equals(r)||s.trackChildChange(Et(i,r,o))}else s.trackChildChange(Ye(i,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?m.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var cn=class n{constructor(e){this.indexedFilter_=new Tt(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,s=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&s}updateChild(e,t,s,i,r,o){return this.matches(new w(t,s))||(s=m.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,s,i,r,o)}updateFullNode(e,t,s){t.isLeafNode()&&(t=m.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(m.EMPTY_NODE);let r=this;return t.forEachChild(S,(o,l)=>{r.matches(new w(o,l))||(i=i.updateImmediateChild(o,m.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,s)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var Ns=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let s=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?s<=0:s<0},this.withinEndPost=t=>{let s=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?s<=0:s<0},this.rangedFilter_=new cn(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,s,i,r,o){return this.rangedFilter_.matches(new w(t,s))||(s=m.EMPTY_NODE),e.getImmediateChild(t).equals(s)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,s,i,r,o):this.fullLimitUpdateChild_(e,t,s,r,o)}updateFullNode(e,t,s){let i;if(t.isLeafNode()||t.isEmpty())i=m.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){i=m.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){let l=r.getNext();if(this.withinDirectionalStart(l))if(this.withinDirectionalEnd(l))i=i.updateImmediateChild(l.name,l.node),o++;else break;else continue}}else{i=t.withIndex(this.index_),i=i.updatePriority(m.EMPTY_NODE);let r;this.reverse_?r=i.getReverseIterator(this.index_):r=i.getIterator(this.index_);let o=0;for(;r.hasNext();){let l=r.getNext();o<this.limit_&&this.withinDirectionalStart(l)&&this.withinDirectionalEnd(l)?o++:i=i.updateImmediateChild(l.name,m.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,s)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,s,i,r){let o;if(this.reverse_){let u=this.index_.getCompare();o=(d,_)=>u(_,d)}else o=this.index_.getCompare();let l=e;f(l.numChildren()===this.limit_,"");let a=new w(t,s),c=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),h=this.rangedFilter_.matches(a);if(l.hasChild(t)){let u=l.getImmediateChild(t),d=i.getChildAfterChild(this.index_,c,this.reverse_);for(;d!=null&&(d.name===t||l.hasChild(d.name));)d=i.getChildAfterChild(this.index_,d,this.reverse_);let _=d==null?1:o(d,a);if(h&&!s.isEmpty()&&_>=0)return r!=null&&r.trackChildChange(Et(t,s,u)),l.updateImmediateChild(t,s);{r!=null&&r.trackChildChange(Ct(t,u));let T=l.updateImmediateChild(t,m.EMPTY_NODE);return d!=null&&this.rangedFilter_.matches(d)?(r!=null&&r.trackChildChange(Ye(d.name,d.node)),T.updateImmediateChild(d.name,d.node)):T}}else return s.isEmpty()?e:h&&o(c,a)>=0?(r!=null&&(r.trackChildChange(Ct(c.name,c.node)),r.trackChildChange(Ye(t,s))),l.updateImmediateChild(t,s).updateImmediateChild(c.name,m.EMPTY_NODE)):e}};var It=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=S}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return f(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return f(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:pe}hasEnd(){return this.endSet_}getIndexEndValue(){return f(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return f(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ie}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return f(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===S}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function Mc(n){return n.loadsAllData()?new Tt(n.getIndex()):n.hasLimit()?new Ns(n):new cn(n)}function Lc(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function Fc(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function Rs(n,e,t){let s=n.copy();return s.startSet_=!0,e===void 0&&(e=null),s.indexStartValue_=e,t!=null?(s.startNameSet_=!0,s.indexStartName_=t):(s.startNameSet_=!1,s.indexStartName_=""),s}function Wc(n,e,t){let s;return n.index_===ee||t?s=Rs(n,e,t):s=Rs(n,e,ie),s.startAfterSet_=!0,s}function Ps(n,e,t){let s=n.copy();return s.endSet_=!0,e===void 0&&(e=null),s.indexEndValue_=e,t!==void 0?(s.endNameSet_=!0,s.indexEndName_=t):(s.endNameSet_=!1,s.indexEndName_=""),s}function Uc(n,e,t){let s;return n.index_===ee||t?s=Ps(n,e,t):s=Ps(n,e,pe),s.endBeforeSet_=!0,s}function Rn(n,e){let t=n.copy();return t.index_=e,t}function So(n){let e={};if(n.isDefault())return e;let t;if(n.index_===S?t="$priority":n.index_===wi?t="$value":n.index_===ee?t="$key":(f(n.index_ instanceof wt,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=R(t),n.startSet_){let s=n.startAfterSet_?"startAfter":"startAt";e[s]=R(n.indexStartValue_),n.startNameSet_&&(e[s]+=","+R(n.indexStartName_))}if(n.endSet_){let s=n.endBeforeSet_?"endBefore":"endAt";e[s]=R(n.indexEndValue_),n.endNameSet_&&(e[s]+=","+R(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function bo(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==S&&(e.i=n.index_.toString()),e}var ks=class n extends sn{constructor(e,t,s,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=s,this.appCheckTokenProvider_=i,this.log_=Ot("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(f(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,s,i){let r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);let o=n.getListenId_(e,s),l={};this.listens_[o]=l;let a=So(e._queryParams);this.restRequest_(r+".json",a,(c,h)=>{let u=h;if(c===404&&(u=null,c=null),c===null&&this.onDataUpdate_(r,u,!1,s),ue(this.listens_,o)===l){let d;c?c===401?d="permission_denied":d="rest_error:"+c:d="ok",i(d,null)}})}unlisten(e,t){let s=n.getListenId_(e,t);delete this.listens_[s]}get(e){let t=So(e._queryParams),s=e._path.toString(),i=new M;return this.restRequest_(s+".json",t,(r,o)=>{let l=o;r===404&&(l=null,r=null),r===null?(this.onDataUpdate_(s,l,!1,null),i.resolve(l)):i.reject(new Error(l))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},s){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Or(t);this.log_("Sending REST request for "+o);let l=new XMLHttpRequest;l.onreadystatechange=()=>{if(s&&l.readyState===4){this.log_("REST Response for "+o+" received. status:",l.status,"response:",l.responseText);let a=null;if(l.status>=200&&l.status<300){try{a=Yt(l.responseText)}catch{D("Failed to parse JSON response for "+o+": "+l.responseText)}s(null,a)}else l.status!==401&&l.status!==404&&D("Got unsuccessful REST response for "+o+" Status: "+l.status),s(l.status);s=null}},l.open("GET",o,!0),l.send()})}};var As=class{constructor(){this.rootNode_=m.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function hn(){return{value:null,children:new Map}}function Ze(n,e,t){if(v(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let s=y(e);n.children.has(s)||n.children.set(s,hn());let i=n.children.get(s);e=I(e),Ze(i,e,t)}}function xs(n,e){if(v(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{let t=n.value;return n.value=null,t.forEachChild(S,(s,i)=>{Ze(n,new E(s),i)}),xs(n,e)}}else if(n.children.size>0){let t=y(e);return e=I(e),n.children.has(t)&&xs(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function Os(n,e,t){n.value!==null?t(e,n.value):Bc(n,(s,i)=>{let r=new E(e.toString()+"/"+s);Os(i,r,t)})}function Bc(n,e){n.children.forEach((t,s)=>{e(s,t)})}var Ds=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&O(this.last_,(s,i)=>{t[s]=t[s]-i}),this.last_=e,t}};var No=10*1e3,Vc=30*1e3,Gc=5*60*1e3,Ms=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Ds(e);let s=No+(Vc-No)*Math.random();ft(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){let e=this.statsListener_.get(),t={},s=!1;O(e,(i,r)=>{r>0&&Q(this.statsToReport_,i)&&(t[i]=r,s=!0)}),s&&this.server_.reportStats(t),ft(this.reportStats_.bind(this),Math.floor(Math.random()*2*Gc))}};var Z=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(Z||{});function Ci(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Ei(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Ti(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var Ls=class n{constructor(e,t,s){this.path=e,this.affectedTree=t,this.revert=s,this.type=Z.ACK_USER_WRITE,this.source=Ci()}operationForChild(e){if(v(this.path)){if(this.affectedTree.value!=null)return f(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new E(e));return new n(C(),t,this.revert)}}else return f(y(this.path)===e,"operationForChild called for unrelated child."),new n(I(this.path),this.affectedTree,this.revert)}};var un=class n{constructor(e,t){this.source=e,this.path=t,this.type=Z.LISTEN_COMPLETE}operationForChild(e){return v(this.path)?new n(this.source,C()):new n(this.source,I(this.path))}};var qe=class n{constructor(e,t,s){this.source=e,this.path=t,this.snap=s,this.type=Z.OVERWRITE}operationForChild(e){return v(this.path)?new n(this.source,C(),this.snap.getImmediateChild(e)):new n(this.source,I(this.path),this.snap)}};var St=class n{constructor(e,t,s){this.source=e,this.path=t,this.children=s,this.type=Z.MERGE}operationForChild(e){if(v(this.path)){let t=this.children.subtree(new E(e));return t.isEmpty()?null:t.value?new qe(this.source,C(),t.value):new n(this.source,C(),t)}else return f(y(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,I(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var ne=class{constructor(e,t,s){this.node_=e,this.fullyInitialized_=t,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(v(e))return this.isFullyInitialized()&&!this.filtered_;let t=y(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var Fs=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function jc(n,e,t,s){let i=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(Dc(o.childName,o.snapshotNode))}),dt(n,i,"child_removed",e,s,t),dt(n,i,"child_added",e,s,t),dt(n,i,"child_moved",r,s,t),dt(n,i,"child_changed",e,s,t),dt(n,i,"value",e,s,t),i}function dt(n,e,t,s,i,r){let o=s.filter(l=>l.type===t);o.sort((l,a)=>Kc(n,l,a)),o.forEach(l=>{let a=Hc(n,l,r);i.forEach(c=>{c.respondsTo(l.type)&&e.push(c.createEvent(a,n.query_))})})}function Hc(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function Kc(n,e,t){if(e.childName==null||t.childName==null)throw We("Should only compare child_ events.");let s=new w(e.childName,e.snapshotNode),i=new w(t.childName,t.snapshotNode);return n.index_.compare(s,i)}function Pn(n,e){return{eventCache:n,serverCache:e}}function pt(n,e,t,s){return Pn(new ne(e,t,s),n.serverCache)}function gl(n,e,t,s){return Pn(n.eventCache,new ne(e,t,s))}function dn(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Re(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var rs,Qc=()=>(rs||(rs=new q(Ha)),rs),F=class n{constructor(e,t=Qc()){this.value=e,this.children=t}static fromObject(e){let t=new n(null);return O(e,(s,i)=>{t=t.set(new E(s),i)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:C(),value:this.value};if(v(e))return null;{let s=y(e),i=this.children.get(s);if(i!==null){let r=i.findRootMostMatchingPathAndValue(I(e),t);return r!=null?{path:b(new E(s),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(v(e))return this;{let t=y(e),s=this.children.get(t);return s!==null?s.subtree(I(e)):new n(null)}}set(e,t){if(v(e))return new n(t,this.children);{let s=y(e),r=(this.children.get(s)||new n(null)).set(I(e),t),o=this.children.insert(s,r);return new n(this.value,o)}}remove(e){if(v(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=y(e),s=this.children.get(t);if(s){let i=s.remove(I(e)),r;return i.isEmpty()?r=this.children.remove(t):r=this.children.insert(t,i),this.value===null&&r.isEmpty()?new n(null):new n(this.value,r)}else return this}}get(e){if(v(e))return this.value;{let t=y(e),s=this.children.get(t);return s?s.get(I(e)):null}}setTree(e,t){if(v(e))return t;{let s=y(e),r=(this.children.get(s)||new n(null)).setTree(I(e),t),o;return r.isEmpty()?o=this.children.remove(s):o=this.children.insert(s,r),new n(this.value,o)}}fold(e){return this.fold_(C(),e)}fold_(e,t){let s={};return this.children.inorderTraversal((i,r)=>{s[i]=r.fold_(b(e,i),t)}),t(e,this.value,s)}findOnPath(e,t){return this.findOnPath_(e,C(),t)}findOnPath_(e,t,s){let i=this.value?s(t,this.value):!1;if(i)return i;if(v(e))return null;{let r=y(e),o=this.children.get(r);return o?o.findOnPath_(I(e),b(t,r),s):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,C(),t)}foreachOnPath_(e,t,s){if(v(e))return this;{this.value&&s(t,this.value);let i=y(e),r=this.children.get(i);return r?r.foreachOnPath_(I(e),b(t,i),s):new n(null)}}foreach(e){this.foreach_(C(),e)}foreach_(e,t){this.children.inorderTraversal((s,i)=>{i.foreach_(b(e,s),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,s)=>{s.value&&e(t,s.value)})}};var X=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new F(null))}};function gt(n,e,t){if(v(e))return new X(new F(t));{let s=n.writeTree_.findRootMostValueAndPath(e);if(s!=null){let i=s.path,r=s.value,o=L(i,e);return r=r.updateChild(o,t),new X(n.writeTree_.set(i,r))}else{let i=new F(t),r=n.writeTree_.setTree(e,i);return new X(r)}}}function Ws(n,e,t){let s=n;return O(t,(i,r)=>{s=gt(s,b(e,i),r)}),s}function Ro(n,e){if(v(e))return X.empty();{let t=n.writeTree_.setTree(e,new F(null));return new X(t)}}function Us(n,e){return ke(n,e)!=null}function ke(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(L(t.path,e)):null}function Po(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(S,(s,i)=>{e.push(new w(s,i))}):n.writeTree_.children.inorderTraversal((s,i)=>{i.value!=null&&e.push(new w(s,i.value))}),e}function fe(n,e){if(v(e))return n;{let t=ke(n,e);return t!=null?new X(new F(t)):new X(n.writeTree_.subtree(e))}}function Bs(n){return n.writeTree_.isEmpty()}function ze(n,e){return ml(C(),n.writeTree_,e)}function ml(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let s=null;return e.children.inorderTraversal((i,r)=>{i===".priority"?(f(r.value!==null,"Priority writes must always be leaf nodes"),s=r.value):t=ml(b(n,i),r,t)}),!t.getChild(n).isEmpty()&&s!==null&&(t=t.updateChild(b(n,".priority"),s)),t}}function kn(n,e){return Cl(e,n)}function Yc(n,e,t,s,i){f(s>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:s,visible:i}),i&&(n.visibleWrites=gt(n.visibleWrites,e,t)),n.lastWriteId=s}function qc(n,e,t,s){f(s>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:s,visible:!0}),n.visibleWrites=Ws(n.visibleWrites,e,t),n.lastWriteId=s}function zc(n,e){for(let t=0;t<n.allWrites.length;t++){let s=n.allWrites[t];if(s.writeId===e)return s}return null}function $c(n,e){let t=n.allWrites.findIndex(l=>l.writeId===e);f(t>=0,"removeWrite called with nonexistent writeId.");let s=n.allWrites[t];n.allWrites.splice(t,1);let i=s.visible,r=!1,o=n.allWrites.length-1;for(;i&&o>=0;){let l=n.allWrites[o];l.visible&&(o>=t&&Xc(l,s.path)?i=!1:Y(s.path,l.path)&&(r=!0)),o--}if(i){if(r)return Jc(n),!0;if(s.snap)n.visibleWrites=Ro(n.visibleWrites,s.path);else{let l=s.children;O(l,a=>{n.visibleWrites=Ro(n.visibleWrites,b(s.path,a))})}return!0}else return!1}function Xc(n,e){if(n.snap)return Y(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&Y(b(n.path,t),e))return!0;return!1}function Jc(n){n.visibleWrites=yl(n.allWrites,Zc,C()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function Zc(n){return n.visible}function yl(n,e,t){let s=X.empty();for(let i=0;i<n.length;++i){let r=n[i];if(e(r)){let o=r.path,l;if(r.snap)Y(t,o)?(l=L(t,o),s=gt(s,l,r.snap)):Y(o,t)&&(l=L(o,t),s=gt(s,C(),r.snap.getChild(l)));else if(r.children){if(Y(t,o))l=L(t,o),s=Ws(s,l,r.children);else if(Y(o,t))if(l=L(o,t),v(l))s=Ws(s,C(),r.children);else{let a=ue(r.children,y(l));if(a){let c=a.getChild(I(l));s=gt(s,C(),c)}}}else throw We("WriteRecord should have .snap or .children")}}return s}function vl(n,e,t,s,i){if(!s&&!i){let r=ke(n.visibleWrites,e);if(r!=null)return r;{let o=fe(n.visibleWrites,e);if(Bs(o))return t;if(t==null&&!Us(o,C()))return null;{let l=t||m.EMPTY_NODE;return ze(o,l)}}}else{let r=fe(n.visibleWrites,e);if(!i&&Bs(r))return t;if(!i&&t==null&&!Us(r,C()))return null;{let o=function(c){return(c.visible||i)&&(!s||!~s.indexOf(c.writeId))&&(Y(c.path,e)||Y(e,c.path))},l=yl(n.allWrites,o,e),a=t||m.EMPTY_NODE;return ze(l,a)}}}function eh(n,e,t){let s=m.EMPTY_NODE,i=ke(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(S,(r,o)=>{s=s.updateImmediateChild(r,o)}),s;if(t){let r=fe(n.visibleWrites,e);return t.forEachChild(S,(o,l)=>{let a=ze(fe(r,new E(o)),l);s=s.updateImmediateChild(o,a)}),Po(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}else{let r=fe(n.visibleWrites,e);return Po(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}}function th(n,e,t,s,i){f(s||i,"Either existingEventSnap or existingServerSnap must exist");let r=b(e,t);if(Us(n.visibleWrites,r))return null;{let o=fe(n.visibleWrites,r);return Bs(o)?i.getChild(t):ze(o,i.getChild(t))}}function nh(n,e,t,s){let i=b(e,t),r=ke(n.visibleWrites,i);if(r!=null)return r;if(s.isCompleteForChild(t)){let o=fe(n.visibleWrites,i);return ze(o,s.getNode().getImmediateChild(t))}else return null}function sh(n,e){return ke(n.visibleWrites,e)}function ih(n,e,t,s,i,r,o){let l,a=fe(n.visibleWrites,e),c=ke(a,C());if(c!=null)l=c;else if(t!=null)l=ze(a,t);else return[];if(l=l.withIndex(o),!l.isEmpty()&&!l.isLeafNode()){let h=[],u=o.getCompare(),d=r?l.getReverseIteratorFrom(s,o):l.getIteratorFrom(s,o),_=d.getNext();for(;_&&h.length<i;)u(_,s)!==0&&h.push(_),_=d.getNext();return h}else return[]}function rh(){return{visibleWrites:X.empty(),allWrites:[],lastWriteId:-1}}function fn(n,e,t,s){return vl(n.writeTree,n.treePath,e,t,s)}function Ii(n,e){return eh(n.writeTree,n.treePath,e)}function ko(n,e,t,s){return th(n.writeTree,n.treePath,e,t,s)}function _n(n,e){return sh(n.writeTree,b(n.treePath,e))}function oh(n,e,t,s,i,r){return ih(n.writeTree,n.treePath,e,t,s,i,r)}function Si(n,e,t){return nh(n.writeTree,n.treePath,e,t)}function wl(n,e){return Cl(b(n.treePath,e),n.writeTree)}function Cl(n,e){return{treePath:n,writeTree:e}}var Vs=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,s=e.childName;f(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),f(s!==".priority","Only non-priority child changes can be tracked.");let i=this.changeMap.get(s);if(i){let r=i.type;if(t==="child_added"&&r==="child_removed")this.changeMap.set(s,Et(s,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&r==="child_added")this.changeMap.delete(s);else if(t==="child_removed"&&r==="child_changed")this.changeMap.set(s,Ct(s,i.oldSnap));else if(t==="child_changed"&&r==="child_added")this.changeMap.set(s,Ye(s,e.snapshotNode));else if(t==="child_changed"&&r==="child_changed")this.changeMap.set(s,Et(s,e.snapshotNode,i.oldSnap));else throw We("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}};var Gs=class{getCompleteChild(e){return null}getChildAfterChild(e,t,s){return null}},El=new Gs,bt=class{constructor(e,t,s=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=s}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let s=this.optCompleteServerCache_!=null?new ne(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Si(this.writes_,e,s)}}getChildAfterChild(e,t,s){let i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Re(this.viewCache_),r=oh(this.writes_,i,t,1,s,e);return r.length===0?null:r[0]}};function lh(n){return{filter:n}}function ah(n,e){f(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),f(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function ch(n,e,t,s,i){let r=new Vs,o,l;if(t.type===Z.OVERWRITE){let c=t;c.source.fromUser?o=js(n,e,c.path,c.snap,s,i,r):(f(c.source.fromServer,"Unknown source."),l=c.source.tagged||e.serverCache.isFiltered()&&!v(c.path),o=pn(n,e,c.path,c.snap,s,i,l,r))}else if(t.type===Z.MERGE){let c=t;c.source.fromUser?o=uh(n,e,c.path,c.children,s,i,r):(f(c.source.fromServer,"Unknown source."),l=c.source.tagged||e.serverCache.isFiltered(),o=Hs(n,e,c.path,c.children,s,i,l,r))}else if(t.type===Z.ACK_USER_WRITE){let c=t;c.revert?o=_h(n,e,c.path,s,i,r):o=dh(n,e,c.path,c.affectedTree,s,i,r)}else if(t.type===Z.LISTEN_COMPLETE)o=fh(n,e,t.path,s,r);else throw We("Unknown operation type: "+t.type);let a=r.getChanges();return hh(e,o,a),{viewCache:o,changes:a}}function hh(n,e,t){let s=e.eventCache;if(s.isFullyInitialized()){let i=s.getNode().isLeafNode()||s.getNode().isEmpty(),r=dn(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!s.getNode().equals(r)||!s.getNode().getPriority().equals(r.getPriority()))&&t.push(pl(dn(e)))}}function Tl(n,e,t,s,i,r){let o=e.eventCache;if(_n(s,t)!=null)return e;{let l,a;if(v(t))if(f(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let c=Re(e),h=c instanceof m?c:m.EMPTY_NODE,u=Ii(s,h);l=n.filter.updateFullNode(e.eventCache.getNode(),u,r)}else{let c=fn(s,Re(e));l=n.filter.updateFullNode(e.eventCache.getNode(),c,r)}else{let c=y(t);if(c===".priority"){f(ge(t)===1,"Can't have a priority with additional path components");let h=o.getNode();a=e.serverCache.getNode();let u=ko(s,t,h,a);u!=null?l=n.filter.updatePriority(h,u):l=o.getNode()}else{let h=I(t),u;if(o.isCompleteForChild(c)){a=e.serverCache.getNode();let d=ko(s,t,o.getNode(),a);d!=null?u=o.getNode().getImmediateChild(c).updateChild(h,d):u=o.getNode().getImmediateChild(c)}else u=Si(s,c,e.serverCache);u!=null?l=n.filter.updateChild(o.getNode(),c,u,h,i,r):l=o.getNode()}}return pt(e,l,o.isFullyInitialized()||v(t),n.filter.filtersNodes())}}function pn(n,e,t,s,i,r,o,l){let a=e.serverCache,c,h=o?n.filter:n.filter.getIndexedFilter();if(v(t))c=h.updateFullNode(a.getNode(),s,null);else if(h.filtersNodes()&&!a.isFiltered()){let _=a.getNode().updateChild(t,s);c=h.updateFullNode(a.getNode(),_,null)}else{let _=y(t);if(!a.isCompleteForPath(t)&&ge(t)>1)return e;let p=I(t),P=a.getNode().getImmediateChild(_).updateChild(p,s);_===".priority"?c=h.updatePriority(a.getNode(),P):c=h.updateChild(a.getNode(),_,P,p,El,null)}let u=gl(e,c,a.isFullyInitialized()||v(t),h.filtersNodes()),d=new bt(i,u,r);return Tl(n,u,t,i,d,l)}function js(n,e,t,s,i,r,o){let l=e.eventCache,a,c,h=new bt(i,e,r);if(v(t))c=n.filter.updateFullNode(e.eventCache.getNode(),s,o),a=pt(e,c,!0,n.filter.filtersNodes());else{let u=y(t);if(u===".priority")c=n.filter.updatePriority(e.eventCache.getNode(),s),a=pt(e,c,l.isFullyInitialized(),l.isFiltered());else{let d=I(t),_=l.getNode().getImmediateChild(u),p;if(v(d))p=s;else{let T=h.getCompleteChild(u);T!=null?gi(d)===".priority"&&T.getChild(cl(d)).isEmpty()?p=T:p=T.updateChild(d,s):p=m.EMPTY_NODE}if(_.equals(p))a=e;else{let T=n.filter.updateChild(l.getNode(),u,p,d,h,o);a=pt(e,T,l.isFullyInitialized(),n.filter.filtersNodes())}}}return a}function Ao(n,e){return n.eventCache.isCompleteForChild(e)}function uh(n,e,t,s,i,r,o){let l=e;return s.foreach((a,c)=>{let h=b(t,a);Ao(e,y(h))&&(l=js(n,l,h,c,i,r,o))}),s.foreach((a,c)=>{let h=b(t,a);Ao(e,y(h))||(l=js(n,l,h,c,i,r,o))}),l}function xo(n,e,t){return t.foreach((s,i)=>{e=e.updateChild(s,i)}),e}function Hs(n,e,t,s,i,r,o,l){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let a=e,c;v(t)?c=s:c=new F(null).setTree(t,s);let h=e.serverCache.getNode();return c.children.inorderTraversal((u,d)=>{if(h.hasChild(u)){let _=e.serverCache.getNode().getImmediateChild(u),p=xo(n,_,d);a=pn(n,a,new E(u),p,i,r,o,l)}}),c.children.inorderTraversal((u,d)=>{let _=!e.serverCache.isCompleteForChild(u)&&d.value===null;if(!h.hasChild(u)&&!_){let p=e.serverCache.getNode().getImmediateChild(u),T=xo(n,p,d);a=pn(n,a,new E(u),T,i,r,o,l)}}),a}function dh(n,e,t,s,i,r,o){if(_n(i,t)!=null)return e;let l=e.serverCache.isFiltered(),a=e.serverCache;if(s.value!=null){if(v(t)&&a.isFullyInitialized()||a.isCompleteForPath(t))return pn(n,e,t,a.getNode().getChild(t),i,r,l,o);if(v(t)){let c=new F(null);return a.getNode().forEachChild(ee,(h,u)=>{c=c.set(new E(h),u)}),Hs(n,e,t,c,i,r,l,o)}else return e}else{let c=new F(null);return s.foreach((h,u)=>{let d=b(t,h);a.isCompleteForPath(d)&&(c=c.set(h,a.getNode().getChild(d)))}),Hs(n,e,t,c,i,r,l,o)}}function fh(n,e,t,s,i){let r=e.serverCache,o=gl(e,r.getNode(),r.isFullyInitialized()||v(t),r.isFiltered());return Tl(n,o,t,s,El,i)}function _h(n,e,t,s,i,r){let o;if(_n(s,t)!=null)return e;{let l=new bt(s,e,i),a=e.eventCache.getNode(),c;if(v(t)||y(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=fn(s,Re(e));else{let u=e.serverCache.getNode();f(u instanceof m,"serverChildren would be complete if leaf node"),h=Ii(s,u)}h=h,c=n.filter.updateFullNode(a,h,r)}else{let h=y(t),u=Si(s,h,e.serverCache);u==null&&e.serverCache.isCompleteForChild(h)&&(u=a.getImmediateChild(h)),u!=null?c=n.filter.updateChild(a,h,u,I(t),l,r):e.eventCache.getNode().hasChild(h)?c=n.filter.updateChild(a,h,m.EMPTY_NODE,I(t),l,r):c=a,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=fn(s,Re(e)),o.isLeafNode()&&(c=n.filter.updateFullNode(c,o,r)))}return o=e.serverCache.isFullyInitialized()||_n(s,C())!=null,pt(e,c,o,n.filter.filtersNodes())}}var Ks=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let s=this.query_._queryParams,i=new Tt(s.getIndex()),r=Mc(s);this.processor_=lh(r);let o=t.serverCache,l=t.eventCache,a=i.updateFullNode(m.EMPTY_NODE,o.getNode(),null),c=r.updateFullNode(m.EMPTY_NODE,l.getNode(),null),h=new ne(a,o.isFullyInitialized(),i.filtersNodes()),u=new ne(c,l.isFullyInitialized(),r.filtersNodes());this.viewCache_=Pn(u,h),this.eventGenerator_=new Fs(this.query_)}get query(){return this.query_}};function ph(n){return n.viewCache_.serverCache.getNode()}function gh(n){return dn(n.viewCache_)}function mh(n,e){let t=Re(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!v(e)&&!t.getImmediateChild(y(e)).isEmpty())?t.getChild(e):null}function Oo(n){return n.eventRegistrations_.length===0}function yh(n,e){n.eventRegistrations_.push(e)}function Do(n,e,t){let s=[];if(t){f(e==null,"A cancel should cancel all event registrations.");let i=n.query._path;n.eventRegistrations_.forEach(r=>{let o=r.createCancelEvent(t,i);o&&s.push(o)})}if(e){let i=[];for(let r=0;r<n.eventRegistrations_.length;++r){let o=n.eventRegistrations_[r];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(n.eventRegistrations_.slice(r+1));break}}n.eventRegistrations_=i}else n.eventRegistrations_=[];return s}function Mo(n,e,t,s){e.type===Z.MERGE&&e.source.queryId!==null&&(f(Re(n.viewCache_),"We should always have a full cache before handling merges"),f(dn(n.viewCache_),"Missing event cache, even though we have a server cache"));let i=n.viewCache_,r=ch(n.processor_,i,e,t,s);return ah(n.processor_,r.viewCache),f(r.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,Il(n,r.changes,r.viewCache.eventCache.getNode(),null)}function vh(n,e){let t=n.viewCache_.eventCache,s=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(S,(r,o)=>{s.push(Ye(r,o))}),t.isFullyInitialized()&&s.push(pl(t.getNode())),Il(n,s,t.getNode(),e)}function Il(n,e,t,s){let i=s?[s]:n.eventRegistrations_;return jc(n.eventGenerator_,e,t,i)}var gn,mn=class{constructor(){this.views=new Map}};function wh(n){f(!gn,"__referenceConstructor has already been defined"),gn=n}function Ch(){return f(gn,"Reference.ts has not been loaded"),gn}function Eh(n){return n.views.size===0}function bi(n,e,t,s){let i=e.source.queryId;if(i!==null){let r=n.views.get(i);return f(r!=null,"SyncTree gave us an op for an invalid query."),Mo(r,e,t,s)}else{let r=[];for(let o of n.views.values())r=r.concat(Mo(o,e,t,s));return r}}function Sl(n,e,t,s,i){let r=e._queryIdentifier,o=n.views.get(r);if(!o){let l=fn(t,i?s:null),a=!1;l?a=!0:s instanceof m?(l=Ii(t,s),a=!1):(l=m.EMPTY_NODE,a=!1);let c=Pn(new ne(l,a,!1),new ne(s,i,!1));return new Ks(e,c)}return o}function Th(n,e,t,s,i,r){let o=Sl(n,e,s,i,r);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),yh(o,t),vh(o,t)}function Ih(n,e,t,s){let i=e._queryIdentifier,r=[],o=[],l=me(n);if(i==="default")for(let[a,c]of n.views.entries())o=o.concat(Do(c,t,s)),Oo(c)&&(n.views.delete(a),c.query._queryParams.loadsAllData()||r.push(c.query));else{let a=n.views.get(i);a&&(o=o.concat(Do(a,t,s)),Oo(a)&&(n.views.delete(i),a.query._queryParams.loadsAllData()||r.push(a.query)))}return l&&!me(n)&&r.push(new(Ch())(e._repo,e._path)),{removed:r,events:o}}function bl(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function _e(n,e){let t=null;for(let s of n.views.values())t=t||mh(s,e);return t}function Nl(n,e){if(e._queryParams.loadsAllData())return An(n);{let s=e._queryIdentifier;return n.views.get(s)}}function Rl(n,e){return Nl(n,e)!=null}function me(n){return An(n)!=null}function An(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var yn;function Sh(n){f(!yn,"__referenceConstructor has already been defined"),yn=n}function bh(){return f(yn,"Reference.ts has not been loaded"),yn}var Nh=1,vn=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new F(null),this.pendingWriteTree_=rh(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function Ni(n,e,t,s,i){return Yc(n.pendingWriteTree_,e,t,s,i),i?et(n,new qe(Ci(),e,t)):[]}function Rh(n,e,t,s){qc(n.pendingWriteTree_,e,t,s);let i=F.fromObject(t);return et(n,new St(Ci(),e,i))}function de(n,e,t=!1){let s=zc(n.pendingWriteTree_,e);if($c(n.pendingWriteTree_,e)){let r=new F(null);return s.snap!=null?r=r.set(C(),!0):O(s.children,o=>{r=r.set(new E(o),!0)}),et(n,new Ls(s.path,r,t))}else return[]}function Mt(n,e,t){return et(n,new qe(Ei(),e,t))}function Ph(n,e,t){let s=F.fromObject(t);return et(n,new St(Ei(),e,s))}function kh(n,e){return et(n,new un(Ei(),e))}function Ah(n,e,t){let s=Ri(n,t);if(s){let i=Pi(s),r=i.path,o=i.queryId,l=L(r,e),a=new un(Ti(o),l);return ki(n,r,a)}else return[]}function wn(n,e,t,s,i=!1){let r=e._path,o=n.syncPointTree_.get(r),l=[];if(o&&(e._queryIdentifier==="default"||Rl(o,e))){let a=Ih(o,e,t,s);Eh(o)&&(n.syncPointTree_=n.syncPointTree_.remove(r));let c=a.removed;if(l=a.events,!i){let h=c.findIndex(d=>d._queryParams.loadsAllData())!==-1,u=n.syncPointTree_.findOnPath(r,(d,_)=>me(_));if(h&&!u){let d=n.syncPointTree_.subtree(r);if(!d.isEmpty()){let _=Dh(d);for(let p=0;p<_.length;++p){let T=_[p],P=T.query,Ce=xl(n,T);n.listenProvider_.startListening(mt(P),Nt(n,P),Ce.hashFn,Ce.onComplete)}}}!u&&c.length>0&&!s&&(h?n.listenProvider_.stopListening(mt(e),null):c.forEach(d=>{let _=n.queryToTagMap.get(On(d));n.listenProvider_.stopListening(mt(d),_)}))}Mh(n,c)}return l}function Pl(n,e,t,s){let i=Ri(n,s);if(i!=null){let r=Pi(i),o=r.path,l=r.queryId,a=L(o,e),c=new qe(Ti(l),a,t);return ki(n,o,c)}else return[]}function xh(n,e,t,s){let i=Ri(n,s);if(i){let r=Pi(i),o=r.path,l=r.queryId,a=L(o,e),c=F.fromObject(t),h=new St(Ti(l),a,c);return ki(n,o,h)}else return[]}function Qs(n,e,t,s=!1){let i=e._path,r=null,o=!1;n.syncPointTree_.foreachOnPath(i,(d,_)=>{let p=L(d,i);r=r||_e(_,p),o=o||me(_)});let l=n.syncPointTree_.get(i);l?(o=o||me(l),r=r||_e(l,C())):(l=new mn,n.syncPointTree_=n.syncPointTree_.set(i,l));let a;r!=null?a=!0:(a=!1,r=m.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((_,p)=>{let T=_e(p,C());T&&(r=r.updateImmediateChild(_,T))}));let c=Rl(l,e);if(!c&&!e._queryParams.loadsAllData()){let d=On(e);f(!n.queryToTagMap.has(d),"View does not exist, but we have a tag");let _=Lh();n.queryToTagMap.set(d,_),n.tagToQueryMap.set(_,d)}let h=kn(n.pendingWriteTree_,i),u=Th(l,e,t,h,r,a);if(!c&&!o&&!s){let d=Nl(l,e);u=u.concat(Fh(n,e,d))}return u}function xn(n,e,t){let i=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(e,(o,l)=>{let a=L(o,e),c=_e(l,a);if(c)return c});return vl(i,e,r,t,!0)}function Oh(n,e){let t=e._path,s=null;n.syncPointTree_.foreachOnPath(t,(c,h)=>{let u=L(c,t);s=s||_e(h,u)});let i=n.syncPointTree_.get(t);i?s=s||_e(i,C()):(i=new mn,n.syncPointTree_=n.syncPointTree_.set(t,i));let r=s!=null,o=r?new ne(s,!0,!1):null,l=kn(n.pendingWriteTree_,e._path),a=Sl(i,e,l,r?o.getNode():m.EMPTY_NODE,r);return gh(a)}function et(n,e){return kl(e,n.syncPointTree_,null,kn(n.pendingWriteTree_,C()))}function kl(n,e,t,s){if(v(n.path))return Al(n,e,t,s);{let i=e.get(C());t==null&&i!=null&&(t=_e(i,C()));let r=[],o=y(n.path),l=n.operationForChild(o),a=e.children.get(o);if(a&&l){let c=t?t.getImmediateChild(o):null,h=wl(s,o);r=r.concat(kl(l,a,c,h))}return i&&(r=r.concat(bi(i,n,s,t))),r}}function Al(n,e,t,s){let i=e.get(C());t==null&&i!=null&&(t=_e(i,C()));let r=[];return e.children.inorderTraversal((o,l)=>{let a=t?t.getImmediateChild(o):null,c=wl(s,o),h=n.operationForChild(o);h&&(r=r.concat(Al(h,l,a,c)))}),i&&(r=r.concat(bi(i,n,s,t))),r}function xl(n,e){let t=e.query,s=Nt(n,t);return{hashFn:()=>(ph(e)||m.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return s?Ah(n,t._path,s):kh(n,t._path);{let r=Ya(i,t);return wn(n,t,null,r)}}}}function Nt(n,e){let t=On(e);return n.queryToTagMap.get(t)}function On(n){return n._path.toString()+"$"+n._queryIdentifier}function Ri(n,e){return n.tagToQueryMap.get(e)}function Pi(n){let e=n.indexOf("$");return f(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new E(n.substr(0,e))}}function ki(n,e,t){let s=n.syncPointTree_.get(e);f(s,"Missing sync point for query tag that we're tracking");let i=kn(n.pendingWriteTree_,e);return bi(s,t,i,null)}function Dh(n){return n.fold((e,t,s)=>{if(t&&me(t))return[An(t)];{let i=[];return t&&(i=bl(t)),O(s,(r,o)=>{i=i.concat(o)}),i}})}function mt(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(bh())(n._repo,n._path):n}function Mh(n,e){for(let t=0;t<e.length;++t){let s=e[t];if(!s._queryParams.loadsAllData()){let i=On(s),r=n.queryToTagMap.get(i);n.queryToTagMap.delete(i),n.tagToQueryMap.delete(r)}}}function Lh(){return Nh++}function Fh(n,e,t){let s=e._path,i=Nt(n,e),r=xl(n,t),o=n.listenProvider_.startListening(mt(e),i,r.hashFn,r.onComplete),l=n.syncPointTree_.subtree(s);if(i)f(!me(l.value),"If we're adding a query, it shouldn't be shadowed");else{let a=l.fold((c,h,u)=>{if(!v(c)&&h&&me(h))return[An(h).query];{let d=[];return h&&(d=d.concat(bl(h).map(_=>_.query))),O(u,(_,p)=>{d=d.concat(p)}),d}});for(let c=0;c<a.length;++c){let h=a[c];n.listenProvider_.stopListening(mt(h),Nt(n,h))}}return o}var Ys=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},qs=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=b(this.path_,e);return new n(this.syncTree_,t)}node(){return xn(this.syncTree_,this.path_)}},Wh=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},Lo=function(n,e,t){if(!n||typeof n!="object")return n;if(f(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return Uh(n[".sv"],e,t);if(typeof n[".sv"]=="object")return Bh(n[".sv"],e);f(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},Uh=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:f(!1,"Unexpected server value: "+n)}},Bh=function(n,e,t){n.hasOwnProperty("increment")||f(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let s=n.increment;typeof s!="number"&&f(!1,"Unexpected increment value: "+s);let i=e.node();if(f(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return s;let o=i.getValue();return typeof o!="number"?s:o+s},Ol=function(n,e,t,s){return xi(e,new qs(t,n),s)},Ai=function(n,e,t){return xi(n,new Ys(e),t)};function xi(n,e,t){let s=n.getPriority().val(),i=Lo(s,e.getImmediateChild(".priority"),t),r;if(n.isLeafNode()){let o=n,l=Lo(o.getValue(),e,t);return l!==o.getValue()||i!==o.getPriority().val()?new Ke(l,N(i)):n}else{let o=n;return r=o,i!==o.getPriority().val()&&(r=r.updatePriority(new Ke(i))),o.forEachChild(S,(l,a)=>{let c=xi(a,e.getImmediateChild(l),t);c!==a&&(r=r.updateImmediateChild(l,c))}),r}}var Rt=class{constructor(e="",t=null,s={children:{},childCount:0}){this.name=e,this.parent=t,this.node=s}};function Dn(n,e){let t=e instanceof E?e:new E(e),s=n,i=y(t);for(;i!==null;){let r=ue(s.node.children,i)||{children:{},childCount:0};s=new Rt(i,s,r),t=I(t),i=y(t)}return s}function Ae(n){return n.node.value}function Oi(n,e){n.node.value=e,zs(n)}function Dl(n){return n.node.childCount>0}function Vh(n){return Ae(n)===void 0&&!Dl(n)}function Mn(n,e){O(n.node.children,(t,s)=>{e(new Rt(t,n,s))})}function Ml(n,e,t,s){t&&!s&&e(n),Mn(n,i=>{Ml(i,e,!0,s)}),t&&s&&e(n)}function Gh(n,e,t){let s=t?n:n.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function Lt(n){return new E(n.parent===null?n.name:Lt(n.parent)+"/"+n.name)}function zs(n){n.parent!==null&&jh(n.parent,n.name,n)}function jh(n,e,t){let s=Vh(t),i=Q(n.node.children,e);s&&i?(delete n.node.children[e],n.node.childCount--,zs(n)):!s&&!i&&(n.node.children[e]=t.node,n.node.childCount++,zs(n))}var Hh=/[\[\].#$\/\u0000-\u001F\u007F]/,Kh=/[\[\].#$\u0000-\u001F\u007F]/,os=10*1024*1024,Ln=function(n){return typeof n=="string"&&n.length!==0&&!Hh.test(n)},Ll=function(n){return typeof n=="string"&&n.length!==0&&!Kh.test(n)},Qh=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Ll(n)},Pt=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Nn(n)||n&&typeof n=="object"&&Q(n,".sv")},se=function(n,e,t,s){s&&e===void 0||Ft(B(n,"value"),e,t)},Ft=function(n,e,t){let s=t instanceof E?new vs(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+Se(s));if(typeof e=="function")throw new Error(n+"contains a function "+Se(s)+" with contents = "+e.toString());if(Nn(e))throw new Error(n+"contains "+e.toString()+" "+Se(s));if(typeof e=="string"&&e.length>os/3&&at(e)>os)throw new Error(n+"contains a string greater than "+os+" utf8 bytes "+Se(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,r=!1;if(O(e,(o,l)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!Ln(o)))throw new Error(n+" contains an invalid key ("+o+") "+Se(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Ec(s,o),Ft(n,l,s),Tc(s)}),i&&r)throw new Error(n+' contains ".value" child '+Se(s)+" in addition to actual children.")}},Yh=function(n,e){let t,s;for(t=0;t<e.length;t++){s=e[t];let r=vt(s);for(let o=0;o<r.length;o++)if(!(r[o]===".priority"&&o===r.length-1)){if(!Ln(r[o]))throw new Error(n+"contains an invalid key ("+r[o]+") in path "+s.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(Cc);let i=null;for(t=0;t<e.length;t++){if(s=e[t],i!==null&&Y(i,s))throw new Error(n+"contains a path "+i.toString()+" that is ancestor of another path "+s.toString());i=s}},Fl=function(n,e,t,s){if(s&&e===void 0)return;let i=B(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");let r=[];O(e,(o,l)=>{let a=new E(o);if(Ft(i,l,b(t,a)),gi(a)===".priority"&&!Pt(l))throw new Error(i+"contains an invalid value for '"+a.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(a)}),Yh(i,r)},Di=function(n,e,t){if(!(t&&e===void 0)){if(Nn(e))throw new Error(B(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Pt(e))throw new Error(B(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Wt=function(n,e,t,s){if(!(s&&t===void 0)&&!Ln(t))throw new Error(B(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},tt=function(n,e,t,s){if(!(s&&t===void 0)&&!Ll(t))throw new Error(B(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},qh=function(n,e,t,s){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),tt(n,e,t,s)},G=function(n,e){if(y(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},Wl=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Ln(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!Qh(t))throw new Error(B(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var $s=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function Fn(n,e){let t=null;for(let s=0;s<e.length;s++){let i=e[s],r=i.getPath();t!==null&&!mi(r,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:r}),t.events.push(i)}t&&n.eventLists_.push(t)}function Ul(n,e,t){Fn(n,t),Bl(n,s=>mi(s,e))}function j(n,e,t){Fn(n,t),Bl(n,s=>Y(s,e)||Y(e,s))}function Bl(n,e){n.recursionDepth_++;let t=!0;for(let s=0;s<n.eventLists_.length;s++){let i=n.eventLists_[s];if(i){let r=i.path;e(r)?(zh(n.eventLists_[s]),n.eventLists_[s]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function zh(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let s=t.getEventRunner();Ne&&x("event: "+t.toString()),Je(s)}}}var Vl="repo_interrupt",$h=25,Xs=class{constructor(e,t,s,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=s,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new $s,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=hn(),this.transactionQueueTree_=new Rt,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function Xh(n,e,t){if(n.stats_=pi(n.repoInfo_),n.forceRestClient_||Xa())n.server_=new ks(n.repoInfo_,(s,i,r,o)=>{Fo(n,s,i,r,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Wo(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{R(t)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}n.persistentConnection_=new yi(n.repoInfo_,e,(s,i,r,o)=>{Fo(n,s,i,r,o)},s=>{Wo(n,s)},s=>{Jh(n,s)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(s=>{n.server_.refreshAuthToken(s)}),n.appCheckProvider_.addTokenChangeListener(s=>{n.server_.refreshAppCheckToken(s.token)}),n.statsReporter_=Za(n.repoInfo_,()=>new Ms(n.stats_,n.server_)),n.infoData_=new As,n.infoSyncTree_=new vn({startListening:(s,i,r,o)=>{let l=[],a=n.infoData_.getNode(s._path);return a.isEmpty()||(l=Mt(n.infoSyncTree_,s._path,a),setTimeout(()=>{o("ok")},0)),l},stopListening:()=>{}}),Mi(n,"connected",!1),n.serverSyncTree_=new vn({startListening:(s,i,r,o)=>(n.server_.listen(s,r,i,(l,a)=>{let c=o(l,a);j(n.eventQueue_,s._path,c)}),[]),stopListening:(s,i)=>{n.server_.unlisten(s,i)}})}function Gl(n){let t=n.infoData_.getNode(new E(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Ut(n){return Wh({timestamp:Gl(n)})}function Fo(n,e,t,s,i){n.dataUpdateCount++;let r=new E(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(s){let a=lt(t,c=>N(c));o=xh(n.serverSyncTree_,r,a,i)}else{let a=N(t);o=Pl(n.serverSyncTree_,r,a,i)}else if(s){let a=lt(t,c=>N(c));o=Ph(n.serverSyncTree_,r,a)}else{let a=N(t);o=Mt(n.serverSyncTree_,r,a)}let l=r;o.length>0&&(l=$e(n,r)),j(n.eventQueue_,l,o)}function Wo(n,e){Mi(n,"connected",e),e===!1&&tu(n)}function Jh(n,e){O(e,(t,s)=>{Mi(n,t,s)})}function Mi(n,e,t){let s=new E("/.info/"+e),i=N(t);n.infoData_.updateSnapshot(s,i);let r=Mt(n.infoSyncTree_,s,i);j(n.eventQueue_,s,r)}function Wn(n){return n.nextWriteId_++}function Zh(n,e,t){let s=Oh(n.serverSyncTree_,e);return s!=null?Promise.resolve(s):n.server_.get(e).then(i=>{let r=N(i).withIndex(e._queryParams.getIndex());Qs(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=Mt(n.serverSyncTree_,e._path,r);else{let l=Nt(n.serverSyncTree_,e);o=Pl(n.serverSyncTree_,e._path,r,l)}return j(n.eventQueue_,e._path,o),wn(n.serverSyncTree_,e,t,null,!0),r},i=>(nt(n,"get for query "+R(e)+" failed: "+i),Promise.reject(new Error(i))))}function Li(n,e,t,s,i){nt(n,"set",{path:e.toString(),value:t,priority:s});let r=Ut(n),o=N(t,s),l=xn(n.serverSyncTree_,e),a=Ai(o,l,r),c=Wn(n),h=Ni(n.serverSyncTree_,e,a,c,!0);Fn(n.eventQueue_,h),n.server_.put(e.toString(),o.val(!0),(d,_)=>{let p=d==="ok";p||D("set at "+e+" failed: "+d);let T=de(n.serverSyncTree_,c,!p);j(n.eventQueue_,e,T),ye(n,i,d,_)});let u=Wi(n,e);$e(n,u),j(n.eventQueue_,u,[])}function eu(n,e,t,s){nt(n,"update",{path:e.toString(),value:t});let i=!0,r=Ut(n),o={};if(O(t,(l,a)=>{i=!1,o[l]=Ol(b(e,l),N(a),n.serverSyncTree_,r)}),i)x("update() called with empty data.  Don't do anything."),ye(n,s,"ok",void 0);else{let l=Wn(n),a=Rh(n.serverSyncTree_,e,o,l);Fn(n.eventQueue_,a),n.server_.merge(e.toString(),t,(c,h)=>{let u=c==="ok";u||D("update at "+e+" failed: "+c);let d=de(n.serverSyncTree_,l,!u),_=d.length>0?$e(n,e):e;j(n.eventQueue_,_,d),ye(n,s,c,h)}),O(t,c=>{let h=Wi(n,b(e,c));$e(n,h)}),j(n.eventQueue_,e,[])}}function tu(n){nt(n,"onDisconnectEvents");let e=Ut(n),t=hn();Os(n.onDisconnect_,C(),(i,r)=>{let o=Ol(i,r,n.serverSyncTree_,e);Ze(t,i,o)});let s=[];Os(t,C(),(i,r)=>{s=s.concat(Mt(n.serverSyncTree_,i,r));let o=Wi(n,i);$e(n,o)}),n.onDisconnect_=hn(),j(n.eventQueue_,C(),s)}function nu(n,e,t){n.server_.onDisconnectCancel(e.toString(),(s,i)=>{s==="ok"&&xs(n.onDisconnect_,e),ye(n,t,s,i)})}function Uo(n,e,t,s){let i=N(t);n.server_.onDisconnectPut(e.toString(),i.val(!0),(r,o)=>{r==="ok"&&Ze(n.onDisconnect_,e,i),ye(n,s,r,o)})}function su(n,e,t,s,i){let r=N(t,s);n.server_.onDisconnectPut(e.toString(),r.val(!0),(o,l)=>{o==="ok"&&Ze(n.onDisconnect_,e,r),ye(n,i,o,l)})}function iu(n,e,t,s){if(qt(t)){x("onDisconnect().update() called with empty data.  Don't do anything."),ye(n,s,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(i,r)=>{i==="ok"&&O(t,(o,l)=>{let a=N(l);Ze(n.onDisconnect_,b(e,o),a)}),ye(n,s,i,r)})}function ru(n,e,t){let s;y(e._path)===".info"?s=Qs(n.infoSyncTree_,e,t):s=Qs(n.serverSyncTree_,e,t),Ul(n.eventQueue_,e._path,s)}function Js(n,e,t){let s;y(e._path)===".info"?s=wn(n.infoSyncTree_,e,t):s=wn(n.serverSyncTree_,e,t),Ul(n.eventQueue_,e._path,s)}function jl(n){n.persistentConnection_&&n.persistentConnection_.interrupt(Vl)}function ou(n){n.persistentConnection_&&n.persistentConnection_.resume(Vl)}function nt(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),x(t,...e)}function ye(n,e,t,s){e&&Je(()=>{if(t==="ok")e(null);else{let i=(t||"error").toUpperCase(),r=i;s&&(r+=": "+s);let o=new Error(r);o.code=i,e(o)}})}function lu(n,e,t,s,i,r){nt(n,"transaction on "+e);let o={path:e,update:t,onComplete:s,status:null,order:Go(),applyLocally:r,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},l=Fi(n,e,void 0);o.currentInputSnapshot=l;let a=o.update(l.val());if(a===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Ft("transaction failed: Data returned ",a,o.path),o.status=0;let c=Dn(n.transactionQueueTree_,e),h=Ae(c)||[];h.push(o),Oi(c,h);let u;typeof a=="object"&&a!==null&&Q(a,".priority")?(u=ue(a,".priority"),f(Pt(u),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):u=(xn(n.serverSyncTree_,e)||m.EMPTY_NODE).getPriority().val();let d=Ut(n),_=N(a,u),p=Ai(_,l,d);o.currentOutputSnapshotRaw=_,o.currentOutputSnapshotResolved=p,o.currentWriteId=Wn(n);let T=Ni(n.serverSyncTree_,e,p,o.currentWriteId,o.applyLocally);j(n.eventQueue_,e,T),Un(n,n.transactionQueueTree_)}}function Fi(n,e,t){return xn(n.serverSyncTree_,e,t)||m.EMPTY_NODE}function Un(n,e=n.transactionQueueTree_){if(e||Bn(n,e),Ae(e)){let t=Kl(n,e);f(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&au(n,Lt(e),t)}else Dl(e)&&Mn(e,t=>{Un(n,t)})}function au(n,e,t){let s=t.map(c=>c.currentWriteId),i=Fi(n,e,s),r=i,o=i.hash();for(let c=0;c<t.length;c++){let h=t[c];f(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;let u=L(e,h.path);r=r.updateChild(u,h.currentOutputSnapshotRaw)}let l=r.val(!0),a=e;n.server_.put(a.toString(),l,c=>{nt(n,"transaction put response",{path:a.toString(),status:c});let h=[];if(c==="ok"){let u=[];for(let d=0;d<t.length;d++)t[d].status=2,h=h.concat(de(n.serverSyncTree_,t[d].currentWriteId)),t[d].onComplete&&u.push(()=>t[d].onComplete(null,!0,t[d].currentOutputSnapshotResolved)),t[d].unwatcher();Bn(n,Dn(n.transactionQueueTree_,e)),Un(n,n.transactionQueueTree_),j(n.eventQueue_,e,h);for(let d=0;d<u.length;d++)Je(u[d])}else{if(c==="datastale")for(let u=0;u<t.length;u++)t[u].status===3?t[u].status=4:t[u].status=0;else{D("transaction at "+a.toString()+" failed: "+c);for(let u=0;u<t.length;u++)t[u].status=4,t[u].abortReason=c}$e(n,e)}},o)}function $e(n,e){let t=Hl(n,e),s=Lt(t),i=Kl(n,t);return cu(n,i,s),s}function cu(n,e,t){if(e.length===0)return;let s=[],i=[],o=e.filter(l=>l.status===0).map(l=>l.currentWriteId);for(let l=0;l<e.length;l++){let a=e[l],c=L(t,a.path),h=!1,u;if(f(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),a.status===4)h=!0,u=a.abortReason,i=i.concat(de(n.serverSyncTree_,a.currentWriteId,!0));else if(a.status===0)if(a.retryCount>=$h)h=!0,u="maxretry",i=i.concat(de(n.serverSyncTree_,a.currentWriteId,!0));else{let d=Fi(n,a.path,o);a.currentInputSnapshot=d;let _=e[l].update(d.val());if(_!==void 0){Ft("transaction failed: Data returned ",_,a.path);let p=N(_);typeof _=="object"&&_!=null&&Q(_,".priority")||(p=p.updatePriority(d.getPriority()));let P=a.currentWriteId,Ce=Ut(n),oe=Ai(p,d,Ce);a.currentOutputSnapshotRaw=p,a.currentOutputSnapshotResolved=oe,a.currentWriteId=Wn(n),o.splice(o.indexOf(P),1),i=i.concat(Ni(n.serverSyncTree_,a.path,oe,a.currentWriteId,a.applyLocally)),i=i.concat(de(n.serverSyncTree_,P,!0))}else h=!0,u="nodata",i=i.concat(de(n.serverSyncTree_,a.currentWriteId,!0))}j(n.eventQueue_,t,i),i=[],h&&(e[l].status=2,function(d){setTimeout(d,Math.floor(0))}(e[l].unwatcher),e[l].onComplete&&(u==="nodata"?s.push(()=>e[l].onComplete(null,!1,e[l].currentInputSnapshot)):s.push(()=>e[l].onComplete(new Error(u),!1,null))))}Bn(n,n.transactionQueueTree_);for(let l=0;l<s.length;l++)Je(s[l]);Un(n,n.transactionQueueTree_)}function Hl(n,e){let t,s=n.transactionQueueTree_;for(t=y(e);t!==null&&Ae(s)===void 0;)s=Dn(s,t),e=I(e),t=y(e);return s}function Kl(n,e){let t=[];return Ql(n,e,t),t.sort((s,i)=>s.order-i.order),t}function Ql(n,e,t){let s=Ae(e);if(s)for(let i=0;i<s.length;i++)t.push(s[i]);Mn(e,i=>{Ql(n,i,t)})}function Bn(n,e){let t=Ae(e);if(t){let s=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[s]=t[i],s++);t.length=s,Oi(e,t.length>0?t:void 0)}Mn(e,s=>{Bn(n,s)})}function Wi(n,e){let t=Lt(Hl(n,e)),s=Dn(n.transactionQueueTree_,e);return Gh(s,i=>{ls(n,i)}),ls(n,s),Ml(s,i=>{ls(n,i)}),t}function ls(n,e){let t=Ae(e);if(t){let s=[],i=[],r=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(f(r===o-1,"All SENT items should be at beginning of queue."),r=o,t[o].status=3,t[o].abortReason="set"):(f(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat(de(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&s.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?Oi(e,void 0):t.length=r+1,j(n.eventQueue_,Lt(e),i);for(let o=0;o<s.length;o++)Je(s[o])}}function hu(n){let e="",t=n.split("/");for(let s=0;s<t.length;s++)if(t[s].length>0){let i=t[s];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function uu(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let s=t.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):D(`Invalid query segment '${t}' in query '${n}'`)}return e}var Zs=function(n,e){let t=du(n),s=t.namespace;t.domain==="firebase.com"&&te(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&t.domain!=="localhost"&&te("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||Ga();let i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new tn(t.host,t.secure,s,i,e,"",s!==t.subdomain),path:new E(t.pathString)}},du=function(n){let e="",t="",s="",i="",r="",o=!0,l="https",a=443;if(typeof n=="string"){let c=n.indexOf("//");c>=0&&(l=n.substring(0,c-1),n=n.substring(c+2));let h=n.indexOf("/");h===-1&&(h=n.length);let u=n.indexOf("?");u===-1&&(u=n.length),e=n.substring(0,Math.min(h,u)),h<u&&(i=hu(n.substring(h,u)));let d=uu(n.substring(Math.min(n.length,u)));c=e.indexOf(":"),c>=0?(o=l==="https"||l==="wss",a=parseInt(e.substring(c+1),10)):c=e.length;let _=e.slice(0,c);if(_.toLowerCase()==="localhost")t="localhost";else if(_.split(".").length<=2)t=_;else{let p=e.indexOf(".");s=e.substring(0,p).toLowerCase(),t=e.substring(p+1),r=s}"ns"in d&&(r=d.ns)}return{host:e,port:a,domain:t,subdomain:s,secure:o,scheme:l,pathString:i,namespace:r}};var Bo="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",fu=function(){let n=0,e=[];return function(t){let s=t===n;n=t;let i,r=new Array(8);for(i=7;i>=0;i--)r[i]=Bo.charAt(t%64),t=Math.floor(t/64);f(t===0,"Cannot push at time == 0");let o=r.join("");if(s){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=Bo.charAt(e[i]);return f(o.length===20,"nextPushId: Length should be 20."),o}}();var Cn=class{constructor(e,t,s,i){this.eventType=e,this.eventRegistration=t,this.snapshot=s,this.prevName=i}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+R(this.snapshot.exportVal())}},En=class{constructor(e,t,s){this.eventRegistration=e,this.error=t,this.path=s}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var kt=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return f(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var Tn=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new M;return nu(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){G("OnDisconnect.remove",this._path);let e=new M;return Uo(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){G("OnDisconnect.set",this._path),se("OnDisconnect.set",e,this._path,!1);let t=new M;return Uo(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){G("OnDisconnect.setWithPriority",this._path),se("OnDisconnect.setWithPriority",e,this._path,!1),Di("OnDisconnect.setWithPriority",t,!1);let s=new M;return su(this._repo,this._path,e,t,s.wrapCallback(()=>{})),s.promise}update(e){G("OnDisconnect.update",this._path),Fl("OnDisconnect.update",e,this._path,!1);let t=new M;return iu(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var W=class n{constructor(e,t,s,i){this._repo=e,this._path=t,this._queryParams=s,this._orderByCalled=i}get key(){return v(this._path)?null:gi(this._path)}get ref(){return new H(this._repo,this._path)}get _queryIdentifier(){let e=bo(this._queryParams),t=_i(e);return t==="{}"?"default":t}get _queryObject(){return bo(this._queryParams)}isEqual(e){if(e=V(e),!(e instanceof n))return!1;let t=this._repo===e._repo,s=mi(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&s&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+wc(this._path)}};function Vn(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function we(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===ee){let s="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==pe)throw new Error(s);if(typeof e!="string")throw new Error(i)}if(n.hasEnd()){if(n.getIndexEndName()!==ie)throw new Error(s);if(typeof t!="string")throw new Error(i)}}else if(n.getIndex()===S){if(e!=null&&!Pt(e)||t!=null&&!Pt(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(f(n.getIndex()instanceof wt||n.getIndex()===wi,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Gn(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var H=class n extends W{constructor(e,t){super(e,t,new It,!1)}get parent(){let e=cl(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},Xe=class n{constructor(e,t,s){this._node=e,this.ref=t,this._index=s}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new E(e),s=ve(this.ref,e);return new n(this._node.getChild(t),s,S)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(s,i)=>e(new n(i,ve(this.ref,s),S)))}hasChild(e){let t=new E(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function Ui(n,e){return n=V(n),n._checkNotDeleted("ref"),e!==void 0?ve(n._root,e):n._root}function Bi(n,e){n=V(n),n._checkNotDeleted("refFromURL");let t=Zs(e,n._repo.repoInfo_.nodeAdmin);Wl("refFromURL",t);let s=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&s.host!==n._repo.repoInfo_.host&&te("refFromURL: Host name does not match the current database: (found "+s.host+" but expected "+n._repo.repoInfo_.host+")"),Ui(n,t.path.toString())}function ve(n,e){return n=V(n),y(n._path)===null?qh("child","path",e,!1):tt("child","path",e,!1),new H(n._repo,b(n._path,e))}function Yl(n,e){n=V(n),G("push",n._path),se("push",e,n._path,!0);let t=Gl(n._repo),s=fu(t),i=ve(n,s),r=ve(n,s),o;return e!=null?o=jn(r,e).then(()=>r):o=Promise.resolve(r),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function ql(n){return G("remove",n._path),jn(n,null)}function jn(n,e){n=V(n),G("set",n._path),se("set",e,n._path,!1);let t=new M;return Li(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function zl(n,e){n=V(n),G("setPriority",n._path),Di("setPriority",e,!1);let t=new M;return Li(n._repo,b(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function $l(n,e,t){if(G("setWithPriority",n._path),se("setWithPriority",e,n._path,!1),Di("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";let s=new M;return Li(n._repo,n._path,e,t,s.wrapCallback(()=>{})),s.promise}function Xl(n,e){Fl("update",e,n._path,!1);let t=new M;return eu(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function Jl(n){n=V(n);let e=new kt(()=>{}),t=new At(e);return Zh(n._repo,n,t).then(s=>new Xe(s,new H(n._repo,n._path),n._queryParams.getIndex()))}var At=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let s=t._queryParams.getIndex();return new Cn("value",this,new Xe(e.snapshotNode,new H(t._repo,t._path),s))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new En(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},In=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new En(this,e,t):null}createEvent(e,t){f(e.childName!=null,"Child events should have a childName.");let s=ve(new H(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new Cn(e.type,this,new Xe(e.snapshotNode,s,i),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function Bt(n,e,t,s,i){let r;if(typeof s=="object"&&(r=void 0,i=s),typeof s=="function"&&(r=s),i&&i.onlyOnce){let a=t,c=(h,u)=>{Js(n._repo,n,l),a(h,u)};c.userCallback=t.userCallback,c.context=t.context,t=c}let o=new kt(t,r||void 0),l=e==="value"?new At(o):new In(e,o);return ru(n._repo,n,l),()=>Js(n._repo,n,l)}function Hn(n,e,t,s){return Bt(n,"value",e,t,s)}function Vi(n,e,t,s){return Bt(n,"child_added",e,t,s)}function Gi(n,e,t,s){return Bt(n,"child_changed",e,t,s)}function ji(n,e,t,s){return Bt(n,"child_moved",e,t,s)}function Hi(n,e,t,s){return Bt(n,"child_removed",e,t,s)}function Ki(n,e,t){let s=null,i=t?new kt(t):null;e==="value"?s=new At(i):e&&(s=new In(e,i)),Js(n._repo,n,s)}var K=class{},Sn=class extends K{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){se("endAt",this._value,e._path,!0);let t=Ps(e._queryParams,this._value,this._key);if(Gn(t),we(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new W(e._repo,e._path,t,e._orderByCalled)}};function Zl(n,e){return Wt("endAt","key",e,!0),new Sn(n,e)}var ei=class extends K{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){se("endBefore",this._value,e._path,!1);let t=Uc(e._queryParams,this._value,this._key);if(Gn(t),we(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new W(e._repo,e._path,t,e._orderByCalled)}};function ea(n,e){return Wt("endBefore","key",e,!0),new ei(n,e)}var bn=class extends K{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){se("startAt",this._value,e._path,!0);let t=Rs(e._queryParams,this._value,this._key);if(Gn(t),we(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new W(e._repo,e._path,t,e._orderByCalled)}};function ta(n=null,e){return Wt("startAt","key",e,!0),new bn(n,e)}var ti=class extends K{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){se("startAfter",this._value,e._path,!1);let t=Wc(e._queryParams,this._value,this._key);if(Gn(t),we(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new W(e._repo,e._path,t,e._orderByCalled)}};function na(n,e){return Wt("startAfter","key",e,!0),new ti(n,e)}var ni=class extends K{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new W(e._repo,e._path,Lc(e._queryParams,this._limit),e._orderByCalled)}};function sa(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new ni(n)}var si=class extends K{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new W(e._repo,e._path,Fc(e._queryParams,this._limit),e._orderByCalled)}};function ia(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new si(n)}var ii=class extends K{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){Vn(e,"orderByChild");let t=new E(this._path);if(v(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let s=new wt(t),i=Rn(e._queryParams,s);return we(i),new W(e._repo,e._path,i,!0)}};function ra(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return tt("orderByChild","path",n,!1),new ii(n)}var ri=class extends K{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){Vn(e,"orderByKey");let t=Rn(e._queryParams,ee);return we(t),new W(e._repo,e._path,t,!0)}};function oa(){return new ri}var oi=class extends K{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){Vn(e,"orderByPriority");let t=Rn(e._queryParams,S);return we(t),new W(e._repo,e._path,t,!0)}};function la(){return new oi}var li=class extends K{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){Vn(e,"orderByValue");let t=Rn(e._queryParams,wi);return we(t),new W(e._repo,e._path,t,!0)}};function aa(){return new li}var ai=class extends K{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(se("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Sn(this._value,this._key)._apply(new bn(this._value,this._key)._apply(e))}};function ca(n,e){return Wt("equalTo","key",e,!0),new ai(n,e)}function z(n,...e){let t=V(n);for(let s of e)t=s._apply(t);return t}wh(H);Sh(H);var _u="FIREBASE_DATABASE_EMULATOR_HOST",ci={},pu=!1;function gu(n,e,t,s){n.repoInfo_=new tn(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),s&&(n.authTokenProvider_=s)}function Qi(n,e,t,s,i){let r=s||n.options.databaseURL;r===void 0&&(n.options.projectId||te("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),x("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=Zs(r,i),l=o.repoInfo,a,c;typeof process<"u"&&process.env&&(c=process.env[_u]),c?(a=!0,r=`http://${c}?ns=${l.namespace}`,o=Zs(r,i),l=o.repoInfo):a=!o.repoInfo.secure;let h=i&&a?new _t(_t.OWNER):new fs(n.name,n.options,e);Wl("Invalid Firebase Database URL",o),v(o.path)||te("Database URL must point to the root of a Firebase Database (not including a child path).");let u=yu(l,n,h,new ds(n.name,t));return new hi(u,n)}function mu(n,e){let t=ci[e];(!t||t[n.key]!==n)&&te(`Database ${e}(${n.repoInfo_}) has already been deleted.`),jl(n),delete t[n.key]}function yu(n,e,t,s){let i=ci[e.name];i||(i={},ci[e.name]=i);let r=i[n.toURLString()];return r&&te("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Xs(n,pu,t,s),i[n.toURLString()]=r,r}var hi=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Xh(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new H(this._repo,C())),this._rootInternal}_delete(){return this._rootInternal!==null&&(mu(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&te("Cannot call "+e+" on a deleted database.")}};function ha(){al.IS_TRANSPORT_INITIALIZED&&D("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function ua(){ha(),yt.forceDisallow()}function da(){ha(),Ve.forceDisallow(),yt.forceAllow()}function fa(n,e,t,s={}){n=V(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&te("Cannot call useEmulator() after instance has already been initialized.");let i=n._repoInternal,r;if(i.repoInfo_.nodeAdmin)s.mockUserToken&&te('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new _t(_t.OWNER);else if(s.mockUserToken){let o=typeof s.mockUserToken=="string"?s.mockUserToken:Pr(s.mockUserToken,n.app.options.projectId);r=new _t(o)}gu(i,e,t,r)}function _a(n){n=V(n),n._checkNotDeleted("goOffline"),jl(n._repo)}function pa(n){n=V(n),n._checkNotDeleted("goOnline"),ou(n._repo)}function ga(n,e){Ho(n,e)}function vu(n){fi(Wr),Fr(new Ue("database",(e,{instanceIdentifier:t})=>{let s=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return Qi(s,i,r,t)},"PUBLIC").setMultipleInstances(!0)),es(ao,co,n),es(ao,co,"esm2017")}var wu={".sv":"timestamp"};function ma(){return wu}function ya(n){return{".sv":{increment:n}}}var ui=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function va(n,e,t){var s;if(n=V(n),G("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";let i=(s=t==null?void 0:t.applyLocally)!==null&&s!==void 0?s:!0,r=new M,o=(a,c,h)=>{let u=null;a?r.reject(a):(u=new Xe(h,new H(n._repo,n._path),S),r.resolve(new ui(c,u)))},l=Hn(n,()=>{});return lu(n._repo,n._path,e,o,l,i),r.promise}yi.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};yi.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};vu();var Cu="@firebase/database-compat",Eu="1.0.4";var Tu=new $t("@firebase/database-compat"),wa=function(n){let e="FIREBASE WARNING: "+n;Tu.warn(e)};var Iu=function(n,e,t,s){if(!(s&&t===void 0)&&typeof t!="boolean")throw new Error(B(n,e)+"must be a boolean.")},Su=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(B(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var Yi=class{constructor(e){this._delegate=e}cancel(e){g("OnDisconnect.cancel",0,1,arguments.length),A("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),s=>e(s)),t}remove(e){g("OnDisconnect.remove",0,1,arguments.length),A("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),s=>e(s)),t}set(e,t){g("OnDisconnect.set",1,2,arguments.length),A("OnDisconnect.set","onComplete",t,!0);let s=this._delegate.set(e);return t&&s.then(()=>t(null),i=>t(i)),s}setWithPriority(e,t,s){g("OnDisconnect.setWithPriority",2,3,arguments.length),A("OnDisconnect.setWithPriority","onComplete",s,!0);let i=this._delegate.setWithPriority(e,t);return s&&i.then(()=>s(null),r=>s(r)),i}update(e,t){if(g("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let r=0;r<e.length;++r)i[""+r]=e[r];e=i,wa("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}A("OnDisconnect.update","onComplete",t,!0);let s=this._delegate.update(e);return t&&s.then(()=>t(null),i=>t(i)),s}};var qi=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return g("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var xe=class n{constructor(e,t){this._database=e,this._delegate=t}val(){return g("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return g("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return g("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return g("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return g("DataSnapshot.child",0,1,arguments.length),e=String(e),tt("DataSnapshot.child","path",e,!1),new n(this._database,this._delegate.child(e))}hasChild(e){return g("DataSnapshot.hasChild",1,1,arguments.length),tt("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return g("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return g("DataSnapshot.forEach",1,1,arguments.length),A("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new n(this._database,t)))}hasChildren(){return g("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return g("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return g("DataSnapshot.ref",0,0,arguments.length),new re(this._database,this._delegate.ref)}get ref(){return this.getRef()}},Kn=class n{constructor(e,t){this.database=e,this._delegate=t}on(e,t,s,i){var r;g("Query.on",2,4,arguments.length),A("Query.on","callback",t,!1);let o=n.getCancelAndContextArgs_("Query.on",s,i),l=(c,h)=>{t.call(o.context,new xe(this.database,c),h)};l.userCallback=t,l.context=o.context;let a=(r=o.cancel)===null||r===void 0?void 0:r.bind(o.context);switch(e){case"value":return Hn(this._delegate,l,a),t;case"child_added":return Vi(this._delegate,l,a),t;case"child_removed":return Hi(this._delegate,l,a),t;case"child_changed":return Gi(this._delegate,l,a),t;case"child_moved":return ji(this._delegate,l,a),t;default:throw new Error(B("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,s){if(g("Query.off",0,3,arguments.length),Su("Query.off",e,!0),A("Query.off","callback",t,!0),Jn("Query.off","context",s,!0),t){let i=()=>{};i.userCallback=t,i.context=s,Ki(this._delegate,e,i)}else Ki(this._delegate,e)}get(){return Jl(this._delegate).then(e=>new xe(this.database,e))}once(e,t,s,i){g("Query.once",1,4,arguments.length),A("Query.once","callback",t,!0);let r=n.getCancelAndContextArgs_("Query.once",s,i),o=new M,l=(c,h)=>{let u=new xe(this.database,c);t&&t.call(r.context,u,h),o.resolve(u)};l.userCallback=t,l.context=r.context;let a=c=>{r.cancel&&r.cancel.call(r.context,c),o.reject(c)};switch(e){case"value":Hn(this._delegate,l,a,{onlyOnce:!0});break;case"child_added":Vi(this._delegate,l,a,{onlyOnce:!0});break;case"child_removed":Hi(this._delegate,l,a,{onlyOnce:!0});break;case"child_changed":Gi(this._delegate,l,a,{onlyOnce:!0});break;case"child_moved":ji(this._delegate,l,a,{onlyOnce:!0});break;default:throw new Error(B("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return g("Query.limitToFirst",1,1,arguments.length),new n(this.database,z(this._delegate,sa(e)))}limitToLast(e){return g("Query.limitToLast",1,1,arguments.length),new n(this.database,z(this._delegate,ia(e)))}orderByChild(e){return g("Query.orderByChild",1,1,arguments.length),new n(this.database,z(this._delegate,ra(e)))}orderByKey(){return g("Query.orderByKey",0,0,arguments.length),new n(this.database,z(this._delegate,oa()))}orderByPriority(){return g("Query.orderByPriority",0,0,arguments.length),new n(this.database,z(this._delegate,la()))}orderByValue(){return g("Query.orderByValue",0,0,arguments.length),new n(this.database,z(this._delegate,aa()))}startAt(e=null,t){return g("Query.startAt",0,2,arguments.length),new n(this.database,z(this._delegate,ta(e,t)))}startAfter(e=null,t){return g("Query.startAfter",0,2,arguments.length),new n(this.database,z(this._delegate,na(e,t)))}endAt(e=null,t){return g("Query.endAt",0,2,arguments.length),new n(this.database,z(this._delegate,Zl(e,t)))}endBefore(e=null,t){return g("Query.endBefore",0,2,arguments.length),new n(this.database,z(this._delegate,ea(e,t)))}equalTo(e,t){return g("Query.equalTo",1,2,arguments.length),new n(this.database,z(this._delegate,ca(e,t)))}toString(){return g("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return g("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(g("Query.isEqual",1,1,arguments.length),!(e instanceof n)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,s){let i={cancel:void 0,context:void 0};if(t&&s)i.cancel=t,A(e,"cancel",i.cancel,!0),i.context=s,Jn(e,"context",i.context,!0);else if(t)if(typeof t=="object"&&t!==null)i.context=t;else if(typeof t=="function")i.cancel=t;else throw new Error(B(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return i}get ref(){return new re(this.database,new H(this._delegate._repo,this._delegate._path))}},re=class n extends Kn{constructor(e,t){super(e,new W(t._repo,t._path,new It,!1)),this.database=e,this._delegate=t}getKey(){return g("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return g("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new n(this.database,ve(this._delegate,e))}getParent(){g("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new n(this.database,e):null}getRoot(){return g("Reference.root",0,0,arguments.length),new n(this.database,this._delegate.root)}set(e,t){g("Reference.set",1,2,arguments.length),A("Reference.set","onComplete",t,!0);let s=jn(this._delegate,e);return t&&s.then(()=>t(null),i=>t(i)),s}update(e,t){if(g("Reference.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let r=0;r<e.length;++r)i[""+r]=e[r];e=i,wa("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}G("Reference.update",this._delegate._path),A("Reference.update","onComplete",t,!0);let s=Xl(this._delegate,e);return t&&s.then(()=>t(null),i=>t(i)),s}setWithPriority(e,t,s){g("Reference.setWithPriority",2,3,arguments.length),A("Reference.setWithPriority","onComplete",s,!0);let i=$l(this._delegate,e,t);return s&&i.then(()=>s(null),r=>s(r)),i}remove(e){g("Reference.remove",0,1,arguments.length),A("Reference.remove","onComplete",e,!0);let t=ql(this._delegate);return e&&t.then(()=>e(null),s=>e(s)),t}transaction(e,t,s){g("Reference.transaction",1,3,arguments.length),A("Reference.transaction","transactionUpdate",e,!1),A("Reference.transaction","onComplete",t,!0),Iu("Reference.transaction","applyLocally",s,!0);let i=va(this._delegate,e,{applyLocally:s}).then(r=>new qi(r.committed,new xe(this.database,r.snapshot)));return t&&i.then(r=>t(null,r.committed,r.snapshot),r=>t(r,!1,null)),i}setPriority(e,t){g("Reference.setPriority",1,2,arguments.length),A("Reference.setPriority","onComplete",t,!0);let s=zl(this._delegate,e);return t&&s.then(()=>t(null),i=>t(i)),s}push(e,t){g("Reference.push",0,2,arguments.length),A("Reference.push","onComplete",t,!0);let s=Yl(this._delegate,e),i=s.then(o=>new n(this.database,o));t&&i.then(()=>t(null),o=>t(o));let r=new n(this.database,s);return r.then=i.then.bind(i),r.catch=i.catch.bind(i,void 0),r}onDisconnect(){return G("Reference.onDisconnect",this._delegate._path),new Yi(new Tn(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var Oe=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:ua,forceLongPolling:da}}useEmulator(e,t,s={}){fa(this._delegate,e,t,s)}ref(e){if(g("database.ref",0,1,arguments.length),e instanceof re){let t=Bi(this._delegate,e.toString());return new re(this,t)}else{let t=Ui(this._delegate,e);return new re(this,t)}}refFromURL(e){g("database.refFromURL",1,1,arguments.length);let s=Bi(this._delegate,e);return new re(this,s)}goOffline(){return g("database.goOffline",0,0,arguments.length),_a(this._delegate)}goOnline(){return g("database.goOnline",0,0,arguments.length),pa(this._delegate)}};Oe.ServerValue={TIMESTAMP:ma(),increment:n=>ya(n)};function bu({app:n,url:e,version:t,customAuthImpl:s,customAppCheckImpl:i,namespace:r,nodeAdmin:o=!1}){fi(t);let l=new Zn("database-standalone"),a=new zt("auth-internal",l);a.setComponent(new Ue("auth-internal",()=>s,"PRIVATE"));let c;return i&&(c=new zt("app-check-internal",l),c.setComponent(new Ue("app-check-internal",()=>i,"PRIVATE"))),{instance:new Oe(Qi(n,a,c,e,o),n),namespace:r}}var Nu=Object.freeze({__proto__:null,initStandalone:bu});var Ru=Oe.ServerValue;function Pu(n){n.INTERNAL.registerComponent(new Ue("database-compat",(e,{instanceIdentifier:t})=>{let s=e.getProvider("app-compat").getImmediate(),i=e.getProvider("database").getImmediate({identifier:t});return new Oe(i,s)},"PUBLIC").setServiceProps({Reference:re,Query:Kn,Database:Oe,DataSnapshot:xe,enableLogging:ga,INTERNAL:Nu,ServerValue:Ru}).setMultipleInstances(!0)),n.registerVersion(Cu,Eu)}Pu(Xt);function Vt(n,e,t="on",s=Zi){return new Xi(i=>{let r=null;return r=n[t](e,(o,l)=>{s.schedule(()=>{i.next({snapshot:o,prevKey:l})}),t==="once"&&s.schedule(()=>i.complete())},o=>{s.schedule(()=>i.error(o))}),t==="on"?{unsubscribe(){r!=null&&n.off(e,r)}}:{unsubscribe(){}}}).pipe(U(i=>{let{snapshot:r,prevKey:o}=i,l=null;return r.exists()&&(l=r.key),{type:e,payload:r,prevKey:o,key:l}}),rr())}function ku(n){return typeof n=="string"}function Au(n){return typeof n.exportVal=="function"}function Sa(n){return n==null}function ba(n){return typeof n.set=="function"}function Ca(n,e){return ba(e)?e:n.ref(e)}function Na(n,e){if(ku(n))return e.stringCase();if(ba(n))return e.firebaseCase();if(Au(n))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof n}`)}function Ra(n){return(Sa(n)||n.length===0)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function Pa(n,e,t){e=Ra(e);let s=e.map(i=>Vt(n,i,"on",t));return Me(...s)}function xu(n,e,t){let s=Pa(n,e).pipe(qn((i,r)=>[...i,r],[]));return Du(n,s,t)}function Ou(n,e){return Vt(n,"value","on",e).pipe(U(t=>{let s;return t.payload.forEach(i=>(s=i.key,!1)),{data:t,lastKeyToLoad:s}}))}function Du(n,e,t){return Ou(n,t).pipe(ar(e),U(([i,r])=>{let o=i.lastKeyToLoad,l=r.map(a=>a.key);return{actions:r,lastKeyToLoad:o,loadedKeys:l}}),or(i=>i.loadedKeys.indexOf(i.lastKeyToLoad)===-1),U(i=>i.actions))}function Ea(n,e){return function(s,i){return Na(s,{stringCase:()=>n.child(s)[e](i),firebaseCase:()=>s[e](i),snapshotCase:()=>s.ref[e](i)})}}function Mu(n){return function(t){return t?Na(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function Lu(n,e,t){return Vt(n,"value","once",t).pipe(Te(s=>{let i=[De(s)];return e.forEach(r=>i.push(Vt(n,r,"on",t))),Me(...i).pipe(qn(Wu,[]))}),sr())}function ka(n,e){let t=n.length;for(let s=0;s<t;s++)if(n[s].payload.key===e)return s;return-1}function Fu(n,e){if(Sa(e))return 0;{let t=ka(n,e);return t===-1?n.length:t+1}}function Wu(n,e){var l;let{payload:t,prevKey:s,key:i}=e,r=ka(n,i),o=Fu(n,s);switch(e.type){case"value":if((l=e.payload)!=null&&l.exists()){let a=null;e.payload.forEach(c=>{let h={payload:c,type:"value",prevKey:a,key:c.key};return a=c.key,n=[...n,h],!1})}return n;case"child_added":if(r>-1){let a=n[r-1];((a==null?void 0:a.key)||null)!==s&&(n=n.filter(c=>c.payload.key!==t.key),n.splice(o,0,e))}else{if(s==null)return[e,...n];n=n.slice(),n.splice(o,0,e)}return n;case"child_removed":return n.filter(a=>a.payload.key!==t.key);case"child_changed":return n.map(a=>a.payload.key===i?e:a);case"child_moved":if(r>-1){let a=n.splice(r,1)[0];return n=n.slice(),n.splice(o,0,a),n}return n;default:return n}}function Ta(n,e,t){return e=Ra(e),Lu(n,e,t)}function Uu(n,e){let t=e.schedulers.outsideAngular,s=e.schedulers.ngZone.run(()=>n.ref);return{query:n,update:Ea(s,"update"),set:Ea(s,"set"),push:i=>s.push(i),remove:Mu(s),snapshotChanges(i){return Ta(n,i,t).pipe(Ie)},stateChanges(i){return Pa(n,i,t).pipe(Ie)},auditTrail(i){return xu(n,i,t).pipe(Ie)},valueChanges(i,r){return Ta(n,i,t).pipe(U(l=>l.map(a=>r&&r.idField?zi(Kt({},a.payload.val()),{[r.idField]:a.key}):a.payload.val())),Ie)}}}function Ia(n,e){return function(){return Vt(n,"value","on",e)}}function Bu(n,e){return{query:n,snapshotChanges(){return Ia(n,e.schedulers.outsideAngular)().pipe(Ie)},update(t){return n.ref.update(t)},set(t){return n.ref.set(t)},remove(){return n.ref.remove()},valueChanges(){return Ia(n,e.schedulers.outsideAngular)().pipe(Ie,U(s=>s.payload.exists()?s.payload.val():null))}}}var Vu=new rt("angularfire2.realtimeDatabaseURL"),Gu=new rt("angularfire2.database.use-emulator"),ju=(()=>{let e=class e{constructor(s,i,r,o,l,a,c,h,u,d,_,p,T,P,Ce){ae(this,"schedulers");ae(this,"database");this.schedulers=a;let oe=c,le=Hr(s,l,i);h&&Zr(le,l,u,_,p,T,d,P),this.database=Qr(`${le.name}.database.${r}`,"AngularFireDatabase",le.name,()=>{let Ht=l.runOutsideAngular(()=>le.database(r||void 0));return oe&&Ht.useEmulator(...oe),Ht},[oe])}list(s,i){let r=this.schedulers.ngZone.runOutsideAngular(()=>Ca(this.database,s)),o=r;return i&&(o=i(r)),Uu(o,this)}object(s){let i=this.schedulers.ngZone.runOutsideAngular(()=>Ca(this.database,s));return Bu(i,this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}};ae(e,"\u0275fac",function(i){return new(i||e)(k(Gr),k(jr,8),k(Vu,8),k(ot),k(Qt),k(Vr),k(Gu,8),k(eo,8),k(Yr,8),k(qr,8),k(zr,8),k($r,8),k(Xr,8),k(Jr,8),k(Br,8))}),ae(e,"\u0275prov",it({token:e,factory:e.\u0275fac,providedIn:"any"}));let n=e;return n})(),Aa=(()=>{let e=class e{constructor(){Xt.registerVersion("angularfire",Ur.full,"rtdb-compat")}};ae(e,"\u0275fac",function(i){return new(i||e)}),ae(e,"\u0275mod",he({type:e})),ae(e,"\u0275inj",ce({providers:[ju]}));let n=e;return n})();var jt="Service workers are disabled or not supported by this browser";function Hu(n){return Qn(()=>er(new Error(n)))}var st=class{constructor(e){if(this.serviceWorker=e,!e)this.worker=this.events=this.registration=Hu(jt);else{let s=Yn(e,"controllerchange").pipe(U(()=>e.controller)),i=Qn(()=>De(e.controller)),r=tr(i,s);this.worker=r.pipe(Fe(h=>!!h)),this.registration=this.worker.pipe(Te(()=>e.getRegistration()));let c=Yn(e,"message").pipe(U(h=>h.data)).pipe(Fe(h=>h&&h.type)).pipe(ir());c.connect(),this.events=c}}postMessage(e,t){return this.worker.pipe(Ee(1),lr(s=>{s.postMessage(Kt({action:e},t))})).toPromise().then(()=>{})}postMessageWithOperation(e,t,s){let i=this.waitForOperationCompleted(s),r=this.postMessage(e,t);return Promise.all([r,i]).then(([,o])=>o)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(e){let t;return typeof e=="string"?t=s=>s.type===e:t=s=>e.includes(s.type),this.events.pipe(Fe(t))}nextEventOfType(e){return this.eventsOfType(e).pipe(Ee(1))}waitForOperationCompleted(e){return this.eventsOfType("OPERATION_COMPLETED").pipe(Fe(t=>t.nonce===e),Ee(1),U(t=>{if(t.result!==void 0)return t.result;throw new Error(t.error)})).toPromise()}get isEnabled(){return!!this.serviceWorker}},Ma=(()=>{let e=class e{get isEnabled(){return this.sw.isEnabled}constructor(s){if(this.sw=s,this.pushManager=null,this.subscriptionChanges=new Ji,!s.isEnabled){this.messages=Le,this.notificationClicks=Le,this.subscription=Le;return}this.messages=this.sw.eventsOfType("PUSH").pipe(U(r=>r.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(U(r=>r.data)),this.pushManager=this.sw.registration.pipe(U(r=>r.pushManager));let i=this.pushManager.pipe(Te(r=>r.getSubscription()));this.subscription=Me(i,this.subscriptionChanges)}requestSubscription(s){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(jt));let i={userVisibleOnly:!0},r=this.decodeBase64(s.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),o=new Uint8Array(new ArrayBuffer(r.length));for(let l=0;l<r.length;l++)o[l]=r.charCodeAt(l);return i.applicationServerKey=o,this.pushManager.pipe(Te(l=>l.subscribe(i)),Ee(1)).toPromise().then(l=>(this.subscriptionChanges.next(l),l))}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(jt));let s=i=>{if(i===null)throw new Error("Not subscribed to push notifications.");return i.unsubscribe().then(r=>{if(!r)throw new Error("Unsubscribe failed!");this.subscriptionChanges.next(null)})};return this.subscription.pipe(Ee(1),Te(s)).toPromise()}decodeBase64(s){return atob(s)}};e.\u0275fac=function(i){return new(i||e)(k(st))},e.\u0275prov=it({token:e,factory:e.\u0275fac});let n=e;return n})(),La=(()=>{let e=class e{get isEnabled(){return this.sw.isEnabled}constructor(s){if(this.sw=s,!s.isEnabled){this.versionUpdates=Le,this.unrecoverable=Le;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(jt));let s=this.sw.generateNonce();return this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:s},s)}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(jt));let s=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:s},s)}};e.\u0275fac=function(i){return new(i||e)(k(st))},e.\u0275prov=it({token:e,factory:e.\u0275fac});let n=e;return n})();var xa=new rt("");function Ku(n,e,t,s){return()=>{if(!(zn(s)&&"serviceWorker"in navigator&&t.enabled!==!1))return;navigator.serviceWorker.addEventListener("controllerchange",()=>{navigator.serviceWorker.controller!==null&&navigator.serviceWorker.controller.postMessage({action:"INITIALIZE"})});let i;if(typeof t.registrationStrategy=="function")i=t.registrationStrategy();else{let[o,...l]=(t.registrationStrategy||"registerWhenStable:30000").split(":");switch(o){case"registerImmediately":i=De(null);break;case"registerWithDelay":i=Oa(+l[0]||0);break;case"registerWhenStable":i=l[0]?Me(Da(n),Oa(+l[0])):Da(n);break;default:throw new Error(`Unknown ServiceWorker registration strategy: ${t.registrationStrategy}`)}}n.get(Qt).runOutsideAngular(()=>i.pipe(Ee(1)).subscribe(()=>navigator.serviceWorker.register(e,{scope:t.scope}).catch(o=>console.error("Service worker registration failed with:",o))))}}function Oa(n){return De(null).pipe(nr(n))}function Da(n){return n.get(gr).isStable.pipe(Fe(t=>t))}function Qu(n,e){return new st(zn(e)&&n.enabled!==!1?navigator.serviceWorker:void 0)}var Gt=class{};function Yu(n,e={}){return hr([Ma,La,{provide:xa,useValue:n},{provide:Gt,useValue:e},{provide:st,useFactory:Qu,deps:[Gt,ot]},{provide:pr,useFactory:Ku,deps:[ur,xa,Gt,ot],multi:!0}])}var Fa=(()=>{let e=class e{static register(s,i={}){return{ngModule:e,providers:[Yu(s,i)]}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=he({type:e}),e.\u0275inj=ce({providers:[Ma,La]});let n=e;return n})();var qu={apiKey:"AIzaSyAGXu3ywY7UaUrzuwVsgEqMPzDBFnuc-mE",authDomain:"wedpic-e01ad.firebaseapp.com",projectId:"wedpic-e01ad",storageBucket:"wedpic-e01ad.appspot.com",messagingSenderId:"610917643067",appId:"1:610917643067:web:9ddfc3bcf91fa167cbfd1e",measurementId:"G-2Y5G69TZXT"},Wa=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=he({type:e,bootstrap:[lo]}),e.\u0275inj=ce({providers:[{provide:wr,useClass:Er}],imports:[vr,Sr.forRoot(),oo,Kr.initializeApp(qu),Aa,no,to,so,Fa.register("ngsw-worker.js",{enabled:!mr(),registrationStrategy:"registerWhenStable:30000"})]});let n=e;return n})();var Ua={production:!0};var zu=()=>ro(),Ba=(n,e)=>typeof window>"u"?Promise.resolve():zu().then(()=>io([["pwa-camera-modal",[[1,"pwa-camera-modal",{facingMode:[1,"facing-mode"],present:[64],dismiss:[64]}]]],["pwa-action-sheet",[[1,"pwa-action-sheet",{header:[1],cancelable:[4],options:[16],open:[32]}]]],["pwa-toast",[[1,"pwa-toast",{message:[1],duration:[2],closing:[32]}]]],["pwa-camera",[[1,"pwa-camera",{facingMode:[1,"facing-mode"],handlePhoto:[16],handleNoDeviceError:[16],noDevicesText:[1,"no-devices-text"],noDevicesButtonText:[1,"no-devices-button-text"],photo:[32],photoSrc:[32],showShutterOverlay:[32],flashIndex:[32],hasCamera:[32],rotation:[32],deviceError:[32]}]]],["pwa-camera-modal-instance",[[1,"pwa-camera-modal-instance",{facingMode:[1,"facing-mode"],noDevicesText:[1,"no-devices-text"],noDevicesButtonText:[1,"no-devices-button-text"]},[[16,"keyup","handleBackdropKeyUp"]]]]]],e));Ba(window);Ua.production&&void 0;yr().bootstrapModule(Wa).catch(n=>console.log(n));
